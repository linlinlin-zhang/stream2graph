{
  "id": "gh_architecture_01634",
  "source": "github",
  "diagram_type": "architecture",
  "code": "graph TD\n    %% Users and Interface\n    User([User]) -->|Accesses| WebApp[Streamlit Web App]\n    User -->|CLI Commands| CLI[CLI Interface]\n    \n    %% Authentication Flow\n    WebApp -->|Authentication| AzureAuth[Azure AD Authentication]\n    AzureAuth -->|Valid credentials| ChatInterface[Chat Interface]\n    AzureAuth -->|Admin access| AdminInterface[Admin Interface]\n    \n    %% Main Chat Flow\n    User -->|Asks question| ChatInterface\n    ChatInterface -->|Query| SemanticPipeline[Semantic RAG Pipeline]\n    \n    %% Semantic Processing Pipeline\n    SemanticPipeline -->|Reformulate query| ReformulationService[Service]\n    ReformulationService -->|LLM call| LLM\n    LLM -->|Reformulated query| ReformulationService\n    ReformulationService -->|Resolved query| SemanticRetrieval[Vector Retrieval Tool]\n    SemanticRetrieval -->|Vector search| WeaviateDB[(Weaviate Vector DB<br>Collection: isschat_docs)]\n    WeaviateDB -->|Relevant documents| SemanticRetrieval\n    SemanticRetrieval -->|Ranked results| GenerationTool[Generation Tool]\n    GenerationTool -->|Context + prompt| LLM[Gemini 2.5 Flash Lite]\n    LLM -->|Generated response| GenerationTool\n    GenerationTool -->|Final answer + sources| ChatInterface\n    \n    %% Data Storage & Management\n    GenerationTool -->|Save conversation| DataManager[Data Manager]\n    DataManager -->|Store data| StorageSystem{Storage System}\n    StorageSystem -->|Local| LocalStorage[(Local File Storage)]\n    StorageSystem -->|Cloud| AzureStorage[(Azure Blob Storage)]\n    \n    %% Features & History\n    ChatInterface -->|User feedback| FeaturesManager[Features Manager]\n    ChatInterface -->|Conversation history| HistoryManager[History Manager]\n    FeaturesManager -->|Feedback data| DataManager\n    HistoryManager -->|Load/save history| DataManager\n    \n    %% CLI Operations\n    CLI -->|Ingest command| IngestionPipeline[Confluence Ingestion Pipeline]\n    CLI -->|Status command| StatusCheck[System Status Check]\n    CLI -->|Query command| SemanticPipeline\n    CLI -->|Chat command| InteractiveCLI[Interactive CLI Chat]\n    \n    %% Data Ingestion Flow\n    IngestionPipeline -->|Extract| ConfluenceConnector[Confluence Connector]\n    ConfluenceConnector -->|Fetch pages| ConfluenceAPI[Confluence API]\n    ConfluenceConnector -->|Raw documents| DocumentProcessor[Document Processor]\n    DocumentProcessor -->|Clean & structure| DocumentChunker[Document Chunker]\n    DocumentChunker -->|Text chunks| EmbeddingService[Embedding Service<br>multilingual-e5-small]\n    EmbeddingService -->|Vector embeddings| WeaviateDB\n    \n    %% Configuration & Secrets\n    SemanticPipeline -.->|Config| ConfigManager[Configuration Manager]\n    ConfigManager -.->|Secrets| KeyVault[Azure Key Vault]\n    ConfigManager -.->|Settings| EnvFile[Environment Variables]\n    \n    %% Performance & Monitoring\n    AdminInterface -->|View metrics| PerformanceDashboard[Performance Dashboard]\n    PerformanceDashboard -->|Query stats| DataManager\n    \n    %% Subgraphs for organization\n    subgraph \"User Interface Layer\"\n        User\n        WebApp\n        CLI\n        ChatInterface\n        AdminInterface\n        InteractiveCLI\n    end\n    \n    subgraph \"Authentication & Authorization\"\n        AzureAuth\n        KeyVault\n    end\n    \n    subgraph \"RAG Processing Engine\"\n        SemanticPipeline\n        ReformulationService\n        SemanticRetrieval\n        GenerationTool\n        LLM\n    end\n    \n    subgraph \"Data Storage Layer\"\n        WeaviateDB\n        DataManager\n        StorageSystem\n        LocalStorage\n        AzureStorage\n    end\n    \n    subgraph \"Application Components\"\n        FeaturesManager\n        HistoryManager\n        PerformanceDashboard\n        ConfigManager\n    end\n    \n    subgraph \"Data Ingestion Pipeline\"\n        IngestionPipeline\n        ConfluenceConnector\n        ConfluenceAPI\n        DocumentProcessor\n        DocumentChunker\n        EmbeddingService\n    end\n    \n    subgraph \"Configuration & Environment\"\n        ConfigManager\n        KeyVault\n        EnvFile\n    end\n    \n    %% Styling\n    classDef interface fill:#e1f5fe,stroke:#0277bd,stroke-width:2px\n    classDef auth fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px\n    classDef processing fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px\n    classDef storage fill:#fff3e0,stroke:#ef6c00,stroke-width:2px\n    classDef components fill:#fce4ec,stroke:#c2185b,stroke-width:2px\n    classDef ingestion fill:#f1f8e9,stroke:#558b2f,stroke-width:2px\n    classDef config fill:#f5f5f5,stroke:#616161,stroke-width:2px\n    \n    class User,WebApp,CLI,ChatInterface,AdminInterface,InteractiveCLI interface\n    class AzureAuth,KeyVault auth\n    class SemanticPipeline,ReformulationService,SemanticRetrieval,GenerationTool,LLM processing\n    class WeaviateDB,DataManager,StorageSystem,LocalStorage,AzureStorage storage\n    class FeaturesManager,HistoryManager,PerformanceDashboard components\n    class IngestionPipeline,ConfluenceConnector,ConfluenceAPI,DocumentProcessor,DocumentChunker,EmbeddingService ingestion\n    class ConfigManager,EnvFile config",
  "license": "mit",
  "compilation_status": "success",
  "cscw_dialogue": [
    {
      "turn_id": 1,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 [User 和 Streamlit Web App 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 2,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 '[User 和 Streamlit Web App'，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 3,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 4,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "User",
        "WebApp"
      ],
      "is_repair": false
    },
    {
      "turn_id": 5,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 CLI Interface 和 Azure AD Authentication。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 6,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 'CLI Interface 和 Azure AD Authentication'，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 7,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 8,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "CLI",
        "AzureAuth"
      ],
      "is_repair": false
    },
    {
      "turn_id": 9,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 Chat Interface 和 Admin Interface 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 10,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 'Chat Interface 和 Admin Interface'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 11,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 12,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "ChatInterface",
        "AdminInterface"
      ],
      "is_repair": false
    },
    {
      "turn_id": 13,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 Semantic RAG Pipeline 和 Service 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 14,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 'Semantic RAG Pipeline 和 Service'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 15,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 16,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "SemanticPipeline",
        "ReformulationService"
      ],
      "is_repair": false
    },
    {
      "turn_id": 17,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 Vector Retrieval Tool 和 (Weaviate Vector DB<br>Collection: isschat_docs。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 18,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 'Vector Retrieval Tool 和 (Weaviate Vector DB<br>Collection: isschat_docs'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 19,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 20,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "SemanticRetrieval",
        "WeaviateDB"
      ],
      "is_repair": false
    },
    {
      "turn_id": 21,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 Generation Tool 和 Gemini 2.5 Flash Lite 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 22,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 'Generation Tool 和 Gemini 2.5 Flash Lite'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 23,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 24,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "GenerationTool",
        "LLM"
      ],
      "is_repair": false
    },
    {
      "turn_id": 25,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 Data Manager 和 Storage System 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 26,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 'Data Manager 和 Storage System'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 27,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 28,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "DataManager",
        "StorageSystem"
      ],
      "is_repair": false
    },
    {
      "turn_id": 29,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "用户在这里会遇到 (Local File Storage 和 (Azure Blob Storage 的分支。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 30,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '(Local File Storage 和 (Azure Blob Storage'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 31,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 32,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "LocalStorage",
        "AzureStorage"
      ],
      "is_repair": false
    },
    {
      "turn_id": 33,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 Features Manager 和 History Manager。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 34,
      "role": "Domain_Expert",
      "action_type": "repair",
      "utterance": "不，其实叫 Features Manager处理 会更准确一点。",
      "elements_involved": [],
      "is_repair": true
    },
    {
      "turn_id": 35,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 'Features Manager处理'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 36,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 37,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "FeaturesManager",
        "HistoryManager"
      ],
      "is_repair": false
    },
    {
      "turn_id": 38,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 Confluence Ingestion Pipeline 和 System Status Check。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 39,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 'Confluence Ingestion Pipeline 和 System Status Check'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 40,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 41,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "IngestionPipeline",
        "StatusCheck"
      ],
      "is_repair": false
    },
    {
      "turn_id": 42,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "用户在这里会遇到 Interactive CLI Chat 和 Confluence Connector 的分支。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 43,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 'Interactive CLI Chat 和 Confluence Connector'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 44,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 45,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "InteractiveCLI",
        "ConfluenceConnector"
      ],
      "is_repair": false
    },
    {
      "turn_id": 46,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 Confluence API 和 Document Processor 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 47,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 'Confluence API 和 Document Processor'，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 48,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 49,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "ConfluenceAPI",
        "DocumentProcessor"
      ],
      "is_repair": false
    },
    {
      "turn_id": 50,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 Document Chunker 和 Embedding Service<br>multilingual-e5-small。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 51,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 'Document Chunker 和 Embedding Service<br>multilingual-e5-small'，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 52,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 53,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "DocumentChunker",
        "EmbeddingService"
      ],
      "is_repair": false
    },
    {
      "turn_id": 54,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 Configuration Manager 和 Azure Key Vault 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 55,
      "role": "Domain_Expert",
      "action_type": "repair",
      "utterance": "等等，我重新想了一下，应该是 Configuration Manager处理 才对。",
      "elements_involved": [],
      "is_repair": true
    },
    {
      "turn_id": 56,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 'Configuration Manager处理'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 57,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 58,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "ConfigManager",
        "KeyVault"
      ],
      "is_repair": false
    },
    {
      "turn_id": 59,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 Environment Variables 和 Performance Dashboard 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 60,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 'Environment Variables 和 Performance Dashboard'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 61,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 62,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "EnvFile",
        "PerformanceDashboard"
      ],
      "is_repair": false
    }
  ],
  "dialogue_metadata": {
    "total_turns": 62,
    "repair_count": 2,
    "grounding_acts_count": 30,
    "theoretical_framework": "Grounding in Communication (Clark & Brennan, 1991)"
  },
  "normalized_at": "2026-02-28T13:21:06Z",
  "extra": {
    "source_url": "https://github.com/Isskar/Isschat/blob/72d26f4ee472ccc2a90d935cc65e0fca478b1dc2/data_flow.mmd",
    "github_repo": "Isskar/Isschat",
    "github_file_path": "data_flow.mmd",
    "content_size": 5038,
    "collected_at": "2026-02-06T02:01:31.361968",
    "license_name": "MIT License",
    "license_url": "https://api.github.com/licenses/mit",
    "repo_stars": 1,
    "repo_forks": 0
  }
}