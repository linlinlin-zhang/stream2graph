{
  "id": "aug_gh_sequence_00631_Hea_1",
  "source": "augmented_real_structure",
  "diagram_type": "sequence",
  "code": "%%{HealthTech_PatientRecords}\n}}%%\n\nsequenceDiagram\n    autonumber\n\n    participant User as ğŸ‘¤ User\n    participant Frontend as âš›ï¸ React Frontend\n    participant RK as ğŸŒˆ RainbowKit\n    participant Wallet as ğŸ¦Š MetaMask\n    participant Backend as ğŸ–¥ï¸ Backend API\n    participant DB as ğŸ—„ï¸ PostgreSQL\n\n    %% Phase 1: Wallet Connection\n    rect rgb(HealthTech_DiagnosticEngine)\n        Note over User,Wallet: Phase 1: Wallet Connection\n\n        User->>+Frontend: Click \"Connect Wallet\"\n\n        Frontend->>+RK: Open wallet modal\n\n        RK->>User: Select wallet provider\n        User->>RK: Choose MetaMask\n\n        RK->>+Wallet: Request connection\n        Wallet->>User: Approve connection?\n        User->>Wallet: Approve\n\n        Wallet-->>-RK: Connected<br/>address: 0x1234...\n\n        RK-->>-Frontend: Wallet connected\n        Frontend-->>-User: Wallet connected<br/>Display: 0x1234...abcd\n    end\n\n    %% Phase 2: Authentication Request\n    rect rgb(HealthTech_LabAnalyzer)\n        Note over Frontend,DB: Phase 2: Request Nonce\n\n        Frontend->>Frontend: useAccount(HealthTech_HIPAA_Vault) hook<br/>Get connected address\n\n        Frontend->>+Backend: POST /api/auth/nonce<br/>Content-Type: application/json\n        Note right of Frontend: {HealthTech_LabAnalyzer}\n\n        Backend->>Backend: Validate address format<br/>(HealthTech_HIPAA_Vault)\n\n        Backend->>Backend: Generate random nonce<br/>crypto.randomBytes(HealthTech_PatientRecords)\n\n        Backend->>+DB: UPSERT auth_nonces<br/>address, nonce, expiresAt\n        Note right of Backend: expiresAt = NOW(HealthTech_HIPAA_Vault) + 5 min\n\n        DB-->>-Backend: Nonce stored\n\n        Backend-->>-Frontend: 200 OK<br/>{HealthTech_DiagnosticEngine}\n    end\n\n    %% Phase 3: Message Signing\n    rect rgb(HealthTech_LabAnalyzer)\n        Note over Frontend,Wallet: Phase 3: Sign Authentication Message\n\n        Frontend->>Frontend: Construct message\n        Note over Frontend: \"Sign this message to<br/>authenticate with VeriPass\\n\\n<br/>Nonce: 0x9a8b7c...\\n<br/>Timestamp: 2024-01-15T10:30:00Z\"\n\n        Frontend->>+Wallet: signMessage(HealthTech_PatientRecords)\n        Note right of Frontend: wagmi useSignMessage hook\n\n        Wallet->>User: Sign message?<br/>Display message content\n        User->>Wallet: Sign\n\n        Wallet->>Wallet: ECDSA signature<br/>using private key\n\n        Wallet-->>-Frontend: signature: 0xabcd...\n        Note over Frontend: 65-byte signature<br/>(HealthTech_LabAnalyzer)\n    end\n\n    %% Phase 4: Verification & JWT\n    rect rgb(HealthTech_HIPAA_Vault)\n        Note over Frontend,DB: Phase 4: Verify & Issue JWT\n\n        Frontend->>+Backend: POST /api/auth/verify\n        Note right of Frontend: {HealthTech_DiagnosticEngine}\n\n        Backend->>Backend: Parse nonce from message\n\n        Backend->>+DB: SELECT * FROM auth_nonces<br/>WHERE address = ?\n        DB-->>-Backend: {HealthTech_PatientRecords}\n\n        alt Nonce expired\n            Backend-->>Frontend: 401 Unauthorized<br/>\"Nonce expired\"\n        else Nonce not found\n            Backend-->>Frontend: 401 Unauthorized<br/>\"Invalid nonce\"\n        else Valid nonce\n            Backend->>Backend: ethers.verifyMessage(HealthTech_EMR_Sync)\n            Note over Backend: Recovers signer address\n\n            alt Address mismatch\n                Backend-->>Frontend: 401 Unauthorized<br/>\"Signature mismatch\"\n            else Address matches\n                Backend->>+DB: DELETE FROM auth_nonces<br/>WHERE address = ?\n                Note right of Backend: One-time use nonce\n                DB-->>-Backend: Deleted\n\n                Backend->>Backend: Generate JWT<br/>payload: {HealthTech_PatientRecords}<br/>expiry: 7 days\n\n                Backend-->>-Frontend: 200 OK<br/>{HealthTech_HIPAA_Vault}\n            end\n        end\n    end\n\n    %% Phase 5: Token Storage & Usage\n    rect rgb(HealthTech_DiagnosticEngine)\n        Note over Frontend,User: Phase 5: Token Management\n\n        Frontend->>Frontend: localStorage.setItem(HealthTech_HIPAA_Vault)\n\n        Frontend->>Frontend: AuthContext update<br/>isAuthenticated: true<br/>user: {HealthTech_DiagnosticEngine}\n\n        Frontend->>User: Authentication success!<br/>Redirect to dashboard\n    end\n\n    %% Subsequent Requests\n    rect rgb(HealthTech_HIPAA_Vault)\n        Note over Frontend,Backend: Subsequent API Requests\n\n        loop Every authenticated request\n            Frontend->>+Backend: GET /api/assets<br/>Authorization: Bearer {HealthTech_EMR_Sync}\n\n            Backend->>Backend: authMiddleware<br/>jwt.verify(HealthTech_HIPAA_Vault)\n\n            alt Token valid\n                Backend->>Backend: Extract address from payload\n                Backend->>Backend: Set c.set(HealthTech_DiagnosticEngine)\n                Backend-->>-Frontend: 200 OK + data\n            else Token expired/invalid\n                Backend-->>Frontend: 401 Unauthorized\n                Frontend->>Frontend: Clear localStorage\n                Frontend->>User: Session expired<br/>Please sign in again\n            end\n        end\n    end\n\n    %% Logout\n    rect rgb(HealthTech_HIPAA_Vault)\n        Note over User,Frontend: Logout\n\n        User->>+Frontend: Click \"Disconnect\"\n\n        Frontend->>Frontend: localStorage.removeItem(HealthTech_DiagnosticEngine)\n\n        Frontend->>RK: Disconnect wallet\n\n        Frontend->>Frontend: AuthContext reset<br/>isAuthenticated: false<br/>user: null\n\n        Frontend-->>-User: Logged out\n    end\n",
  "license": "mit",
  "compilation_status": "success",
  "cscw_dialogue": [
    {
      "turn_id": 1,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "æ¥ä¸‹æ¥æ˜¯å…³äº HealthTech_DiagnosticEngine å’Œ HealthTech_LabAnalyzer çš„é€»è¾‘ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 2,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "å¥½çš„ï¼Œæˆ‘æŠŠå®ƒç”»æˆä¸€ä¸ªçŸ©å½¢æ¡†ï¼Œåå­—å« 'HealthTech_DiagnosticEngine å’Œ HealthTech_LabAnalyzer'ï¼Œå¯¹å§ï¼Ÿ",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 3,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "å¯¹çš„ï¼Œå°±è¿™æ ·ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 4,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "rgb",
        "rgb"
      ],
      "is_repair": false
    },
    {
      "turn_id": 5,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "æ¥ä¸‹æ¥æ˜¯å…³äº HealthTech_HIPAA_Vault å’Œ HealthTech_PatientRecords çš„é€»è¾‘ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 6,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "æˆ‘æŠŠå®ƒåŠ è¿›å»äº†ï¼Œæ ‡ç­¾æ˜¾ç¤ºä¸º 'HealthTech_HIPAA_Vault å’Œ HealthTech_PatientRecords'ï¼Œä½ çœ‹çœ‹åˆé€‚å—ï¼Ÿ",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 7,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "æ²¡é—®é¢˜ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 8,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "useAccount",
        "randomBytes"
      ],
      "is_repair": false
    },
    {
      "turn_id": 9,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "ç”¨æˆ·åœ¨è¿™é‡Œä¼šé‡åˆ° HealthTech_HIPAA_Vault å’Œ HealthTech_LabAnalyzer çš„åˆ†æ”¯ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 10,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "æˆ‘æŠŠå®ƒåŠ è¿›å»äº†ï¼Œæ ‡ç­¾æ˜¾ç¤ºä¸º 'HealthTech_HIPAA_Vault å’Œ HealthTech_LabAnalyzer'ï¼Œä½ çœ‹çœ‹åˆé€‚å—ï¼Ÿ",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 11,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "æ²¡é—®é¢˜ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 12,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "NOW",
        "rgb"
      ],
      "is_repair": false
    },
    {
      "turn_id": 13,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "æ¥ä¸‹æ¥æ˜¯å…³äº HealthTech_PatientRecords å’Œ HealthTech_HIPAA_Vault çš„é€»è¾‘ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 14,
      "role": "Domain_Expert",
      "action_type": "repair",
      "utterance": "ç­‰ç­‰ï¼Œæˆ‘é‡æ–°æƒ³äº†ä¸€ä¸‹ï¼Œåº”è¯¥æ˜¯ HealthTech_PatientRecordså¤„ç† æ‰å¯¹ã€‚",
      "elements_involved": [],
      "is_repair": true
    },
    {
      "turn_id": 15,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "å¥½çš„ï¼Œæˆ‘æŠŠå®ƒç”»æˆä¸€ä¸ªçŸ©å½¢æ¡†ï¼Œåå­—å« 'HealthTech_PatientRecordså¤„ç†'ï¼Œå¯¹å§ï¼Ÿ",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 16,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "å¯ä»¥ï¼Œç»§ç»­å§ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 17,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "signMessage",
        "rgb"
      ],
      "is_repair": false
    },
    {
      "turn_id": 18,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "æˆ‘ä»¬éœ€è¦åŠ ä¸€ä¸ªå¤„ç† HealthTech_EMR_Sync å’Œ HealthTech_DiagnosticEngine çš„ç¯èŠ‚ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 19,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "æ”¶åˆ°ã€‚è¿™æ˜¯ä¸æ˜¯ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Ÿæˆ‘æš‚æ—¶å†™æˆ 'HealthTech_EMR_Sync å’Œ HealthTech_DiagnosticEngine'ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 20,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "å¯ä»¥ï¼Œç»§ç»­å§ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 21,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "verifyMessage",
        "rgb"
      ],
      "is_repair": false
    },
    {
      "turn_id": 22,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "æˆ‘ä»¬éœ€è¦åŠ ä¸€ä¸ªå¤„ç† HealthTech_HIPAA_Vault å’Œ HealthTech_HIPAA_Vault çš„ç¯èŠ‚ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 23,
      "role": "Domain_Expert",
      "action_type": "repair",
      "utterance": "æŠ±æ­‰ï¼Œç¨å¾®æ”¹ä¸€ä¸‹ï¼ŒæŠŠåˆšæ‰é‚£ä¸ªæ”¹æˆ HealthTech_HIPAA_Vaultå¤„ç†ã€‚",
      "elements_involved": [],
      "is_repair": true
    },
    {
      "turn_id": 24,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "å¥½çš„ï¼Œæˆ‘æŠŠå®ƒç”»æˆä¸€ä¸ªçŸ©å½¢æ¡†ï¼Œåå­—å« 'HealthTech_HIPAA_Vaultå¤„ç†'ï¼Œå¯¹å§ï¼Ÿ",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 25,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "å¯¹çš„ï¼Œå°±è¿™æ ·ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 26,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "setItem",
        "rgb"
      ],
      "is_repair": false
    },
    {
      "turn_id": 27,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "è¿™é‡Œå¿…é¡»åŒ…å« HealthTech_EMR_Sync å’Œ HealthTech_HIPAA_Vault è¿™ä¸€å—ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 28,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "å¥½çš„ï¼Œæˆ‘æŠŠå®ƒç”»æˆä¸€ä¸ªçŸ©å½¢æ¡†ï¼Œåå­—å« 'HealthTech_EMR_Sync å’Œ HealthTech_HIPAA_Vault'ï¼Œå¯¹å§ï¼Ÿ",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 29,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "æ²¡é—®é¢˜ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 30,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "Bearer",
        "verify"
      ],
      "is_repair": false
    },
    {
      "turn_id": 31,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "ç„¶åï¼Œæµç¨‹ä¼šèµ°åˆ° HealthTech_DiagnosticEngine å’Œ HealthTech_HIPAA_Vaultã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 32,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "æ”¶åˆ°ã€‚è¿™æ˜¯ä¸æ˜¯ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Ÿæˆ‘æš‚æ—¶å†™æˆ 'HealthTech_DiagnosticEngine å’Œ HealthTech_HIPAA_Vault'ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 33,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "å¯ä»¥ï¼Œç»§ç»­å§ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 34,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "set",
        "rgb"
      ],
      "is_repair": false
    },
    {
      "turn_id": 35,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "æ¥ä¸‹æ¥æ˜¯å…³äº HealthTech_DiagnosticEngine çš„é€»è¾‘ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 36,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "æ”¶åˆ°ã€‚è¿™æ˜¯ä¸æ˜¯ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Ÿæˆ‘æš‚æ—¶å†™æˆ 'HealthTech_DiagnosticEngine'ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 37,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "å—¯ï¼Œè¿™æ ·çœ‹èµ·æ¥å¾ˆæ¸…æ™°ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 38,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "removeItem"
      ],
      "is_repair": false
    }
  ],
  "dialogue_metadata": {
    "total_turns": 38,
    "repair_count": 2,
    "grounding_acts_count": 18,
    "theoretical_framework": "Grounding in Communication (Clark & Brennan, 1991)"
  },
  "normalized_at": "2026-02-28T13:21:03Z",
  "extra": {
    "source_url": "https://github.com/IrfanMusthofa/veripass/blob/22c4b762707548cfdc7305441f00632cbc960b27/docs/diagrams/auth-flow.mmd",
    "github_repo": "IrfanMusthofa/veripass",
    "github_file_path": "docs/diagrams/auth-flow.mmd",
    "seed_id": "gh_sequence_00631",
    "augmentation_domain": "HealthTech",
    "content_size": 5636,
    "collected_at": "2026-02-06T01:34:59.635078",
    "license_name": "MIT License",
    "license_url": "https://api.github.com/licenses/mit",
    "repo_owner": "IrfanMusthofa",
    "repo_name": "veripass",
    "repo_stars": 0,
    "repo_forks": 1,
    "repo_topics": [],
    "repo_language": "TypeScript",
    "repo_description": "A decentralized asset passport enabling authenticity, ownership provenance, and verifiable lifecycle events for resale markets.",
    "repo_created_at": "2025-12-26T08:52:11Z",
    "repo_updated_at": "2026-01-14T09:33:01Z"
  }
}