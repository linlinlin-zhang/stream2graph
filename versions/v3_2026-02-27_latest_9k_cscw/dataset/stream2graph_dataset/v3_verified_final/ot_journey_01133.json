{
  "id": "ot_journey_01133",
  "source": "other",
  "source_url": "https://github.com/rtyx/project-module-apr2025/blob/dc1d9e46f8d5b5f2e8fe98b37a25825f031df456/docs/diagrams/images/component-interaction.mmd",
  "source_type": "github_search",
  "github_repo": "rtyx/project-module-apr2025",
  "diagram_type": "journey",
  "code": "sequenceDiagram\n    %% Component Interaction - User browsing/searching journey\n    %% Based on actual user flow through the application\n\n    participant User as ğŸ‘¤ User\n    participant Browser as ğŸŒ Browser\n    participant NextJS as âš›ï¸ Next.js App\n    participant ArtworkAPI as ğŸ¨ Artwork API\n    participant PersonAPI as ğŸ‘¥ Person API\n    participant RAGAPI as ğŸ§  RAG API\n    participant SolrClient as ğŸ” Solr Client\n    participant RAGService as ğŸ”„ RAG Service\n    participant ES as ğŸ” Elasticsearch\n    participant OpenAI as ğŸ¤– OpenAI\n    participant Mongo as ğŸƒ MongoDB\n\n    Note over User, Mongo: User Journey: Search â†’ Browse â†’ Detail â†’ Related â†’ Chat\n\n    %% 1. Homepage Load\n    User->>Browser: Navigate to homepage\n    Browser->>NextJS: GET /de (or /en)\n    NextJS->>NextJS: Load homepage component\n    NextJS-->>Browser: Homepage with hero section\n    Browser-->>User: Display homepage\n\n    %% 2. Search Artworks\n    User->>Browser: Enter search query \"impressionist\"\n    Browser->>NextJS: Search form submission\n    NextJS->>ArtworkAPI: GET /api/de/artworks?q=impressionist&page=1&pageSize=12\n    \n    ArtworkAPI->>SolrClient: searchArtworks({query: \"impressionist\", pageSize: 12})\n    SolrClient->>SolrClient: Build Solr query parameters\n    SolrClient->>SolrClient: Execute search against collection.kunsthaus.ch\n    SolrClient-->>ArtworkAPI: SolrSearchResponse with artworks + facets\n    \n    ArtworkAPI->>ArtworkAPI: Transform Solr results to Artwork models\n    ArtworkAPI-->>NextJS: JSON response with artworks + pagination\n    NextJS->>NextJS: Update artwork grid component\n    NextJS-->>Browser: Render search results\n    Browser-->>User: Display 12 impressionist artworks\n\n    %% 3. Filter Results\n    User->>Browser: Apply category filter \"Painting\"\n    Browser->>NextJS: Update search parameters\n    NextJS->>ArtworkAPI: GET /api/de/artworks?q=impressionist&categories=Painting\n    \n    ArtworkAPI->>SolrClient: searchArtworks({query: \"impressionist\", categories: [\"Painting\"]})\n    SolrClient->>SolrClient: Add category filter to query\n    SolrClient-->>ArtworkAPI: Filtered results\n    ArtworkAPI-->>NextJS: Filtered artworks\n    NextJS-->>Browser: Updated results\n    Browser-->>User: Show only paintings\n\n    %% 4. View Artwork Detail\n    User->>Browser: Click on artwork \"Sunflowers\"\n    Browser->>NextJS: Navigate to /de/artworks/123\n    NextJS->>ArtworkAPI: GET /api/de/artworks/123\n    \n    ArtworkAPI->>SolrClient: getArtworkById(\"123\")\n    SolrClient-->>ArtworkAPI: Artwork details\n    ArtworkAPI-->>NextJS: Complete artwork data\n    NextJS->>NextJS: Load artwork detail page + IIIF viewer\n    NextJS-->>Browser: Artwork detail page\n    Browser-->>User: Show artwork details + high-res image\n\n    %% 5. View Related Artist\n    User->>Browser: Click on artist \"Van Gogh\"\n    Browser->>NextJS: Navigate to /de/persons/456\n    NextJS->>PersonAPI: GET /api/de/persons/456\n    \n    PersonAPI->>SolrClient: getArtistById(\"456\")\n    SolrClient-->>PersonAPI: Person details\n    PersonAPI-->>NextJS: Person data\n    NextJS->>NextJS: Load person detail page\n    NextJS-->>Browser: Person biography + artworks\n    Browser-->>User: Show Van Gogh's biography + works\n\n    %% 6. Ask RAG Question\n    User->>Browser: Type question \"What technique did Van Gogh use?\"\n    Browser->>NextJS: Submit RAG query\n    NextJS->>RAGAPI: POST /api/de/rag/answer/artwork/123<br/>{\"q\": \"What technique did Van Gogh use?\", \"currentArtwork\": {...}}\n    \n    RAGAPI->>RAGService: answerRag({q, lang: \"de\", currentArtwork: {...}})\n    \n    Note over RAGService: RAG Processing\n    RAGService->>RAGService: Enhance query + detect language\n    RAGService->>OpenAI: Generate embedding\n    OpenAI-->>RAGService: Embedding vector\n    \n    par Vector Search\n        RAGService->>ES: KNN search with artwork context\n        ES-->>RAGService: Vector results\n    and Lexical Search\n        RAGService->>ES: BM25 search with artwork context\n        ES-->>RAGService: Lexical results\n    end\n    \n    RAGService->>RAGService: Merge results + select context\n    RAGService->>OpenAI: Generate answer with context\n    OpenAI-->>RAGService: Answer with citations\n    \n    RAGService-->>RAGAPI: AnswerResult with citations\n    RAGAPI-->>NextJS: JSON response\n    NextJS->>NextJS: Update chat interface\n    NextJS-->>Browser: Display answer with citations\n    Browser-->>User: \"Van Gogh verwendete Ã–lmalerei-Technik... [1] [2]\"\n\n    %% 7. Follow-up Question\n    User->>Browser: Ask follow-up \"When was it painted?\"\n    Browser->>NextJS: Submit follow-up\n    NextJS->>RAGAPI: POST /api/de/rag/answer/artwork/123<br/>{\"q\": \"When was it painted?\", \"history\": [...]}\n    \n    RAGAPI->>RAGService: answerRag({q, lang: \"de\", history: [...]})\n    RAGService->>RAGService: Process with conversation history\n    RAGService->>OpenAI: Generate answer with context + history\n    OpenAI-->>RAGService: Contextual answer\n    RAGService-->>RAGAPI: AnswerResult\n    RAGAPI-->>NextJS: Follow-up answer\n    NextJS-->>Browser: Display contextual answer\n    Browser-->>User: \"Das GemÃ¤lde wurde 1888 gemalt... [3]\"\n\n    %% 8. Browse Related Artworks\n    User->>Browser: Click \"View all works by Van Gogh\"\n    Browser->>NextJS: Navigate to artist's works\n    NextJS->>ArtworkAPI: GET /api/de/artworks?person=456&page=1\n    \n    ArtworkAPI->>SolrClient: searchArtworks({artistId: 456})\n    SolrClient-->>ArtworkAPI: All Van Gogh artworks\n    ArtworkAPI-->>NextJS: Artwork list\n    NextJS-->>Browser: Grid of Van Gogh's works\n    Browser-->>User: Show all Van Gogh artworks\n\n    %% Error Handling\n    alt Search Error\n        SolrClient-->>ArtworkAPI: Error response\n        ArtworkAPI-->>NextJS: 500 Error\n        NextJS-->>Browser: Error message\n        Browser-->>User: \"Search temporarily unavailable\"\n    end\n\n    alt RAG Error\n        RAGService-->>RAGAPI: No context found\n        RAGAPI-->>NextJS: Empty response\n        NextJS-->>Browser: \"No information available\"\n        Browser-->>User: \"Ich finde dazu keine ausreichenden Informationen.\"\n    end\n",
  "content_size": 6007,
  "collected_at": "2026-02-06T11:05:28.383939",
  "compilation_status": "failed",
  "license": "other_source",
  "license_name": "Other Source (GitHub-based)",
  "compilation_error": "[WinError 2] ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶ã€‚"
}