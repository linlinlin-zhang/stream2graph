{
  "id": "gl_block-beta_00329",
  "source": "gitlab",
  "source_url": "https://github.com/fkhb90/Surge/blob/a01cc6df251e6f46d8865cb6083caf982c199f2d/docs/URL-Filter-Flow-Chinese-Vertical.mmd",
  "source_note": "collected_from_github_additional",
  "github_repo": "fkhb90/Surge",
  "diagram_type": "block-beta",
  "code": "flowchart TB\n  %% 直向 (Top-to-Bottom) 版本\n  %% 子圖與節點文字皆為中文，採高對比配色，適合貼到支援 Mermaid 的編輯器\n\n  %% 樣式定義（高對比）\n  classDef header fill:#ffffff,stroke:#000,stroke-width:2px,color:#000,font-size:14px,font-weight:bold;\n  classDef allow  fill:#eaffea,stroke:#004d00,stroke-width:2.5px,color:#002200,font-size:13px;\n  classDef warn   fill:#fff8e0,stroke:#7a4a00,stroke-width:2.5px,color:#332200,font-size:13px;\n  classDef block  fill:#a40000,stroke:#300000,stroke-width:2.5px,color:#ffffff,font-size:13px;\n  classDef info   fill:#ffffff,stroke:#003a8c,stroke-width:2.5px,color:#000000,font-size:13px;\n  classDef groupFill fill:#fbfbfb,stroke:#bbbbbb,stroke-width:1px,color:#111,font-size:12px;\n\n  %% 解析組\n  subgraph ParseGroup[解析階段]\n    direction TB\n    Start[開始]\n    Parse[解析 URL：主機、路徑、查詢]\n  end\n\n  %% 白名單與快取組\n  subgraph WhitelistCache[白名單與快取]\n    direction TB\n    Exemptions{路徑豁免？}\n    HardWhitelist{硬性白名單？}\n    L1Cache{L1 快取 決策}\n  end\n\n  %% 域名與關鍵腳本檢查組\n  subgraph DomainGroup[域名與關鍵腳本檢查]\n    direction TB\n    DomainBlocked{域名在黑名單？}\n    Critical{為關鍵追蹤腳本？}\n    SoftWhitelisted{軟性白名單？}\n  end\n\n  %% 路徑檢查組\n  subgraph PathGroup[路徑檢查]\n    direction TB\n    PathAllow{路徑由允許清單放行？}\n    PathKeywords{路徑匹配追蹤關鍵字？}\n    PathRegex{路徑匹配正則或啟發式？}\n  end\n\n  %% 參數處理組\n  subgraph ParamGroup[參數處理]\n    direction TB\n    HasQuery{含查詢參數？}\n    ParamExempt{主機豁免參數清理？}\n    CleanParams{清理追蹤參數後 URL 是否改變？}\n  end\n\n  %% 結果節點\n  FinalNegCache[若未知 設負向快取然後放行]\n  ReturnReq[返回 修改後請求]\n  Allow[允許 通過]\n  BlockResponse[阻擋 並回應：丟棄 或 小圖 或 204 或 403]\n\n  %% 主流程（由上而下）\n  Start --> Parse\n  Parse --> Exemptions\n  Exemptions -- 是 --> Allow\n  Exemptions -- 否 --> HardWhitelist\n\n  HardWhitelist -- 是 --> Allow\n  HardWhitelist -- 否 --> L1Cache\n\n  L1Cache -- 被標記阻擋 --> BlockResponse\n  L1Cache -- 否或未知 --> DomainBlocked\n\n  DomainBlocked -- 是 --> BlockResponse\n  DomainBlocked -- 否 --> Critical\n\n  Critical -- 是 --> BlockResponse\n  Critical -- 否 --> SoftWhitelisted\n\n  SoftWhitelisted -- 是 --> PathAllow\n  SoftWhitelisted -- 否 --> PathAllow\n\n  PathAllow -- 是 --> Allow\n  PathAllow -- 否 --> PathKeywords\n\n  PathKeywords -- 是 --> BlockResponse\n  PathKeywords -- 否 --> PathRegex\n\n  PathRegex -- 是 --> BlockResponse\n  PathRegex -- 否 --> HasQuery\n\n  HasQuery -- 否 --> FinalNegCache\n  HasQuery -- 是 --> ParamExempt\n\n  ParamExempt -- 是 --> FinalNegCache\n  ParamExempt -- 否 --> CleanParams\n\n  CleanParams -- 有變更 --> ReturnReq\n  CleanParams -- 無變更 --> FinalNegCache\n\n  FinalNegCache --> Allow\n\n  %% 套用樣式\n  class Start,Parse header;\n  class Exemptions,ParamExempt,CleanParams,ReturnReq info;\n  class HardWhitelist,PathAllow,Allow allow;\n  class L1Cache,FinalNegCache warn;\n  class DomainBlocked,Critical,PathKeywords,PathRegex,BlockResponse block;\n\n  %% 群組底色\n  class ParseGroup,WhitelistCache,DomainGroup,PathGroup,ParamGroup groupFill;\n\n  %% 連線樣式（深色與加粗）\n  linkStyle default stroke:#111,stroke-width:2.2px,stroke-linecap:round;",
  "content_size": 2841,
  "collected_at": "2026-02-06T14:07:23.061089",
  "compilation_status": "failed",
  "license": "gitlab_repo",
  "license_name": "GitLab Repository",
  "license_url": "https://gitlab.com",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}