{
  "id": "gh_flowchart_00719",
  "source": "github",
  "source_url": "https://github.com/timothywarner/az305/blob/f1dac63440bdff4359294c400acb349c6f12671c/images/hub-spoke-network.mmd",
  "github_repo": "timothywarner/az305",
  "github_file_path": "images/hub-spoke-network.mmd",
  "diagram_type": "flowchart",
  "code": "%% AZ-305 Domain 4: Hub-Spoke Network Topology\n%% Reference: Azure Architecture Center hub-spoke pattern, CAF networking\n%% Exam Focus: VNet peering, Azure Firewall, ExpressRoute, VPN\n\nflowchart TB\n    subgraph ONPREM[\"On-Premises Network\"]\n        direction TB\n        ONPREM_DC[\"Corporate Datacenter<br/>10.100.0.0/16\"]\n        ONPREM_USERS[\"Enterprise Users\"]\n        ONPREM_APPS[\"Legacy Applications\"]\n    end\n\n    subgraph HYBRID_CONN[\"Hybrid Connectivity\"]\n        direction TB\n\n        ER[\"ExpressRoute Circuit<br/>Private Peering<br/>1-10 Gbps\"]\n        ER_GW[\"ExpressRoute Gateway<br/>ErGw2AZ (Zone-redundant)\"]\n\n        VPN[\"Site-to-Site VPN<br/>IPsec/IKE<br/>Backup connectivity\"]\n        VPN_GW[\"VPN Gateway<br/>VpnGw2AZ\"]\n    end\n\n    subgraph HUB[\"Hub Virtual Network (10.0.0.0/16)\"]\n        direction TB\n\n        subgraph HUB_SUBNETS[\"Hub Subnets\"]\n            GW_SUBNET[\"GatewaySubnet<br/>10.0.1.0/24<br/>ER + VPN Gateways\"]\n            FW_SUBNET[\"AzureFirewallSubnet<br/>10.0.2.0/24<br/>Min /26 required\"]\n            BASTION_SUBNET[\"AzureBastionSubnet<br/>10.0.3.0/24<br/>Secure RDP/SSH\"]\n            MGMT_SUBNET[\"Management Subnet<br/>10.0.4.0/24<br/>Jump boxes, tools\"]\n        end\n\n        subgraph SHARED_SERVICES[\"Shared Services\"]\n            FIREWALL[\"Azure Firewall<br/>Premium SKU<br/>IDPS, TLS inspection\"]\n            BASTION[\"Azure Bastion<br/>Standard SKU<br/>Native RDP/SSH\"]\n            DNS[\"Private DNS Zones<br/>privatelink.*.azure.net<br/>Custom domains\"]\n            KV[\"Shared Key Vault<br/>Certificates, secrets\"]\n        end\n\n        FW_POLICY[\"Firewall Policy<br/>Network rules<br/>Application rules<br/>DNAT rules\"]\n    end\n\n    subgraph SPOKE1[\"Spoke 1 - Production (10.1.0.0/16)\"]\n        direction TB\n\n        SPOKE1_WEB[\"Web Tier Subnet<br/>10.1.1.0/24\"]\n        SPOKE1_APP[\"App Tier Subnet<br/>10.1.2.0/24\"]\n        SPOKE1_DATA[\"Data Tier Subnet<br/>10.1.3.0/24\"]\n\n        SPOKE1_NSG[\"NSG: Deny Inbound<br/>Allow via Firewall\"]\n        SPOKE1_UDR[\"UDR: 0.0.0.0/0<br/>-> Azure Firewall\"]\n\n        SPOKE1_PEP[\"Private Endpoints<br/>Storage, SQL, KV\"]\n    end\n\n    subgraph SPOKE2[\"Spoke 2 - Development (10.2.0.0/16)\"]\n        direction TB\n\n        SPOKE2_DEV[\"Dev Environment<br/>10.2.1.0/24\"]\n        SPOKE2_TEST[\"Test Environment<br/>10.2.2.0/24\"]\n\n        SPOKE2_NSG[\"NSG: Segmentation\"]\n        SPOKE2_UDR[\"UDR: Route to Hub\"]\n    end\n\n    subgraph SPOKE3[\"Spoke 3 - DMZ (10.3.0.0/16)\"]\n        direction TB\n\n        SPOKE3_DMZ[\"DMZ Subnet<br/>10.3.1.0/24\"]\n        APP_GW[\"Application Gateway<br/>WAF_v2 SKU<br/>Public IP\"]\n        SPOKE3_UDR[\"UDR: Internet via<br/>Azure Firewall\"]\n    end\n\n    subgraph SPOKE4[\"Spoke 4 - Shared Services (10.4.0.0/16)\"]\n        direction TB\n\n        SPOKE4_AD[\"AD DS Subnet<br/>Domain Controllers\"]\n        SPOKE4_MGMT[\"Management Tools<br/>SCCM, WSUS\"]\n    end\n\n    subgraph INTERNET[\"Internet\"]\n        USERS[\"External Users\"]\n        PARTNERS[\"Partner Networks\"]\n    end\n\n    %% On-premises connectivity\n    ONPREM_DC --> ER\n    ONPREM_DC --> VPN\n    ER --> ER_GW\n    VPN --> VPN_GW\n    ER_GW --> GW_SUBNET\n    VPN_GW --> GW_SUBNET\n\n    %% Hub-Spoke peering\n    HUB <-->|VNet Peering<br/>Allow Gateway Transit| SPOKE1\n    HUB <-->|VNet Peering<br/>Use Remote Gateway| SPOKE2\n    HUB <-->|VNet Peering| SPOKE3\n    HUB <-->|VNet Peering| SPOKE4\n\n    %% Traffic flows through firewall\n    SPOKE1 --> FIREWALL\n    SPOKE2 --> FIREWALL\n    SPOKE3 --> FIREWALL\n    SPOKE4 --> FIREWALL\n\n    FIREWALL --> INTERNET\n    FIREWALL --> ONPREM_DC\n\n    %% Application Gateway to backend\n    USERS --> APP_GW\n    APP_GW --> SPOKE1_WEB\n\n    %% Firewall policy\n    FW_POLICY --> FIREWALL\n\n    %% DNS resolution\n    DNS -.-> SPOKE1_PEP\n\n    %% Exam decision points\n    NOTE1[\"**EXAM TIP**: VNet peering is<br/>non-transitive - spokes cannot<br/>communicate directly without<br/>Firewall or NVA routing\"]\n    NOTE2[\"**EXAM TIP**: Use Gateway Transit<br/>on hub peering to share<br/>ExpressRoute/VPN with spokes\"]\n    NOTE3[\"**EXAM TIP**: Azure Firewall needs<br/>dedicated /26 subnet minimum<br/>named 'AzureFirewallSubnet'\"]\n    NOTE4[\"**EXAM TIP**: UDRs required to<br/>force traffic through Firewall<br/>Default route 0.0.0.0/0 -> FW\"]\n\n    %% Styling\n    classDef onpremStyle fill:#78909c,stroke:#455a64,color:#fff\n    classDef connectStyle fill:#ab47bc,stroke:#7b1fa2,color:#fff\n    classDef hubStyle fill:#1565c0,stroke:#0d47a1,color:#fff\n    classDef subnetStyle fill:#e3f2fd,stroke:#1976d2,color:#000\n    classDef serviceStyle fill:#ffca28,stroke:#ff8f00,color:#000\n    classDef spokeStyle fill:#66bb6a,stroke:#388e3c,color:#fff\n    classDef spoke2Style fill:#4fc3f7,stroke:#0288d1,color:#000\n    classDef dmzStyle fill:#ef5350,stroke:#c62828,color:#fff\n    classDef sharedStyle fill:#7e57c2,stroke:#512da8,color:#fff\n    classDef internetStyle fill:#90a4ae,stroke:#546e7a,color:#fff\n    classDef noteStyle fill:#fff9c4,stroke:#fbc02d,color:#000,stroke-dasharray: 5 5\n\n    class ONPREM_DC,ONPREM_USERS,ONPREM_APPS onpremStyle\n    class ER,ER_GW,VPN,VPN_GW connectStyle\n    class GW_SUBNET,FW_SUBNET,BASTION_SUBNET,MGMT_SUBNET subnetStyle\n    class FIREWALL,BASTION,DNS,KV,FW_POLICY serviceStyle\n    class SPOKE1_WEB,SPOKE1_APP,SPOKE1_DATA,SPOKE1_NSG,SPOKE1_UDR,SPOKE1_PEP spokeStyle\n    class SPOKE2_DEV,SPOKE2_TEST,SPOKE2_NSG,SPOKE2_UDR spoke2Style\n    class SPOKE3_DMZ,APP_GW,SPOKE3_UDR dmzStyle\n    class SPOKE4_AD,SPOKE4_MGMT sharedStyle\n    class USERS,PARTNERS internetStyle\n    class NOTE1,NOTE2,NOTE3,NOTE4 noteStyle\n",
  "content_size": 5501,
  "collected_at": "2026-02-06T01:47:12.036127",
  "compilation_status": "success",
  "license": "mit",
  "license_name": "MIT License",
  "license_url": "https://api.github.com/licenses/mit",
  "repo_stars": 90,
  "repo_forks": 81,
  "repo_owner": "timothywarner",
  "repo_name": "az305",
  "repo_description": "AZ-305: Designing Microsoft Azure Infrastructure Solutions Crash Course",
  "repo_language": "Bicep",
  "repo_topics": [
    "architecture",
    "arm-templates",
    "az-305",
    "azure",
    "bicep"
  ],
  "repo_created_at": "2022-02-06T16:34:03Z",
  "repo_updated_at": "2026-02-02T23:11:57Z"
}