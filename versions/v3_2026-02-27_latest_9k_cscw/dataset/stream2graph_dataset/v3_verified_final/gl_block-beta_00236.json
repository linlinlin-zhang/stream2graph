{
  "id": "gl_block-beta_00236",
  "source": "gitlab",
  "source_url": "https://github.com/macgyver13/silent-payments-hub/blob/ce8edc54f51b8a5c7a5959909d1f6ee034f8a5ed/diagrams/wallet_ux.mmd",
  "source_note": "collected_from_github_additional",
  "github_repo": "macgyver13/silent-payments-hub",
  "diagram_type": "block-beta",
  "code": "---\nconfig:\n  diagramMarginY: 100\n  noteMargin: 20\n  noteAlign: center\n  mirrorActors: true\n---\n%%{init: {'themeVariables': {\n  'noteBkgColor':'#333',\n  'noteTextColor': '#cccccc',\n  'fontSize': '30px',\n  'noteFontSize': '30px',\n  'fontFamily': 'verdana'\n}}}%%\n\nsequenceDiagram\n%% autonumber\n  actor Sender\n  actor User\n  participant Wallet as Wallet (Client)\n  participant MyScanServer as Scan Server (Own)\n  participant Bitcoin as Bitcoin Network\n  participant HostedScanServer as Scan Server (Hosted)\n  actor Recipient\n\n  Note over User, Wallet: Wallet Setup\n  User->>Wallet: Generate Scan Secret + Spend Key\n  Wallet->>Wallet: Derive Silent Payment Address\n  Wallet-->>User: Share SP Address (public)\n\n  Note over Sender: Sender sends BTC to SP address\n  Sender->>Wallet: Sender computes recipient address for this transaction (tweak key)\n  Wallet->>Bitcoin: Broadcast transaction\n  \n  Note over User, Wallet: Receiving Funds\n  rect rgb(55,55,55)\n  alt Wallet Scanner (Private)\n  Note over User, MyScanServer: Wallet does all the work <br>(Least complex, Most compute)\n    Wallet->>Bitcoin: Fetch block data (All or Block Filter?)\n    Wallet->>Wallet: Scan for tweaked outputs (Scan Key)\n  else Own Scanner (Private / Fast)  \n    rect rgb(75,55,55)\n      Note over User, MyScanServer: Least wallet development requried <br> (\"Prefered\" Balance Privacy + UX, Distributed compute)\n      rect rgb(55,55,75)\n        Note over User, Wallet: Scanner Registration - one time\n        Wallet->>MyScanServer: Register Scan key\n        loop For Each Block\n          MyScanServer-->>MyScanServer: Scan for tweaked outputs (Scan Key)\n        end\n      end\n      rect rgb(55,55,95)\n        Note over User, Wallet: Typical Wallet UX\n        User->>Wallet: Check Balance\n        Wallet->>MyScanServer: Fetch new UTXOs\n        MyScanServer->>Wallet: Return matching UTXOs\n        Wallet-->>Wallet: Update Balance\n        Wallet-->>User: Show updated balance (UTXOs found)\n      end\n    end\n  else Outsourced Scanner (Fast / Trust Required)\n    rect rgb(40, 62, 53)\n      Note over User, MyScanServer: More wallet development requried <br> (Best UX for Light Clients, Least Private )\n      Bitcoin->>HostedScanServer: New Block\n      loop For Each Block\n        HostedScanServer-->>HostedScanServer: Index all tweaks that meet BIP352 spec <br> ? discard spent?\n      end\n      rect rgb(55,75,55)\n        alt Subscribe or Bulk Download?\n          rect rgb(55,75,75)\n            Wallet->>HostedScanServer: Request all tweaks from last block checked for a given Scan Key\n            HostedScanServer->>Wallet: Return matching UTXOs\n          end\n        else\n          rect rgb(75,75,55)\n            Wallet->>HostedScanServer: Request tweaks for block or range of blocks (more privacy/more data) <br> ? Should this be supported?\n            HostedScanServer->>Wallet: Return all tweaks for range\n          end\n        end\n      end\n    end\n  end\n  end\n\n  Note over User, Wallet: Spending Funds\n  Wallet->>Wallet: Derive tweak from Spend key\n  Wallet->>Bitcoin: Broadcast transaction\n  Bitcoin->>Recipient: Funds arrive (standard output)\n\nNote over Wallet: Wallet Recovery? <br> scan all taproot outputs since wallet birthday\n",
  "content_size": 3208,
  "collected_at": "2026-02-06T14:05:05.736687",
  "compilation_status": "failed",
  "license": "gitlab_repo",
  "license_name": "GitLab Repository",
  "license_url": "https://gitlab.com",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}