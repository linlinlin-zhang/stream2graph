{
  "id": "gh_architecture_01695",
  "source": "github",
  "source_url": "https://github.com/timothywarner/az305/blob/f1dac63440bdff4359294c400acb349c6f12671c/images/private-link-topology.mmd",
  "github_repo": "timothywarner/az305",
  "github_file_path": "images/private-link-topology.mmd",
  "diagram_type": "architecture",
  "code": "%% AZ-305 Domain 4: Private Link/Private Endpoint Connectivity Patterns\n%% Reference: Azure Private Link architecture, network isolation\n%% Exam Focus: Private endpoints, DNS resolution, cross-region patterns\n\nflowchart TB\n    subgraph ONPREM[\"On-Premises Network\"]\n        direction TB\n        ONPREM_DNS[\"On-Premises DNS<br/>Conditional Forwarder\"]\n        ONPREM_CLIENT[\"On-Premises Client<br/>10.100.1.10\"]\n        ONPREM_APP[\"Legacy Application\"]\n    end\n\n    subgraph HUB_VNET[\"Hub Virtual Network (10.0.0.0/16)\"]\n        direction TB\n\n        subgraph CONNECTIVITY[\"Connectivity Services\"]\n            ER_GW[\"ExpressRoute Gateway\"]\n            VPN_GW[\"VPN Gateway\"]\n            FIREWALL[\"Azure Firewall\"]\n        end\n\n        subgraph DNS_INFRA[\"DNS Infrastructure\"]\n            DNS_RESOLVER[\"Private DNS Resolver\"]\n            DNS_INBOUND[\"Inbound Endpoint<br/>10.0.5.4\"]\n            DNS_OUTBOUND[\"Outbound Endpoint<br/>Forwarding Rules\"]\n        end\n\n        PRIVATE_DNS_ZONES[\"Private DNS Zones<br/>Linked to VNets\"]\n    end\n\n    subgraph SPOKE1[\"Spoke VNet - Application (10.1.0.0/16)\"]\n        direction TB\n\n        APP_SUBNET[\"Application Subnet<br/>10.1.1.0/24\"]\n        APP_VM[\"Application VM<br/>10.1.1.10\"]\n\n        PE_SUBNET[\"Private Endpoint Subnet<br/>10.1.2.0/24<br/>Disable Network Policies\"]\n\n        subgraph PES_APP[\"Private Endpoints\"]\n            PE_STORAGE[\"PE: Storage Account<br/>10.1.2.10<br/>blob.core.windows.net\"]\n            PE_SQL[\"PE: Azure SQL<br/>10.1.2.11<br/>database.windows.net\"]\n            PE_KV[\"PE: Key Vault<br/>10.1.2.12<br/>vault.azure.net\"]\n        end\n    end\n\n    subgraph SPOKE2[\"Spoke VNet - Data Platform (10.2.0.0/16)\"]\n        direction TB\n\n        DATA_SUBNET[\"Data Subnet<br/>10.2.1.0/24\"]\n        SYNAPSE_VM[\"Synapse Integration<br/>Runtime VM\"]\n\n        PE_SUBNET2[\"Private Endpoint Subnet<br/>10.2.2.0/24\"]\n\n        subgraph PES_DATA[\"Private Endpoints\"]\n            PE_ADLS[\"PE: ADLS Gen2<br/>10.2.2.10<br/>dfs.core.windows.net\"]\n            PE_SYNAPSE[\"PE: Synapse Analytics<br/>10.2.2.11<br/>sql.azuresynapse.net\"]\n            PE_COSMOS[\"PE: Cosmos DB<br/>10.2.2.12<br/>documents.azure.com\"]\n        end\n    end\n\n    subgraph AZURE_SERVICES[\"Azure PaaS Services (Public)\"]\n        direction TB\n\n        STORAGE[\"Storage Account<br/>mystorageacct<br/>Public endpoint disabled\"]\n        SQL_DB[\"Azure SQL Database<br/>mysqlserver<br/>Public access denied\"]\n        KEY_VAULT[\"Key Vault<br/>mykeyvault<br/>Network ACLs applied\"]\n        ADLS[\"ADLS Gen2<br/>mydatalake<br/>Private access only\"]\n        SYNAPSE[\"Synapse Workspace<br/>Managed VNet enabled\"]\n        COSMOS_DB[\"Cosmos DB<br/>Global distribution<br/>Private endpoints per region\"]\n    end\n\n    subgraph DNS_RESOLUTION[\"DNS Resolution Flow\"]\n        direction LR\n\n        DNS_QUERY[\"1. DNS Query:<br/>mystorageacct.blob.core.windows.net\"]\n        DNS_CNAME[\"2. CNAME to:<br/>mystorageacct.privatelink.blob.core.windows.net\"]\n        DNS_PRIVATE[\"3. Private DNS Zone<br/>resolves to: 10.1.2.10\"]\n        DNS_CONNECT[\"4. Traffic flows to<br/>Private Endpoint IP\"]\n    end\n\n    subgraph PATTERNS[\"Common Connectivity Patterns\"]\n        direction TB\n\n        PATTERN1[\"**Hub-Spoke Pattern**<br/>- PEs in spokes<br/>- DNS zones in hub<br/>- Cross-spoke via firewall\"]\n\n        PATTERN2[\"**Centralized PE Pattern**<br/>- All PEs in hub<br/>- Shared by all spokes<br/>- Simplified DNS\"]\n\n        PATTERN3[\"**Regional Pattern**<br/>- PE per region<br/>- Local DNS resolution<br/>- Latency optimization\"]\n\n        PATTERN4[\"**Service Endpoint vs PE**<br/>- SE: Traffic stays on MS backbone<br/>- PE: Private IP in your VNet<br/>- PE: Required for on-prem access\"]\n    end\n\n    subgraph PRIVATE_DNS_CONFIG[\"Private DNS Zone Configuration\"]\n        direction TB\n\n        BLOB_ZONE[\"privatelink.blob.core.windows.net<br/>A record: mystorageacct -> 10.1.2.10\"]\n        SQL_ZONE[\"privatelink.database.windows.net<br/>A record: mysqlserver -> 10.1.2.11\"]\n        KV_ZONE[\"privatelink.vaultcore.azure.net<br/>A record: mykeyvault -> 10.1.2.12\"]\n        DFS_ZONE[\"privatelink.dfs.core.windows.net<br/>A record: mydatalake -> 10.2.2.10\"]\n\n        VNET_LINK[\"VNet Links<br/>Hub + All Spokes<br/>Auto-registration disabled\"]\n    end\n\n    %% On-premises connectivity\n    ONPREM_DNS -->|Conditional Forward| DNS_INBOUND\n    ONPREM_CLIENT --> ER_GW\n    ER_GW --> FIREWALL\n\n    %% Hub DNS resolution\n    DNS_RESOLVER --> DNS_INBOUND\n    DNS_RESOLVER --> DNS_OUTBOUND\n    DNS_OUTBOUND --> PRIVATE_DNS_ZONES\n\n    %% VNet peering\n    HUB_VNET <-->|VNet Peering| SPOKE1\n    HUB_VNET <-->|VNet Peering| SPOKE2\n\n    %% Private endpoint connections\n    PE_STORAGE --> STORAGE\n    PE_SQL --> SQL_DB\n    PE_KV --> KEY_VAULT\n    PE_ADLS --> ADLS\n    PE_SYNAPSE --> SYNAPSE\n    PE_COSMOS --> COSMOS_DB\n\n    %% Application to PE\n    APP_VM --> PE_STORAGE\n    APP_VM --> PE_SQL\n    APP_VM --> PE_KV\n    SYNAPSE_VM --> PE_ADLS\n    SYNAPSE_VM --> PE_SYNAPSE\n\n    %% DNS resolution flow\n    DNS_QUERY --> DNS_CNAME\n    DNS_CNAME --> DNS_PRIVATE\n    DNS_PRIVATE --> DNS_CONNECT\n\n    %% DNS zone links\n    BLOB_ZONE --> VNET_LINK\n    SQL_ZONE --> VNET_LINK\n    KV_ZONE --> VNET_LINK\n    DFS_ZONE --> VNET_LINK\n\n    %% Exam notes\n    NOTE1[\"**EXAM TIP**: Private Endpoints<br/>require dedicated subnet with<br/>network policies disabled\"]\n    NOTE2[\"**EXAM TIP**: DNS resolution is critical<br/>Private DNS zones must be<br/>linked to all consuming VNets\"]\n    NOTE3[\"**EXAM TIP**: On-prem access requires<br/>conditional DNS forwarding<br/>to Azure DNS resolver\"]\n    NOTE4[\"**EXAM TIP**: Disable public access<br/>on PaaS services after<br/>configuring private endpoints\"]\n\n    %% Styling\n    classDef onpremStyle fill:#78909c,stroke:#455a64,color:#fff\n    classDef hubStyle fill:#1565c0,stroke:#0d47a1,color:#fff\n    classDef dnsStyle fill:#7e57c2,stroke:#512da8,color:#fff\n    classDef spokeStyle fill:#66bb6a,stroke:#388e3c,color:#fff\n    classDef peStyle fill:#ff7043,stroke:#e64a19,color:#fff\n    classDef paasStyle fill:#42a5f5,stroke:#1976d2,color:#fff\n    classDef flowStyle fill:#ffca28,stroke:#ff8f00,color:#000\n    classDef patternStyle fill:#26c6da,stroke:#00838f,color:#000\n    classDef zoneStyle fill:#f06292,stroke:#c2185b,color:#fff\n    classDef noteStyle fill:#fff9c4,stroke:#fbc02d,color:#000,stroke-dasharray: 5 5\n\n    class ONPREM_DNS,ONPREM_CLIENT,ONPREM_APP onpremStyle\n    class ER_GW,VPN_GW,FIREWALL hubStyle\n    class DNS_RESOLVER,DNS_INBOUND,DNS_OUTBOUND,PRIVATE_DNS_ZONES dnsStyle\n    class APP_SUBNET,APP_VM,PE_SUBNET,DATA_SUBNET,SYNAPSE_VM,PE_SUBNET2 spokeStyle\n    class PE_STORAGE,PE_SQL,PE_KV,PE_ADLS,PE_SYNAPSE,PE_COSMOS peStyle\n    class STORAGE,SQL_DB,KEY_VAULT,ADLS,SYNAPSE,COSMOS_DB paasStyle\n    class DNS_QUERY,DNS_CNAME,DNS_PRIVATE,DNS_CONNECT flowStyle\n    class PATTERN1,PATTERN2,PATTERN3,PATTERN4 patternStyle\n    class BLOB_ZONE,SQL_ZONE,KV_ZONE,DFS_ZONE,VNET_LINK zoneStyle\n    class NOTE1,NOTE2,NOTE3,NOTE4 noteStyle\n",
  "content_size": 6947,
  "collected_at": "2026-02-06T02:02:14.351218",
  "compilation_status": "success",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "license": "mit",
  "license_name": "MIT License",
  "license_url": "https://api.github.com/licenses/mit",
  "repo_stars": 90,
  "repo_forks": 81
}