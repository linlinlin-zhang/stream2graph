{
  "id": "gh_sequence_00916",
  "source": "github",
  "source_url": "https://github.com/luth9r/FitTracker/blob/c81958bfbd32229654cff70c18fdc0d6e0541f71/docs/google-oauth-login-flow.mmd",
  "github_repo": "luth9r/FitTracker",
  "github_file_path": "docs/google-oauth-login-flow.mmd",
  "diagram_type": "sequence",
  "code": "%%{init: {'look':'neo', 'theme':'redux-color'}}%%\nsequenceDiagram\n    participant C as Client\n    participant G as Google OAuth\n    participant AC as AuthController\n    participant GOS as GoogleOAuthService\n    participant GT as Google Token API\n    participant GV as Google Validator\n    participant UR as UserRepository\n    participant DB as PostgreSQL\n    participant JTG as JwtTokenGenerator\n\n    C->>C: Generate PKCE parameters\n    C->>G: Redirect to Google OAuth\n    G-->>C: Redirect with code\n    \n    C->>AC: POST /api/auth/google-login<br/>{code, codeVerifier}\n    AC->>GOS: ExchangeCodeForTokens(code, codeVerifier)\n    GOS->>GT: POST https://oauth2.googleapis.com/token\n    GT-->>GOS: {access_token, id_token, ...}\n    GOS->>GV: ValidateAsync(id_token)\n    GV-->>GOS: {sub, email, ...}\n    GOS-->>AC: GoogleTokenPayload\n    \n    AC->>UR: FindByGoogleProviderId(sub)\n    UR->>DB: SELECT * FROM Users<br/>WHERE GoogleProviderId = ?\n    DB-->>UR: User found\n    UR-->>AC: user\n    \n    AC->>JTG: GenerateAuthToken(userId)\n    JTG-->>AC: authToken\n    AC-->>C: 200 OK + Set-Cookie: auth-token\n",
  "content_size": 1100,
  "collected_at": "2026-02-06T01:50:43.764377",
  "compilation_status": "failed",
  "license": "mit",
  "license_name": "MIT License",
  "license_url": "https://api.github.com/licenses/mit",
  "repo_stars": 2,
  "repo_forks": 0,
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "dialogue": [
    {
      "turn_id": 1,
      "speaker": "Speaker_B",
      "utterance": "首先，我们需要定义流程的起点。",
      "speech_act": "sequential",
      "diagram_elements_added": [],
      "timestamp_offset": 15
    },
    {
      "turn_id": 2,
      "speaker": "Speaker_A",
      "utterance": "这个设计看起来不错。",
      "speech_act": "inform",
      "diagram_elements_added": [],
      "timestamp_offset": 30
    },
    {
      "turn_id": 3,
      "speaker": "Speaker_B",
      "utterance": "相较于方案A，Client有更好的性能。",
      "speech_act": "contrastive",
      "diagram_elements_added": [],
      "timestamp_offset": 45
    },
    {
      "turn_id": 4,
      "speaker": "Speaker_A",
      "utterance": "我的意思是Client应该这样理解...",
      "speech_act": "clarify",
      "diagram_elements_added": [
        "C"
      ],
      "timestamp_offset": 60
    },
    {
      "turn_id": 5,
      "speaker": "Speaker_B",
      "utterance": "整体架构包含Google OAuth、AuthController这几个部分。",
      "speech_act": "structural",
      "diagram_elements_added": [],
      "timestamp_offset": 75
    },
    {
      "turn_id": 6,
      "speaker": "Speaker_A",
      "utterance": "这个设计看起来不错。",
      "speech_act": "inform",
      "diagram_elements_added": [
        "G",
        "AC",
        "GOS"
      ],
      "timestamp_offset": 90
    },
    {
      "turn_id": 7,
      "speaker": "Speaker_B",
      "utterance": "Google Token API主要包含以下几类。",
      "speech_act": "classification",
      "diagram_elements_added": [],
      "timestamp_offset": 105
    },
    {
      "turn_id": 8,
      "speaker": "Speaker_A",
      "utterance": "明白了，Google Token API就这样设计。",
      "speech_act": "confirm",
      "diagram_elements_added": [
        "GT"
      ],
      "timestamp_offset": 120
    },
    {
      "turn_id": 9,
      "speaker": "Speaker_B",
      "utterance": "Google Validator、UserRepository主要包含以下几类。",
      "speech_act": "classification",
      "diagram_elements_added": [],
      "timestamp_offset": 135
    },
    {
      "turn_id": 10,
      "speaker": "Speaker_A",
      "utterance": "我的意思是Google Validator、UserRepository应该这样理解...",
      "speech_act": "clarify",
      "diagram_elements_added": [
        "GV",
        "UR"
      ],
      "timestamp_offset": 150
    },
    {
      "turn_id": 11,
      "speaker": "Speaker_B",
      "utterance": "PostgreSQL主要包含以下几类。",
      "speech_act": "classification",
      "diagram_elements_added": [],
      "timestamp_offset": 165
    },
    {
      "turn_id": 12,
      "speaker": "Speaker_A",
      "utterance": "好的，那就按这个方案。",
      "speech_act": "confirm",
      "diagram_elements_added": [
        "DB"
      ],
      "timestamp_offset": 180
    },
    {
      "turn_id": 13,
      "speaker": "Speaker_B",
      "utterance": "我们应该如何处理JwtTokenGenerator、Generate PKCE parameters？",
      "speech_act": "request",
      "diagram_elements_added": [],
      "timestamp_offset": 195
    },
    {
      "turn_id": 14,
      "speaker": "Speaker_A",
      "utterance": "我同意这个观点。",
      "speech_act": "inform",
      "diagram_elements_added": [],
      "timestamp_offset": 210
    },
    {
      "turn_id": 15,
      "speaker": "Speaker_B",
      "utterance": "最终，我们在JwtTokenGenerator、Generate PKCE parameters完成整个流程。",
      "speech_act": "sequential",
      "diagram_elements_added": [],
      "timestamp_offset": 225
    },
    {
      "turn_id": 16,
      "speaker": "Speaker_A",
      "utterance": "JwtTokenGenerator、Generate PKCE parameters负责具体的功能实现。",
      "speech_act": "structural",
      "diagram_elements_added": [
        "JTG",
        "msg_0"
      ],
      "timestamp_offset": 240
    },
    {
      "turn_id": 17,
      "speaker": "Speaker_B",
      "utterance": "我们可以将Redirect to Google OAuth分为几个类型。",
      "speech_act": "classification",
      "diagram_elements_added": [],
      "timestamp_offset": 255
    },
    {
      "turn_id": 18,
      "speaker": "Speaker_A",
      "utterance": "我的意思是Redirect to Google OAuth应该这样理解...",
      "speech_act": "clarify",
      "diagram_elements_added": [],
      "timestamp_offset": 270
    },
    {
      "turn_id": 19,
      "speaker": "Speaker_B",
      "utterance": "Redirect to Google OAuth主要包含以下几类。",
      "speech_act": "classification",
      "diagram_elements_added": [
        "msg_1"
      ],
      "timestamp_offset": 285
    },
    {
      "turn_id": 20,
      "speaker": "Speaker_A",
      "utterance": "从结构上看，我们有POST /api/auth/google-login<br/>{code, codeVerifier}。",
      "speech_act": "structural",
      "diagram_elements_added": [],
      "timestamp_offset": 300
    },
    {
      "turn_id": 21,
      "speaker": "Speaker_B",
      "utterance": "我的意思是POST /api/auth/google-login<br/>{code, codeVerifier}应该这样理解...",
      "speech_act": "clarify",
      "diagram_elements_added": [
        "msg_2"
      ],
      "timestamp_offset": 315
    },
    {
      "turn_id": 22,
      "speaker": "Speaker_A",
      "utterance": "我们可以将ExchangeCodeForTokens(code, codeVerifier)、POST https://oauth2.googleapis.com/token分为几个类型。",
      "speech_act": "classification",
      "diagram_elements_added": [],
      "timestamp_offset": 330
    },
    {
      "turn_id": 23,
      "speaker": "Speaker_B",
      "utterance": "让我澄清一下，ExchangeCodeForTokens(code, codeVerifier)、POST https://oauth2.googleapis.com/token的作用是...",
      "speech_act": "clarify",
      "diagram_elements_added": [
        "msg_3",
        "msg_4",
        "msg_5"
      ],
      "timestamp_offset": 345
    },
    {
      "turn_id": 24,
      "speaker": "Speaker_A",
      "utterance": "我们可以将FindByGoogleProviderId(sub)分为几个类型。",
      "speech_act": "classification",
      "diagram_elements_added": [],
      "timestamp_offset": 360
    },
    {
      "turn_id": 25,
      "speaker": "Speaker_B",
      "utterance": "这个设计看起来不错。",
      "speech_act": "inform",
      "diagram_elements_added": [],
      "timestamp_offset": 375
    },
    {
      "turn_id": 26,
      "speaker": "Speaker_A",
      "utterance": "FindByGoogleProviderId(sub)和另一个方案相比，优势在于...",
      "speech_act": "contrastive",
      "diagram_elements_added": [
        "msg_6"
      ],
      "timestamp_offset": 390
    },
    {
      "turn_id": 27,
      "speaker": "Speaker_B",
      "utterance": "你能详细说明一下SELECT * FROM Users<br/>WHERE GoogleProviderId = ?、GenerateAuthToken(userId)吗？",
      "speech_act": "request",
      "diagram_elements_added": [],
      "timestamp_offset": 405
    },
    {
      "turn_id": 28,
      "speaker": "Speaker_A",
      "utterance": "最后，流程到达SELECT * FROM Users<br/>WHERE GoogleProviderId = ?、GenerateAuthToken(userId)结束。",
      "speech_act": "sequential",
      "diagram_elements_added": [
        "msg_7",
        "msg_8"
      ],
      "timestamp_offset": 420
    }
  ],
  "dialogue_stats": {
    "total_turns": 28,
    "speaker_distribution": {
      "Speaker_B": 14,
      "Speaker_A": 14
    },
    "speech_act_distribution": {
      "sequential": 3,
      "inform": 4,
      "contrastive": 2,
      "clarify": 5,
      "structural": 3,
      "classification": 7,
      "confirm": 2,
      "request": 2
    },
    "avg_turn_length": 40.535714285714285,
    "dialogue_duration": 420
  }
}