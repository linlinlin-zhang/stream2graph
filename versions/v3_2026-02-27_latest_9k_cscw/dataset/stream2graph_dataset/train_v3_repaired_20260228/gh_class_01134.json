{
  "id": "gh_class_01134",
  "source": "github",
  "source_url": "https://github.com/tkin91e55/zmqNotifier/blob/31aa5819f73d974ed9644a0e323588241049fb7a/docs/config_uml.mmd",
  "github_repo": "tkin91e55/zmqNotifier",
  "github_file_path": "docs/config_uml.mmd",
  "diagram_type": "class",
  "code": "classDiagram\n    %% Enums\n    class StorageBackend {\n        <<enumeration>>\n        CSV\n        SQLITE\n    }\n\n\n    %% Simple Configuration Classes\n    class BrokerSettings {\n        +int brokertime_tz = 0\n    }\n\n    class ZmqSettings {\n        +str host = \"localhost\"\n        +int push_port = 32768\n        +int pull_port = 32769\n        +int sub_port = 32770\n        +str client_id = \"zmq-notifier\"\n    }\n\n    class StorageSettings {\n        +Path data_path = \"./data\"\n        +StorageBackend backend = CSV\n        +bool compression_enabled = true\n        +int retention_days = 180\n        +int flush_interval_minutes = 5\n    }\n\n    class DataValidationSettings {\n        +tuple~str~ supported_symbols\n        +tuple~str~ supported_timeframes\n        +_normalize_timeframes()\n    }\n\n    class LoggingSettings {\n        +str level = \"INFO\"\n        +str fmt\n        +str datefmt\n        +Path log_dir = \"./logs\"\n        +str file_name = \"runtime.log\"\n        +int max_bytes\n        +int backup_count\n        +bool console_enabled = true\n        +str|None console_level\n        +str|None file_level\n        +bool propagate = true\n        +dict~str,str~ loggers\n    }\n\n    %% ========================================================================\n    %% NOTIFIER CONFIGURATION HIERARCHY (grouped namespace)\n    %% ========================================================================\n    namespace NotifierHierarchy {\n        class TelegramSettings {\n            +str|None telegram_bot_token\n            +str|None telegram_chat_id\n        }\n\n        class SymbolTrackerConfig {\n            +int|None cooldown_unit\n            +int|None min_buckets_calculation\n            +dict~str,int~|None num_bucket_retention\n            +_upper_retention_keys()\n            +_validate_retention()\n        }\n\n        class SymbolNotifierConfig {\n            +dict~str,tuple~int,int~~ thresholds\n            +SymbolTrackerConfig|None tracker\n            +_validate_thresholds()\n        }\n\n        class NotificationDispatchSettings {\n            +int message_interval_seconds = 15\n            +TelegramSettings telegram\n        }\n\n        class NotifierSettings {\n            +dict~str,SymbolNotifierConfig~ symbols\n            +SymbolTrackerConfig tracker_defaults\n            +NotificationDispatchSettings dispatch\n            +_upper_symbol_keys()\n            +symbol_config(str) SymbolNotifierConfig|None\n            +resolve_tracker_config(str) SymbolTrackerConfig\n            +thresholds_for(str) dict~str,tuple~int,int~~|None\n        }\n    }\n    %% ========================================================================\n\n    %% Top-level Application Settings\n    class AppSettings {\n        +BrokerSettings broker\n        +ZmqSettings zmq\n        +StorageSettings storage\n        +DataValidationSettings validation\n        +NotifierSettings notifier\n        +LoggingSettings logging\n        +bool auto_create_dirs = true\n        +_materialise_directories()\n    }\n\n    %% Helper Functions\n    class UtilityFunctions {\n        <<utility>>\n        +_default_tracker_settings() SymbolTrackerConfig\n        +_ensure_directory(Path) Path\n        +_resolve_path(Path) Path\n        +configure_logging(LoggingSettings?) LoggingSettings\n        +get_settings(**overrides) AppSettings\n    }\n\n    class StdoutStreamHandler {\n        <<logging>>\n        +emit(LogRecord)\n    }\n\n    %% Relationships - Simple configs\n    StorageSettings --> StorageBackend : uses\n\n    %% Relationships - Notifier hierarchy (within namespace)\n    SymbolNotifierConfig o-- SymbolTrackerConfig : optional\n\n    NotificationDispatchSettings *-- TelegramSettings : contains\n    NotifierSettings *-- NotificationDispatchSettings : contains\n    NotifierSettings *-- SymbolTrackerConfig : tracker_defaults\n    NotifierSettings o-- SymbolNotifierConfig : symbols dict\n\n    %% Relationships - AppSettings to all configs\n    AppSettings *-- BrokerSettings : contains\n    AppSettings *-- ZmqSettings : contains\n    AppSettings *-- StorageSettings : contains\n    AppSettings *-- DataValidationSettings : contains\n    AppSettings *-- NotifierSettings : contains\n    AppSettings *-- LoggingSettings : contains\n\n    %% Utility relationships\n    UtilityFunctions ..> SymbolTrackerConfig : creates\n    UtilityFunctions ..> AppSettings : creates\n    UtilityFunctions ..> LoggingSettings : configures\n\n    %% Notes\n    note for NotifierSettings \"Contains helper methods to:<br>- Get symbol config<br>- Resolve tracker config with overrides<br>- Get thresholds per symbol\"\n    note for AppSettings \"Root configuration class<br>Loaded from .env with prefix:<br>ZMQ_NOTIFIER_\"\n    note for SymbolTrackerConfig \"NOTE: num_bucket_retention<br>REPLACES entire dict when<br>overriding, not merged\"\n",
  "content_size": 4737,
  "collected_at": "2026-02-06T01:53:26.082545",
  "compilation_status": "success",
  "compilation_error": "",
  "license": "mit",
  "license_name": "MIT License",
  "license_url": "https://api.github.com/licenses/mit",
  "repo_stars": 0,
  "repo_forks": 0,
  "cscw_dialogue": [
    {
      "turn_id": 1,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 <<enumeration>>\n        CSV\n        SQLITE\n     和 +int brokertime_tz = 0\n     的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 2,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '<<enumeration>>\n        CSV\n        SQLITE\n     和 +int brokertime_tz = 0\n    '？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 3,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 4,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "StorageBackend",
        "BrokerSettings"
      ],
      "is_repair": false
    },
    {
      "turn_id": 5,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 +str host = \"localhost\"\n        +int push_port = 32768\n        +int pull_port = 32769\n        +int sub_port = 32770\n        +str client_id = \"zmq-notifier\"\n     和 +Path data_path = \"./data\"\n        +StorageBackend backend = CSV\n        +bool compression_enabled = true\n        +int retention_days = 180\n        +int flush_interval_minutes = 5\n     的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 6,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '+str host = \"localhost\"\n        +int push_port = 32768\n        +int pull_port = 32769\n        +int sub_port = 32770\n        +str client_id = \"zmq-notifier\"\n     和 +Path data_path = \"./data\"\n        +StorageBackend backend = CSV\n        +bool compression_enabled = true\n        +int retention_days = 180\n        +int flush_interval_minutes = 5\n    '，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 7,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 8,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "ZmqSettings",
        "StorageSettings"
      ],
      "is_repair": false
    },
    {
      "turn_id": 9,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 +tuple~str~ supported_symbols\n        +tuple~str~ supported_timeframes\n        +_normalize_timeframes( 和 +str level = \"INFO\"\n        +str fmt\n        +str datefmt\n        +Path log_dir = \"./logs\"\n        +str file_name = \"runtime.log\"\n        +int max_bytes\n        +int backup_count\n        +bool console_enabled = true\n        +str|None console_level\n        +str|None file_level\n        +bool propagate = true\n        +dict~str,str~ loggers\n    。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 10,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '+tuple~str~ supported_symbols\n        +tuple~str~ supported_timeframes\n        +_normalize_timeframes( 和 +str level = \"INFO\"\n        +str fmt\n        +str datefmt\n        +Path log_dir = \"./logs\"\n        +str file_name = \"runtime.log\"\n        +int max_bytes\n        +int backup_count\n        +bool console_enabled = true\n        +str|None console_level\n        +str|None file_level\n        +bool propagate = true\n        +dict~str,str~ loggers\n    '？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 11,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 12,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "DataValidationSettings",
        "LoggingSettings"
      ],
      "is_repair": false
    },
    {
      "turn_id": 13,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 grouped namespace 和 class TelegramSettings {\n            +str|None telegram_bot_token\n            +str|None telegram_chat_id\n         的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 14,
      "role": "Domain_Expert",
      "action_type": "repair",
      "utterance": "不，其实叫 grouped namespace处理 会更准确一点。",
      "elements_involved": [],
      "is_repair": true
    },
    {
      "turn_id": 15,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 'grouped namespace处理'，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 16,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 17,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "HIERARCHY",
        "NotifierHierarchy"
      ],
      "is_repair": false
    },
    {
      "turn_id": 18,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 +int|None cooldown_unit\n            +int|None min_buckets_calculation\n            +dict~str,int~|None num_bucket_retention\n            +_upper_retention_keys( 和 +dict~str,tuple~int,int~~ thresholds\n            +SymbolTrackerConfig|None tracker\n            +_validate_thresholds(。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 19,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '+int|None cooldown_unit\n            +int|None min_buckets_calculation\n            +dict~str,int~|None num_bucket_retention\n            +_upper_retention_keys( 和 +dict~str,tuple~int,int~~ thresholds\n            +SymbolTrackerConfig|None tracker\n            +_validate_thresholds('，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 20,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 21,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "SymbolTrackerConfig",
        "SymbolNotifierConfig"
      ],
      "is_repair": false
    },
    {
      "turn_id": 22,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 +int message_interval_seconds = 15\n            +TelegramSettings telegram\n         和 +dict~str,SymbolNotifierConfig~ symbols\n            +SymbolTrackerConfig tracker_defaults\n            +NotificationDispatchSettings dispatch\n            +_upper_symbol_keys( 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 23,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '+int message_interval_seconds = 15\n            +TelegramSettings telegram\n         和 +dict~str,SymbolNotifierConfig~ symbols\n            +SymbolTrackerConfig tracker_defaults\n            +NotificationDispatchSettings dispatch\n            +_upper_symbol_keys('？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 24,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 25,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "NotificationDispatchSettings",
        "NotifierSettings"
      ],
      "is_repair": false
    },
    {
      "turn_id": 26,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "用户在这里会遇到 str 和 str 的分支。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 27,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 'str 和 str'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 28,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 29,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "symbol_config",
        "resolve_tracker_config"
      ],
      "is_repair": false
    },
    {
      "turn_id": 30,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 str 和 +BrokerSettings broker\n        +ZmqSettings zmq\n        +StorageSettings storage\n        +DataValidationSettings validation\n        +NotifierSettings notifier\n        +LoggingSettings logging\n        +bool auto_create_dirs = true\n        +_materialise_directories(。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 31,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 'str 和 +BrokerSettings broker\n        +ZmqSettings zmq\n        +StorageSettings storage\n        +DataValidationSettings validation\n        +NotifierSettings notifier\n        +LoggingSettings logging\n        +bool auto_create_dirs = true\n        +_materialise_directories('，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 32,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 33,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "thresholds_for",
        "AppSettings"
      ],
      "is_repair": false
    },
    {
      "turn_id": 34,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "用户在这里会遇到 <<utility>>\n        +_default_tracker_settings( 和 Path 的分支。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 35,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 '<<utility>>\n        +_default_tracker_settings( 和 Path'，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 36,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 37,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "UtilityFunctions",
        "_ensure_directory"
      ],
      "is_repair": false
    },
    {
      "turn_id": 38,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 Path 和 LoggingSettings? 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 39,
      "role": "Domain_Expert",
      "action_type": "repair",
      "utterance": "不，其实叫 Path处理 会更准确一点。",
      "elements_involved": [],
      "is_repair": true
    },
    {
      "turn_id": 40,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 'Path处理'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 41,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 42,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "_resolve_path",
        "configure_logging"
      ],
      "is_repair": false
    },
    {
      "turn_id": 43,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 **overrides 和 <<logging>>\n        +emit(LogRecord 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 44,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 '**overrides 和 <<logging>>\n        +emit(LogRecord'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 45,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 46,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "get_settings",
        "StdoutStreamHandler"
      ],
      "is_repair": false
    },
    {
      "turn_id": 47,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 within namespace 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 48,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 'within namespace'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 49,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 50,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "hierarchy"
      ],
      "is_repair": false
    }
  ],
  "dialogue_metadata": {
    "total_turns": 50,
    "repair_count": 2,
    "grounding_acts_count": 24,
    "theoretical_framework": "Grounding in Communication (Clark & Brennan, 1991)"
  },
  "repair_log": [
    "compilation_recovered_local_original"
  ],
  "repaired_at": "2026-02-28T13:41:21Z"
}