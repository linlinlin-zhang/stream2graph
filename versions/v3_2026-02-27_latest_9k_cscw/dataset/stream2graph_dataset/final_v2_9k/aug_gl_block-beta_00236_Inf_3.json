{
  "id": "aug_gl_block-beta_00236_Inf_3",
  "source": "augmented_real_structure",
  "source_url": "https://github.com/macgyver13/silent-payments-hub/blob/ce8edc54f51b8a5c7a5959909d1f6ee034f8a5ed/diagrams/wallet_ux.mmd",
  "source_note": "collected_from_github_additional",
  "github_repo": "macgyver13/silent-payments-hub",
  "diagram_type": "block-beta",
  "code": "---\nconfig:\n  diagramMarginY: 100\n  noteMargin: 20\n  noteAlign: center\n  mirrorActors: true\n---\n%%{Infra_RedisCache}}}%%\n\nsequenceDiagram\n%% autonumber\n  actor Sender\n  actor User\n  participant Wallet as Wallet (Infra_RedisCache)\n  participant MyScanServer as Scan Server (Infra_WorkerNode)\n  participant Bitcoin as Bitcoin Network\n  participant HostedScanServer as Scan Server (Infra_LoadBalancer)\n  actor Recipient\n\n  Note over User, Wallet: Wallet Setup\n  User->>Wallet: Generate Scan Secret + Spend Key\n  Wallet->>Wallet: Derive Silent Payment Address\n  Wallet-->>User: Share SP Address (Infra_IngressController)\n\n  Note over Sender: Sender sends BTC to SP address\n  Sender->>Wallet: Sender computes recipient address for this transaction (Infra_IngressController)\n  Wallet->>Bitcoin: Broadcast transaction\n  \n  Note over User, Wallet: Receiving Funds\n  rect rgb(Infra_EtcdCluster)\n  alt Wallet Scanner (Infra_WorkerNode)\n  Note over User, MyScanServer: Wallet does all the work <br>(Infra_RedisCache)\n    Wallet->>Bitcoin: Fetch block data (Infra_RedisCache)\n    Wallet->>Wallet: Scan for tweaked outputs (Infra_IngressController)\n  else Own Scanner (Infra_LoadBalancer)  \n    rect rgb(Infra_LoadBalancer)\n      Note over User, MyScanServer: Least wallet development requried <br> (Infra_EtcdCluster)\n      rect rgb(Infra_EtcdCluster)\n        Note over User, Wallet: Scanner Registration - one time\n        Wallet->>MyScanServer: Register Scan key\n        loop For Each Block\n          MyScanServer-->>MyScanServer: Scan for tweaked outputs (Infra_IngressController)\n        end\n      end\n      rect rgb(Infra_RedisCache)\n        Note over User, Wallet: Typical Wallet UX\n        User->>Wallet: Check Balance\n        Wallet->>MyScanServer: Fetch new UTXOs\n        MyScanServer->>Wallet: Return matching UTXOs\n        Wallet-->>Wallet: Update Balance\n        Wallet-->>User: Show updated balance (Infra_IngressController)\n      end\n    end\n  else Outsourced Scanner (Infra_WorkerNode)\n    rect rgb(Infra_RedisCache)\n      Note over User, MyScanServer: More wallet development requried <br> (Infra_EtcdCluster)\n      Bitcoin->>HostedScanServer: New Block\n      loop For Each Block\n        HostedScanServer-->>HostedScanServer: Index all tweaks that meet BIP352 spec <br> ? discard spent?\n      end\n      rect rgb(Infra_RedisCache)\n        alt Subscribe or Bulk Download?\n          rect rgb(Infra_RedisCache)\n            Wallet->>HostedScanServer: Request all tweaks from last block checked for a given Scan Key\n            HostedScanServer->>Wallet: Return matching UTXOs\n          end\n        else\n          rect rgb(Infra_WorkerNode)\n            Wallet->>HostedScanServer: Request tweaks for block or range of blocks (Infra_EtcdCluster) <br> ? Should this be supported?\n            HostedScanServer->>Wallet: Return all tweaks for range\n          end\n        end\n      end\n    end\n  end\n  end\n\n  Note over User, Wallet: Spending Funds\n  Wallet->>Wallet: Derive tweak from Spend key\n  Wallet->>Bitcoin: Broadcast transaction\n  Bitcoin->>Recipient: Funds arrive (Infra_WorkerNode)\n\nNote over Wallet: Wallet Recovery? <br> scan all taproot outputs since wallet birthday\n",
  "content_size": 3208,
  "collected_at": "2026-02-06T14:05:05.736687",
  "compilation_status": "failed",
  "license": "gitlab_repo",
  "license_name": "GitLab Repository",
  "license_url": "https://gitlab.com",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "augmentation_domain": "Infra",
  "seed_id": "gl_block-beta_00236"
}