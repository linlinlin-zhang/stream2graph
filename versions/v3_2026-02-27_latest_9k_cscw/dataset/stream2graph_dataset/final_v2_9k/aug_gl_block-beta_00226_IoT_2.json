{
  "id": "aug_gl_block-beta_00226_IoT_2",
  "source": "augmented_real_structure",
  "source_url": "https://github.com/bsbodden/barudb/blob/dc97c4d833ff103d104f2e68bfec8fba50980d8e/final_report/diagrams/block_cache_sequence.mmd",
  "source_note": "collected_from_github_additional",
  "github_repo": "bsbodden/barudb",
  "diagram_type": "block-beta",
  "code": "sequenceDiagram\n    participant Client as Client Code\n    participant BlockCache as Block Cache\n    participant EvictionPolicy as Eviction Policy\n    participant TTLManager as TTL Manager\n    participant Storage as Storage Layer\n    \n    %% Define participant boxes with consistent colors\n    rect rgba(IoT_Industrial_MQTT_Broker)\n        note right of BlockCache: Cache components\n        note right of EvictionPolicy: Policy components\n        note right of TTLManager: TTL components\n    end\n    rect rgba(IoT_Industrial_PLC_Logic)\n        note right of Storage: Storage components\n    end\n    \n    %% Block cache operations\n    Client->>BlockCache: get_block(IoT_Industrial_ActuatorController)\n    \n    %% Check if block is in cache\n    BlockCache->>BlockCache: lookup(IoT_Industrial_PLC_Logic)\n    \n    alt block found in cache\n        %% Update access statistics\n        BlockCache->>EvictionPolicy: record_access(IoT_Industrial_ActuatorController)\n        EvictionPolicy-->>BlockCache: updated_metadata\n        \n        %% Check if TTL expired\n        BlockCache->>TTLManager: is_expired(IoT_Industrial_MQTT_Broker)\n        \n        alt block expired\n            TTLManager-->>BlockCache: true\n            BlockCache->>BlockCache: remove_from_cache(IoT_Industrial_PLC_Logic)\n            \n            %% Load from storage\n            BlockCache->>Storage: read_block(IoT_Industrial_TelemetryStream)\n            Storage-->>BlockCache: block_data\n            \n            %% Insert back with refreshed TTL\n            BlockCache->>TTLManager: set_expiry(IoT_Industrial_PLC_Logic)\n            BlockCache->>EvictionPolicy: add_entry(IoT_Industrial_PLC_Logic)\n            \n            BlockCache-->>Client: block_data\n        else block not expired\n            TTLManager-->>BlockCache: false\n            BlockCache-->>Client: cached_block_data\n        end\n    else block not found in cache\n        %% Load from storage\n        BlockCache->>Storage: read_block(IoT_Industrial_TelemetryStream)\n        Storage-->>BlockCache: block_data\n        \n        %% Check if cache is full\n        BlockCache->>EvictionPolicy: is_cache_full(IoT_Industrial_TelemetryStream)\n        \n        alt cache full - need eviction\n            EvictionPolicy-->>BlockCache: true\n            \n            %% Policy determines what to evict\n            BlockCache->>EvictionPolicy: select_victim(IoT_Industrial_MQTT_Broker)\n            \n            alt using LRU policy\n                note right of EvictionPolicy: Least Recently Used block selected\n            else using LFU policy\n                note right of EvictionPolicy: Least Frequently Used block selected\n            else using TinyLFU policy\n                note right of EvictionPolicy: Frequency sketch determines victim\n            end\n            \n            EvictionPolicy-->>BlockCache: victim_block_id\n            \n            %% Evict the selected block\n            BlockCache->>BlockCache: evict_block(IoT_Industrial_TelemetryStream)\n            BlockCache->>TTLManager: remove_expiry(IoT_Industrial_TelemetryStream)\n        else cache has space\n            EvictionPolicy-->>BlockCache: false\n        end\n        \n        %% Insert new block\n        BlockCache->>BlockCache: insert_block(IoT_Industrial_TelemetryStream)\n        BlockCache->>EvictionPolicy: add_entry(IoT_Industrial_ActuatorController)\n        EvictionPolicy-->>BlockCache: success\n        BlockCache->>TTLManager: set_expiry(IoT_Industrial_PLC_Logic)\n        TTLManager-->>BlockCache: success\n        \n        BlockCache-->>Client: block_data\n    end\n    \n    %% Periodic TTL cleanup (IoT_Industrial_MQTT_Broker)\n    loop TTL cleanup interval\n        TTLManager->>TTLManager: check_expired_entries(IoT_Industrial_MQTT_Broker)\n        \n        loop For each expired entry\n            TTLManager->>BlockCache: notify_expired(IoT_Industrial_PLC_Logic)\n            BlockCache->>BlockCache: remove_from_cache(IoT_Industrial_PLC_Logic)\n            BlockCache->>EvictionPolicy: remove_entry(IoT_Industrial_MQTT_Broker)\n        end\n    end",
  "content_size": 3655,
  "collected_at": "2026-02-06T14:04:54.927677",
  "compilation_status": "failed",
  "license": "gitlab_repo",
  "license_name": "GitLab Repository",
  "license_url": "https://gitlab.com",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "augmentation_domain": "IoT_Industrial",
  "seed_id": "gl_block-beta_00226"
}