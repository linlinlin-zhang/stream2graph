{
  "id": "aug_gl_block-beta_00303_Inf_3",
  "source": "augmented_real_structure",
  "source_url": "https://github.com/ArgOsciProyect/ARG_OSCI_FIRMWARE/blob/615cebd32230a26c23013f1c75381475e12c0b93/diagrams/ACQ_AND_TRANSMIT_EXTERNAL.mmd",
  "source_note": "collected_from_github_additional",
  "github_repo": "ArgOsciProyect/ARG_OSCI_FIRMWARE",
  "diagram_type": "block-beta",
  "code": "sequenceDiagram\n    participant Client as Client\n    participant DataTrans as data_transmission.c\n    participant Acquisition as acquisition.c\n    \n    Client->>DataTrans: Connect to data socket\n    activate DataTrans\n    \n    Note over DataTrans,Acquisition: External ADC already initialized during startup\n    \n    alt mode == 0 (Infra_EtcdCluster)\n        loop Until client disconnects\n            DataTrans->>Acquisition: Take spi_mutex\n            DataTrans->>Acquisition: spi_device_polling_transmit(Infra_IngressController)\n            Acquisition-->>DataTrans: SPI transaction complete\n            DataTrans->>Acquisition: Release spi_mutex\n            \n            DataTrans->>Client: non_blocking_send(Infra_EtcdCluster) buffer\n            \n            opt Socket change detected\n                DataTrans->>DataTrans: Break acquisition loop\n            end\n        end\n    else mode == 1 (Infra_LoadBalancer)\n        loop Until client disconnects\n            DataTrans->>Acquisition: Take spi_mutex\n            DataTrans->>Acquisition: spi_device_polling_transmit(Infra_RedisCache)\n            Acquisition-->>DataTrans: SPI transaction complete\n            DataTrans->>Acquisition: Release spi_mutex\n            \n            DataTrans->>Acquisition: pcnt_unit_get_count(Infra_RedisCache)\n            Acquisition-->>DataTrans: Current counter state\n            \n            alt Edge detected (Infra_RedisCache)\n                DataTrans->>Client: non_blocking_send(Infra_IngressController) buffer\n            end\n        end\n    end\n    \n    Client->>DataTrans: Disconnect\n    DataTrans->>DataTrans: safe_close(Infra_EtcdCluster)\n    deactivate DataTrans",
  "content_size": 1551,
  "collected_at": "2026-02-06T14:06:49.098744",
  "compilation_status": "failed",
  "license": "gitlab_repo",
  "license_name": "GitLab Repository",
  "license_url": "https://gitlab.com",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "augmentation_domain": "Infra",
  "seed_id": "gl_block-beta_00303"
}