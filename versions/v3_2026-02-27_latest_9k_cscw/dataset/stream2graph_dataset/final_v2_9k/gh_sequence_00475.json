{
  "id": "gh_sequence_00475",
  "source": "github",
  "source_url": "https://github.com/DamienReichhart/ChatApp/blob/c4cc2ad171949d92ad0d8e0f12a4ddf246c319f3/documentation/uml/sequence/sequence-text-messaging-flow.mmd",
  "github_repo": "DamienReichhart/ChatApp",
  "github_file_path": "documentation/uml/sequence/sequence-text-messaging-flow.mmd",
  "diagram_type": "sequence",
  "code": "sequenceDiagram\n    %% Participants\n    participant ClientUI as Client UI\n    participant ChatController as Chat Controller\n    participant WebSocketSvc as WebSocketService\n    participant WebSocketHandler as WebSocketHandler\n    participant MsgProcessor as WebSocketMessageProcessor\n    participant StompSession as STOMP Session\n    participant ClientDB as Client Database\n    participant MessageDAO as Message DAO\n    participant ServerEndpoint as Server WebSocket Endpoint\n    participant ServerController as Message Controller\n    participant SessionService as Chat Session Service\n\n    %% Sending a Text Message\n    ClientUI->>ChatController: sendMessage()\n    ChatController->>MessageDAO: create(message)\n    MessageDAO->>ClientDB: INSERT INTO messages\n    ClientDB-->>MessageDAO: message.id\n    MessageDAO-->>ChatController: savedMessage\n    \n    ChatController->>WebSocketSvc: sendMessage(savedMessage)\n    WebSocketSvc->>WebSocketHandler: sendMessage(savedMessage)\n    WebSocketHandler->>MsgProcessor: sendMessage(savedMessage)\n    \n    MsgProcessor->>MsgProcessor: Create WebSocketMessageDTO\n    MsgProcessor->>StompSession: send(chatTopic + \"/message\", messageDTO)\n    StompSession->>ServerEndpoint: /app/chat/{chatId}/message\n    \n    ServerEndpoint->>ServerController: sendChatMessage(chatId, message)\n    ServerController->>ServerController: validateMessage(message, chatId, true)\n    Note over ServerController: Check if user is a participant<br/>in session registry\n    \n    alt Valid Message\n        ServerController->>SessionService: getUsersInChat(chatId)\n        ServerController->>ServerEndpoint: send to /topic/chat/{chatId}/message\n        \n        %% Message broadcast to all subscribers (including sender)\n        ServerEndpoint-->>StompSession: broadcast message\n        StompSession-->>MsgProcessor: handleFrame(frame)\n        MsgProcessor->>MsgProcessor: processChatMessage(dto)\n        MsgProcessor->>WebSocketHandler: notifyMessageReceived(message)\n        WebSocketHandler->>WebSocketSvc: onMessageReceived(message)\n        WebSocketSvc->>ChatController: notify message listeners\n        ChatController->>ClientUI: update UI with new message\n    else Invalid Message\n        ServerController->>ServerController: Create error message\n        ServerController->>ServerEndpoint: return error message\n        ServerEndpoint-->>StompSession: send error\n        StompSession-->>MsgProcessor: handleFrame(error)\n        MsgProcessor->>WebSocketHandler: notifyError(errorMessage)\n        WebSocketHandler->>WebSocketSvc: onError(errorMessage)\n        WebSocketSvc->>ChatController: notify error listeners\n        ChatController->>ClientUI: display error\n    end\n",
  "content_size": 2685,
  "collected_at": "2026-02-06T01:32:50.165849",
  "compilation_status": "failed",
  "license": "mit",
  "license_name": "MIT License",
  "license_url": "https://api.github.com/licenses/mit",
  "repo_stars": 1,
  "repo_forks": 0,
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}