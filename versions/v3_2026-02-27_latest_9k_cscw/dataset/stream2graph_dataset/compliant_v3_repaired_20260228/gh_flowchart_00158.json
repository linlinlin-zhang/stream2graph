{
  "id": "gh_flowchart_00158",
  "source": "github",
  "source_url": "https://github.com/wavlake/monorepo/blob/1f05fed26c5a064d7760c72567c2237055ed3e5d/architecture-simple.mmd",
  "github_repo": "wavlake/monorepo",
  "github_file_path": "architecture-simple.mmd",
  "diagram_type": "flowchart",
  "code": "---\nconfig:\n  theme: neo\n  layout: elk\n---\nflowchart TB\n subgraph subGraph0[\"Frontend Layer\"]\n        CLIENT[\"Web/Mobile App<br>and/or Third Party Client\"]\n        WALLET[\"Streaming Credit Wallet<br>Custom NIP (NIP-60)<br>\"]\n  end\n subgraph subGraph1[\"API Gateway Layer\"]\n        API[\"API Server<br>Go + Gin<br>JWT/NIP-98 Auth\"]\n        CDN[\"Content Middleware<br>Bearer Token Validation<br>402 Payment Required\"]\n  end\n subgraph subGraph2[\"Core Services\"]\n        AUTH[\"Authentication<br>Firebase + Nostr\"]\n        CONTENT[\"Content Management<br>Audio Files/Images\"]\n        MINT[\"Streaming Credit Mint<br>Cashu eCash<br>\"]\n  end\n subgraph subGraph3[\"Accounting\"]\n        ACCT[\"Accounting Service<br>Double-Entry Ledger\"]\n        ZBD[\"ZBD Integration<br>Lightning Payments\"]\n  end\n subgraph subGraph4[\"Data Layer\"]\n        DB1[(\"PostgreSQL<br>API DB\")]\n        DB2[(\"PostgreSQL<br>Accounting DB\")]\n        DB3[(\"PostgreSQL<br>Nutshell DB\")]\n        REDIS[(\"Redis<br>Cache/Sessions\")]\n        GCS[(\"Google Cloud<br>Storage<br>Audio/Images\")]\n  end\n subgraph subGraph5[\"Nostr Network\"]\n        NOSTR[\"Wavlake Relay\"]\n        NOSTR_PUBLIC[\"Public Relays\"]\n  end\n    CLIENT --> NOSTR & NOSTR_PUBLIC & CDN\n    WALLET <--> MINT\n    WALLET <-.-> CLIENT\n    CDN --> MINT & ZBD & GCS & REDIS\n    CLIENT -- Artist Users only --> API\n    API --> AUTH & CONTENT\n    AUTH --> DB1\n    CONTENT --> DB1 & GCS\n    ACCT --> DB2 & REDIS\n    MINT --> DB3\n    ZBD --> ACCT\n     CLIENT:::existing\n     WALLET:::existing\n     API:::existing\n     CDN:::middleware\n     AUTH:::existing\n     CONTENT:::existing\n     MINT:::existing\n     ACCT:::existing\n     ZBD:::existing\n     DB1:::data\n     DB2:::data\n     DB3:::data\n     REDIS:::data\n     GCS:::data\n     NOSTR:::external\n     NOSTR_PUBLIC:::external\n    classDef existing fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px,color:#000,font-weight:bold\n    classDef external fill:#e1f5fe,stroke:#0277bd,stroke-width:2px,color:#000,font-weight:bold\n    classDef data fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px,color:#000,font-weight:bold\n    classDef middleware fill:#fff9c4,stroke:#f57f17,stroke-width:3px,color:#000,font-weight:bold\n    style MINT fill:#FFF9C4,stroke:#FF6D00\n    style ACCT stroke:#FF6D00,fill:#FFCDD2\n    style ZBD stroke:#FF6D00,fill:#FFCDD2\n    style subGraph3 fill:#FFFFFF\n",
  "content_size": 2320,
  "collected_at": "2026-02-06T01:42:18.670849",
  "compilation_status": "success",
  "license": "mit",
  "license_name": "MIT License",
  "license_url": "https://api.github.com/licenses/mit",
  "repo_stars": 0,
  "repo_forks": 0,
  "compilation_error": "",
  "cscw_dialogue": [
    {
      "turn_id": 1,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 \"Frontend Layer\" 和 \"Web/Mobile App<br>and/or Third Party Client\" 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 2,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 '\"Frontend Layer\" 和 \"Web/Mobile App<br>and/or Third Party Client\"'，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 3,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 4,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "subGraph0",
        "CLIENT"
      ],
      "is_repair": false
    },
    {
      "turn_id": 5,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 \"Streaming Credit Wallet<br>Custom NIP (NIP-60 和 \"API Gateway Layer\"。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 6,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 '\"Streaming Credit Wallet<br>Custom NIP (NIP-60 和 \"API Gateway Layer\"'，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 7,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 8,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "WALLET",
        "subGraph1"
      ],
      "is_repair": false
    },
    {
      "turn_id": 9,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 \"API Server<br>Go + Gin<br>JWT/NIP-98 Auth\" 和 \"Content Middleware<br>Bearer Token Validation<br>402 Payment Required\" 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 10,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '\"API Server<br>Go + Gin<br>JWT/NIP-98 Auth\" 和 \"Content Middleware<br>Bearer Token Validation<br>402 Payment Required\"'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 11,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 12,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "API",
        "CDN"
      ],
      "is_repair": false
    },
    {
      "turn_id": 13,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "用户在这里会遇到 \"Core Services\" 和 \"Authentication<br>Firebase + Nostr\" 的分支。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 14,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 '\"Core Services\" 和 \"Authentication<br>Firebase + Nostr\"'，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 15,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 16,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "subGraph2",
        "AUTH"
      ],
      "is_repair": false
    },
    {
      "turn_id": 17,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 \"Content Management<br>Audio Files/Images\" 和 \"Streaming Credit Mint<br>Cashu eCash<br>\" 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 18,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 '\"Content Management<br>Audio Files/Images\" 和 \"Streaming Credit Mint<br>Cashu eCash<br>\"'，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 19,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 20,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "CONTENT",
        "MINT"
      ],
      "is_repair": false
    },
    {
      "turn_id": 21,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "用户在这里会遇到 \"Accounting\" 和 \"Accounting Service<br>Double-Entry Ledger\" 的分支。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 22,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '\"Accounting\" 和 \"Accounting Service<br>Double-Entry Ledger\"'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 23,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 24,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "subGraph3",
        "ACCT"
      ],
      "is_repair": false
    },
    {
      "turn_id": 25,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 \"ZBD Integration<br>Lightning Payments\" 和 \"Data Layer\" 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 26,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 '\"ZBD Integration<br>Lightning Payments\" 和 \"Data Layer\"'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 27,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 28,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "ZBD",
        "subGraph4"
      ],
      "is_repair": false
    },
    {
      "turn_id": 29,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 (\"PostgreSQL<br>API DB\" 和 (\"PostgreSQL<br>Accounting DB\"。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 30,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '(\"PostgreSQL<br>API DB\" 和 (\"PostgreSQL<br>Accounting DB\"'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 31,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 32,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "DB1",
        "DB2"
      ],
      "is_repair": false
    },
    {
      "turn_id": 33,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 (\"PostgreSQL<br>Nutshell DB\" 和 (\"Redis<br>Cache/Sessions\" 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 34,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 '(\"PostgreSQL<br>Nutshell DB\" 和 (\"Redis<br>Cache/Sessions\"'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 35,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 36,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "DB3",
        "REDIS"
      ],
      "is_repair": false
    },
    {
      "turn_id": 37,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 (\"Google Cloud<br>Storage<br>Audio/Images\" 和 \"Nostr Network\" 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 38,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 '(\"Google Cloud<br>Storage<br>Audio/Images\" 和 \"Nostr Network\"'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 39,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 40,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "GCS",
        "subGraph5"
      ],
      "is_repair": false
    },
    {
      "turn_id": 41,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 \"Wavlake Relay\" 和 \"Public Relays\" 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 42,
      "role": "Domain_Expert",
      "action_type": "repair",
      "utterance": "不，其实叫 \"Wavlake Relay\"处理 会更准确一点。",
      "elements_involved": [],
      "is_repair": true
    },
    {
      "turn_id": 43,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 '\"Wavlake Relay\"处理'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 44,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 45,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "NOSTR",
        "NOSTR_PUBLIC"
      ],
      "is_repair": false
    }
  ],
  "dialogue_metadata": {
    "total_turns": 45,
    "repair_count": 1,
    "grounding_acts_count": 22,
    "theoretical_framework": "Grounding in Communication (Clark & Brennan, 1991)"
  },
  "repair_log": [
    "compilation_recovered_local_original"
  ],
  "repaired_at": "2026-02-28T13:41:44Z"
}