{
  "id": "ot_journey_01064",
  "source": "other",
  "source_url": "https://github.com/alexfarlander/stitch-run/blob/97ed17d1aa70d69eaf4e348e021a4473f10c471b/docs/implementation/diagrams/database-schema.mmd",
  "source_type": "github_search",
  "github_repo": "alexfarlander/stitch-run",
  "diagram_type": "journey",
  "code": "erDiagram\n    %% Core Flow and Run Tables\n    stitch_flows ||--o{ stitch_runs : \"executes\"\n    stitch_flows ||--o{ stitch_flows : \"parent_of\"\n    stitch_flows ||--o{ stitch_flow_versions : \"has_versions\"\n    stitch_flows ||--o| stitch_flow_versions : \"current_version\"\n    stitch_flows ||--o{ stitch_entities : \"tracks\"\n    stitch_flows ||--o{ stitch_webhook_configs : \"receives_webhooks\"\n    \n    %% Run and Version Relationship\n    stitch_runs }o--|| stitch_flow_versions : \"executed_version\"\n    \n    %% Entity Relationships\n    stitch_entities ||--o{ stitch_journey_events : \"generates\"\n    stitch_entities ||--o{ stitch_runs : \"triggers\"\n    stitch_entities ||--o{ stitch_webhook_events : \"created_from\"\n    \n    %% Webhook System\n    stitch_webhook_configs ||--o{ stitch_webhook_events : \"receives\"\n    stitch_webhook_events }o--|| stitch_runs : \"triggers\"\n    \n    %% Media Library\n    stitch_media ||--o{ stitch_media : \"style_reference\"\n    stitch_media ||--o{ stitch_media : \"source_image\"\n    \n    %% ========================================================================\n    %% Table: stitch_flows\n    %% Purpose: Stores all canvases (BMC and Workflows)\n    %% ========================================================================\n    stitch_flows {\n        uuid id PK \"Primary key\"\n        text name \"Canvas name\"\n        jsonb graph \"Visual graph structure\"\n        text canvas_type \"bmc or workflow\"\n        uuid parent_id FK \"Parent canvas for hierarchy\"\n        uuid current_version_id FK \"Latest version\"\n        timestamptz created_at \"Creation timestamp\"\n        timestamptz updated_at \"Last update timestamp\"\n    }\n    \n    %% ========================================================================\n    %% Table: stitch_flow_versions\n    %% Purpose: Immutable snapshots of canvas versions\n    %% ========================================================================\n    stitch_flow_versions {\n        uuid id PK \"Primary key\"\n        uuid flow_id FK \"Parent flow\"\n        jsonb visual_graph \"UI graph with positions\"\n        jsonb execution_graph \"Optimized runtime graph\"\n        text commit_message \"Version description\"\n        timestamptz created_at \"Version creation time\"\n    }\n    \n    %% ========================================================================\n    %% Table: stitch_runs\n    %% Purpose: Tracks workflow execution instances\n    %% ========================================================================\n    stitch_runs {\n        uuid id PK \"Primary key\"\n        uuid flow_id FK \"Flow being executed\"\n        uuid flow_version_id FK \"Specific version executed\"\n        uuid entity_id FK \"Entity triggering run\"\n        jsonb node_states \"Current state of all nodes\"\n        jsonb trigger \"Trigger metadata\"\n        timestamptz created_at \"Run start time\"\n        timestamptz updated_at \"Last state update\"\n    }\n    \n    %% ========================================================================\n    %% Table: stitch_entities\n    %% Purpose: Tracks customers/leads moving through canvas\n    %% ========================================================================\n    stitch_entities {\n        uuid id PK \"Primary key\"\n        uuid canvas_id FK \"Canvas entity belongs to\"\n        text name \"Entity name\"\n        text avatar_url \"Avatar image URL\"\n        text entity_type \"customer, lead, churned\"\n        text current_node_id \"Current node position\"\n        text current_edge_id \"Current edge if traveling\"\n        numeric edge_progress \"Position on edge 0.0-1.0\"\n        jsonb journey \"Journey history array\"\n        jsonb metadata \"Additional entity data\"\n        timestamptz created_at \"Entity creation time\"\n        timestamptz updated_at \"Last position update\"\n    }\n    \n    %% ========================================================================\n    %% Table: stitch_journey_events\n    %% Purpose: Detailed event log of entity movements\n    %% ========================================================================\n    stitch_journey_events {\n        uuid id PK \"Primary key\"\n        uuid entity_id FK \"Entity generating event\"\n        text event_type \"Event type identifier\"\n        text node_id \"Related node if applicable\"\n        text edge_id \"Related edge if applicable\"\n        numeric progress \"Progress value 0.0-1.0\"\n        jsonb metadata \"Event-specific data\"\n        timestamptz timestamp \"Event occurrence time\"\n    }\n    \n    %% ========================================================================\n    %% Table: stitch_webhook_configs\n    %% Purpose: Webhook endpoint configurations\n    %% ========================================================================\n    stitch_webhook_configs {\n        uuid id PK \"Primary key\"\n        uuid canvas_id FK \"Canvas receiving webhooks\"\n        text name \"Config name\"\n        text source \"stripe, typeform, calendly\"\n        text endpoint_slug UK \"Unique URL slug\"\n        text secret \"Webhook signature secret\"\n        uuid workflow_id FK \"Workflow to trigger\"\n        text entry_edge_id \"Edge to inject entity\"\n        jsonb entity_mapping \"Field mapping config\"\n        boolean is_active \"Enable/disable webhook\"\n        timestamptz created_at \"Config creation time\"\n        timestamptz updated_at \"Last config update\"\n    }\n    \n    %% ========================================================================\n    %% Table: stitch_webhook_events\n    %% Purpose: Log of received webhook events\n    %% ========================================================================\n    stitch_webhook_events {\n        uuid id PK \"Primary key\"\n        uuid webhook_config_id FK \"Config that received event\"\n        timestamptz received_at \"Event receipt time\"\n        jsonb payload \"Raw webhook payload\"\n        uuid entity_id FK \"Created entity\"\n        uuid workflow_run_id FK \"Triggered run\"\n        text status \"pending, processed, failed\"\n        text error \"Error message if failed\"\n        timestamptz processed_at \"Processing completion time\"\n    }\n    \n    %% ========================================================================\n    %% Table: stitch_media\n    %% Purpose: Centralized media asset library\n    %% ========================================================================\n    stitch_media {\n        uuid id PK \"Primary key\"\n        text name \"Asset name\"\n        text description \"Asset description\"\n        text media_type \"image, video, audio, etc\"\n        text storage_path \"Storage bucket path\"\n        text url \"Public URL\"\n        text thumbnail_path \"Thumbnail storage path\"\n        text thumbnail_url \"Thumbnail public URL\"\n        integer file_size \"File size in bytes\"\n        text mime_type \"MIME type\"\n        numeric duration_seconds \"Duration for audio/video\"\n        jsonb dimensions \"Width and height\"\n        jsonb metadata \"Additional metadata\"\n        text[] tags \"Searchable tags array\"\n        uuid style_reference_id FK \"Style reference asset\"\n        uuid source_image_id FK \"Source image asset\"\n        uuid user_id FK \"Owner user ID\"\n        timestamptz created_at \"Asset creation time\"\n        timestamptz updated_at \"Last asset update\"\n    }\n",
  "content_size": 7119,
  "collected_at": "2026-02-06T11:02:46.342167",
  "compilation_status": "success",
  "license": "other_source",
  "license_name": "Other Source (GitHub-based)",
  "compilation_error": "",
  "cscw_dialogue": [
    {
      "turn_id": 1,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 stitch_runs : \"executes\"\n    stitch_flows ||--o{ stitch_flows : \"parent_of\"\n    stitch_flows ||--o{ stitch_flow_versions : \"has_versions\"\n    stitch_flows ||--o| stitch_flow_versions : \"current_version\"\n    stitch_flows ||--o{ stitch_entities : \"tracks\"\n    stitch_flows ||--o{ stitch_webhook_configs : \"receives_webhooks\"\n    \n    %% Run and Version Relationship\n    stitch_runs  和 stitch_journey_events : \"generates\"\n    stitch_entities ||--o{ stitch_runs : \"triggers\"\n    stitch_entities ||--o{ stitch_webhook_events : \"created_from\"\n    \n    %% Webhook System\n    stitch_webhook_configs ||--o{ stitch_webhook_events : \"receives\"\n    stitch_webhook_events  的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 2,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 'stitch_runs : \"executes\"\n    stitch_flows ||--o{ stitch_flows : \"parent_of\"\n    stitch_flows ||--o{ stitch_flow_versions : \"has_versions\"\n    stitch_flows ||--o| stitch_flow_versions : \"current_version\"\n    stitch_flows ||--o{ stitch_entities : \"tracks\"\n    stitch_flows ||--o{ stitch_webhook_configs : \"receives_webhooks\"\n    \n    %% Run and Version Relationship\n    stitch_runs  和 stitch_journey_events : \"generates\"\n    stitch_entities ||--o{ stitch_runs : \"triggers\"\n    stitch_entities ||--o{ stitch_webhook_events : \"created_from\"\n    \n    %% Webhook System\n    stitch_webhook_configs ||--o{ stitch_webhook_events : \"receives\"\n    stitch_webhook_events '，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 3,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 4,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "o",
        "o"
      ],
      "is_repair": false
    },
    {
      "turn_id": 5,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "用户在这里会遇到 stitch_media : \"style_reference\"\n    stitch_media ||--o{ stitch_media : \"source_image\"\n    \n    %% ========================================================================\n    %% Table: stitch_flows\n    %% Purpose: Stores all canvases (BMC and Workflows 和 uuid id PK \"Primary key\"\n        text name \"Canvas name\"\n        jsonb graph \"Visual graph structure\"\n        text canvas_type \"bmc or workflow\"\n        uuid parent_id FK \"Parent canvas for hierarchy\"\n        uuid current_version_id FK \"Latest version\"\n        timestamptz created_at \"Creation timestamp\"\n        timestamptz updated_at \"Last update timestamp\"\n     的分支。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 6,
      "role": "Domain_Expert",
      "action_type": "repair",
      "utterance": "等等，我重新想了一下，应该是 stitch_media : \"style_reference\"\n    stitch_media ||--o{ stitch_media : \"source_image\"\n    \n    %% ========================================================================\n    %% Table: stitch_flows\n    %% Purpose: Stores all canvases (BMC and Workflows处理 才对。",
      "elements_involved": [],
      "is_repair": true
    },
    {
      "turn_id": 7,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 'stitch_media : \"style_reference\"\n    stitch_media ||--o{ stitch_media : \"source_image\"\n    \n    %% ========================================================================\n    %% Table: stitch_flows\n    %% Purpose: Stores all canvases (BMC and Workflows处理'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 8,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 9,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "o",
        "stitch_flows"
      ],
      "is_repair": false
    },
    {
      "turn_id": 10,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 uuid id PK \"Primary key\"\n        uuid flow_id FK \"Parent flow\"\n        jsonb visual_graph \"UI graph with positions\"\n        jsonb execution_graph \"Optimized runtime graph\"\n        text commit_message \"Version description\"\n        timestamptz created_at \"Version creation time\"\n     和 uuid id PK \"Primary key\"\n        uuid flow_id FK \"Flow being executed\"\n        uuid flow_version_id FK \"Specific version executed\"\n        uuid entity_id FK \"Entity triggering run\"\n        jsonb node_states \"Current state of all nodes\"\n        jsonb trigger \"Trigger metadata\"\n        timestamptz created_at \"Run start time\"\n        timestamptz updated_at \"Last state update\"\n    。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 11,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 'uuid id PK \"Primary key\"\n        uuid flow_id FK \"Parent flow\"\n        jsonb visual_graph \"UI graph with positions\"\n        jsonb execution_graph \"Optimized runtime graph\"\n        text commit_message \"Version description\"\n        timestamptz created_at \"Version creation time\"\n     和 uuid id PK \"Primary key\"\n        uuid flow_id FK \"Flow being executed\"\n        uuid flow_version_id FK \"Specific version executed\"\n        uuid entity_id FK \"Entity triggering run\"\n        jsonb node_states \"Current state of all nodes\"\n        jsonb trigger \"Trigger metadata\"\n        timestamptz created_at \"Run start time\"\n        timestamptz updated_at \"Last state update\"\n    '。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 12,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 13,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "stitch_flow_versions",
        "stitch_runs"
      ],
      "is_repair": false
    },
    {
      "turn_id": 14,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 uuid id PK \"Primary key\"\n        uuid canvas_id FK \"Canvas entity belongs to\"\n        text name \"Entity name\"\n        text avatar_url \"Avatar image URL\"\n        text entity_type \"customer, lead, churned\"\n        text current_node_id \"Current node position\"\n        text current_edge_id \"Current edge if traveling\"\n        numeric edge_progress \"Position on edge 0.0-1.0\"\n        jsonb journey \"Journey history array\"\n        jsonb metadata \"Additional entity data\"\n        timestamptz created_at \"Entity creation time\"\n        timestamptz updated_at \"Last position update\"\n     和 uuid id PK \"Primary key\"\n        uuid entity_id FK \"Entity generating event\"\n        text event_type \"Event type identifier\"\n        text node_id \"Related node if applicable\"\n        text edge_id \"Related edge if applicable\"\n        numeric progress \"Progress value 0.0-1.0\"\n        jsonb metadata \"Event-specific data\"\n        timestamptz timestamp \"Event occurrence time\"\n    。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 15,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 'uuid id PK \"Primary key\"\n        uuid canvas_id FK \"Canvas entity belongs to\"\n        text name \"Entity name\"\n        text avatar_url \"Avatar image URL\"\n        text entity_type \"customer, lead, churned\"\n        text current_node_id \"Current node position\"\n        text current_edge_id \"Current edge if traveling\"\n        numeric edge_progress \"Position on edge 0.0-1.0\"\n        jsonb journey \"Journey history array\"\n        jsonb metadata \"Additional entity data\"\n        timestamptz created_at \"Entity creation time\"\n        timestamptz updated_at \"Last position update\"\n     和 uuid id PK \"Primary key\"\n        uuid entity_id FK \"Entity generating event\"\n        text event_type \"Event type identifier\"\n        text node_id \"Related node if applicable\"\n        text edge_id \"Related edge if applicable\"\n        numeric progress \"Progress value 0.0-1.0\"\n        jsonb metadata \"Event-specific data\"\n        timestamptz timestamp \"Event occurrence time\"\n    '。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 16,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 17,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "stitch_entities",
        "stitch_journey_events"
      ],
      "is_repair": false
    },
    {
      "turn_id": 18,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 uuid id PK \"Primary key\"\n        uuid canvas_id FK \"Canvas receiving webhooks\"\n        text name \"Config name\"\n        text source \"stripe, typeform, calendly\"\n        text endpoint_slug UK \"Unique URL slug\"\n        text secret \"Webhook signature secret\"\n        uuid workflow_id FK \"Workflow to trigger\"\n        text entry_edge_id \"Edge to inject entity\"\n        jsonb entity_mapping \"Field mapping config\"\n        boolean is_active \"Enable/disable webhook\"\n        timestamptz created_at \"Config creation time\"\n        timestamptz updated_at \"Last config update\"\n     和 uuid id PK \"Primary key\"\n        uuid webhook_config_id FK \"Config that received event\"\n        timestamptz received_at \"Event receipt time\"\n        jsonb payload \"Raw webhook payload\"\n        uuid entity_id FK \"Created entity\"\n        uuid workflow_run_id FK \"Triggered run\"\n        text status \"pending, processed, failed\"\n        text error \"Error message if failed\"\n        timestamptz processed_at \"Processing completion time\"\n     的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 19,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 'uuid id PK \"Primary key\"\n        uuid canvas_id FK \"Canvas receiving webhooks\"\n        text name \"Config name\"\n        text source \"stripe, typeform, calendly\"\n        text endpoint_slug UK \"Unique URL slug\"\n        text secret \"Webhook signature secret\"\n        uuid workflow_id FK \"Workflow to trigger\"\n        text entry_edge_id \"Edge to inject entity\"\n        jsonb entity_mapping \"Field mapping config\"\n        boolean is_active \"Enable/disable webhook\"\n        timestamptz created_at \"Config creation time\"\n        timestamptz updated_at \"Last config update\"\n     和 uuid id PK \"Primary key\"\n        uuid webhook_config_id FK \"Config that received event\"\n        timestamptz received_at \"Event receipt time\"\n        jsonb payload \"Raw webhook payload\"\n        uuid entity_id FK \"Created entity\"\n        uuid workflow_run_id FK \"Triggered run\"\n        text status \"pending, processed, failed\"\n        text error \"Error message if failed\"\n        timestamptz processed_at \"Processing completion time\"\n    '？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 20,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 21,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "stitch_webhook_configs",
        "stitch_webhook_events"
      ],
      "is_repair": false
    },
    {
      "turn_id": 22,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 uuid id PK \"Primary key\"\n        text name \"Asset name\"\n        text description \"Asset description\"\n        text media_type \"image, video, audio, etc\"\n        text storage_path \"Storage bucket path\"\n        text url \"Public URL\"\n        text thumbnail_path \"Thumbnail storage path\"\n        text thumbnail_url \"Thumbnail public URL\"\n        integer file_size \"File size in bytes\"\n        text mime_type \"MIME type\"\n        numeric duration_seconds \"Duration for audio/video\"\n        jsonb dimensions \"Width and height\"\n        jsonb metadata \"Additional metadata\"\n        text[ 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 23,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 'uuid id PK \"Primary key\"\n        text name \"Asset name\"\n        text description \"Asset description\"\n        text media_type \"image, video, audio, etc\"\n        text storage_path \"Storage bucket path\"\n        text url \"Public URL\"\n        text thumbnail_path \"Thumbnail storage path\"\n        text thumbnail_url \"Thumbnail public URL\"\n        integer file_size \"File size in bytes\"\n        text mime_type \"MIME type\"\n        numeric duration_seconds \"Duration for audio/video\"\n        jsonb dimensions \"Width and height\"\n        jsonb metadata \"Additional metadata\"\n        text['，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 24,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 25,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "stitch_media"
      ],
      "is_repair": false
    }
  ],
  "dialogue_metadata": {
    "total_turns": 25,
    "repair_count": 1,
    "grounding_acts_count": 12,
    "theoretical_framework": "Grounding in Communication (Clark & Brennan, 1991)"
  },
  "repair_log": [
    "compilation_recovered_local_original"
  ],
  "repaired_at": "2026-02-28T13:41:46Z"
}