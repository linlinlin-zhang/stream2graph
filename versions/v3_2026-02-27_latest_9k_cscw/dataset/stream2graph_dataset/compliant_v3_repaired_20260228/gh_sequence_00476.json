{
  "id": "gh_sequence_00476",
  "source": "github",
  "source_url": "https://github.com/DamienReichhart/ChatApp/blob/c4cc2ad171949d92ad0d8e0f12a4ddf246c319f3/documentation/uml/sequence/sequence-connection-flow.mmd",
  "github_repo": "DamienReichhart/ChatApp",
  "github_file_path": "documentation/uml/sequence/sequence-connection-flow.mmd",
  "diagram_type": "sequence",
  "code": "sequenceDiagram\n    %% Participants\n    participant ClientUI as Client UI\n    participant AuthController as Auth Controller\n    participant SessionSvc as SessionService\n    participant WebSocketSvc as WebSocketService\n    participant WebSocketHandler as WebSocketHandler\n    participant ConnManager as WebSocketConnectionManager\n    participant StompClient as STOMP Client\n    participant ClientDB as Client Database\n    participant UserDAO as User DAO\n    participant ServerEndpoint as Server WebSocket Endpoint\n    participant ServerController as Server Controller\n\n    %% Connection Flow\n    ClientUI->>AuthController: login(username, password)\n    AuthController->>UserDAO: getUserByCredentials(username, password)\n    UserDAO->>ClientDB: SELECT * FROM users\n    ClientDB-->>UserDAO: userData\n    UserDAO-->>AuthController: authenticatedUser\n    \n    alt Authentication Success\n        AuthController->>SessionSvc: setCurrentUser(authenticatedUser)\n        SessionSvc->>AuthController: sessionStarted\n        AuthController->>WebSocketSvc: connect(authenticatedUser)\n        WebSocketSvc->>WebSocketSvc: this.currentUser = user\n        WebSocketSvc->>WebSocketHandler: connect(user)\n        WebSocketHandler->>ConnManager: connect(user)\n        ConnManager->>ConnManager: this.currentUser = user\n        ConnManager->>ConnManager: createWebSocketClient()\n        ConnManager->>StompClient: connect()\n        StompClient->>ServerEndpoint: WebSocket connection request\n        \n        %% Async Connection Handling\n        ServerEndpoint-->>StompClient: connection established\n        StompClient-->>ConnManager: stompSession created\n        ConnManager->>WebSocketHandler: handleSuccessfulConnection(session)\n        WebSocketHandler->>WebSocketSvc: onConnectionStatusChanged(true)\n        WebSocketSvc->>WebSocketSvc: processPendingJoins()\n        \n        Note over WebSocketSvc: Process any chats<br/>waiting to be joined\n        \n        WebSocketSvc->>AuthController: notify connection listeners\n        AuthController->>ClientUI: update UI (connected)\n        \n        %% Load user data from local database\n        AuthController->>SessionSvc: loadUserData()\n        SessionSvc->>UserDAO: getUserChats(userId)\n        UserDAO->>ClientDB: SELECT * FROM chat_participants WHERE user_id = ?\n        ClientDB-->>UserDAO: chatParticipantData\n        UserDAO-->>SessionSvc: userChats\n        SessionSvc-->>AuthController: userData loaded\n        AuthController->>ClientUI: navigate to main view\n    else Authentication Failure\n        AuthController->>ClientUI: show error message\n    end\n    \n    %% Error Handling Path (Alternative Flow)\n    ServerEndpoint--xStompClient: connection error\n    StompClient--xConnManager: connection error\n    ConnManager->>WebSocketHandler: handleTransportError(session, exception)\n    WebSocketHandler->>WebSocketSvc: onError(errorMessage)\n    WebSocketSvc->>AuthController: notify error listeners\n    AuthController->>ClientUI: show connection error\n",
  "content_size": 2989,
  "collected_at": "2026-02-06T01:32:50.845607",
  "compilation_status": "success",
  "license": "mit",
  "license_name": "MIT License",
  "license_url": "https://api.github.com/licenses/mit",
  "repo_stars": 1,
  "repo_forks": 0,
  "compilation_error": "",
  "cscw_dialogue": [
    {
      "turn_id": 1,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 username, password 和 username, password。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 2,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 'username, password 和 username, password'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 3,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 4,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "login",
        "getUserByCredentials"
      ],
      "is_repair": false
    },
    {
      "turn_id": 5,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "用户在这里会遇到 authenticatedUser 和 authenticatedUser 的分支。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 6,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 'authenticatedUser 和 authenticatedUser'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 7,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 8,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "setCurrentUser",
        "connect"
      ],
      "is_repair": false
    },
    {
      "turn_id": 9,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 user 和 user 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 10,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 'user 和 user'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 11,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 12,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "connect",
        "connect"
      ],
      "is_repair": false
    },
    {
      "turn_id": 13,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 session 和 true。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 14,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 'session 和 true'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 15,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 16,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "handleSuccessfulConnection",
        "onConnectionStatusChanged"
      ],
      "is_repair": false
    },
    {
      "turn_id": 17,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 connected 和 userId 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 18,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 'connected 和 userId'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 19,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 20,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "UI",
        "getUserChats"
      ],
      "is_repair": false
    },
    {
      "turn_id": 21,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 Alternative Flow 和 session, exception。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 22,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 'Alternative Flow 和 session, exception'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 23,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 24,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "Path",
        "handleTransportError"
      ],
      "is_repair": false
    },
    {
      "turn_id": 25,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 errorMessage 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 26,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 'errorMessage'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 27,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 28,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "onError"
      ],
      "is_repair": false
    }
  ],
  "dialogue_metadata": {
    "total_turns": 28,
    "repair_count": 0,
    "grounding_acts_count": 14,
    "theoretical_framework": "Grounding in Communication (Clark & Brennan, 1991)"
  },
  "repair_log": [
    "compilation_recovered_local_original"
  ],
  "repaired_at": "2026-02-28T13:41:44Z"
}