{
  "id": "ot_pie_00850",
  "source": "other",
  "source_url": "https://github.com/kotek-7/minpuzz/blob/654b51056933c621c2671ca993745a92ad3af09d/docs/sequence-game-connection.mmd",
  "source_type": "github_search_special",
  "github_repo": "kotek-7/minpuzz",
  "diagram_type": "pie",
  "code": "%%{init: {'theme':'default', 'themeVariables': {'primaryColor': '#4f46e5', 'primaryTextColor': '#fff', 'primaryBorderColor': '#3730a3', 'lineColor': '#374151', 'secondaryColor': '#e5e7eb', 'tertiaryColor': '#f3f4f6'}}}%%\n\nsequenceDiagram\n    participant U1 as ユーザー1\n    participant F1 as フロントエンド1\n    participant B as バックエンド\n    participant R as Redis\n    participant F2 as フロントエンド2\n    participant U2 as ユーザー2\n\n    Note over U1,U2: ゲーム接続フェーズ（match-found 後）\n\n    par 両チームに並行通知\n        B->>F1: Socket to teamA: match-found（matchId, self, partner）\n        F1->>F1: ゲーム画面に遷移（接続待ち表示）\n    and\n        B->>F2: Socket to teamB: match-found（同一ペイロード）\n        F2->>F2: ゲーム画面に遷移（接続待ち表示）\n    end\n\n    Note over F1,F2: 各プレイヤーがゲームルームに接続登録（参加直後に game-init を受信）\n    par 両チームが並行接続\n        U1->>F1: ゲーム接続開始\n        F1->>B: Socket emit: join-game（matchId, teamId, userId）\n        B-->>F1: game-init（board, pieces, startedAt?, duration?）\n        Note over B,F1: 即座に本人へ state-sync も送出（最新全量）\n        B-->>F1: state-sync（board, pieces, score, timer?, matchStatus）\n        Note over B: publicルームへ参加（progress/game-end/timer-sync用）\n        B->>B: room:match:{id}:public に join\n        B->>R: SADD match:{matchId}:team:{teamId}:connected userId\n    and\n        U2->>F2: ゲーム接続開始\n        F2->>B: Socket emit: join-game（matchId, teamId, userId）\n        B-->>F2: game-init（board, pieces, startedAt?, duration?）\n        B-->>F2: state-sync（board, pieces, score, timer?, matchStatus）\n        B->>B: room:match:{id}:public に join\n        B->>R: SADD match:{matchId}:team:{teamId}:connected userId\n    end\n\n    B->>R: 接続数を確認（teamA/B が期待人数に到達?）\n    alt 全プレイヤーが接続完了\n        R-->>B: 達成\n        B->>R: match を READY に更新、チーム両方を IN_GAME に更新\n        Note over B: ゲーム開始通知（チームルームに限定）＋タイマー開始\n        B->>F1: Socket to teamA room: game-start（matchId）\n        B->>F2: Socket to teamB room: game-start（matchId）\n        B->>R: match:{id}:timer = {startedAt, durationMs}\n        Note over B: timer-sync を public に5秒周期で送出開始\n    else まだ接続待ち\n        Note over U1,U2: 接続待ち表示を継続\n    end\n\n    Note over U1,U2: 次: docs/in-game/sequence-in-game.mmd（game-start以後のゲーム操作）\n",
  "content_size": 2111,
  "collected_at": "2026-02-06T10:47:53.768596",
  "compilation_status": "success",
  "license": "other_source",
  "license_name": "Other Source (GitHub-based)",
  "compilation_error": "",
  "cscw_dialogue": [
    {
      "turn_id": 1,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "用户在这里会遇到 主架构 的分支。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 2,
      "role": "Domain_Expert",
      "action_type": "repair",
      "utterance": "不，其实叫 主架构处理 会更准确一点。",
      "elements_involved": [],
      "is_repair": true
    },
    {
      "turn_id": 3,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '主架构处理'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 4,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 5,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "root"
      ],
      "is_repair": false
    }
  ],
  "dialogue_metadata": {
    "total_turns": 5,
    "repair_count": 1,
    "grounding_acts_count": 2,
    "theoretical_framework": "Grounding in Communication (Clark & Brennan, 1991)"
  },
  "repair_log": [
    "compilation_recovered_local_original"
  ],
  "repaired_at": "2026-02-28T13:41:35Z"
}