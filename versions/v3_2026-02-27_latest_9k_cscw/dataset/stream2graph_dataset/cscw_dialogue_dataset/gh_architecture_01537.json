{
  "id": "gh_architecture_01537",
  "source": "github",
  "source_url": "https://github.com/timothywarner/az305/blob/f1dac63440bdff4359294c400acb349c6f12671c/images/governance-hierarchy.mmd",
  "github_repo": "timothywarner/az305",
  "github_file_path": "images/governance-hierarchy.mmd",
  "diagram_type": "architecture",
  "code": "%% AZ-305 Domain 1: Management Group Hierarchy with Policy Inheritance\n%% Reference: Azure Landing Zone architecture - CAF best practices\n%% Exam Focus: Resource organization, policy inheritance, governance scope\n\nflowchart TB\n    subgraph ROOT[\"Tenant Root Group\"]\n        direction TB\n        ROOT_MG[\"**Root Management Group**<br/>Enterprise-wide Policies<br/>- Allowed Locations<br/>- Audit Diagnostics\"]\n\n        subgraph PLATFORM[\"Platform Management Groups\"]\n            direction TB\n            PLATFORM_MG[\"**Platform MG**<br/>Shared Services Policies\"]\n\n            IDENTITY_MG[\"**Identity MG**<br/>- AD DS Policies<br/>- MFA Requirements\"]\n            MGMT_MG[\"**Management MG**<br/>- Monitoring Policies<br/>- Backup Requirements\"]\n            CONN_MG[\"**Connectivity MG**<br/>- Network Policies<br/>- Firewall Rules\"]\n\n            IDENTITY_SUB[/\"Identity Subscription<br/>AD DS, Entra ID Connect\"/]\n            MGMT_SUB[/\"Management Subscription<br/>Log Analytics, Automation<br/>Recovery Services Vault\"/]\n            CONN_SUB[/\"Connectivity Subscription<br/>Hub VNet, Azure Firewall<br/>ExpressRoute Gateway\"/]\n        end\n\n        subgraph LANDING[\"Landing Zones Management Groups\"]\n            direction TB\n            LZ_MG[\"**Landing Zones MG**<br/>Workload Policies<br/>- Required Tags<br/>- VM SKU Restrictions\"]\n\n            CORP_MG[\"**Corp MG**<br/>Internal Workloads<br/>- Deny Public IP<br/>- Private Endpoints Only\"]\n            ONLINE_MG[\"**Online MG**<br/>Internet-facing<br/>- WAF Required<br/>- DDoS Protection\"]\n\n            CORP_PROD[/\"Corp-Prod Subscription<br/>Production Workloads\"/]\n            CORP_DEV[/\"Corp-Dev Subscription<br/>Dev/Test Workloads\"/]\n            ONLINE_PROD[/\"Online-Prod Subscription<br/>Public Applications\"/]\n            ONLINE_DEV[/\"Online-Dev Subscription<br/>Public Dev/Test\"/]\n        end\n\n        subgraph SANDBOX[\"Sandbox Environment\"]\n            SANDBOX_MG[\"**Sandbox MG**<br/>Relaxed Policies<br/>- No VNet Peering<br/>- Budget Limits\"]\n            SANDBOX_SUB[/\"Sandbox Subscriptions<br/>Exploration & Testing\"/]\n        end\n\n        DECOMM_MG[\"**Decommissioned MG**<br/>Deny All Policy<br/>Audit Only\"]\n    end\n\n    %% Hierarchy connections\n    ROOT_MG --> PLATFORM_MG\n    ROOT_MG --> LZ_MG\n    ROOT_MG --> SANDBOX_MG\n    ROOT_MG --> DECOMM_MG\n\n    PLATFORM_MG --> IDENTITY_MG\n    PLATFORM_MG --> MGMT_MG\n    PLATFORM_MG --> CONN_MG\n\n    IDENTITY_MG --> IDENTITY_SUB\n    MGMT_MG --> MGMT_SUB\n    CONN_MG --> CONN_SUB\n\n    LZ_MG --> CORP_MG\n    LZ_MG --> ONLINE_MG\n\n    CORP_MG --> CORP_PROD\n    CORP_MG --> CORP_DEV\n    ONLINE_MG --> ONLINE_PROD\n    ONLINE_MG --> ONLINE_DEV\n\n    SANDBOX_MG --> SANDBOX_SUB\n\n    %% Policy inheritance indicators\n    INHERIT1[\"Policies INHERITED<br/>from parent scopes\"]\n    EXEMPT[\"Policy EXEMPTIONS<br/>can override inheritance\"]\n\n    %% Styling\n    classDef rootStyle fill:#1a1a2e,stroke:#16213e,color:#fff,stroke-width:3px\n    classDef platformStyle fill:#0f4c75,stroke:#3282b8,color:#fff,stroke-width:2px\n    classDef lzStyle fill:#2e7d32,stroke:#4caf50,color:#fff,stroke-width:2px\n    classDef sandboxStyle fill:#f57c00,stroke:#ff9800,color:#fff,stroke-width:2px\n    classDef decommStyle fill:#c62828,stroke:#ef5350,color:#fff,stroke-width:2px\n    classDef subStyle fill:#e3f2fd,stroke:#1976d2,color:#000,stroke-width:1px\n    classDef noteStyle fill:#fff3e0,stroke:#ff9800,color:#000,stroke-dasharray: 5 5\n\n    class ROOT_MG rootStyle\n    class PLATFORM_MG,IDENTITY_MG,MGMT_MG,CONN_MG platformStyle\n    class LZ_MG,CORP_MG,ONLINE_MG lzStyle\n    class SANDBOX_MG sandboxStyle\n    class DECOMM_MG decommStyle\n    class IDENTITY_SUB,MGMT_SUB,CONN_SUB,CORP_PROD,CORP_DEV,ONLINE_PROD,ONLINE_DEV,SANDBOX_SUB subStyle\n    class INHERIT1,EXEMPT noteStyle\n",
  "content_size": 3755,
  "collected_at": "2026-02-06T01:47:35.874755",
  "license": "mit",
  "license_name": "MIT License",
  "compilation_status": "success",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "license_url": "https://api.github.com/licenses/mit",
  "repo_stars": 90,
  "repo_forks": 81,
  "cscw_dialogue": [
    {
      "turn_id": 1,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 \"Tenant Root Group\" 和 \"**Root Management Group**<br/>Enterprise-wide Policies<br/>- Allowed Locations<br/>- Audit Diagnostics\" 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 2,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '\"Tenant Root Group\" 和 \"**Root Management Group**<br/>Enterprise-wide Policies<br/>- Allowed Locations<br/>- Audit Diagnostics\"'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 3,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 4,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "ROOT",
        "ROOT_MG"
      ],
      "is_repair": false
    },
    {
      "turn_id": 5,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 \"Platform Management Groups\" 和 \"**Platform MG**<br/>Shared Services Policies\" 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 6,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '\"Platform Management Groups\" 和 \"**Platform MG**<br/>Shared Services Policies\"'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 7,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 8,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "PLATFORM",
        "PLATFORM_MG"
      ],
      "is_repair": false
    },
    {
      "turn_id": 9,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 \"**Identity MG**<br/>- AD DS Policies<br/>- MFA Requirements\" 和 \"**Management MG**<br/>- Monitoring Policies<br/>- Backup Requirements\" 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 10,
      "role": "Domain_Expert",
      "action_type": "repair",
      "utterance": "不，其实叫 \"**Identity MG**<br/>- AD DS Policies<br/>- MFA Requirements\"处理 会更准确一点。",
      "elements_involved": [],
      "is_repair": true
    },
    {
      "turn_id": 11,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '\"**Identity MG**<br/>- AD DS Policies<br/>- MFA Requirements\"处理'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 12,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 13,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "IDENTITY_MG",
        "MGMT_MG"
      ],
      "is_repair": false
    },
    {
      "turn_id": 14,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 \"**Connectivity MG**<br/>- Network Policies<br/>- Firewall Rules\" 和 /\"Identity Subscription<br/>AD DS, Entra ID Connect\"/ 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 15,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '\"**Connectivity MG**<br/>- Network Policies<br/>- Firewall Rules\" 和 /\"Identity Subscription<br/>AD DS, Entra ID Connect\"/'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 16,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 17,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "CONN_MG",
        "IDENTITY_SUB"
      ],
      "is_repair": false
    },
    {
      "turn_id": 18,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 /\"Management Subscription<br/>Log Analytics, Automation<br/>Recovery Services Vault\"/ 和 /\"Connectivity Subscription<br/>Hub VNet, Azure Firewall<br/>ExpressRoute Gateway\"/ 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 19,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '/\"Management Subscription<br/>Log Analytics, Automation<br/>Recovery Services Vault\"/ 和 /\"Connectivity Subscription<br/>Hub VNet, Azure Firewall<br/>ExpressRoute Gateway\"/'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 20,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 21,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "MGMT_SUB",
        "CONN_SUB"
      ],
      "is_repair": false
    },
    {
      "turn_id": 22,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 \"Landing Zones Management Groups\" 和 \"**Landing Zones MG**<br/>Workload Policies<br/>- Required Tags<br/>- VM SKU Restrictions\" 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 23,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '\"Landing Zones Management Groups\" 和 \"**Landing Zones MG**<br/>Workload Policies<br/>- Required Tags<br/>- VM SKU Restrictions\"'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 24,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 25,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "LANDING",
        "LZ_MG"
      ],
      "is_repair": false
    },
    {
      "turn_id": 26,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "用户在这里会遇到 \"**Corp MG**<br/>Internal Workloads<br/>- Deny Public IP<br/>- Private Endpoints Only\" 和 \"**Online MG**<br/>Internet-facing<br/>- WAF Required<br/>- DDoS Protection\" 的分支。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 27,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 '\"**Corp MG**<br/>Internal Workloads<br/>- Deny Public IP<br/>- Private Endpoints Only\" 和 \"**Online MG**<br/>Internet-facing<br/>- WAF Required<br/>- DDoS Protection\"'，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 28,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 29,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "CORP_MG",
        "ONLINE_MG"
      ],
      "is_repair": false
    },
    {
      "turn_id": 30,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 /\"Corp-Prod Subscription<br/>Production Workloads\"/ 和 /\"Corp-Dev Subscription<br/>Dev/Test Workloads\"/ 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 31,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '/\"Corp-Prod Subscription<br/>Production Workloads\"/ 和 /\"Corp-Dev Subscription<br/>Dev/Test Workloads\"/'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 32,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 33,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "CORP_PROD",
        "CORP_DEV"
      ],
      "is_repair": false
    },
    {
      "turn_id": 34,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 /\"Online-Prod Subscription<br/>Public Applications\"/ 和 /\"Online-Dev Subscription<br/>Public Dev/Test\"/。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 35,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '/\"Online-Prod Subscription<br/>Public Applications\"/ 和 /\"Online-Dev Subscription<br/>Public Dev/Test\"/'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 36,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 37,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "ONLINE_PROD",
        "ONLINE_DEV"
      ],
      "is_repair": false
    },
    {
      "turn_id": 38,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 \"Sandbox Environment\" 和 \"**Sandbox MG**<br/>Relaxed Policies<br/>- No VNet Peering<br/>- Budget Limits\" 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 39,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 '\"Sandbox Environment\" 和 \"**Sandbox MG**<br/>Relaxed Policies<br/>- No VNet Peering<br/>- Budget Limits\"'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 40,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 41,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "SANDBOX",
        "SANDBOX_MG"
      ],
      "is_repair": false
    },
    {
      "turn_id": 42,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 /\"Sandbox Subscriptions<br/>Exploration & Testing\"/ 和 \"**Decommissioned MG**<br/>Deny All Policy<br/>Audit Only\" 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 43,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '/\"Sandbox Subscriptions<br/>Exploration & Testing\"/ 和 \"**Decommissioned MG**<br/>Deny All Policy<br/>Audit Only\"'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 44,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 45,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "SANDBOX_SUB",
        "DECOMM_MG"
      ],
      "is_repair": false
    },
    {
      "turn_id": 46,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "用户在这里会遇到 \"Policies INHERITED<br/>from parent scopes\" 和 \"Policy EXEMPTIONS<br/>can override inheritance\" 的分支。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 47,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '\"Policies INHERITED<br/>from parent scopes\" 和 \"Policy EXEMPTIONS<br/>can override inheritance\"'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 48,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 49,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "INHERIT1",
        "EXEMPT"
      ],
      "is_repair": false
    }
  ],
  "dialogue_metadata": {
    "total_turns": 49,
    "repair_count": 1,
    "grounding_acts_count": 24,
    "theoretical_framework": "Grounding in Communication (Clark & Brennan, 1991)"
  }
}