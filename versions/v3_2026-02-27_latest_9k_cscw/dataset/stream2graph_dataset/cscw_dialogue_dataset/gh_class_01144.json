{
  "id": "gh_class_01144",
  "source": "github",
  "source_url": "https://github.com/a38062an/hft-orderbook-benchmark/blob/f7a8e5e2727109298209aea57e9a3d570b77d417/docs/mapOrderBookStructure.mmd",
  "github_repo": "a38062an/hft-orderbook-benchmark",
  "github_file_path": "docs/mapOrderBookStructure.mmd",
  "diagram_type": "class",
  "code": "---\ntitle: MapOrderBook Data Structure Design\n---\nclassDiagram\n    %% Core Types and Enums\n    class Side {\n        <<enumeration>>\n        Buy\n        Sell\n    }\n    \n    class OrderType {\n        <<enumeration>>\n        Limit\n        Market\n    }\n    \n    %% Basic Types (type aliases)\n    class Types {\n        <<typedefs>>\n        OrderId: uint64_t\n        Price: uint64_t\n        Quantity: uint64_t\n        Timestamp: uint64_t\n    }\n    \n    %% Order Structure\n    class Order {\n        +OrderId id\n        +Price price\n        +Quantity quantity\n        +Side side\n        +OrderType type\n        +Timestamp timestamp\n    }\n    \n    %% Trade Structure\n    class Trade {\n        +OrderId buyOrderId\n        +OrderId sellOrderId\n        +Price price\n        +Quantity quantity\n        +Timestamp timestamp\n    }\n    \n    %% Order Location for Fast Lookup\n    class OrderLocation {\n        +bool isBuy\n        +Price price\n        +OrderList::iterator iterator\n    }\n    \n    %% STL Container Types\n    class OrderList {\n        <<std::list~Order~>>\n        +push_back(order)\n        +pop_front()\n        +erase(iterator)\n        +front() Order\n        +empty() bool\n    }\n    \n    class BidsMap {\n        <<std::map~Price, OrderList, greater~Price~~~>>\n        +operator[](price) OrderList\n        +begin() iterator\n        +erase(price)\n        +empty() bool\n    }\n    \n    class AsksMap {\n        <<std::map~Price, OrderList, less~Price~~~>>\n        +operator[](price) OrderList\n        +begin() iterator\n        +erase(price)\n        +empty() bool\n    }\n    \n    class OrderLookup {\n        <<std::unordered_map~OrderId, OrderLocation~>>\n        +operator[](orderId) OrderLocation\n        +find(orderId) iterator\n        +erase(orderId)\n    }\n    \n    %% Main Class\n    class MapOrderBook {\n        -BidsMap bids_\n        -AsksMap asks_\n        -OrderLookup orderLookup_\n        +addOrder(order) void\n        +cancelOrder(orderId) void\n        +modifyOrder(orderId, qty) void\n        +match() vector~Trade~\n        +getOrderCount() size_t\n        +getBestBid() Price\n        +getBestAsk() Price\n    }\n    \n    %% Relationships\n    Order --> Side : has\n    Order --> OrderType : has\n    Order --> Types : uses types\n    Trade --> Types : uses types\n    \n    OrderList \"1\" *-- \"*\" Order : contains FIFO\n    \n    BidsMap \"1\" *-- \"*\" OrderList : Price to List\n    AsksMap \"1\" *-- \"*\" OrderList : Price to List\n    \n    OrderLocation --> OrderList : points into\n    OrderLookup \"1\" *-- \"*\" OrderLocation : OrderId to Location\n    \n    MapOrderBook \"1\" *-- \"1\" BidsMap : owns\n    MapOrderBook \"1\" *-- \"1\" AsksMap : owns\n    MapOrderBook \"1\" *-- \"1\" OrderLookup : owns\n    MapOrderBook ..> Trade : creates\n    MapOrderBook ..> Order : processes\n    \n    %% Notes on Design Decisions\n    note for BidsMap \"std::map greater\nHighest bid first\nO(log n) insert/delete\"\n    \n    note for AsksMap \"std::map less\nLowest ask first\nO(log n) insert/delete\"\n    \n    note for OrderList \"std::list doubly-linked\nFIFO at each price\nO(1) push/pop/erase\"\n    \n    note for OrderLookup \"std::unordered_map\nO(1) lookup by OrderId\nEnables fast cancel/modify\"\n    \n    note for Order \"Price-time priority\nEach order tracked by ID\"\n    \n    note for MapOrderBook \"Add: O(log n)\nCancel: O(1) avg\nMatch: O(m)\nBest price: O(1) map.begin()\ngetBestBid/Ask: O(1)\"\n\n    %% Styling\n    classDef container fill:#e1f5ff,stroke:#0288d1,stroke-width:2px\n    classDef struct fill:#fff3e0,stroke:#f57c00,stroke-width:2px\n    classDef enum fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px\n    classDef core fill:#e8f5e9,stroke:#388e3c,stroke-width:3px\n    \n    class OrderList container\n    class BidsMap container\n    class AsksMap container\n    class OrderLookup container\n    class Order struct\n    class Trade struct\n    class OrderLocation struct\n    class Side enum\n    class OrderType enum\n    class MapOrderBook core\n",
  "content_size": 3885,
  "collected_at": "2026-02-06T01:53:36.096132",
  "compilation_status": "failed",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0,
  "cscw_dialogue": [
    {
      "turn_id": 1,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "用户在这里会遇到 <<enumeration>>\n        Buy\n        Sell\n     和 <<enumeration>>\n        Limit\n        Market\n     的分支。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 2,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '<<enumeration>>\n        Buy\n        Sell\n     和 <<enumeration>>\n        Limit\n        Market\n    '？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 3,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 4,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "Side",
        "OrderType"
      ],
      "is_repair": false
    },
    {
      "turn_id": 5,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 type aliases 和 <<typedefs>>\n        OrderId: uint64_t\n        Price: uint64_t\n        Quantity: uint64_t\n        Timestamp: uint64_t\n     的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 6,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 'type aliases 和 <<typedefs>>\n        OrderId: uint64_t\n        Price: uint64_t\n        Quantity: uint64_t\n        Timestamp: uint64_t\n    '，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 7,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 8,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "Types",
        "Types"
      ],
      "is_repair": false
    },
    {
      "turn_id": 9,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 +OrderId id\n        +Price price\n        +Quantity quantity\n        +Side side\n        +OrderType type\n        +Timestamp timestamp\n     和 +OrderId buyOrderId\n        +OrderId sellOrderId\n        +Price price\n        +Quantity quantity\n        +Timestamp timestamp\n     的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 10,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '+OrderId id\n        +Price price\n        +Quantity quantity\n        +Side side\n        +OrderType type\n        +Timestamp timestamp\n     和 +OrderId buyOrderId\n        +OrderId sellOrderId\n        +Price price\n        +Quantity quantity\n        +Timestamp timestamp\n    '，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 11,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 12,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "Order",
        "Trade"
      ],
      "is_repair": false
    },
    {
      "turn_id": 13,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 +bool isBuy\n        +Price price\n        +OrderList::iterator iterator\n     和 <<std::list~Order~>>\n        +push_back(order 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 14,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 '+bool isBuy\n        +Price price\n        +OrderList::iterator iterator\n     和 <<std::list~Order~>>\n        +push_back(order'，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 15,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 16,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "OrderLocation",
        "OrderList"
      ],
      "is_repair": false
    },
    {
      "turn_id": 17,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "用户在这里会遇到 iterator 和 <<std::map~Price, OrderList, greater~Price~~~>>\n        +operator[ 的分支。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 18,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 'iterator 和 <<std::map~Price, OrderList, greater~Price~~~>>\n        +operator['？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 19,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 20,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "erase",
        "BidsMap"
      ],
      "is_repair": false
    },
    {
      "turn_id": 21,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 price 和 <<std::map~Price, OrderList, less~Price~~~>>\n        +operator[ 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 22,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 'price 和 <<std::map~Price, OrderList, less~Price~~~>>\n        +operator['。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 23,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 24,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "erase",
        "AsksMap"
      ],
      "is_repair": false
    },
    {
      "turn_id": 25,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 price 和 <<std::unordered_map~OrderId, OrderLocation~>>\n        +operator[。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 26,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 'price 和 <<std::unordered_map~OrderId, OrderLocation~>>\n        +operator['，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 27,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 28,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "erase",
        "OrderLookup"
      ],
      "is_repair": false
    },
    {
      "turn_id": 29,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 orderId 和 orderId。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 30,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 'orderId 和 orderId'，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 31,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 32,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "find",
        "erase"
      ],
      "is_repair": false
    },
    {
      "turn_id": 33,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 -BidsMap bids_\n        -AsksMap asks_\n        -OrderLookup orderLookup_\n        +addOrder(order 和 orderId 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 34,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '-BidsMap bids_\n        -AsksMap asks_\n        -OrderLookup orderLookup_\n        +addOrder(order 和 orderId'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 35,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 36,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "MapOrderBook",
        "cancelOrder"
      ],
      "is_repair": false
    },
    {
      "turn_id": 37,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 orderId, qty 和 log n 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 38,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 'orderId, qty 和 log n'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 39,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 40,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "modifyOrder",
        "O"
      ],
      "is_repair": false
    },
    {
      "turn_id": 41,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 log n 和 1 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 42,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 'log n 和 1'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 43,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 44,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "O",
        "O"
      ],
      "is_repair": false
    },
    {
      "turn_id": 45,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 1 和 log n 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 46,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 '1 和 log n'，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 47,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 48,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "O",
        "O"
      ],
      "is_repair": false
    },
    {
      "turn_id": 49,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 1 和 m 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 50,
      "role": "Domain_Expert",
      "action_type": "repair",
      "utterance": "不，其实叫 1处理 会更准确一点。",
      "elements_involved": [],
      "is_repair": true
    },
    {
      "turn_id": 51,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '1处理'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 52,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 53,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "O",
        "O"
      ],
      "is_repair": false
    },
    {
      "turn_id": 54,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 1 和 1 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 55,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '1 和 1'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 56,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 57,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "O",
        "O"
      ],
      "is_repair": false
    }
  ],
  "dialogue_metadata": {
    "total_turns": 57,
    "repair_count": 1,
    "grounding_acts_count": 28,
    "theoretical_framework": "Grounding in Communication (Clark & Brennan, 1991)"
  }
}