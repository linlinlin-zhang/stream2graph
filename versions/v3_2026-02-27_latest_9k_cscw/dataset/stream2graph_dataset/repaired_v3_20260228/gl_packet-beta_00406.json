{
  "id": "gl_packet-beta_00406",
  "source": "gitlab",
  "source_url": "https://github.com/Lucascis/discord_bot/blob/3c98f8c01a7f4e2f2e4770f9209b19c752940a0f/docs/architecture/diagrams/container.mmd",
  "source_note": "collected_from_github_additional",
  "github_repo": "Lucascis/discord_bot",
  "diagram_type": "packet-beta",
  "code": "%% Container Diagram (C4 Model - Level 2)\n%% Purpose: Shows the internal architecture of the Discord Music Bot system\n%% Author: Discord Bot Team\n%% Last Updated: 2025-11-03\n\ngraph TB\n    %% External Users/Systems\n    User[\"ğŸ‘¤ Discord User<br/>[Person]\"]\n    Discord[\"Discord API<br/>[External System]\"]\n    MusicAPIs[\"Music APIs<br/>[External System]<br/>YouTube, Spotify,<br/>SoundCloud\"]\n    Stripe[\"Stripe API<br/>[External System]\"]\n\n    %% Application Layer\n    subgraph DiscordBot[\"Discord Music Bot [Software System]\"]\n\n        %% Gateway Service\n        Gateway[\"Gateway Service<br/>[Node.js Container]<br/><br/>Handles Discord<br/>interactions, slash<br/>commands, and events<br/><br/>Technology:<br/>Discord.js, TypeScript\"]\n\n        %% Audio Service\n        Audio[\"Audio Service<br/>[Node.js Container]<br/><br/>Manages music playback,<br/>queue operations, and<br/>Lavalink integration<br/><br/>Technology:<br/>lavalink-client, TypeScript\"]\n\n        %% API Service\n        API[\"API Service<br/>[Node.js Container]<br/><br/>Provides REST endpoints<br/>for webhooks, analytics,<br/>and external access<br/><br/>Technology:<br/>Express.js, TypeScript\"]\n\n        %% Worker Service\n        Worker[\"Worker Service<br/>[Node.js Container]<br/><br/>Handles background jobs,<br/>cleanup tasks, and<br/>scheduled operations<br/><br/>Technology:<br/>Node.js, TypeScript\"]\n\n        %% Lavalink\n        Lavalink[\"Lavalink<br/>[Java Container]<br/><br/>Audio processing server<br/>with advanced plugins<br/>for music streaming<br/><br/>Technology:<br/>Lavalink 4.1.1, Java\"]\n    end\n\n    %% Data Layer\n    subgraph Data[\"Data Layer\"]\n        PostgreSQL[\"PostgreSQL<br/>[Database]<br/><br/>Persistent storage<br/>for queues, settings,<br/>and subscriptions<br/><br/>Technology:<br/>PostgreSQL 15\"]\n\n        Redis[\"Redis<br/>[Cache & Pub/Sub]<br/><br/>Caching, session<br/>management, and<br/>inter-service messaging<br/><br/>Technology:<br/>Redis 7\"]\n    end\n\n    %% User Interactions\n    User -->|\"Slash commands<br/>HTTPS/WSS\"| Discord\n    Discord -->|\"Events & Commands<br/>Gateway WebSocket\"| Gateway\n\n    %% Service Interactions\n    Gateway -->|\"Publishes commands<br/>redis pub/sub\"| Redis\n    Gateway -->|\"Reads/Writes<br/>guild settings\"| PostgreSQL\n    Gateway -->|\"Sends UI updates<br/>REST API\"| Discord\n\n    Redis -->|\"Subscribes to commands<br/>redis pub/sub\"| Audio\n    Audio -->|\"Publishes UI updates<br/>redis pub/sub\"| Redis\n    Redis -->|\"Receives UI updates<br/>redis pub/sub\"| Gateway\n\n    Audio -->|\"Reads/Writes queue<br/>SQL queries\"| PostgreSQL\n    Audio -->|\"Manages players<br/>WebSocket\"| Lavalink\n    Audio -->|\"Caches search results<br/>GET/SET\"| Redis\n\n    Lavalink -->|\"Streams audio<br/>UDP packets\"| Discord\n    Lavalink -->|\"Fetches music<br/>HTTPS\"| MusicAPIs\n\n    API -->|\"Receives webhooks<br/>HTTPS POST\"| Stripe\n    API -->|\"Reads/Writes<br/>subscriptions\"| PostgreSQL\n    API -->|\"Publishes events<br/>redis pub/sub\"| Redis\n    API -->|\"Caches data<br/>GET/SET\"| Redis\n\n    Worker -->|\"Cleanup operations<br/>SQL queries\"| PostgreSQL\n    Worker -->|\"Publishes jobs<br/>redis pub/sub\"| Redis\n\n    %% External Integrations\n    Discord -->|\"Voice connection<br/>UDP\"| Lavalink\n\n    %% Styling\n    classDef person fill:#08427b,stroke:#052e56,color:#fff\n    classDef container fill:#1168bd,stroke:#0b4884,color:#fff\n    classDef database fill:#2b7a2b,stroke:#1a5c1a,color:#fff\n    classDef external fill:#999999,stroke:#6b6b6b,color:#fff\n\n    class User person\n    class Gateway,Audio,API,Worker,Lavalink container\n    class PostgreSQL,Redis database\n    class Discord,MusicAPIs,Stripe external\n",
  "content_size": 3627,
  "collected_at": "2026-02-06T14:09:07.850753",
  "compilation_status": "success",
  "license": "gitlab_repo",
  "license_name": "GitLab Repository",
  "license_url": "https://gitlab.com",
  "compilation_error": "",
  "cscw_dialogue": [
    {
      "turn_id": 1,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "è¿™é‡Œå¿…é¡»åŒ…å« C4 Model - Level 2 å’Œ \"ğŸ‘¤ Discord User<br/>[Person è¿™ä¸€å—ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 2,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "æ”¶åˆ°ã€‚è¿™æ˜¯ä¸æ˜¯ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Ÿæˆ‘æš‚æ—¶å†™æˆ 'C4 Model - Level 2 å’Œ \"ğŸ‘¤ Discord User<br/>[Person'ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 3,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "å¯¹çš„ï¼Œå°±è¿™æ ·ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 4,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "Diagram",
        "User"
      ],
      "is_repair": false
    },
    {
      "turn_id": 5,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "è¿™é‡Œå¿…é¡»åŒ…å« \"Discord API<br/>[External System å’Œ \"Music APIs<br/>[External System è¿™ä¸€å—ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 6,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "æˆ‘æŠŠå®ƒåŠ è¿›å»äº†ï¼Œæ ‡ç­¾æ˜¾ç¤ºä¸º '\"Discord API<br/>[External System å’Œ \"Music APIs<br/>[External System'ï¼Œä½ çœ‹çœ‹åˆé€‚å—ï¼Ÿ",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 7,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "æ²¡é—®é¢˜ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 8,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "Discord",
        "MusicAPIs"
      ],
      "is_repair": false
    },
    {
      "turn_id": 9,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "æˆ‘ä»¬éœ€è¦åŠ ä¸€ä¸ªå¤„ç† \"Stripe API<br/>[External System å’Œ \"Discord Music Bot [Software System çš„ç¯èŠ‚ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 10,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "å¥½çš„ï¼Œæˆ‘æŠŠå®ƒç”»æˆä¸€ä¸ªçŸ©å½¢æ¡†ï¼Œåå­—å« '\"Stripe API<br/>[External System å’Œ \"Discord Music Bot [Software System'ï¼Œå¯¹å§ï¼Ÿ",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 11,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "å¯¹çš„ï¼Œå°±è¿™æ ·ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 12,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "Stripe",
        "DiscordBot"
      ],
      "is_repair": false
    },
    {
      "turn_id": 13,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "è¿™é‡Œå¿…é¡»åŒ…å« \"Gateway Service<br/>[Node.js Container å’Œ \"Audio Service<br/>[Node.js Container è¿™ä¸€å—ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 14,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "æ”¶åˆ°ã€‚è¿™æ˜¯ä¸æ˜¯ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶ï¼Ÿæˆ‘æš‚æ—¶å†™æˆ '\"Gateway Service<br/>[Node.js Container å’Œ \"Audio Service<br/>[Node.js Container'ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 15,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "æ²¡é—®é¢˜ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 16,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "Gateway",
        "Audio"
      ],
      "is_repair": false
    },
    {
      "turn_id": 17,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "è¿™é‡Œå¿…é¡»åŒ…å« \"API Service<br/>[Node.js Container å’Œ \"Worker Service<br/>[Node.js Container è¿™ä¸€å—ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 18,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "æˆ‘æŠŠå®ƒåŠ è¿›å»äº†ï¼Œæ ‡ç­¾æ˜¾ç¤ºä¸º '\"API Service<br/>[Node.js Container å’Œ \"Worker Service<br/>[Node.js Container'ï¼Œä½ çœ‹çœ‹åˆé€‚å—ï¼Ÿ",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 19,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "å¯¹çš„ï¼Œå°±è¿™æ ·ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 20,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "API",
        "Worker"
      ],
      "is_repair": false
    },
    {
      "turn_id": 21,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "æ¥ä¸‹æ¥æ˜¯å…³äº \"Lavalink<br/>[Java Container å’Œ \"Data Layer\" çš„é€»è¾‘ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 22,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "å¥½çš„ï¼Œæˆ‘æŠŠå®ƒç”»æˆä¸€ä¸ªçŸ©å½¢æ¡†ï¼Œåå­—å« '\"Lavalink<br/>[Java Container å’Œ \"Data Layer\"'ï¼Œå¯¹å§ï¼Ÿ",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 23,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "å¯ä»¥ï¼Œç»§ç»­å§ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 24,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "Lavalink",
        "Data"
      ],
      "is_repair": false
    },
    {
      "turn_id": 25,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "ç”¨æˆ·åœ¨è¿™é‡Œä¼šé‡åˆ° \"PostgreSQL<br/>[Database å’Œ \"Redis<br/>[Cache & Pub/Sub çš„åˆ†æ”¯ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 26,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "å¥½çš„ï¼Œæˆ‘æŠŠå®ƒç”»æˆä¸€ä¸ªçŸ©å½¢æ¡†ï¼Œåå­—å« '\"PostgreSQL<br/>[Database å’Œ \"Redis<br/>[Cache & Pub/Sub'ï¼Œå¯¹å§ï¼Ÿ",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 27,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "å¯ä»¥ï¼Œç»§ç»­å§ã€‚",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 28,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[ç³»ç»Ÿæ—¥å¿—: Editor æ›´æ–°äº†å›¾è¡¨ä»£ç ä»¥åæ˜ ä¸Šè¿°ç»“æ„]",
      "elements_involved": [
        "PostgreSQL",
        "Redis"
      ],
      "is_repair": false
    }
  ],
  "dialogue_metadata": {
    "total_turns": 28,
    "repair_count": 0,
    "grounding_acts_count": 14,
    "theoretical_framework": "Grounding in Communication (Clark & Brennan, 1991)"
  },
  "repair_log": [
    "compilation_recovered_local_original"
  ],
  "repaired_at": "2026-02-28T13:41:23Z"
}