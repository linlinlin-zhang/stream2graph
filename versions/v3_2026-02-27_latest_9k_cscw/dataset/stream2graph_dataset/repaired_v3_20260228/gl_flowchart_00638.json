{
  "id": "gl_flowchart_00638",
  "source": "gitlab",
  "source_url": "https://github.com/WKosikowski/wojo-nes-emulator/blob/12a769acf1b44135a883681e60987768c2a8c1aa/UML/APUCycle.mmd",
  "source_note": "collected_from_github_final",
  "github_repo": "WKosikowski/wojo-nes-emulator",
  "diagram_type": "flowchart",
  "code": "---\nconfig:\n  layout: elk\n  theme: redux\n---\nflowchart TD\n    %% Node Definitions\n    start_apu_cycle[\"Start APU Cycle\"]\n    check_apu_status_register[\"Check APU Status Register (0x4015)\"]\n    apu_enabled{\"Is APU Enabled?\"}\n    advance_apu_timers[\"Advance Timers for All Channels\"]\n    mute_channels[\"Mute All Channels\"]\n    output_silence[\"Output Silent Audio\"]\n    process_pulse1[\"Process Pulse 1 Channel\"]\n    process_pulse2[\"Process Pulse 2 Channel\"]\n    process_triangle_noise_dmc[\"Process Triangle, Noise, DMC Channels\"]\n    pulse1_enabled{\"Is Pulse 1 Enabled?\"}\n    pulse2_enabled{\"Is Pulse 2 Enabled?\"}\n    check_pulse1_timer[\"Check Timer for Pulse 1 (Registers 0x4002-0x4003)\"]\n    silence_pulse1[\"Output Silence for Pulse 1\"]\n    pulse1_timer_expired{\"Has Pulse 1 Timer Expired?\"}\n    generate_pulse1_waveform[\"Generate Pulse 1 Waveform (Duty Cycle: 0x4000)\"]\n    maintain_pulse1_waveform[\"Maintain Current Waveform for Pulse 1\"]\n    apply_pulse1_volume_envelope[\"Apply Volume/Envelope (0x4000)\"]\n    apply_pulse1_sweep[\"Apply Frequency Sweep (0x4001)\"]\n    output_pulse1_sample[\"Output Pulse 1 Sample\"]\n    check_pulse2_timer[\"Check Timer for Pulse 2 (Registers 0x4006-0x4007)\"]\n    silence_pulse2[\"Output Silence for Pulse 2\"]\n    pulse2_timer_expired{\"Has Pulse 2 Timer Expired?\"}\n    generate_pulse2_waveform[\"Generate Pulse 2 Waveform (Duty Cycle: 0x4004)\"]\n    maintain_pulse2_waveform[\"Maintain Current Waveform for Pulse 2\"]\n    apply_pulse2_volume_envelope[\"Apply Volume/Envelope (0x4004)\"]\n    apply_pulse2_sweep[\"Apply Frequency Sweep (0x4005)\"]\n    output_pulse2_sample[\"Output Pulse 2 Sample\"]\n    mix_samples[\"Mix Channel Samples, Add to Buffer\"]\n    buffer_full{\"Is Audio Buffer Full?\"}\n    send_to_audio_device[\"Send to Audio Device (e.g., Core Audio)\"]\n    queue_samples[\"Queue Samples for Next Cycle\"]\n    end_audio_generation[\"End: Audio Sample Generation\"]\n\n    %% Node Connections\n    start_apu_cycle --> check_apu_status_register\n    check_apu_status_register --> apu_enabled\n    apu_enabled -- Yes --> advance_apu_timers\n    apu_enabled -- No --> mute_channels\n    mute_channels --> output_silence\n    advance_apu_timers --> process_pulse1\n    process_pulse1 --> process_pulse2\n    process_pulse1 --> pulse1_enabled\n    process_pulse2 --> process_triangle_noise_dmc\n    process_pulse2 --> pulse2_enabled\n    pulse1_enabled -- Yes --> check_pulse1_timer\n    pulse1_enabled -- No --> silence_pulse1\n    check_pulse1_timer --> pulse1_timer_expired\n    pulse1_timer_expired -- Yes --> generate_pulse1_waveform\n    pulse1_timer_expired -- No --> maintain_pulse1_waveform\n    generate_pulse1_waveform --> apply_pulse1_volume_envelope\n    maintain_pulse1_waveform --> apply_pulse1_volume_envelope\n    apply_pulse1_volume_envelope --> apply_pulse1_sweep\n    apply_pulse1_sweep --> output_pulse1_sample\n    silence_pulse1 --> output_pulse1_sample\n    pulse2_enabled -- Yes --> check_pulse2_timer\n    pulse2_enabled -- No --> silence_pulse2\n    check_pulse2_timer --> pulse2_timer_expired\n    pulse2_timer_expired -- Yes --> generate_pulse2_waveform\n    pulse2_timer_expired -- No --> maintain_pulse2_waveform\n    generate_pulse2_waveform --> apply_pulse2_volume_envelope\n    maintain_pulse2_waveform --> apply_pulse2_volume_envelope\n    apply_pulse2_volume_envelope --> apply_pulse2_sweep\n    apply_pulse2_sweep --> output_pulse2_sample\n    silence_pulse2 --> output_pulse2_sample\n    output_pulse1_sample --> mix_samples\n    output_silence --> mix_samples\n    process_triangle_noise_dmc --> mix_samples\n    output_pulse2_sample --> mix_samples\n    mix_samples --> buffer_full\n    buffer_full -- Yes --> send_to_audio_device\n    buffer_full -- No --> queue_samples\n    send_to_audio_device --> end_audio_generation\n    queue_samples --> end_audio_generation\n\n    %% Styling\n    style process_triangle_noise_dmc fill:#FFCDD2\n    style mix_samples fill:#E1BEE7\n",
  "content_size": 3883,
  "collected_at": "2026-02-06T14:18:18.374535",
  "compilation_status": "success",
  "license": "mit",
  "license_name": "MIT License",
  "license_url": "https://api.github.com/licenses/mit",
  "repo_stars": 1,
  "repo_forks": 0,
  "repo_owner": "WKosikowski",
  "repo_name": "wojo-nes-emulator",
  "repo_description": "A Nintendo Entertainment System Emulator written in Swift",
  "repo_language": "Swift",
  "repo_topics": [],
  "repo_created_at": "2025-05-11T14:35:51Z",
  "repo_updated_at": "2026-01-11T20:44:05Z",
  "cscw_dialogue": [
    {
      "turn_id": 1,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 \"Start APU Cycle\" 和 \"Check APU Status Register (0x4015 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 2,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '\"Start APU Cycle\" 和 \"Check APU Status Register (0x4015'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 3,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 4,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "start_apu_cycle",
        "check_apu_status_register"
      ],
      "is_repair": false
    },
    {
      "turn_id": 5,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "然后，流程会走到 \"Is APU Enabled?\" 和 \"Advance Timers for All Channels\"。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 6,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '\"Is APU Enabled?\" 和 \"Advance Timers for All Channels\"'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 7,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 8,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "apu_enabled",
        "advance_apu_timers"
      ],
      "is_repair": false
    },
    {
      "turn_id": 9,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 \"Mute All Channels\" 和 \"Output Silent Audio\" 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 10,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 '\"Mute All Channels\" 和 \"Output Silent Audio\"'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 11,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 12,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "mute_channels",
        "output_silence"
      ],
      "is_repair": false
    },
    {
      "turn_id": 13,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 \"Process Pulse 1 Channel\" 和 \"Process Pulse 2 Channel\" 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 14,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 '\"Process Pulse 1 Channel\" 和 \"Process Pulse 2 Channel\"'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 15,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 16,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "process_pulse1",
        "process_pulse2"
      ],
      "is_repair": false
    },
    {
      "turn_id": 17,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "用户在这里会遇到 \"Process Triangle, Noise, DMC Channels\" 和 \"Is Pulse 1 Enabled?\" 的分支。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 18,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 '\"Process Triangle, Noise, DMC Channels\" 和 \"Is Pulse 1 Enabled?\"'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 19,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 20,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "process_triangle_noise_dmc",
        "pulse1_enabled"
      ],
      "is_repair": false
    },
    {
      "turn_id": 21,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 \"Is Pulse 2 Enabled?\" 和 \"Check Timer for Pulse 1 (Registers 0x4002-0x4003 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 22,
      "role": "Domain_Expert",
      "action_type": "repair",
      "utterance": "不，其实叫 \"Is Pulse 2 Enabled?\"处理 会更准确一点。",
      "elements_involved": [],
      "is_repair": true
    },
    {
      "turn_id": 23,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '\"Is Pulse 2 Enabled?\"处理'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 24,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 25,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "pulse2_enabled",
        "check_pulse1_timer"
      ],
      "is_repair": false
    },
    {
      "turn_id": 26,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 \"Output Silence for Pulse 1\" 和 \"Has Pulse 1 Timer Expired?\" 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 27,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "我把它加进去了，标签显示为 '\"Output Silence for Pulse 1\" 和 \"Has Pulse 1 Timer Expired?\"'，你看看合适吗？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 28,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 29,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "silence_pulse1",
        "pulse1_timer_expired"
      ],
      "is_repair": false
    },
    {
      "turn_id": 30,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 \"Generate Pulse 1 Waveform (Duty Cycle: 0x4000 和 \"Maintain Current Waveform for Pulse 1\" 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 31,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 '\"Generate Pulse 1 Waveform (Duty Cycle: 0x4000 和 \"Maintain Current Waveform for Pulse 1\"'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 32,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 33,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "generate_pulse1_waveform",
        "maintain_pulse1_waveform"
      ],
      "is_repair": false
    },
    {
      "turn_id": 34,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 \"Apply Volume/Envelope (0x4000 和 \"Apply Frequency Sweep (0x4001 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 35,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '\"Apply Volume/Envelope (0x4000 和 \"Apply Frequency Sweep (0x4001'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 36,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 37,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "apply_pulse1_volume_envelope",
        "apply_pulse1_sweep"
      ],
      "is_repair": false
    },
    {
      "turn_id": 38,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 \"Output Pulse 1 Sample\" 和 \"Check Timer for Pulse 2 (Registers 0x4006-0x4007 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 39,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 '\"Output Pulse 1 Sample\" 和 \"Check Timer for Pulse 2 (Registers 0x4006-0x4007'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 40,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 41,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "output_pulse1_sample",
        "check_pulse2_timer"
      ],
      "is_repair": false
    },
    {
      "turn_id": 42,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "用户在这里会遇到 \"Output Silence for Pulse 2\" 和 \"Has Pulse 2 Timer Expired?\" 的分支。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 43,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '\"Output Silence for Pulse 2\" 和 \"Has Pulse 2 Timer Expired?\"'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 44,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 45,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "silence_pulse2",
        "pulse2_timer_expired"
      ],
      "is_repair": false
    },
    {
      "turn_id": 46,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "这里必须包含 \"Generate Pulse 2 Waveform (Duty Cycle: 0x4004 和 \"Maintain Current Waveform for Pulse 2\" 这一块。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 47,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 '\"Generate Pulse 2 Waveform (Duty Cycle: 0x4004 和 \"Maintain Current Waveform for Pulse 2\"'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 48,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 49,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "generate_pulse2_waveform",
        "maintain_pulse2_waveform"
      ],
      "is_repair": false
    },
    {
      "turn_id": 50,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 \"Apply Volume/Envelope (0x4004 和 \"Apply Frequency Sweep (0x4005 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 51,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "收到。这是不是一个判断条件？我暂时写成 '\"Apply Volume/Envelope (0x4004 和 \"Apply Frequency Sweep (0x4005'。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 52,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "可以，继续吧。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 53,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "apply_pulse2_volume_envelope",
        "apply_pulse2_sweep"
      ],
      "is_repair": false
    },
    {
      "turn_id": 54,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "接下来是关于 \"Output Pulse 2 Sample\" 和 \"Mix Channel Samples, Add to Buffer\" 的逻辑。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 55,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "好的，我把它画成一个矩形框，名字叫 '\"Output Pulse 2 Sample\" 和 \"Mix Channel Samples, Add to Buffer\"'，对吧？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 56,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "嗯，这样看起来很清晰。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 57,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "output_pulse2_sample",
        "mix_samples"
      ],
      "is_repair": false
    },
    {
      "turn_id": 58,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 \"Is Audio Buffer Full?\" 和 \"Send to Audio Device (e.g., Core Audio 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 59,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '\"Is Audio Buffer Full?\" 和 \"Send to Audio Device (e.g., Core Audio'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 60,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "对的，就这样。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 61,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "buffer_full",
        "send_to_audio_device"
      ],
      "is_repair": false
    },
    {
      "turn_id": 62,
      "role": "Domain_Expert",
      "action_type": "propose",
      "utterance": "我们需要加一个处理 \"Queue Samples for Next Cycle\" 和 \"End: Audio Sample Generation\" 的环节。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 63,
      "role": "Diagram_Editor",
      "action_type": "clarify",
      "utterance": "明白，所以它是承接上一步的，内容是 '\"Queue Samples for Next Cycle\" 和 \"End: Audio Sample Generation\"'？",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 64,
      "role": "Domain_Expert",
      "action_type": "confirm",
      "utterance": "没问题。",
      "elements_involved": [],
      "is_repair": false
    },
    {
      "turn_id": 65,
      "role": "Diagram_Editor",
      "action_type": "execute",
      "utterance": "[系统日志: Editor 更新了图表代码以反映上述结构]",
      "elements_involved": [
        "queue_samples",
        "end_audio_generation"
      ],
      "is_repair": false
    }
  ],
  "dialogue_metadata": {
    "total_turns": 65,
    "repair_count": 1,
    "grounding_acts_count": 32,
    "theoretical_framework": "Grounding in Communication (Clark & Brennan, 1991)"
  },
  "repaired_at": "2026-02-28T13:41:37Z"
}