# Stream2Graph 数据质量报告

**生成时间**: 2026-02-06
**数据集路径**: stream2graph_dataset/final_100percent_real
**总样本数**: 8,000

---

## 1. 数据概览

### 1.1 数据来源分布

| 来源 | 数量 | 占比 |
|------|------|------|
| GitHub | 3,594 | 44.9% |
| HuggingFace | 2,400 | 30.0% |
| GitLab | 806 | 10.1% |
| Other | 1,200 | 15.0% |
| **总计** | **8,000** | **100%** |

### 1.2 图表类型分布

| 类型 | 数量 | 占比 |
|------|------|------|
| flowchart | 3,460 | 43.3% |
| sequence | 825 | 10.3% |
| class | 702 | 8.8% |
| architecture | 631 | 7.9% |
| mindmap | 453 | 5.7% |
| stateDiagram | 403 | 5.0% |
| gantt | 399 | 5.0% |
| er | 170 | 2.1% |
| journey | 165 | 2.1% |
| gitGraph | 133 | 1.7% |
| packet-beta | 126 | 1.6% |
| block-beta | 125 | 1.6% |
| requirementDiagram | 112 | 1.4% |
| timeline | 85 | 1.1% |
| xychart | 56 | 0.7% |
| pie | 55 | 0.7% |
| C4Context | 47 | 0.6% |
| kanban | 27 | 0.3% |
| sankey | 25 | 0.3% |

---

## 2. 许可证状况

### 2.1 问题描述

**状态**: ⚠️ **未解决**

**问题**: 当前8,000个样本中，**没有样本包含许可证信息**。

**影响**:
- 无法确定数据的使用权限
- 不符合学术论文数据集要求
- 存在潜在的法律风险

### 2.2 解决方案

#### 方案A: 批量获取GitHub许可证（推荐）

**方法**:
1. 使用GitHub API获取每个仓库的许可证信息
2. 需要GitHub Token（每小时5,000次请求限制）
3. 3,594个GitHub样本需要约4-5小时完成

**命令**:
```bash
python add_licenses.py
```

**字段**:
- `license`: 许可证key (mit, apache-2.0, gpl-3.0等)
- `license_name`: 许可证全称
- `repo_stars`: 仓库星标数
- `repo_forks`: 仓库分支数

#### 方案B: 按来源分类标记

**方法**:
- GitHub来源：标记为"github_repo"，需要单独获取许可证
- HuggingFace来源：标记为"huggingface_dataset"
- GitLab来源：标记为"gitlab_repo"
- Other来源：手动检查并标记

#### 方案C: 仅使用MIT/Apache许可证的数据

**方法**:
1. 先获取所有许可证信息
2. 过滤仅保留MIT/Apache许可证的样本
3. 预计可保留约60-70%的数据

---

## 3. 可编译性状况

### 3.1 验证结果

**状态**: ⚠️ **部分完成，存在问题**

| 状态 | 数量 | 占比 |
|------|------|------|
| success | 306 | 3.8% |
| failed | 23 | 0.3% |
| error | 7,678 | 96.0% |
| NOT_SET | 1 | ~0% |

### 3.2 问题分析

**主要问题**: Windows系统上subprocess调用npx.cmd时出现 `[WinError 2] 系统找不到指定的文件`

**原因**:
1. Windows环境下的进程池(ProcessPoolExecutor)问题
2. npx.cmd路径在大量并发调用时无法正确解析
3. 临时文件创建/清理的竞争条件

**成功样本特征**:
- 全部为`architecture`类型
- 均为GitHub来源
- 可能是验证开始时成功处理的样本

### 3.3 解决方案

#### 方案A: 使用更简单的方法重新验证（推荐）

**方法1: 批量Mermaid验证脚本**
```bash
# 安装Mermaid CLI
npm install -g @mermaid-js/mermaid-cli

# 使用脚本批量验证
python batch_validate.py
```

**方法2: 使用Mermaid Live API**
- 使用Mermaid的在线API进行验证
- 避免本地CLI问题
- 需要注意速率限制

#### 方案B: 仅使用已知有效的图表类型

**已知可编译**:
- architecture (graph TD): 成功率92.7%
- flowchart: 需要进一步验证
- sequenceDiagram: 需要进一步验证

**可能存在问题**:
- C4Context: 需要特定Mermaid版本支持
- block-beta: 需要最新版Mermaid
- packet-beta: 需要特定插件

#### 方案C: 使用正则表达式验证

**方法**:
- 不实际编译，仅检查语法关键字
- 快速但不够准确
- 作为初步筛选使用

---

## 4. 数据质量综合评估

### 4.1 评估矩阵

| 维度 | 评分 | 说明 |
|------|------|------|
| 数据真实性 | ⭐⭐⭐⭐⭐ | 100%来自互联网真实仓库 |
| 来源可追溯 | ⭐⭐⭐⭐⭐ | 每个样本都有完整URL |
| 代码完整性 | ⭐⭐⭐⭐☆ | 代码完整，无截断 |
| 数据多样性 | ⭐⭐⭐⭐⭐ | 19种图表类型，多来源 |
| **许可证合规** | ⭐☆☆☆☆ | **未记录许可证信息** |
| **可编译性** | ⭐☆☆☆☆ | **仅3.8%验证成功** |

### 4.2 论文发表风险评估

| 风险项 | 严重程度 | 影响 | 解决难度 |
|--------|----------|------|----------|
| 缺少许可证信息 | 🔴 高 | 法律风险，审稿人质疑 | 中（需时4-5小时） |
| 可编译性验证失败 | 🔴 高 | 数据质量受质疑 | 中（需时6-8小时） |
| 缺少渲染图像 | 🟡 中 | 训练数据不完整 | 低（批量渲染） |
| 缺少对话数据 | 🟡 中 | 无法训练文本到图表模型 | 高（需逆向工程） |

---

## 5. 建议的后续步骤

### 阶段1: 修复许可证（优先）

**时间**: 4-5小时
**步骤**:
1. 获取GitHub Token
2. 运行批量许可证获取脚本
3. 生成许可证分布报告
4. 过滤或标记高风险样本

### 阶段2: 重新验证可编译性

**时间**: 6-8小时
**步骤**:
1. 修复Windows subprocess问题
2. 分批验证（每批500个）
3. 记录失败原因
4. 过滤无法编译的样本

### 阶段3: 生成渲染图像

**时间**: 2-3小时
**步骤**:
1. 使用Mermaid CLI批量渲染
2. 生成PNG/SVG图像
3. 验证图像质量

### 阶段4: 逆向工程生成对话

**时间**: 需GPU/LLM API
**步骤**:
1. 使用GPT-4/Claude API
2. 为每个图表生成自然语言描述
3. 验证对话质量

---

## 6. 立即可用的数据

### 6.1 当前可用样本

**可用**: 306个（已验证可编译）
- 全部为`architecture`类型
- 全部为GitHub来源
- 已验证可编译

### 6.2 建议使用策略

**选项A: 小样本高质量（推荐短期）**
- 使用306个已验证样本
- 仅用于原型验证和初步实验
- 论文中注明数据收集进行中

**选项B: 全部数据高风险（不推荐）**
- 使用全部8,000个样本
- 承担审稿人质疑的风险
- 需要大量补充说明

**选项C: 修复后使用（推荐最终）**
- 完成许可证和可编译性修复
- 预计可保留5,000-6,000个高质量样本
- 符合学术论文标准

---

## 7. 技术问题详细日志

### 7.1 许可证获取失败日志

```
GitHub API返回403错误
原因：未提供GitHub Token或Token已过期
解决：需要提供有效的GitHub Personal Access Token
```

### 7.2 可编译性验证失败日志

```
[WinError 2] 系统找不到指定的文件。
原因：Windows下subprocess调用npx.cmd失败
影响：7,678个样本验证失败
解决：需要修复subprocess调用方式或换用Linux环境
```

---

## 8. 总结

### 当前状况

**已完成**:
- ✅ 8,000个真实数据样本收集
- ✅ 多来源（GitHub/HuggingFace/GitLab）
- ✅ 多类型（19种图表类型）
- ✅ 来源可追溯（完整URL）

**待解决**:
- ❌ 许可证信息缺失
- ❌ 可编译性验证失败率过高（96%）
- ❌ 缺少渲染图像
- ❌ 缺少对话数据

### 建议决策

**对于CSCW 2026投稿**:

1. **如果截止日期紧迫**:
   - 使用306个已验证的高质量样本
   - 在论文中注明数据收集策略和限制
   - 承诺后续扩展数据集

2. **如果时间充裕**（1-2周）:
   - 完成许可证补充（4-5小时）
   - 重新验证可编译性（6-8小时）
   - 预计可获得5,000+高质量样本

3. **需要您决策**:
   - 是否提供GitHub Token用于许可证获取？
   - 是否有Linux环境用于验证？
   - 是否能接受小样本（306个）用于初步投稿？

---

**报告生成者**: Claude Code
**数据来源**: dataset_validation.csv, compilability_report.json
**验证时间**: 2026-02-06
