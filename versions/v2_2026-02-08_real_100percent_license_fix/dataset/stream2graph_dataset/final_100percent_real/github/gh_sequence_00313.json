{
  "id": "gh_sequence_00313",
  "source": "github",
  "source_url": "https://github.com/SawatKia/WealthTracking/blob/3237ea7fcdf6f42df90fc1654faaddbd113d6f73/design/newClassesDesign/IncomeExpenseManagement/IeReadOne.mmd",
  "github_repo": "SawatKia/WealthTracking",
  "github_file_path": "design/newClassesDesign/IncomeExpenseManagement/IeReadOne.mmd",
  "diagram_type": "sequence",
  "code": "%%{\n    init: {\n        \"theme\":\"neutral\",\n        \"themeVariables\": {\n            'labelBoxBorderColor': '#ff0000'\n        },\n        \"sequence\": { \n            \"wrap\": true, \n            \"width\": 200 \n        } \n    }\n}%%\nsequenceDiagram\n    participant Client\n    participant Sec as Security\n    participant Router\n    box orange Controller\n        participant BaseCont as BaseController\n        participant Cont as TransactionController\n    end\n    participant PGClient as PostgreSQLClient\n    participant BaseModel as BaseModel\n    participant Model as TransactionModel extends BaseModel\n    %% participant ContainsModel as ContainsModel extends BaseModel\n    %% participant BankAccountModel as BankAccountModel extends BaseModel\n    participant Redis as RedisCache\n    participant DB as [(Database)]\n\n    Client->>+Router: GET /transactions/:transactionId (ReadOne Transaction)\n     Note over Sec, Router: this method defined in UserManagement/read.mmd\n    Router->>+Sec: verifyToken(req)\n    alt Token decode error | Token expired | Invalid token\n        Sec-->>Router: next(new UnauthorizedError('Invalid credentials'))\n        Router-->>Client: ğŸ”´401, \"Could not validate credentials\"\n    end\n    Sec-->>-Router: decoded user object\n\n    Note over Sec, Router: this method defined in UserManagement/create.mmd\n    Router->>Router: MethodValidator(allowedMethods)\n    opt path not available\n        Router-->>Client: ğŸ”´404, \"<path> not available\"\n    end\n    opt method not allowed\n        Router-->>Client: ğŸ”´405, \"<method> not allowed for <path>\"\n    end\n\n    Router->>+Cont: getOneTransaction(req, res, next)\n    Cont->>Cont: Destructoring parameters\n    \n    Note over Cont: requiredFields = [\"transactionId\"]\n    Cont->>+BaseCont: verifyField({transactionId}, requiredFields)\n    Note over BaseCont: also type conversion eg. string -> decimal\n    opt missing required fields\n        BaseCont-->>Cont: throw Error('<field> is required')\n        Cont-->>Router: next(BadRequestError(error))\n        Router-->>Client: ğŸ”´400, \"<field> is required\"\n    end\n    BaseCont-->>-Cont: return true\n\n    Note over Cont, BaseCont: this method defined in UserManagement/read.mmd\n    Cont->>+BaseCont: getCurrentUser(req)\n    BaseCont-->>-Cont: return User object\n    opt user not found\n        Cont-->>Router: next(new NotFoundError('User not found'))\n        Router-->>Client: ğŸ”´404, \"User not found\"\n    end\n\n    Cont->>+Model: findTransactionDetail(transactionUuid)\n\n    Model->>+BaseModel: validateSchema(data) \n    Note over BaseModel: also validate each input individually by Regex: as each type of input has its own pattern, specific requirements and constraints.\n    opt missing required field || invalid type || RegEx does not match\n        BaseModel-->>Model: throw new Error('<field> is invalid')\n        Model-->>Cont: throw error\n        Cont-->>Router: next(new BadRequestError(error.message))\n        Router-->>Client: ğŸ”´400, \"<error.message>\"\n    end\n    BaseModel-->>-Model: return true\n\n    Model->>+Redis: Check if required transaction Uuid was cached\n    Redis-->>-Model: return cachedTransactionData\n    opt if cache miss\n        Model->>+BaseModel: query(sql, params)\n        Note over BaseModel: query with prepare Statements\n        BaseModel->>+DB: do operation\n        DB-->>-BaseModel: result\n        opt transaction not found\n            BaseModel-->>Model: throw new Error(\"transaction not found\")\n            Model-->>Cont: throw error\n            Cont-->>Router: next(error)\n            Router-->>Client: ğŸ”´404, \"transaction not found\"\n        end\n        opt any error occurred\n            BaseModel-->>Model: throw Error\n            Model-->>Cont: throw error\n            Cont-->>Router: next(error)\n            Router-->>Client: ğŸ”´500, \"something went wrong\"\n        end\n        BaseModel-->>-Model: return the detail of given transaction Uuid \n        Note over Model, Redis: Async operation\n        Model-)Redis: add transaction details with transaction Uuid as a key\n    end\n    Model->>-Cont: return the detail of given transaction Uuid\n\n    Note over Cont, BaseCont: verify that the current user owns the bank accounts involved\n    Cont->>+BaseCont: verifyOwnership(user, [transaction])\n    opt bank account's user email does not match current user email\n        BaseCont-->>Cont: return false\n        Cont-->>Router: throw ForbiddenError('You are not allowed to access this resource')\n        Router-->>Client: ğŸ”´403, \"You are not allowed to access this resource\"\n    end\n    BaseCont-->>-Cont: return true\n    \n    Cont->>Cont: formatResponse(200, 'Transaction found', TransactionDetail)\n    Cont-->>-Router: return formatted response\n    Router-->>-Client: ğŸŸ¢200, { status: 200, message: \"Transaction found\", data: {TransactionDetail} }\n",
  "content_size": 4768,
  "collected_at": "2026-02-06T01:30:33.985089",
  "compilation_status": "failed",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 1,
  "repo_forks": 1,
  "compilation_error": "[WinError 2] ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶ã€‚"
}