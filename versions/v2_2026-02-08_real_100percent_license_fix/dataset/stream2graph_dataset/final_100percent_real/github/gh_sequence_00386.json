{
  "id": "gh_sequence_00386",
  "source": "github",
  "source_url": "https://github.com/ik-workshop/naglfar-analytics/blob/2ff359b7b80b238f0b039374ec84a4f8152fadc1/docs/assets/diagrams/05-request-flow-blocked-token.mmd",
  "github_repo": "ik-workshop/naglfar-analytics",
  "github_file_path": "docs/assets/diagrams/05-request-flow-blocked-token.mmd",
  "diagram_type": "sequence",
  "code": "sequenceDiagram\n    participant Client\n    participant Traefik as API Gateway\n    participant Naglfar as Naglfar<br/>Validation\n    participant Redis\n    participant Kafka\n\n    Client->>Traefik: GET /api/v1/books<br/>Authorization: Bearer token\n    Traefik->>Naglfar: Forward request\n\n    rect rgb(255, 200, 200)\n        Note over Naglfar,Redis: Token Compromise Detected!\n        Naglfar->>Redis: Check IP hash in blocked_ips?\n        Redis-->>Naglfar: NOT FOUND ✓\n        Naglfar->>Redis: Check token hash in blocked_tokens?\n        Redis-->>Naglfar: FOUND ✗ (BLOCKED)\n    end\n\n    rect rgb(255, 230, 230)\n        Note over Naglfar,Kafka: Log Block Event\n        Naglfar->>Kafka: Publish<br/>{decision: \"block\", reason: \"token_compromised\"}\n        Naglfar-->>Traefik: 401 Unauthorized<br/>{error: \"token_revoked\"}\n    end\n\n    Traefik-->>Client: 401 Unauthorized<br/>Must re-authenticate\n",
  "content_size": 891,
  "collected_at": "2026-02-06T01:31:32.047912",
  "compilation_status": "failed",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0,
  "repo_owner": "ik-workshop",
  "repo_name": "naglfar-analytics",
  "repo_description": "The ship made of dead men's nails. A bit darker, but represents collection and analysis of threat data.",
  "repo_language": "Python",
  "repo_topics": [],
  "repo_created_at": "2025-12-27T10:40:47Z",
  "repo_updated_at": "2025-12-29T16:42:42Z",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}