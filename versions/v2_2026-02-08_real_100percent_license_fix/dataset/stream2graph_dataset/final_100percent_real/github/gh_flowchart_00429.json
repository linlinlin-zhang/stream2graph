{
  "id": "gh_flowchart_00429",
  "source": "github",
  "source_url": "https://github.com/ngdzu/qtapp/blob/e3a1c2bbd71821fc0388274ec7f2043532d8f8aa/project-dashboard/doc/processes/diagrams/DOC-PROC-006_workflow.mmd",
  "github_repo": "ngdzu/qtapp",
  "github_file_path": "project-dashboard/doc/processes/diagrams/DOC-PROC-006_workflow.mmd",
  "diagram_type": "flowchart",
  "code": "flowchart TD\n    Start([Migration Trigger]) --> DryRun{Dry Run Mode?}\n    DryRun -- Yes --> SimulateMig[Simulate Migration]\n    SimulateMig --> ReportDry[Report Dry Run Results]\n    ReportDry --> End([Migration Complete])\n    DryRun -- No --> PreCheck[Run Pre-Migration Checks]\n    PreCheck --> CheckIntegrity[Check DB Integrity]\n    CheckIntegrity --> CheckFK[Verify Foreign Keys]\n    CheckFK --> CheckSize[Check DB Size]\n    CheckSize --> PreValid{Pre-Validation Pass?}\n    PreValid -- Fail --> LogPreFail[Log Pre-Check Failure]\n    LogPreFail --> Abort[Abort Migration]\n    Abort --> End\n    PreValid -- Pass --> Backup[Backup Database]\n    Backup --> DetectPending[Detect Pending Migrations]\n    DetectPending --> CheckVersion[Check schema_version Table]\n    CheckVersion --> PendingFound{Pending Migrations?}\n    PendingFound -- No --> NoOp[No Migrations to Apply]\n    NoOp --> End\n    PendingFound -- Yes --> OrderMigs[Order by Number Schema/Data/Seed]\n    OrderMigs --> BeginTx[BEGIN TRANSACTION]\n    BeginTx --> ApplyNext{Next Migration?}\n    ApplyNext -- Schema --> ApplyDDL[Apply DDL Changes]\n    ApplyNext -- Data --> TransformData[Transform Existing Data]\n    ApplyNext -- Seed --> InsertDefaults[Insert Seed Data]\n    ApplyDDL --> RecordVersion[Record in schema_version]\n    TransformData --> RecordVersion\n    InsertDefaults --> RecordVersion\n    RecordVersion --> CommitTx[COMMIT TRANSACTION]\n    CommitTx --> MoreMigs{More Migrations?}\n    MoreMigs -- Yes --> ApplyNext\n    MoreMigs -- No --> PostCheck[Run Post-Migration Checks]\n    PostCheck --> VerifyVersion[Verify Schema Version]\n    VerifyVersion --> CheckInvariants[Check Data Invariants]\n    CheckInvariants --> PostValid{Post-Validation Pass?}\n    PostValid -- Fail --> LogPostFail[Log Post-Check Failure]\n    LogPostFail --> Rollback[Rollback Migration]\n    Rollback --> RestoreBackup[Restore from Backup]\n    RestoreBackup --> End\n    PostValid -- Pass --> LogSuccess[Log Migration Success]\n    LogSuccess --> CleanBackup[Clean Old Backups]\n    CleanBackup --> End\n    ApplyNext -- Error --> TxError[Transaction Error]\n    TxError --> RollbackTx[ROLLBACK TRANSACTION]\n    RollbackTx --> LogError[Log Migration Error]\n    LogError --> Rollback\n",
  "content_size": 2220,
  "collected_at": "2026-02-06T01:44:02.209975",
  "compilation_status": "failed",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0,
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}