{
  "id": "gh_sequence_00556",
  "source": "github",
  "source_url": "https://github.com/adminbjkai/notes-dashboard/blob/4beaaa28474e04faefbf52f7a881bbb334bd194c/docs-by-notebooklm/generated/data-flow.mmd",
  "github_repo": "adminbjkai/notes-dashboard",
  "github_file_path": "docs-by-notebooklm/generated/data-flow.mmd",
  "diagram_type": "sequence",
  "code": "%% Notes Dashboard - Data Flow Sequences\n%% Generated: 2025-12-24\n%% Source: CONSTITUTION.md + note_service.py\n\nsequenceDiagram\n    autonumber\n    participant U as User\n    participant FE as Frontend<br/>(Next.js)\n    participant BE as Backend<br/>(FastAPI)\n    participant DB as PostgreSQL\n\n    Note over U,DB: Reorder Operation (Article I Section 1.4)\n\n    U->>FE: Drag note to new position\n    FE->>FE: Calculate drop zone (35/30/35)\n    FE->>FE: Check horizontal offset (±40px)\n    FE->>BE: POST /api/notes/reorder<br/>{note_id, parent_id, position}\n\n    BE->>DB: UPDATE note SET position = 999999<br/>(temporary, avoid conflicts)\n    BE->>DB: SELECT * FROM notes<br/>WHERE parent_id = ?<br/>ORDER BY position, created_at, id\n\n    Note over BE: _normalize_positions()\n    loop For each sibling at index i\n        BE->>DB: UPDATE notes SET position = i\n    end\n\n    BE->>FE: 200 OK {normalized tree}\n    FE->>U: UI updates with new hierarchy\n\n    Note over U,DB: Image Upload Operation\n\n    U->>FE: Select file via slash command\n    FE->>FE: Validate file size (≤10MB)\n    FE->>BE: POST /api/uploads<br/>(multipart/form-data)\n    BE->>BE: Generate UUID filename\n    BE->>BE: Save to /app/uploads/\n    BE->>FE: {url: \"/uploads/abc123.png\"}\n    FE->>FE: Prepend http://localhost:8000\n    FE->>U: Image rendered in TipTap\n\n    Note over U,DB: Delete Operation (Atomic)\n\n    U->>FE: Delete note via context menu\n    FE->>BE: DELETE /api/notes/{id}\n    BE->>DB: DELETE FROM notes WHERE id = ?\n    BE->>DB: db.flush()\n    BE->>DB: _normalize_positions(parent_id)\n    BE->>DB: db.commit()\n    Note over BE: Single transaction!\n    BE->>FE: 200 OK\n    FE->>U: Note removed from tree\n",
  "content_size": 1678,
  "collected_at": "2026-02-06T01:33:55.081642",
  "compilation_status": "failed",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0,
  "repo_owner": "adminbjkai",
  "repo_name": "notes-dashboard",
  "repo_description": "full-stack hierarchical note-taking application built with FastAPI, Next.js, and PostgreSQL featuring drag-and-drop organization",
  "repo_language": "TypeScript",
  "repo_topics": [],
  "repo_created_at": "2025-12-22T10:14:23Z",
  "repo_updated_at": "2025-12-26T00:20:25Z",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}