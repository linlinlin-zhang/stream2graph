{
  "id": "gh_sequence_00894",
  "source": "github",
  "source_url": "https://github.com/sallim-me/web-client/blob/526e7dc481046359eeafcc07817741c7bb5785d4/mermaid/chat.mmd",
  "github_repo": "sallim-me/web-client",
  "github_file_path": "mermaid/chat.mmd",
  "diagram_type": "sequence",
  "code": "sequenceDiagram\n    participant U1 as 사용자 A\n    participant F1 as 프론트엔드 A\n    participant BE as 백엔드 서버\n    participant WS as WebSocket 브로커\n    participant F2 as 프론트엔드 B\n    participant U2 as 사용자 B\n\n    Note over U1,U2: 실시간 채팅 시스템 플로우\n\n    %% 채팅방 입장\n    rect rgb(240, 248, 255)\n    Note over F1,BE: 채팅방 입장 과정\n    U1->>F1: 채팅방 입장\n    F1->>+BE: POST /chat/rooms/{roomId}/enter\n    BE-->>-F1: 200 OK\n    \n    F1->>+WS: WebSocket 연결 (ws://localhost:8080/ws-chat)\n    WS-->>-F1: 연결 성공\n    \n    F1->>WS: 구독 (/topic/room/{roomId})\n    WS-->>F1: 구독 성공\n    \n    F1->>+BE: GET /chat/rooms/{roomId}/messages\n    BE-->>-F1: 기존 메시지 목록\n    F1->>U1: 채팅방 UI 표시 + 입력창 포커스\n    end\n\n    %% 사용자 B도 동일하게 입장\n    rect rgb(245, 255, 250)\n    Note over F2,BE: 사용자 B 채팅방 입장\n    U2->>F2: 채팅방 입장\n    F2->>+BE: POST /chat/rooms/{roomId}/enter\n    BE-->>-F2: 200 OK\n    F2->>WS: WebSocket 연결 + 구독\n    WS-->>F2: 연결 및 구독 성공\n    F2->>+BE: GET /chat/rooms/{roomId}/messages\n    BE-->>-F2: 기존 메시지 목록\n    end\n\n    %% 실시간 메시지 송수신\n    rect rgb(255, 248, 248)\n    Note over U1,U2: 실시간 메시지 송수신\n    \n    U1->>F1: 메시지 입력 + 엔터\n    F1->>F1: 낙관적 UI 업데이트 (임시 메시지 표시)\n    \n    alt WebSocket 연결됨\n        F1->>WS: 메시지 전송 (/app/chat/room/{roomId})\n        WS->>+BE: 메시지 처리\n        BE->>BE: 메시지 DB 저장\n        BE->>-WS: 저장된 메시지 반환\n        \n        par 실시간 브로드캐스트\n            WS->>F1: 메시지 수신 (/topic/room/{roomId})\n            F1->>F1: 임시 메시지 → 실제 메시지 교체\n            F1->>U1: 메시지 UI 업데이트 + 입력창 포커스\n        and\n            WS->>F2: 메시지 수신 (/topic/room/{roomId})\n            F2->>F2: 새 메시지 UI 추가\n            F2->>U2: 실시간 메시지 표시\n        end\n        \n    else WebSocket 끊어짐 (폴백)\n        F1->>+BE: POST /chat/rooms/{roomId}/messages\n        BE->>BE: 메시지 DB 저장\n        BE-->>-F1: 저장 완료\n        F1->>F1: 쿼리 무효화 및 새로고침\n    end\n    end\n\n    %% 연속 메시지\n    rect rgb(248, 255, 248)\n    Note over U1,U2: 연속 메시지 (포커스 유지)\n    U1->>F1: 두 번째 메시지 입력 + 엔터\n    F1->>F1: 포커스 유지 (100ms 후 자동 포커스)\n    F1->>WS: 메시지 전송\n    WS->>BE: 메시지 처리\n    BE->>WS: 저장된 메시지\n    \n    par\n        WS->>F1: 메시지 수신\n        F1->>U1: UI 업데이트 + 포커스 유지\n    and\n        WS->>F2: 메시지 수신\n        F2->>U2: 실시간 표시\n    end\n    end\n\n    %% 모바일 버튼 사용\n    rect rgb(255, 255, 240)\n    Note over U2,F2: 모바일 전송 버튼 사용\n    U2->>F2: 메시지 입력 + 전송 버튼 터치\n    F2->>F2: handleSendButtonClick() 실행\n    F2->>WS: 메시지 전송\n    F2->>F2: 버튼 클릭 후 입력창 포커스 (100ms 후)\n    WS->>BE: 메시지 처리\n    BE->>WS: 저장된 메시지\n    \n    par\n        WS->>F2: 메시지 수신\n        F2->>U2: UI 업데이트 + 키보드 자동 표시\n    and\n        WS->>F1: 메시지 수신\n        F1->>U1: 실시간 표시\n    end\n    end\n\n    %% 채팅방 퇴장\n    rect rgb(248, 248, 248)\n    Note over F1,BE: 채팅방 퇴장\n    U1->>F1: 뒤로가기 또는 페이지 이동\n    F1->>WS: 구독 해제 (/topic/room/{roomId})\n    F1->>WS: WebSocket 연결 해제\n    F1->>+BE: POST /chat/rooms/{roomId}/exit\n    BE-->>-F1: 퇴장 완료\n    end\n\n    %% 에러 처리\n    rect rgb(255, 245, 245)\n    Note over F1,BE: 연결 실패 시 처리\n    alt WebSocket 연결 실패\n        F1->>WS: 연결 시도\n        WS--xF1: 연결 실패\n        F1->>F1: 자동 재연결 시도 (최대 5회)\n        F1->>U1: 연결 상태 표시 (\"연결 안됨\")\n    else 메시지 전송 실패\n        F1->>WS: 메시지 전송 시도\n        WS--xF1: 전송 실패\n        F1->>F1: 임시 메시지 제거\n        F1->>+BE: REST API 폴백 전송\n        BE-->>-F1: 전송 완료\n    end\n    end\n",
  "content_size": 3150,
  "collected_at": "2026-02-06T01:50:25.898602",
  "compilation_status": "failed",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0,
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}