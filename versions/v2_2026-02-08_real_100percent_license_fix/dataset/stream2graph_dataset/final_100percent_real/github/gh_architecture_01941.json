{
  "id": "gh_architecture_01941",
  "source": "github",
  "source_url": "https://github.com/vaskomet/CapstoneProjectMetallinosE-Clean/blob/75dd266f9e5f00ca887adf8d291f36f4503fa0ee/docs/diagrams/flows/WEBSOCKET_ARCHITECTURE.mmd",
  "github_repo": "vaskomet/CapstoneProjectMetallinosE-Clean",
  "github_file_path": "docs/diagrams/flows/WEBSOCKET_ARCHITECTURE.mmd",
  "diagram_type": "architecture",
  "code": "%% WebSocket Architecture Diagram\n%% Shows all WebSocket connections, message types, and routing\n%% View in VS Code with Mermaid extension or paste into https://mermaid.live\n\ngraph TB\n    subgraph \"Frontend (React)\"\n        UserBrowser[User Browser]\n        WSContext[WebSocketContext]\n        ChatContext[UnifiedChatContext]\n        CleaningJobs[CleaningJobsPool]\n        NotificationBell[NotificationBell]\n    end\n\n    subgraph \"Django Channels Layer\"\n        Daphne[Daphne ASGI Server]\n        ChannelsLayer[Redis Channels Layer]\n        \n        subgraph \"Consumers\"\n            NotificationConsumer[NotificationConsumer<br/>ws/notifications/user_id/]\n            ChatConsumer[UnifiedChatConsumer<br/>ws/chat/]\n            JobChatConsumer[JobChatConsumer<br/>ws/job_chat/job_id/]\n        end\n    end\n\n    subgraph \"Backend Services\"\n        PaymentViews[Payment Views]\n        JobViews[Job Views]\n        NotificationModel[Notification Model]\n        ChatModel[ChatMessage Model]\n        EventPublisher[EventPublisher<br/>core/events.py]\n    end\n\n    subgraph \"Redis Pub/Sub\"\n        RedisChannels[Redis Channels]\n        RedisCache[Redis Cache<br/>Unread counts]\n    end\n\n    %% Frontend WebSocket Connections\n    UserBrowser -->|\"Connect on login\"| WSContext\n    WSContext -->|\"ws://localhost:8000/ws/notifications/{user_id}/?token=JWT\"| Daphne\n    \n    ChatContext -->|\"ws://localhost:8000/ws/chat/?token=JWT\"| Daphne\n    ChatContext -->|\"Legacy: ws://localhost:8000/ws/job_chat/{job_id}/?token=JWT\"| Daphne\n\n    %% Daphne Routing\n    Daphne -->|Route| NotificationConsumer\n    Daphne -->|Route| ChatConsumer\n    Daphne -->|Route| JobChatConsumer\n\n    %% Consumer → Channels Layer\n    NotificationConsumer <-->|group_send/group_add| ChannelsLayer\n    ChatConsumer <-->|group_send/group_add| ChannelsLayer\n    JobChatConsumer <-->|group_send/group_add| ChannelsLayer\n\n    %% Channels Layer → Redis\n    ChannelsLayer <-->|Pub/Sub| RedisChannels\n    ChannelsLayer <-->|Cache| RedisCache\n\n    %% Backend Triggers\n    PaymentViews -->|\"Create notification\"| NotificationModel\n    JobViews -->|\"Create notification\"| NotificationModel\n    \n    NotificationModel -->|\"Serialize + Push\"| ChannelsLayer\n    ChannelsLayer -->|\"notifications_{user_id}\"| NotificationConsumer\n    \n    ChatModel -->|\"Publish message\"| EventPublisher\n    EventPublisher -->|\"Topic: chat\"| ChannelsLayer\n    ChannelsLayer -->|\"chat_{room_id}\"| ChatConsumer\n\n    %% Real-time Updates\n    NotificationConsumer -->|\"notification_message\"| WSContext\n    WSContext -->|\"Update state\"| NotificationBell\n    WSContext -->|\"jobNotificationReceived event\"| CleaningJobs\n    \n    ChatConsumer -->|\"chat_message\"| ChatContext\n    ChatContext -->|\"Update room state\"| UserBrowser\n\n    %% Message Types\n    subgraph \"Notification Messages\"\n        NM1[\"new_notification<br/>{notification: {...}}\"]\n        NM2[\"notification_read<br/>{notification_id}\"]\n        NM3[\"unread_count<br/>{count}\"]\n    end\n\n    subgraph \"Chat Messages\"\n        CM1[\"chat_message<br/>{message, sender, timestamp}\"]\n        CM2[\"typing_indicator<br/>{user, is_typing}\"]\n        CM3[\"user_joined/left<br/>{user}\"]\n    end\n\n    NotificationConsumer -.->|Types| NM1\n    NotificationConsumer -.->|Types| NM2\n    NotificationConsumer -.->|Types| NM3\n\n    ChatConsumer -.->|Types| CM1\n    ChatConsumer -.->|Types| CM2\n    ChatConsumer -.->|Types| CM3\n\n    %% Styling\n    classDef frontend fill:#E3F2FD,stroke:#1976D2,stroke-width:2px\n    classDef backend fill:#E8F5E9,stroke:#388E3C,stroke-width:2px\n    classDef redis fill:#FFEBEE,stroke:#C62828,stroke-width:2px\n    classDef consumer fill:#FFF3E0,stroke:#F57C00,stroke-width:2px\n\n    class UserBrowser,WSContext,ChatContext,CleaningJobs,NotificationBell frontend\n    class PaymentViews,JobViews,NotificationModel,ChatModel,EventPublisher backend\n    class RedisChannels,RedisCache,ChannelsLayer redis\n    class NotificationConsumer,ChatConsumer,JobChatConsumer consumer\n",
  "content_size": 3955,
  "collected_at": "2026-02-06T02:05:04.438176",
  "compilation_status": "failed",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0
}