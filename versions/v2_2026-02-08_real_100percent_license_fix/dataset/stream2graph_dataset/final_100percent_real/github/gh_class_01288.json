{
  "id": "gh_class_01288",
  "source": "github",
  "source_url": "https://github.com/effibot/ros2_canbus_control/blob/d1719413a073689bd6ec9ea90ac20c9ba6cb0427/misc/waveshare_cpp/classDiagram.mmd",
  "github_repo": "effibot/ros2_canbus_control",
  "github_file_path": "misc/waveshare_cpp/classDiagram.mmd",
  "diagram_type": "class",
  "code": "classDiagram\n    %% Updated Frame Traits with Hybrid Design\n    %% - Primary template with interface documentation (void types)\n    %% - VariableFrame uses MAX_* constants (no redundant aliases)\n    %% - Added modern C++17 utility templates for convenience\n    %% - SFINAE-friendly type checking and validation\n    \n    %% Color definitions for different entity types\n    class FrameTraits {\n        <<template trait>>\n        +static constexpr size_t FRAME_SIZE = 0\n        +static constexpr size_t ID_SIZE = 0\n        +static constexpr size_t DATA_SIZE = 0\n        +using StorageType = void\n        +using IDType = void\n        +using DataType = void\n        +using PayloadPair = void\n        +using IDPair = void\n        +Note: Primary template with interface documentation\n        +Note: Intentionally uses void types to prevent usage\n        +Note: All specializations must override these members\n    }\n    \n    class FrameTraitsFixedFrame {\n        <<specialization>>\n        +static constexpr size_t FRAME_SIZE = 20\n        +static constexpr size_t ID_SIZE = 4\n        +static constexpr size_t DATA_SIZE = 8\n        +using StorageType = std::array~uint8_t, 20~\n        +using IDType = std::array~uint8_t, 4~\n        +using DataType = std::array~uint8_t, 8~\n        +using PayloadPair = std::pair~DataType, uint8_t~\n        +using IDPair = std::pair~IDType, uint8_t~\n    }\n    \n    class FrameTraitsVariableFrame {\n        <<specialization>>\n        +static constexpr size_t MAX_FRAME_SIZE = 15\n        +static constexpr size_t MAX_ID_SIZE = 4\n        +static constexpr size_t MAX_DATA_SIZE = 8\n        +using StorageType = std::vector~uint8_t~\n        +using IDType = std::variant~uint16_t, uint32_t~\n        +using DataType = std::vector~uint8_t~\n        +using PayloadPair = std::pair~DataType, uint8_t~\n        +using IDPair = std::pair~IDType, uint8_t~\n        +Note: Uses MAX_* constants for variable sizing\n        +Note: No redundant FRAME_SIZE aliases\n    }\n    \n    class FrameTraitsConfigFrame {\n        <<specialization>>\n        +static constexpr size_t FRAME_SIZE = 20\n        +static constexpr size_t CONFIG_SIZE = 16\n        +using StorageType = std::array~uint8_t, 20~\n        +using ConfigType = std::array~uint8_t, 16~\n        +using BaudType = uint8_t\n        +using ModeType = uint8_t\n    }\n\n    class BaseFrame {\n        <<CRTP Base Class>>\n        #using Traits = FrameTraits~Derived~\n        #using StorageType = typename Traits::StorageType\n        #StorageType storage\n        +serialize() const → Result~std::array<uint8_t, Traits::FRAME_SIZE>~\n        +deserialize(const uint8_t*) → Result~bool~\n        +validate() const → Result~bool~\n        +size() const → size_t\n        +data() const → const uint8_t*\n        +get_checksum() const → uint8_t\n    }\n    \n    class FixedFrame {\n        +using Traits = FrameTraits~FixedFrame~\n        +using IDType = typename Traits::IDType\n        +using DataType = typename Traits::DataType\n        +set_id(const IDType&)\n        +get_id() const → IDType\n        +set_data(const DataType&, uint8_t dlc)\n        +get_data() const → std::pair~DataType, uint8_t~\n        +set_frame_type(uint8_t)\n        +get_frame_type() const → uint8_t\n        +calculate_checksum() const → uint8_t\n    }\n    \n    class VariableFrame {\n        +using Traits = FrameTraits~VariableFrame~\n        +using IDType = typename Traits::IDType\n        +using DataType = typename Traits::DataType\n        +set_id(uint32_t, bool extended = false)\n        +get_id() const → std::pair~uint32_t, bool~\n        +set_data(const std::array~uint8_t~&)\n        +get_data() const → std::array~uint8_t~\n        +get_dlc() const → uint8_t\n        +is_extended() const → bool\n        +is_remote() const → bool\n        +build_type_byte() const → uint8_t\n    }\n    \n    class ConfigFrame {\n        +using Traits = FrameTraits~ConfigFrame~\n        +using ConfigType = typename Traits::ConfigType\n        +set_can_baud(uint8_t)\n        +get_can_baud() const → uint8_t\n        +set_filter_mask(uint32_t filter, uint32_t mask)\n        +get_filter_mask() const → std::pair~uint32_t, uint32_t~\n        +set_can_mode(uint8_t)\n        +get_can_mode() const → uint8_t\n        +set_auto_rtx(bool)\n        +get_auto_rtx() const → bool\n        +validate_config() const → bool\n    }\n    \n    class UsbCan {\n        -libusb_context* context\n        -libusb_device_handle* device_handle\n        +initialize() → Result~bool~\n        +close() → Result~bool~\n        +send_frame~T~(const T&) → Result~bool~\n        +receive_frame~T~() → Result~T~\n        +configure(const ConfigFrame&) → Result~bool~\n        +set_baud_rate(uint8_t) → Result~bool~\n        +get_status() → Result~uint8_t~\n        -write_data(const uint8_t*, size_t) → Result~size_t~\n        -read_data(uint8_t*, size_t) → Result~size_t~\n    }\n    \n    class Result {\n        <<template>>\n        +T value\n        +std::error_code status\n        +bool ok() const\n        +bool fail() const\n        +explicit operator bool() const\n        +bool operator!() const\n        +std::string to_string()\n        +static Result~T~ success(T val)\n        +static Result~T~ error(Status err)\n    }\n    \n    class Status {\n        <<enumeration>>\n        SUCCESS = 0\n        WBAD_START = 1\n        WBAD_HEADER = 2\n        WBAD_TYPE = 3\n        WBAD_FRAME_TYPE = 4\n        WBAD_LENGTH = 5\n        WBAD_ID = 6\n        WBAD_DATA = 7\n        WBAD_DLC = 8\n        WBAD_FORMAT = 9\n        WBAD_RESERVED = 10\n        WBAD_CHECKSUM = 11\n        WBAD_DATA_INDEX = 12\n        WBAD_CAN_MODE = 13\n        WTIMEOUT = 14\n        DNOT_FOUND = 15\n        DNOT_OPEN = 16\n        DALREADY_OPEN = 17\n        DREAD_ERROR = 18\n        DWRITE_ERROR = 19\n        DCONFIG_ERROR = 20\n        CAN_SDO_TIMEOUT = 21\n        CAN_SDO_ABORT = 22\n        CAN_PDO_ERROR = 23\n        CAN_NMT_ERROR = 24\n        UNKNOWN = 255\n    }\n    \n    class ErrorCategory {\n        <<std::error_category>>\n        +name() const → const char*\n        +message(int ev) const → std::string\n    }\n    \n    class Common {\n        <<utility>>\n        +static constexpr uint8_t START = 0xAA\n        +static constexpr uint8_t HEADER = 0x55\n        +static constexpr uint8_t END = 0x55\n        +enum class FrameType\n        +enum class FrameFormat\n        +enum class CANBaud\n        +enum class CANMode\n        +constexpr uint8_t calculate_checksum(const uint8_t*, size_t)\n        +constexpr bool validate_dlc(uint8_t)\n        +constexpr uint32_t extract_id(const uint8_t*, bool extended)\n    }\n\n    class FrameTraitsUtilities {\n        <<utility templates>>\n        +template~T~ using frame_traits_t = FrameTraits~T~\n        +template~T~ constexpr size_t frame_size_v\n        +template~T~ constexpr bool is_frame_type_v\n        +template~T~ constexpr bool is_valid_frame_traits_v\n        +template~T~ struct validate_frame_traits\n        +Note: Modern C++17 utility templates\n        +Note: SFINAE-friendly type checking\n        +Note: Compile-time validation\n    }\n\n    %% Color styling - unique color for each class\n    style FrameTraits fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000\n    style FrameTraitsFixedFrame fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000\n    style FrameTraitsVariableFrame fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000\n    style FrameTraitsConfigFrame fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000\n    style BaseFrame fill:#fff8e1,stroke:#f57c00,stroke-width:3px,color:#000\n    style FixedFrame fill:#fdf2c4,stroke:#ff6f00,stroke-width:2px,color:#000\n    style VariableFrame fill:#fdf2c4,stroke:#ff6f00,stroke-width:2px,color:#000\n    style ConfigFrame fill:#fdf2c4,stroke:#ff6f00,stroke-width:2px,color:#000\n    style UsbCan fill:#ffebee,stroke:#c62828,stroke-width:3px,color:#000\n    style Common fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px,color:#000\n    style FrameTraitsUtilities fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px,color:#000\n    style Result fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px,color:#000\n    style Status fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px,color:#000\n    style ErrorCategory fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px,color:#000\n\n\n    %% Trait specialization relationships\n    FrameTraits <|-- FrameTraitsFixedFrame : specializes\n    FrameTraits <|-- FrameTraitsVariableFrame : specializes\n    FrameTraits <|-- FrameTraitsConfigFrame : specializes\n    \n    %% CRTP inheritance relationships\n    BaseFrame <|-- FixedFrame : inherits CRTP\n    BaseFrame <|-- VariableFrame : inherits CRTP\n    FixedFrame <|-- ConfigFrame : inherits\n    \n    %% Trait usage connections (connecting traits to BaseFrame through CRTP)\n    BaseFrame ..> FrameTraits : uses via CRTP\n    FixedFrame ..> FrameTraitsFixedFrame : instantiates traits\n    VariableFrame ..> FrameTraitsVariableFrame : instantiates traits\n    ConfigFrame ..> FrameTraitsConfigFrame : instantiates traits\n    \n    %% Main class dependencies\n    UsbCan --> BaseFrame : uses\n    UsbCan --> FixedFrame : uses\n    UsbCan --> VariableFrame : uses\n    UsbCan --> ConfigFrame : uses\n    UsbCan --> Result : returns\n    \n    %% Error handling system\n    Result --> Status : uses error codes\n    Status --> ErrorCategory : converts to error_code\n    \n    %% Common utilities dependencies\n    BaseFrame ..> Common : uses utilities\n    BaseFrame --> Result : returns\n    FixedFrame ..> Common : uses constants\n    VariableFrame ..> Common : uses constants\n    ConfigFrame ..> Common : uses constants\n    UsbCan ..> Common : uses utilities\n    \n    %% Frame traits utility dependencies\n    FrameTraitsUtilities ..> FrameTraits : wraps and validates\n    FrameTraitsUtilities ..> FrameTraitsFixedFrame : validates\n    FrameTraitsUtilities ..> FrameTraitsVariableFrame : validates  \n    FrameTraitsUtilities ..> FrameTraitsConfigFrame : validates\n    BaseFrame ..> FrameTraitsUtilities : uses utilities\n\n\n",
  "content_size": 9854,
  "collected_at": "2026-02-06T01:55:41.749280",
  "compilation_status": "failed",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0
}