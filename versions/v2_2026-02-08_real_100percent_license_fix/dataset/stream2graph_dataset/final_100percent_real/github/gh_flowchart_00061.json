{
  "id": "gh_flowchart_00061",
  "source": "github",
  "source_url": "https://github.com/bondieffects/audio_dsp/blob/088f06acc8b2f8eea6ea3049636f8ae5ed8ea59b/docs/i2s_tx.mmd",
  "github_repo": "bondieffects/audio_dsp",
  "github_file_path": "docs/i2s_tx.mmd",
  "diagram_type": "flowchart",
  "code": "flowchart TB\n    %% I2S TX (Transmitter) Block Diagram - Detailed Implementation\n\n    RST[\"reset_n<br/>Active Low Reset\"]\n\n    subgraph inputs [\"External Inputs\"]\n        BCLK[\"i2s_bclk<br/>Bit Clock<br/>(Falling Edge Trigger)\"]\n        WS[\"i2s_ws<br/>Word Select<br/>0=Left, 1=Right\"]\n        LEFT_IN[\"audio_left<br/>16-bit Left Sample<br/>Parallel Input\"]\n        RIGHT_IN[\"audio_right<br/>16-bit Right Sample<br/>Parallel Input\"]\n        TX_RDY[\"tx_ready<br/>Input Data Ready Flag\"]\n    end\n    \n    subgraph outputs [\"Serial Output & Control\"]\n        SDATA_OUT[\"i2s_sdata<br/>Serial Audio Data Output<br/>(MSB First, Left-Justified)\"]\n        SAMPLE_REQ[\"sample_request<br/>Sample Request Flag<br/>(Pulses on WS falling edge)\"]\n    end\n    \n    subgraph ws_detection [\"WS Transition Detection\"]\n        WS_PREV[\"ws_prev<br/>Previous WS State<br/>Edge Detection Register\"]\n        WS_EDGE[\"WS Edge Detection<br/>Detects WS transitions<br/>Triggers sample request\"]\n        FALL_DETECT[\"WS Falling Edge<br/>ws_prev=1 & i2s_ws=0<br/>Start of new frame\"]\n    end\n    \n    subgraph sample_control [\"Sample Input Control\"]\n        REQ_GEN[\"request_sample<br/>Internal Request Signal<br/>Generated on WS falling edge\"]\n        DATA_CAPTURE[\"Data Capture Logic<br/>Loads samples when<br/>tx_ready=1 & request=1\"]\n    end\n    \n    subgraph data_storage [\"Data Storage Registers\"]\n        LEFT_REG[\"left_data_reg<br/>16-bit Left Sample Buffer<br/>Loaded on sample request\"]\n        RIGHT_REG[\"right_data_reg<br/>16-bit Right Sample Buffer<br/>Loaded on sample request\"]\n        CURRENT_DATA[\"current_data (tx_data)<br/>16-bit Active Transmission Data<br/>Selected based on WS\"]\n    end\n    \n    subgraph transmission_control [\"Transmission Control Logic\"]\n        BCLK_COUNT[\"bclk_count<br/>Bit Position Counter (0-20)<br/>Resets on WS change\"]\n        CHANNEL_SELECT[\"Channel Selection<br/>WS=0: Load left_data_reg<br/>WS=1: Load right_data_reg\"]\n        BIT_SELECT[\"Bit Selection Logic<br/>Outputs tx_data(16-bclk_count)<br/>MSB first transmission\"]\n    end\n    \n    subgraph output_logic [\"Serial Output Generation\"]\n        SETUP_TIME[\"Setup Time (bclk_count=0)<br/>Output '0' for timing\"]\n        DATA_PERIOD[\"Data Period (1-16)<br/>Transmit 16 data bits<br/>MSB first\"]\n        IDLE_PERIOD[\"Idle Period (>16)<br/>Output '0' until next WS\"]\n        SDATA_MUX[\"Serial Data Multiplexer<br/>Selects output based on<br/>bclk_count value\"]\n    end\n\n    %% Input connections\n    RST --> ws_detection\n    RST --> sample_control\n    RST --> data_storage\n    RST --> transmission_control\n    RST --> output_logic\n    \n    BCLK --> ws_detection\n    BCLK --> sample_control\n    BCLK --> transmission_control\n    BCLK --> output_logic\n    \n    WS --> ws_detection\n    WS --> transmission_control\n    \n    LEFT_IN --> sample_control\n    RIGHT_IN --> sample_control\n    TX_RDY --> sample_control\n    \n    %% WS Detection Flow\n    WS --> WS_PREV\n    WS_PREV --> WS_EDGE\n    WS_EDGE --> FALL_DETECT\n    FALL_DETECT --> REQ_GEN\n    \n    %% Sample Control Flow\n    REQ_GEN --> DATA_CAPTURE\n    DATA_CAPTURE --> LEFT_REG\n    DATA_CAPTURE --> RIGHT_REG\n    \n    %% Data Storage to Transmission\n    LEFT_REG --> CHANNEL_SELECT\n    RIGHT_REG --> CHANNEL_SELECT\n    CHANNEL_SELECT --> CURRENT_DATA\n    \n    %% Transmission Control Flow\n    WS --> BCLK_COUNT\n    BCLK_COUNT --> BIT_SELECT\n    CURRENT_DATA --> BIT_SELECT\n    BIT_SELECT --> SDATA_MUX\n    \n    %% Output Logic Flow\n    BCLK_COUNT --> SETUP_TIME\n    BCLK_COUNT --> DATA_PERIOD\n    BCLK_COUNT --> IDLE_PERIOD\n    SETUP_TIME --> SDATA_MUX\n    DATA_PERIOD --> SDATA_MUX\n    IDLE_PERIOD --> SDATA_MUX\n    \n    %% Final Outputs\n    SDATA_MUX --> SDATA_OUT\n    REQ_GEN --> SAMPLE_REQ\n    \n    %% Detailed data flow annotations\n    FALL_DETECT -.->|\"WS falling edge<br/>Start new frame\"| REQ_GEN\n    REQ_GEN -.->|\"request_sample='1'<br/>One clock pulse\"| DATA_CAPTURE\n    DATA_CAPTURE -.->|\"If tx_ready='1'<br/>Load new samples\"| LEFT_REG\n    DATA_CAPTURE -.->|\"If tx_ready='1'<br/>Load new samples\"| RIGHT_REG\n    \n    WS_EDGE -.->|\"Any WS change<br/>Reset bclk_count=0\"| BCLK_COUNT\n    CHANNEL_SELECT -.->|\"WS=0: Left channel<br/>WS=1: Right channel\"| CURRENT_DATA\n    \n    BIT_SELECT -.->|\"bclk_count 1-16:<br/>tx_data(16-bclk_count)\"| DATA_PERIOD\n    SETUP_TIME -.->|\"bclk_count=0:<br/>Output '0'\"| SDATA_MUX\n    IDLE_PERIOD -.->|\"bclk_count>16:<br/>Output '0'\"| SDATA_MUX\n\n    %% Timing annotations\n    BCLK -.->|\"Falling edge<br/>triggered\"| transmission_control\n    WS_PREV -.->|\"Edge detection<br/>ws_prev ≠ i2s_ws\"| WS_EDGE\n\n    %% Styling\n    classDef inputStyle fill:#e1f5fe,stroke:#01579b,stroke-width:2px,color:#000\n    classDef outputStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px,color:#000\n    classDef wsStyle fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#000\n    classDef controlStyle fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px,color:#000\n    classDef storageStyle fill:#ffebee,stroke:#c62828,stroke-width:2px,color:#000\n    classDef transmitStyle fill:#e3f2fd,stroke:#0d47a1,stroke-width:2px,color:#000\n    classDef outputLogicStyle fill:#fce4ec,stroke:#880e4f,stroke-width:2px,color:#000\n\n    class BCLK,WS,RST,LEFT_IN,RIGHT_IN,TX_RDY inputStyle\n    class SDATA_OUT,SAMPLE_REQ outputStyle\n    class WS_PREV,WS_EDGE,FALL_DETECT wsStyle\n    class REQ_GEN,DATA_CAPTURE controlStyle\n    class LEFT_REG,RIGHT_REG,CURRENT_DATA storageStyle\n    class BCLK_COUNT,CHANNEL_SELECT,BIT_SELECT transmitStyle\n    class SETUP_TIME,DATA_PERIOD,IDLE_PERIOD,SDATA_MUX outputLogicStyle",
  "content_size": 5531,
  "collected_at": "2026-02-06T01:41:39.562738",
  "compilation_status": "failed",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0,
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}