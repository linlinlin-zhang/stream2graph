{
  "id": "gh_flowchart_00118",
  "source": "github",
  "source_url": "https://github.com/masterzoidberg/sessionscribe/blob/1b65ce3a9e9836f2682b78777bbee5f9f3b55254/docs/security/dataflow.mmd",
  "github_repo": "masterzoidberg/sessionscribe",
  "github_file_path": "docs/security/dataflow.mmd",
  "diagram_type": "flowchart",
  "code": "```mermaid\nflowchart TD\n    %% SessionScribe PHI Data Flow - Actual Implementation\n    \n    %% Audio Capture Layer\n    MIC[üé§ Microphone<br/>Raw Audio]\n    SYS[üîä System Audio<br/>Loopback]\n    WASAPI[WASAPI Capture<br/>native/win/AudioCapture/]\n    \n    %% Audio Processing\n    DUAL[DualRecorder<br/>L=Mic, R=System<br/>48kHz/16-bit]\n    WAV[Stereo WAV File<br/>%UserProfile%\\Documents\\SessionScribe\\Recordings\\]\n    \n    %% ASR Pipeline\n    ASR[ASR Service :7035<br/>services/asr/app.py]\n    TRANSCRIPT[Raw Transcript<br/>‚ö†Ô∏è CONTAINS PHI]\n    \n    %% Redaction Pipeline\n    RED[Redaction Service :7032<br/>services/redaction/app.py]\n    PHI_DETECT[PHI Detector<br/>spaCy + Regex]\n    REDACTED[Redacted Text<br/>‚úÖ PHI REMOVED]\n    \n    %% Processing Services\n    INSIGHTS[Insights Bridge :7033<br/>OFFLINE MODE]\n    NOTES[Note Builder :7034<br/>OFFLINE MODE]\n    \n    %% Security & Logging\n    CRED[Windows Credential Manager<br/>keytar/keyring]\n    LOGS[Structured Logs<br/>‚úÖ METADATA ONLY]\n    METRICS[Prometheus Metrics<br/>‚úÖ NO PHI CONTENT]\n    \n    %% External (Currently Offline)\n    OPENAI[OpenAI API<br/>‚ùå DISABLED]\n    \n    %% Data Flow\n    MIC --> WASAPI\n    SYS --> WASAPI\n    WASAPI --> DUAL\n    DUAL --> WAV\n    DUAL --> ASR\n    \n    ASR --> TRANSCRIPT\n    TRANSCRIPT --> RED\n    RED --> PHI_DETECT\n    PHI_DETECT --> REDACTED\n    \n    REDACTED --> INSIGHTS\n    REDACTED --> NOTES\n    \n    %% Security Controls\n    ASR --> LOGS\n    RED --> LOGS\n    INSIGHTS --> LOGS\n    NOTES --> LOGS\n    \n    ASR --> METRICS\n    RED --> METRICS\n    INSIGHTS --> METRICS  \n    NOTES --> METRICS\n    \n    ASR -.-> CRED\n    RED -.-> CRED\n    INSIGHTS -.-> CRED\n    NOTES -.-> CRED\n    \n    %% External Disabled\n    INSIGHTS -.->|OFFLINE| OPENAI\n    \n    %% PHI Protection Boundaries\n    subgraph PHI_ZONE [‚ö†Ô∏è PHI ZONE - PROTECTED]\n        TRANSCRIPT\n        WAV\n    end\n    \n    subgraph SAFE_ZONE [‚úÖ SAFE ZONE - NO PHI]\n        REDACTED\n        LOGS\n        METRICS\n        CRED\n    end\n    \n    subgraph OFFLINE_ZONE [üîí OFFLINE - NO EGRESS]\n        INSIGHTS\n        NOTES\n        OPENAI\n    end\n    \n    %% Critical Security Controls\n    classDef phiData fill:#ffcccc,stroke:#ff0000,stroke-width:3px\n    classDef safeData fill:#ccffcc,stroke:#00ff00,stroke-width:2px\n    classDef offlineData fill:#ccccff,stroke:#0000ff,stroke-width:2px\n    classDef securityControl fill:#ffff99,stroke:#ffaa00,stroke-width:2px\n    \n    class TRANSCRIPT,WAV phiData\n    class REDACTED,LOGS,METRICS safeData\n    class INSIGHTS,NOTES,OPENAI offlineData\n    class CRED,PHI_DETECT securityControl\n```\n\n## Security Implementation Notes\n\n### ‚úÖ IMPLEMENTED PROTECTIONS\n\n1. **PHI Containment**\n   - Raw transcripts isolated to ASR service memory\n   - WAV files stored locally only (`%UserProfile%\\Documents\\SessionScribe\\Recordings\\`)\n   - Redaction pipeline mandatory before downstream processing\n\n2. **Logging Safety** (`services/shared/logging_config.py:80-93`)\n   ```python\n   unsafe_keywords = ['transcript', 'text', 'content', 'audio_data', 'speech',\n                      'utterance', 'phrase', 'word', 'sentence']\n   # Fields containing these keywords are automatically filtered\n   ```\n\n3. **Offline Mode Enforcement**\n   - All services default to `offline_mode: true`\n   - OpenAI API integration disabled by default\n   - No automatic egress of PHI data\n\n4. **Credential Security**\n   - Windows Credential Manager integration via keytar/keyring\n   - JWT signing keys stored securely\n   - No hardcoded secrets in source code\n\n### ‚ö†Ô∏è IMPLEMENTATION GAPS\n\n1. **WebSocket Authentication Not Active**\n   - JWT framework present but not enforced on WS connections\n   - Bearer token validation missing in ASR service\n\n2. **Redaction Pipeline Untested**\n   - PHI detection patterns defined but end-to-end flow unvalidated\n   - No confirmation that all PHI is successfully removed\n\n3. **Data Retention Policy Undefined**\n   - WAV files accumulate indefinitely in Documents folder\n   - No automatic cleanup of recorded audio files\n\n### üîí CRITICAL CONTROLS REQUIRED\n\n1. **Mandatory Redaction Gate**\n   - Block any downstream processing until PHI removed\n   - Validate redaction completeness before insights generation\n\n2. **Access Auditing**\n   - Log all access to PHI-containing data (metadata only)\n   - Track redaction effectiveness and coverage\n\n3. **Data Lifecycle Management**\n   - Auto-purge WAV files after processing\n   - Secure deletion of temporary transcript data",
  "content_size": 4444,
  "collected_at": "2026-02-06T01:42:03.275106",
  "compilation_status": "failed",
  "compilation_error": "[WinError 2] Á≥ªÁªüÊâæ‰∏çÂà∞ÊåáÂÆöÁöÑÊñá‰ª∂„ÄÇ",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0,
  "repo_owner": "masterzoidberg",
  "repo_name": "sessionscribe",
  "repo_description": "Help with therapy notes",
  "repo_language": "Python",
  "repo_topics": [],
  "repo_created_at": "2025-09-06T04:56:54Z",
  "repo_updated_at": "2025-09-23T03:33:48Z"
}