{
  "id": "gh_sequence_00672",
  "source": "github",
  "source_url": "https://github.com/Youknow2509/cio_verify_face/blob/64dd1b1eb75e62b25244067fb046f81672585bbe/doc/sequence_diagrams/identity_org/create_employee.mmd",
  "github_repo": "Youknow2509/cio_verify_face",
  "github_file_path": "doc/sequence_diagrams/identity_org/create_employee.mmd",
  "diagram_type": "sequence",
  "code": "sequenceDiagram\n    participant Admin as Company Admin\n    participant LB as Load Balancer\n    participant Gateway as API Gateway\n    participant Auth as Auth Service\n    participant Identity as Identity Service\n    participant Cache as Redis Cache\n    participant DB as PostgreSQL\n    participant Queue as Message Queue\n    participant Notification as Notification Service\n\n    Admin->>+LB: POST /api/v1/users\n    Note over Admin,LB: {name, email, employee_id, department, position, phone}\n    \n    LB->>+Gateway: Forward request\n    Gateway->>+Auth: Validate admin token\n    Auth->>Auth: Extract company_id from token\n    Auth-->>-Gateway: Admin authorized for company\n    \n    Gateway->>+Identity: POST /api/v1/users\n    Note over Gateway,Identity: Include company_id in request context\n    \n    Identity->>Identity: Validate employee data\n    Note over Identity: Email format, employee_id uniqueness within company\n    \n    Identity->>+DB: Check email & employee_id uniqueness\n    Note over Identity,DB: Scoped to company for employee_id uniqueness\n    DB-->>-Identity: Uniqueness validation result\n    \n    alt Email or employee_id already exists\n        Identity-->>Gateway: 409 Conflict - Duplicate email/employee_id\n    else Data is unique\n        Identity->>+DB: BEGIN TRANSACTION\n        DB-->>-Identity: Transaction started\n        \n        par Create user record\n            Identity->>+DB: INSERT INTO users\n            Note over Identity,DB: Generate user_id, link to company\n            DB-->>-Identity: User created\n        and Create employee profile\n            Identity->>+DB: INSERT INTO employee_profiles\n            Note over Identity,DB: Department, position, hire date\n            DB-->>-Identity: Profile created\n        and Initialize permissions\n            Identity->>+DB: INSERT INTO user_permissions\n            Note over Identity,DB: Default employee permissions\n            DB-->>-Identity: Permissions set\n        end\n        \n        Identity->>+DB: COMMIT TRANSACTION\n        DB-->>-Identity: Transaction committed\n        \n        par Cache new employee data\n            Identity->>+Cache: Set user_profile:{user_id}\n            Note over Identity,Cache: TTL: 1 hour\n            Cache-->>-Identity: Profile cached\n        and Clear company user lists\n            Identity->>+Cache: DELETE company_users:{company_id}:*\n            Note over Identity,Cache: Invalidate cached user listings\n            Cache-->>-Identity: Cache cleared\n        and Queue onboarding workflow\n            Identity->>+Queue: Publish EmployeeCreated event\n            Note over Identity,Queue: Trigger onboarding process\n            Queue-->>-Identity: Event published\n        and Send welcome notification\n            Identity->>+Notification: Send welcome email\n            Note over Identity,Notification: Include setup instructions\n            Notification-->>-Identity: Email queued\n        end\n        \n        Identity-->>-Gateway: 201 Created - Employee added successfully\n    end\n    \n    Gateway-->>-LB: Response\n    LB-->>-Admin: Employee creation result\n    \n    Note over Admin,DB: Employee management optimizations:\n    Note over Admin,DB: 1. Bulk employee import capabilities\n    Note over Admin,DB: 2. Active Directory/LDAP integration\n    Note over Admin,DB: 3. Automated onboarding workflows\n    Note over Admin,DB: 4. Employee lifecycle management\n    Note over Admin,DB: 5. Self-service employee registration",
  "content_size": 3441,
  "collected_at": "2026-02-06T01:35:29.454399",
  "compilation_status": "failed",
  "license": "mit",
  "license_name": "MIT License",
  "license_url": "https://api.github.com/licenses/mit",
  "repo_stars": 1,
  "repo_forks": 2,
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}