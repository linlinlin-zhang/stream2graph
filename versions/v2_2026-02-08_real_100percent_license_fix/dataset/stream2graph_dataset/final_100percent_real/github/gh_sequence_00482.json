{
  "id": "gh_sequence_00482",
  "source": "github",
  "source_url": "https://github.com/web3-authn/tatchi/blob/9ade49935f120a9d7c1b915e181969cdbd22d05d/examples/tatchi-docs/src/public/diagrams/contract-login-flow.mmd",
  "github_repo": "web3-authn/tatchi",
  "github_file_path": "examples/tatchi-docs/src/public/diagrams/contract-login-flow.mmd",
  "diagram_type": "sequence",
  "code": "sequenceDiagram\n    box Iframe Wallet\n    participant Wallet as Wallet\n    participant Worker as VRF Worker\n    end\n    participant Relay as Relay Server (Optional)\n\n    Note over Wallet,Worker: Phase 1: Load Encrypted VRF\n    Wallet->>Wallet: 1. Retrieve encrypted VRF from IndexedDB\n\n    Note over Wallet,Relay: Phase 2: VRF Unlock (Two Options)\n\n    alt Option A: Shamir 3-Pass Unlock (No TouchID)\n        Wallet->>Relay: 2a. Request Shamir 3-pass decrypt\n        Relay->>Wallet: Server KEK component\n        Wallet->>Worker: 3a. Decrypt VRF with combined KEK\n        Worker->>Worker: 4a. VRF keypair loaded into memory\n        Worker->>Wallet: 5a. VRF session active ✓\n        Note over Wallet: No biometric prompt required\n    else Option B: WebAuthn Unlock (TouchID Fallback)\n        Wallet->>Wallet: 2b. WebAuthn authentication (TouchID prompt)\n        Note over Wallet: PRF extension returns chacha20 output\n        Wallet->>Worker: 3b. Decrypt VRF with PRF output\n        Worker->>Worker: 4b. VRF keypair loaded into memory\n        Worker->>Wallet: 5b. VRF session active ✓\n        Note over Wallet,Relay: Optional: Refresh Shamir encryption\n        Wallet->>Relay: 6b. Store new server-encrypted VRF\n    end\n\n    Note over Wallet,Relay: Phase 3: Optional JWT Session\n    opt Mint JWT for web2 auth\n        Wallet->>Worker: 7. Generate fresh VRF challenge\n        Worker->>Wallet: VRF challenge + proof\n        Wallet->>Wallet: 8. WebAuthn authentication (TouchID prompt)\n        Wallet->>Relay: 9. Verify authentication + VRF proof\n        Relay->>Wallet: 10. JWT token\n    end\n\n    Note over Wallet,Worker: VRF unlocked - ready to generate WebAuthn challenges\n",
  "content_size": 1671,
  "collected_at": "2026-02-06T01:32:55.652862",
  "compilation_status": "failed",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 23,
  "repo_forks": 4,
  "repo_owner": "web3-authn",
  "repo_name": "tatchi",
  "repo_description": "A serverless TouchID based wallet. Not your passkey, not your coins.",
  "repo_language": "TypeScript",
  "repo_topics": [],
  "repo_created_at": "2025-06-29T16:51:24Z",
  "repo_updated_at": "2026-02-04T18:45:53Z",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}