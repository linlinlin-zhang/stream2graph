{
  "id": "gh_class_01084",
  "source": "github",
  "source_url": "https://github.com/RogerPugaRuiz/guiders-backend/blob/e3db33e508e4f149444a9d05f1376035a8fe616c/realTimeContextClassDiagram.mmd",
  "github_repo": "RogerPugaRuiz/guiders-backend",
  "github_file_path": "realTimeContextClassDiagram.mmd",
  "diagram_type": "class",
  "code": "classDiagram\n    class RealTimeWebSocketGateway {\n        +handleConnection(client: Socket)\n        +handleDisconnect(client: Socket)\n        +handleVisitorSendMessage(client: AuthenticatedSocket, event: Event)\n        +handleCommercialSendMessage(client: AuthenticatedSocket, event: Event)\n        +handleGetCommercialChats(client: AuthenticatedSocket)\n    }\n\n    class ConnectionUser {\n        -userId: ConnectionUserId\n        -socketId: Optional<ConnectionSocketId>\n        -roles: ConnectionRole[]\n        +isSameUser(userId: ConnectionUserId): boolean\n        +isConnected(): boolean\n        +isDisconnected(): boolean\n        +hasRole(role: string | ConnectionRole): boolean\n        +connect(socketId: ConnectionSocketId): ConnectionUser\n        +disconnect(): ConnectionUser\n        +sendMessage(toUser: ConnectionUser, message: string, timestamp: Date): ConnectionUser\n        +toPrimitives(): ConnectionUserPrimitive\n    }\n\n    class ConnectionRepository {\n        <<interface>>\n        +save(user: ConnectionUser): Promise<void>\n        +remove(user: ConnectionUser): Promise<void>\n        +find(criteria: Criteria<ConnectionUser>): Promise<ConnectionUser[]>\n        +findOne(criteria: Criteria<ConnectionUser>): Promise<Result<ConnectionUser, ConnectionUserNotFound>>\n    }\n\n    class InMemoryConnectionService {\n        -userSocketsMap: Map<string, string>\n        -socketUserMap: Map<string, string>\n        -userRolesMap: Map<string, string[]>\n        +save(user: ConnectionUser): Promise<void>\n        +remove(user: ConnectionUser): Promise<void>\n        +find(criteria: Criteria<ConnectionUser>): Promise<ConnectionUser[]>\n        +findOne(criteria: Criteria<ConnectionUser>): Promise<Result<ConnectionUser, ConnectionUserNotFound>>\n    }\n\n    class WsChatMessageEmitterService {\n        +emit(from: ConnectionUser, to: ConnectionUser, message: string, timestamp: Date): Promise<Result<void, UserNotConnectedError>>\n    }\n\n    class ConnectionRole {\n        +create(value: string): ConnectionRole\n        +visitor(): ConnectionRole\n        +commercial(): ConnectionRole\n        +isVisitor: boolean\n        +isCommercial: boolean\n    }\n\n    class ConnectionSocketId {\n        +create(value: string): ConnectionSocketId\n    }\n\n    class ConnectionUserId {\n        +create(value: string): ConnectionUserId\n    }\n\n    class RealTimeMessageSendEvent {\n        +create(from: string, to: string, message: string, timestamp: Date, direction: string): RealTimeMessageSendEvent\n    }\n\n    class DisconnectedEvent {\n        +connectionId: string\n        +roles: string[]\n        +timestamp: Date\n    }\n\n    class ConnectedEvent {\n        +connectionId: string\n        +roles: string[]\n        +timestamp: Date\n    }\n\n    RealTimeWebSocketGateway --> ConnectionRepository\n    RealTimeWebSocketGateway --> WsChatMessageEmitterService\n    ConnectionUser --> ConnectedEvent\n    ConnectionUser --> DisconnectedEvent\n    ConnectionUser --> RealTimeMessageSendEvent\n    ConnectionUser --> ConnectionRole\n    ConnectionUser --> ConnectionSocketId\n    ConnectionUser --> ConnectionUserId\n    InMemoryConnectionService ..|> ConnectionRepository\n    WsChatMessageEmitterService ..|> IChatMessageEmitter",
  "content_size": 3197,
  "collected_at": "2026-02-06T01:52:42.488605",
  "compilation_status": "failed",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0
}