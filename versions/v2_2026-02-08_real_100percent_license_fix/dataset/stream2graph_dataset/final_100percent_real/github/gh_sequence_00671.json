{
  "id": "gh_sequence_00671",
  "source": "github",
  "source_url": "https://github.com/vhvplatform/go-framework/blob/e8e89354796cca5451aaa145b32a004d57e4346a/docs/diagrams/data-flow.mmd",
  "github_repo": "vhvplatform/go-framework",
  "github_file_path": "docs/diagrams/data-flow.mmd",
  "diagram_type": "sequence",
  "code": "%% Request Flow - User Login Example\n%% Converted from PlantUML to Mermaid\n\nsequenceDiagram\n    participant Client\n    participant Gateway as API Gateway<br/>:8080\n    participant Auth as Auth Service<br/>:8081\n    participant MongoDB\n    participant Redis\n    participant RabbitMQ\n    participant Notification as Notification<br/>Service\n    \n    %% Authentication Request\n    rect rgb(240, 248, 255)\n        Note over Client,Gateway: Authentication Request\n        Client->>Gateway: POST /api/auth/login<br/>{<br/>  \"email\": \"user@example.com\",<br/>  \"password\": \"password123\"<br/>}\n        activate Gateway\n        Gateway->>Gateway: Validate request format\n        Gateway->>Gateway: Extract credentials\n        \n        Gateway->>Auth: LoginRequest (gRPC)<br/>{<br/>  email: \"user@example.com\"<br/>  password: \"password123\"<br/>}\n        activate Auth\n    end\n    \n    %% Database Query\n    rect rgb(245, 255, 250)\n        Note over Auth,MongoDB: Database Query\n        Auth->>MongoDB: Find user by email\n        activate MongoDB\n        Note right of MongoDB: db.users.findOne({<br/>  email: \"user@example.com\"<br/>})<br/><br/>Uses index: email_unique_idx<br/>Query time: ~5ms\n        \n        MongoDB-->>Auth: User document\n        deactivate MongoDB\n        \n        Note left of Auth: User {<br/>  id: \"user-123\"<br/>  email: \"user@example.com\"<br/>  password_hash: \"$2a$10$...\"<br/>  tenant_id: \"tenant-456\"<br/>  roles: [\"user\", \"editor\"]<br/>}\n    end\n    \n    %% Password Verification\n    rect rgb(255, 250, 240)\n        Note over Auth: Password Verification\n        Auth->>Auth: Verify password with bcrypt\n        Note right of Auth: bcrypt.Compare(<br/>  hashedPassword,<br/>  providedPassword<br/>)<br/><br/>Time: ~100ms (intentionally slow)\n    end\n    \n    alt Password Valid\n        %% Session Creation\n        rect rgb(240, 248, 255)\n            Note over Auth,Redis: Session Creation\n            Auth->>Auth: Generate JWT token\n            Note right of Auth: Token payload:<br/>{<br/>  user_id: \"user-123\"<br/>  tenant_id: \"tenant-456\"<br/>  roles: [\"user\", \"editor\"]<br/>  exp: 1640000000<br/>}<br/><br/>Signed with: JWT_SECRET\n            \n            Auth->>Redis: Store session\n            activate Redis\n            Note right of Redis: Key: session:user-123:abc123<br/>Value: {<br/>  user_id: \"user-123\"<br/>  tenant_id: \"tenant-456\"<br/>  login_time: \"2024-01-15T10:30:00Z\"<br/>  ip: \"192.168.1.100\"<br/>}<br/>TTL: 24 hours\n            Redis-->>Auth: OK\n            deactivate Redis\n        end\n        \n        %% Audit Logging\n        rect rgb(245, 255, 250)\n            Note over Auth,Notification: Audit Logging\n            Auth->>RabbitMQ: Publish login event\n            activate RabbitMQ\n            Note right of RabbitMQ: Exchange: events<br/>Routing key: auth.login<br/><br/>Message:<br/>{<br/>  event: \"user.login\"<br/>  user_id: \"user-123\"<br/>  tenant_id: \"tenant-456\"<br/>  timestamp: \"2024-01-15T10:30:00Z\"<br/>  ip: \"192.168.1.100\"<br/>}\n            \n            RabbitMQ->>Notification: Consume event\n            activate Notification\n            Notification->>Notification: Check security alerts\n            Notification->>Notification: Log to audit trail\n            deactivate Notification\n            deactivate RabbitMQ\n        end\n        \n        %% Success Response\n        rect rgb(240, 248, 255)\n            Note over Auth,Client: Success Response\n            Auth-->>Gateway: LoginResponse\n            Note left of Auth: {<br/>  success: true<br/>  token: \"eyJhbGc...\"<br/>  user: {<br/>    id: \"user-123\"<br/>    email: \"user@example.com\"<br/>    name: \"User Name\"<br/>  }<br/>  expires_at: \"2024-01-16T10:30:00Z\"<br/>}\n            deactivate Auth\n            \n            Gateway->>Gateway: Transform to HTTP response\n            Gateway-->>Client: HTTP 200 OK\n            Note left of Gateway: {<br/>  \"token\": \"eyJhbGc...\",<br/>  \"user\": {<br/>    \"id\": \"user-123\",<br/>    \"email\": \"user@example.com\",<br/>    \"name\": \"User Name\"<br/>  },<br/>  \"expires_at\": \"2024-01-16T10:30:00Z\"<br/>}\n        end\n    else Password Invalid\n        Auth-->>Gateway: LoginError\n        Note left of Auth: {<br/>  success: false<br/>  error: \"Invalid credentials\"<br/>}\n        deactivate Auth\n        \n        Gateway-->>Client: HTTP 401 Unauthorized\n        Note left of Gateway: {<br/>  \"error\": \"Invalid credentials\",<br/>  \"message\": \"Email or password is incorrect\"<br/>}\n    end\n    \n    deactivate Gateway\n    \n    %% Subsequent Authenticated Request\n    rect rgb(255, 250, 240)\n        Note over Client,Gateway: Subsequent Authenticated Request\n        Client->>Gateway: GET /api/users/profile\n        Note right of Client: Headers:<br/>Authorization: Bearer eyJhbGc...\n        \n        activate Gateway\n        Gateway->>Gateway: Extract JWT from header\n        Gateway->>Gateway: Verify JWT signature\n        Gateway->>Gateway: Check expiration\n        Gateway->>Gateway: Extract user_id from claims\n        \n        Gateway->>Redis: Check token blacklist\n        activate Redis\n        Redis-->>Gateway: Not blacklisted\n        deactivate Redis\n        \n        Gateway->>Gateway: Add user context to request\n        \n        Gateway->>Auth: Forward request with context\n        Auth-->>Gateway: User profile data\n        Gateway-->>Client: HTTP 200 OK\n        \n        deactivate Gateway\n    end\n",
  "content_size": 5356,
  "collected_at": "2026-02-06T01:35:28.765790",
  "compilation_status": "failed",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0
}