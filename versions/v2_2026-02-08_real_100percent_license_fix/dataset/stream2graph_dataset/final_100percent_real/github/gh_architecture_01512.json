{
  "id": "gh_architecture_01512",
  "source": "github",
  "source_url": "https://github.com/shaed-rp/cloudnotes/blob/30340bef4e1698dc05598f8e4a75c72f3f740893/docs/updated_architecture_diagrams.mmd",
  "github_repo": "shaed-rp/cloudnotes",
  "github_file_path": "docs/updated_architecture_diagrams.mmd",
  "diagram_type": "architecture",
  "code": "graph TD\n    %% -- STYLES --\n    classDef source fill:#f9f9f9,stroke:#333,stroke-width:2px,color:#333;\n    classDef storage fill:#34A853,stroke:#fff,stroke-width:2px,color:#fff;\n    classDef dataform fill:#4285F4,stroke:#fff,stroke-width:2px,color:#fff;\n    classDef bq_bronze fill:#cd7f32,stroke:#333,stroke-width:2px,color:#fff;\n    classDef bq_silver fill:#C0C0C0,stroke:#333,stroke-width:2px,color:#333;\n    classDef bq_gold fill:#FFD700,stroke:#333,stroke-width:2px,color:#333;\n    classDef git fill:#F4511E,stroke:#fff,stroke-width:2px,color:#fff;\n    classDef optional fill:#E6E6FA,stroke:#666,stroke-width:2px,stroke-dasharray: 5 5,color:#333;\n    classDef ml fill:#AA00FF,stroke:#fff,stroke-width:2px,color:#fff;\n    \n    %% Note Styles\n    classDef noteBlock fill:#fff,stroke:#333,stroke-width:1px,stroke-dasharray: 5 5,color:#333;\n    classDef sqlNote fill:#FFF9C4,stroke:#FBC02D,stroke-width:1px,color:#333;\n    classDef mlNote fill:#F3E5F5,stroke:#AA00FF,stroke-width:1px,color:#333;\n    classDef stratNote fill:#D1C4E9,stroke:#4527A0,stroke-width:2px,color:#000; %% Updated for SQLX\n\n    %% -- 1. SOURCES --\n    subgraph \"1. Diverse Data Sources\"\n        S_Ford[(\"<b>Ford Data</b><br/>sample_ford.xlsx\")]:::source\n        S_Stell[(\"<b>Stellantis Data</b><br/>sample_stellantis.xlsx\")]:::source\n        S_Inv[(\"<b>Inventory</b><br/>sample_inventory.xlsx\")]:::source\n        S_Upfit[(\"<b>Upfitter Data</b><br/>Morgan/Knapheide\")]:::source\n        S_Log[(\"<b>Logistics</b><br/>Lightyear\")]:::source\n    end\n\n    %% -- 2. INGESTION --\n    subgraph \"2. Event-Driven Loader (Gen 2)\"\n        GCS(\"GCS Landing Bucket\"):::storage\n        Eventarc[\"Eventarc Trigger\"]:::storage\n        CFunc_Ingest[\"Cloud Function: Ingest Excel<br/>(Multisheet Parsing)\"]:::storage\n        CFunc_Load[\"Cloud Function: Load & Trigger<br/>(Smart Routing)\"]:::storage\n        \n        S_Ford & S_Stell & S_Inv & S_Upfit & S_Log --> GCS\n        GCS -->|Finalized Event| Eventarc -->|Triggers| CFunc_Ingest\n        CFunc_Ingest -->|JSONL| CFunc_Load\n    end\n\n    %% -- 3. DATA WAREHOUSE & DATAFORM --\n    subgraph \"3. BigQuery Warehouse & Dataform Pipeline\"\n        \n        %% BRONZE LAYER\n        Bronze[(\"<b>BRONZE LAYER</b><br/>landing table<br/>JSON Payload\")]:::bq_bronze\n        CFunc_Load -->|BigQuery Load Job| Bronze\n        CFunc_Load -.->|API Call: Tags| Dataform_API\n\n        %% DATAFORM CONTROL PLANE\n        subgraph \"Dataform Transformation Pipeline\"\n            Git[(\"<b>Git Repo</b><br/>Version Control\")]:::git\n            Dataform_API[\"Create Compilation Result\"]:::dataform\n            \n            %% SILVER LOGIC (Standard SQLX)\n            Silver_Ford_SQLX[(\"<b>silver_ford.sqlx</b>\")]:::dataform\n            Silver_Stell_SQLX[(\"<b>silver_stellantis.sqlx</b>\")]:::dataform\n            Silver_Inv_SQLX[(\"<b>silver_inventory.sqlx</b>\")]:::dataform\n            Silver_Other_SQLX[(\"<b>silver_*.sqlx</b><br/>(Upfit/Log/etc)\")]:::dataform\n            \n            %% GOLD LOGIC (DECLARATIVE)\n            Gold_SQLX[(\"<b>master_vehicle_360.sqlx</b><br/>View Layer\")]:::dataform\n            \n            Git -.-> Dataform_API\n            Dataform_API --> Silver_Ford_SQLX & Silver_Stell_SQLX & Silver_Inv_SQLX & Silver_Other_SQLX\n        end\n\n        %% SILVER TRANSITION\n        Bronze --> Silver_Ford_SQLX & Silver_Stell_SQLX & Silver_Inv_SQLX & Silver_Other_SQLX\n        \n        %% SILVER LAYER TABLES\n        Silver_Ford_Tab[(\"<b>Silver: Ford</b>\")]:::bq_silver\n        Silver_Stell_Tab[(\"<b>Silver: Stellantis</b>\")]:::bq_silver\n        Silver_Inv_Tab[(\"<b>Silver: Inventory</b>\")]:::bq_silver\n        Silver_Other_Tab[(\"<b>Silver: Upfit/Log</b>\")]:::bq_silver\n        \n        Silver_Ford_SQLX --> Silver_Ford_Tab\n        Silver_Stell_SQLX --> Silver_Stell_Tab\n        Silver_Inv_SQLX --> Silver_Inv_Tab\n        Silver_Other_SQLX --> Silver_Other_Tab\n        \n        %% GOLD TRANSITION\n        Silver_Ford_Tab & Silver_Stell_Tab & Silver_Inv_Tab & Silver_Other_Tab --> Gold_SQLX\n        \n        %% GOLD LAYER\n        Gold[(\"<b>GOLD LAYER</b><br/>master_vehicle_360\")]:::bq_gold\n        Stats[(\"<b>GOLD STATS</b><br/>dealer_summary_stats\")]:::bq_gold\n        Gold_SQLX --> Gold\n        Gold --> Stats\n    end\n\n    %% -- INTELLIGENCE LAYER (Planned) --\n    subgraph \"Intelligence Layer (BQML)\"\n        ML_Reg[\"<b>Model 1: Turnaround</b><br/>Linear Regression\"]:::ml\n        ML_TS[\"<b>Model 2: Forecasting</b><br/>Vertex AI TimesFM\"]:::ml\n        ML_Anom[\"<b>Model 3: Supply Chain</b><br/>ARIMA_PLUS Anomaly\"]:::ml\n        \n        %% Training Flows\n        Silver_Other_Tab -->|Train| ML_Reg\n        Silver_Ford_Tab -->|Train| ML_TS\n        Silver_Inv_Tab -->|Train| ML_Anom\n        \n        %% Prediction Flows\n        ML_Reg & ML_TS & ML_Anom -->|Predictions| Gold\n    end\n\n    %% -- 4. OUTPUT --\n    Gold --> Dash[\"Looker Dashboard\"]\n    Gold --> AI[\"AI Agent\"]\n\n    %% -- NOTES: STRATEGY --\n    noteStrat[\"<b>Strategy: Declarative SQLX</b><br/><i>Why:</i> Clear, version-controlled transformations.<br/>Each source has a dedicated parsing file.<br/><i>Pros:</i> Readable, modular, easy to debug.\"]:::stratNote\n    Silver_Ford_SQLX -.- noteStrat\n\n    %% -- NOTES: DATAFORM LOGIC --\n    noteSilverSQL[\"<b>.sqlx Logic: Bronze to Silver</b><br/>1. <b>Extraction:</b> <code>JSON_VALUE(raw_data, '$...')</code><br/>2. <b>Sanitization:</b> <code>SAFE_CAST</code>, Cleaning VINs.<br/>3. <b>Incremental:</b> <code>ingested_at >= MAX(ingested_at)</code>\"]:::sqlNote\n    Silver_Ford_SQLX -.- noteSilverSQL\n\n    noteGoldSQL[\"<b>.sqlx Logic: Silver to Gold</b><br/>1. <b>Union:</b> Collect unique VINs from all sources.<br/>2. <b>Left Join:</b> Enrich VINs with details.<br/>3. <b>Coalesce:</b> Prioritize Inventory (Real-Time) > OEM.\"]:::sqlNote\n    Gold_SQLX -.- noteGoldSQL\n\n    %% -- NOTES: INTELLIGENCE --\n    noteML1[\"<b>Use Case 1: Upfit Turnaround</b><br/><i>Model:</i> Linear Regression<br/><i>Input:</i> Body Type, Upfitter, Season.<br/><i>Output:</i> Predicted Completion Date for new arrivals.<br/><i>Goal:</i> Inform customers of delays early.\"]:::mlNote\n    ML_Reg -.- noteML1\n\n    noteML2[\"<b>Use Case 2: Financial Forecasting</b><br/><i>Model:</i> Vertex AI TimesFM (Foundation Model)<br/><i>Input:</i> Daily Inventory Value.<br/><i>Output:</i> 30-day Floor Plan Cost forecast.<br/><i>Goal:</i> Zero-shot forecasting of cash flow.\"]:::mlNote\n    ML_TS -.- noteML2\n\n    noteML3[\"<b>Use Case 3: Supply Chain Anomalies</b><br/><i>Model:</i> ARIMA_PLUS<br/><i>Input:</i> Shipping Duration (Pickup to Dropoff).<br/><i>Output:</i> Anomaly Score.<br/><i>Goal:</i> Trigger alerts for 'Stuck' shipments.\"]:::mlNote\n    ML_Anom -.- noteML3\n",
  "content_size": 6642,
  "collected_at": "2026-02-06T01:47:13.394072",
  "license": "none",
  "license_name": "No License",
  "compilation_status": "failed",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0
}