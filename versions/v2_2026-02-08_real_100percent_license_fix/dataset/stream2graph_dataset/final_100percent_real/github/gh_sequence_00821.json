{
  "id": "gh_sequence_00821",
  "source": "github",
  "source_url": "https://github.com/bernardogv/Containers_k8/blob/97afa8848d2607c3d1a0d91e32fb831de0fb1f6a/book/diagrams/pv-pvc-binding.mmd",
  "github_repo": "bernardogv/Containers_k8",
  "github_file_path": "book/diagrams/pv-pvc-binding.mmd",
  "diagram_type": "sequence",
  "code": "%% D7.2: PV/PVC Binding Process\n%% Priority: P0 | Complexity: Medium\n%% Chapter 7: Configuration and Storage\n\nsequenceDiagram\n    participant User as User/Operator\n    participant SC as StorageClass\n    participant Prov as Provisioner\n    participant PV as PersistentVolume\n    participant PVC as PersistentVolumeClaim\n    participant Controller as PV Controller\n    participant Pod as Pod\n\n    Note over User,Pod: Static Provisioning (Pre-created PV)\n\n    User->>PV: 1. Create PersistentVolume\n    Note right of PV: capacity: 100Gi<br/>accessModes: ReadWriteOnce<br/>hostPath/nfs/cloud storage\n\n    PV->>Controller: 2. Register PV\n    Note right of Controller: Status: Available\n\n    User->>PVC: 3. Create PVC\n    Note right of PVC: Request: 50Gi<br/>accessModes: ReadWriteOnce<br/>storageClassName: \"\"\n\n    PVC->>Controller: 4. Request binding\n    Controller->>Controller: 5. Find matching PV\n    Note right of Controller: Match criteria:<br/>• Size >= request<br/>• Access modes compatible<br/>• StorageClass match\n\n    Controller->>PV: 6. Bind PVC to PV\n    Controller->>PVC: 7. Update PVC status\n    Note right of PVC: Status: Bound<br/>volumeName: pv-001\n\n    User->>Pod: 8. Create Pod with PVC\n    Pod->>PVC: 9. Request volume\n    PVC->>PV: 10. Mount volume\n    PV-->>Pod: 11. Volume ready\n    Note right of Pod: Volume mounted at<br/>/data\n\n    Note over User,Pod: Dynamic Provisioning (Auto-created PV)\n\n    User->>SC: 12. Create StorageClass\n    Note right of SC: provisioner: kubernetes.io/aws-ebs<br/>parameters:<br/>  type: gp3<br/>  iops: 3000\n\n    User->>PVC: 13. Create PVC with StorageClass\n    Note right of PVC: storageClassName: fast-ssd<br/>resources: 100Gi\n\n    PVC->>Controller: 14. Request provisioning\n    Controller->>SC: 15. Get provisioner\n    SC->>Prov: 16. Trigger provisioning\n    Prov->>Prov: 17. Create storage backend\n    Note right of Prov: Create EBS volume<br/>in AWS\n\n    Prov->>PV: 18. Create PV object\n    Note right of PV: Auto-generated<br/>Matches PVC request\n\n    PV->>Controller: 19. Register PV\n    Controller->>PVC: 20. Auto-bind PVC to PV\n    Note right of PVC: Status: Bound\n\n    User->>Pod: 21. Create Pod\n    Pod->>PVC: 22. Mount PVC\n    PVC-->>Pod: 23. Volume ready\n\n    Note over User,Pod: Volume Lifecycle States\n\n    Note right of PV: PV States:<br/>• Available (unbound)<br/>• Bound (claimed)<br/>• Released (PVC deleted)<br/>• Failed (reclaim error)\n\n    Note right of PVC: PVC States:<br/>• Pending (no PV)<br/>• Bound (PV assigned)<br/>• Lost (PV missing)\n\n    Note over User,Pod: Reclaim Policies\n\n    User->>Pod: 24. Delete Pod\n    Pod->>PVC: Volume unmounted\n\n    User->>PVC: 25. Delete PVC\n    PVC->>PV: Release claim\n\n    alt Retain Policy\n        Note right of PV: Status: Released<br/>Data preserved<br/>Manual cleanup required\n    else Delete Policy\n        PV->>Prov: Delete storage\n        Prov-->>PV: Storage deleted\n        Note right of PV: PV deleted<br/>Data destroyed\n    else Recycle Policy (Deprecated)\n        PV->>PV: Scrub data (rm -rf)\n        Note right of PV: Status: Available<br/>Ready for new claim\n    end\n",
  "content_size": 3093,
  "collected_at": "2026-02-06T01:37:30.739406",
  "compilation_status": "failed",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0,
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}