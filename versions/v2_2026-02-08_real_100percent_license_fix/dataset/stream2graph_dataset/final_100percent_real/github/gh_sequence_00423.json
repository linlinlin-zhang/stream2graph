{
  "id": "gh_sequence_00423",
  "source": "github",
  "source_url": "https://github.com/AAUCyber/DistributedSecureChat/blob/3796e0194759847a3ba2e4dd1c7b86b5cb1214e0/docs/report/figures/sequence_diagrams.mmd",
  "github_repo": "AAUCyber/DistributedSecureChat",
  "github_file_path": "docs/report/figures/sequence_diagrams.mmd",
  "diagram_type": "sequence",
  "code": "Initial connection between peers\n```mermaid\nsequenceDiagram\nparticipant Alice \nparticipant DNS Resolver\nparticipant Bob \n\n\nNote over Alice , Bob : Both Alice and Bob run a client application that includes a server component.\n\nAlice ->>Alice : User initiates connection to \"bob.com\"\n%% Public fingerprint fetching\nAlice ->>+DNS Resolver: DoH TXT Lookup for \"bob.com\"\nDNS Resolver-->>-Alice : Return Bob's DNS Fingerprint & Algorithm\n%% --- Step 2: Alice checks her local 'known_peers' file ---\nAlice ->>Alice : Check Known Peers (\"bob.com\")\n\n%% SRV records\nAlice ->>+DNS Resolver: DoH SRV Lookup for \"bob.com\"\nDNS Resolver-->>-Alice : Return Bob's address (e.g., \"bob.com:8443\")\n\n%% Load cert and init mTLS handshake\nAlice ->>Alice : Load Alice's cert/key\nAlice ->>+Bob : TCP/TLS Dial (Sends Alice's Certificate)\nBob -->>-Alice : TLS Handshake (Sends Bob's Certificate)\n\n%% Validation on both sides\npar Alice Validates Bob\nAlice ->>Alice : Validate Peer Cert'\nNote right of Alice : 1. Hash Bob's cert, compare to Bob's fingerprint.<br/>2. Check cert expiration.<br/>3. Verify \"bob.com\" is in cert SAN.\nand Bob Validates Alice\nBob ->>Bob : Validate Client Cert\nNote left of Bob : 1. Check local known Peers for \"alice.com\".<br/>2. Fetch Alice's fingerprint from DNS.<br/>3. Compare Alice's cert hash to local & DNS fingerprint.\nend\n\n%% Session created\nNote over Alice , Bob : Both validations must succeed\nAlice ->>Bob : TLS Handshake Complete\nBob -->>Alice : TLS Handshake Complete\n\nBob ->>Bob : Creates peer session for Alice\nAlice ->>Alice : Creates peer session for Bob\n\nnote over Alice : Client notifies its UI\nnote over Bob : Client notifies its UI\n\n```\n\nInitial setup of Alice:\n```mermaid\nsequenceDiagram\nparticipant Alice as Alice\nparticipant ChatClient as Alice's Chat Client\nparticipant DNSProvider as Authoritative Nameserver\n\nAlice->>+ChatClient: 1. Run \"generate keys\" (for alice.com)\nChatClient->>ChatClient: Generate 'chat.pem' (Certificate with SAN: alice.com)\nChatClient->>ChatClient: Generate 'chat.key' (Private Key)\nChatClient->>ChatClient: Create hash (fingerprint) of 'chat.pem' (e.g., SHA256)\nChatClient-->>-Alice: Display Fingerprint\n\nAlice->>Alice: 2. Note Client IP (e.g., 99.88.77.66) and Port (e.g., 8443)\nAlice->>+DNSProvider: 3. Log in to manage domain 'alice.com'\n\nNote over Alice, DNSProvider: Alice adds DNS records for discovery:\n\nAlice->>DNSProvider: Create A Record\nNote right of Alice: Host: chat.alice.com<br/>Value: 99.88.77.66\nAlice->>DNSProvider: Create SRV Record\nNote right of Alice: Service: _chat._tcp.alice.com<br/>Target: chat.alice.com<br/>Port: 8443\nAlice->>DNSProvider: Create TXT Record\nNote right of Alice: Host: alice.com<br/>Value: \"algo=SHA... hash=abc123...\"\n\nDNSProvider-->>DNSProvider: 4. Propagate DNS record changes\nAlice->>+ChatClient: 5. Start server component\nChatClient->>ChatClient: Listen for connections on 0.0.0.0:8443\nNote over ChatClient, DNSProvider: Set up and discoverable by other users.\n\n```\n\nSending a message from Alice to Bob:\n```mermaid\nsequenceDiagram\nparticipant Alice\nparticipant Bob\n\nNote over Alice, Bob: Assumes a secure TLS connection and Peer Session<br/>are already established.\n\nAlice->>Alice: User inputs message \"Hello!\" for Bob\n%% Alice sending message\nactivate Alice\nAlice->>Alice: Call client send message (\"bob.com\", \"Hello!\")\nAlice->>Alice: A (peerlist?) manager handles send message (\"bob.com\", \"Hello!\")\nAlice->>Alice: Session sends message (\"Hello!\")\nnote right of Alice: Message \"Hello!\" is put into the session's outgoing channel.\ndeactivate Alice\n\n%% Network stuff\nAlice->>+Bob: Writes \"Hello!\" to TLS connection\n\n%% Bob recieving message\nactivate Bob\nnote left of Bob: Reads \"Hello!\" from the connection.\nBob->>Bob: Message is put into the session's ingoing channel\nBob->>Bob: Client recieves message from channel\ndeactivate Bob\n\nBob->>Bob: Bob's UI (TUI/CLI) displays the message.\n```",
  "content_size": 3886,
  "collected_at": "2026-02-06T01:32:07.120286",
  "compilation_status": "failed",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "license": "mit",
  "license_name": "MIT License",
  "license_url": "https://api.github.com/licenses/mit",
  "repo_stars": 0,
  "repo_forks": 0,
  "repo_owner": "AAUCyber",
  "repo_name": "DistributedSecureChat",
  "repo_description": "A decentralized peer-to-peer secure chat application.",
  "repo_language": "Go",
  "repo_topics": [],
  "repo_created_at": "2025-10-13T07:23:47Z",
  "repo_updated_at": "2026-02-02T19:54:58Z"
}