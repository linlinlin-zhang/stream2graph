{
  "id": "gh_sequence_00797",
  "source": "github",
  "source_url": "https://github.com/agreen757/DN_Tech_Docs/blob/3d183fde300678da96f78cd34daec0c9a096a150/applications/crm/diagrams/youtube-search-sequence.mmd",
  "github_repo": "agreen757/DN_Tech_Docs",
  "github_file_path": "applications/crm/diagrams/youtube-search-sequence.mmd",
  "diagram_type": "sequence",
  "code": "sequenceDiagram\n    participant User\n    participant YouTubeSearchModal\n    participant useYouTubeSearch\n    participant youtubeSearch\n    participant youtubeAuth\n    participant YouTubeAPI as YouTube Data API v3\n    \n    User->>YouTubeSearchModal: Opens search modal\n    YouTubeSearchModal->>useYouTubeSearch: Initialize hook\n    useYouTubeSearch->>useYouTubeSearch: Load cached state from sessionStorage\n    \n    User->>YouTubeSearchModal: Enters search query\n    User->>YouTubeSearchModal: Selects sort order (relevance/viewCount/title)\n    User->>YouTubeSearchModal: Clicks search\n    \n    YouTubeSearchModal->>useYouTubeSearch: performSearch()\n    useYouTubeSearch->>youtubeAuth: getYouTubeAccessToken()\n    \n    alt Token is cached and valid\n        youtubeAuth-->>useYouTubeSearch: Return cached token\n    else Token expired or missing\n        youtubeAuth->>YouTubeAPI: Request new access token\n        YouTubeAPI-->>youtubeAuth: Return access token + expiry\n        youtubeAuth->>youtubeAuth: Cache token with expiry\n        youtubeAuth-->>useYouTubeSearch: Return new token\n    end\n    \n    useYouTubeSearch->>youtubeSearch: searchYouTubeChannels(params)\n    youtubeSearch->>YouTubeAPI: GET /youtube/v3/search<br/>?part=snippet&type=channel&q={query}&order={order}\n    \n    alt Success (200)\n        YouTubeAPI-->>youtubeSearch: Return search results with channel IDs\n        youtubeSearch->>YouTubeAPI: GET /youtube/v3/channels<br/>?part=snippet,statistics&id={channelIds}\n        YouTubeAPI-->>youtubeSearch: Return channel statistics\n        youtubeSearch->>youtubeSearch: Map and merge data\n        youtubeSearch->>youtubeSearch: Filter out Topic channels\n        youtubeSearch-->>useYouTubeSearch: Return YouTubeSearchResponse\n    else 401/403 (Auth error)\n        YouTubeAPI-->>youtubeSearch: Auth error\n        youtubeSearch->>youtubeAuth: clearCachedYouTubeToken()\n        youtubeSearch->>youtubeAuth: getYouTubeAccessToken()\n        youtubeSearch->>YouTubeAPI: Retry request with new token\n    else 429 (Rate limit)\n        YouTubeAPI-->>youtubeSearch: Rate limit error\n        youtubeSearch->>youtubeSearch: Exponential backoff retry (3 attempts)\n    else Other error\n        YouTubeAPI-->>youtubeSearch: Error response\n        youtubeSearch-->>useYouTubeSearch: Throw error with message\n    end\n    \n    useYouTubeSearch->>useYouTubeSearch: Cache results by query/sort/page\n    useYouTubeSearch->>useYouTubeSearch: Save state to sessionStorage\n    useYouTubeSearch-->>YouTubeSearchModal: Update searchResults state\n    \n    YouTubeSearchModal->>YouTubeSearchResults: Render results in DataGrid\n    YouTubeSearchResults-->>User: Display channel list\n    \n    User->>YouTubeSearchResults: Clicks on channel row\n    YouTubeSearchResults->>YouTubeSearchModal: onChannelSelect(channelId)\n    YouTubeSearchModal->>useYouTubeSearch: fetchChannelDetails(channelId)\n    \n    useYouTubeSearch->>youtubeSearch: getChannelDetailsById(channelId)\n    youtubeSearch->>YouTubeAPI: GET /youtube/v3/channels<br/>?part=snippet,contentDetails,statistics&id={channelId}\n    YouTubeAPI-->>youtubeSearch: Return full channel details\n    youtubeSearch->>youtubeSearch: Extract email from description (regex)\n    youtubeSearch-->>useYouTubeSearch: Return YouTubeChannelSearchDetails\n    \n    useYouTubeSearch-->>YouTubeSearchModal: Update selectedChannel state\n    YouTubeSearchModal->>YouTubeChannelDetail: Render channel details\n    YouTubeChannelDetail-->>User: Display full channel info\n    \n    User->>YouTubeChannelDetail: Clicks \"Add to [Category]\"\n    YouTubeChannelDetail->>YouTubeSearchModal: onAddToCategory(category)\n    YouTubeSearchModal->>ChannelConfirmationModal: Open with channel data\n    User->>ChannelConfirmationModal: Reviews and confirms\n    ChannelConfirmationModal->>YouTubeSearchModal: onConfirm(formValues)\n    YouTubeSearchModal->>Firestore: addOutreachItem()\n    Firestore-->>YouTubeSearchModal: Success\n    YouTubeSearchModal-->>User: Show success notification\n    YouTubeSearchModal->>YouTubeSearchModal: onChannelAdded() callback\n",
  "content_size": 4057,
  "collected_at": "2026-02-06T01:37:12.284611",
  "compilation_status": "failed",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0,
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}