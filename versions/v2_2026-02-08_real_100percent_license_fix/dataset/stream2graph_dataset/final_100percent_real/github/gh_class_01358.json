{
  "id": "gh_class_01358",
  "source": "github",
  "source_url": "https://github.com/thsic/Maniae/blob/7f89de815b2610678b57c735ca7a42f2f7a1b393/docs/PoC/02_%E3%83%89%E3%83%A1%E3%82%A4%E3%83%B3%E3%83%A2%E3%83%87%E3%83%AB%E5%9B%B3_PoC.mmd",
  "github_repo": "thsic/Maniae",
  "github_file_path": "docs/PoC/02_ドメインモデル図_PoC.mmd",
  "diagram_type": "class",
  "code": "classDiagram\ndirection LR\n%% コアドメインの関心は「特定のODペアの到着予定時刻と過去の到着実績を知れること」\n\tnamespace StopAggregate {\n\t\tclass Stop[\"Stop: 停留所\"] {\n      <<RootEntity>>\n\t\t\tStopId: 停留所ID\n\t\t\tStopName: 停留所名\n\t\t\tTimetable: 時刻表\n\t\t\tFeedInfoAggregate.FeedVersion: 提供データバージョン\n\t\t}\n\n\t\tclass TimeTable[\"TimeTable: 時刻表\"] {\n      <<ValueObject>>\n\t\t\tRouteAggregate.RouteId: 路線ID\n\t\t\tShared.ArrivalTime: 到着時刻\n\t\t\tShared.DepartureTime: 出発時刻\n\t\t}\n\n\t\tclass StopId[\"StopId: 停留所ID\"] {\n      <<ValueObject>>\n\t\t\tValue: String\n\t\t}\n\n\t\tclass StopName[\"StopName: 停留所名\"] {\n      <<ValueObject>>\n\t\t\tValue: String\n\t\t}\n\t}\n\n\tnote for Stop\"**【StopAggregate のビジネスルール】**\n  **Stop: 停留所**\n  ・特定の FeedVersion に関連付けられる。\n  ・FeedVersion 変更時を除き、StopName, Timetable は変更不可。\n  **StopId: 停留所ID**\n  ・システム内で一意。1文字以上20文字以内。\n  **StopName: 停留所名**\n  ・1文字以上40文字以内。\n  **TimeTable: 時刻表**\n  ・到着と出発は同時刻を許容。\n  ・始発/終着は片方の時刻のみ許容。\"\n\n\tnamespace RouteAggregate {\n\t\tclass Route[\"Route: 路線\"] {\n      <<RootEntity>>\n\t\t\tRouteId: 路線ID\n\t\t\tRouteName: 路線名\n\t\t\tOrderedStops: 停留所順序\n\t\t\tAgencyAggregate.AgencyId: 事業者ID\n\t\t\tFeedInfoAggregate.FeedVersion: 提供データバージョン\n\t\t}\n\n\t\tclass RouteName[\"RouteName: 路線名\"] {\n      <<ValueObject>>\n\t\t\tValue: String\n\t\t}\n\n\t\tclass RouteId[\"RouteId: 路線ID\"] {\n      <<ValueObject>>\n\t\t\tValue: String\n\t\t}\n\t}\n\n\tnote for Route\"**【RouteAggregate のビジネスルール】**\n  **Route: 路線**\n  ・特定の FeedVersion に関連付けられる。\n  ・FeedVersion 変更時を除き、RouteName, OrderedStops, AgencyId は変更不可。\n\t・OrderedStops は StopId のリスト。\n  ・OrderedStops は2つ以上の StopId を含み、StopId は重複不可。\n  **RouteId: 路線ID**\n  ・システム内で一意。1文字以上20文字以内。\n  **RouteName: 路線名**\n  ・1文字以上40文字以内。\"\n\n%% ---サブドメイン「Trip: 運行」ここから---\n\tnamespace TripAggregate {\n\t\tclass Trip[\"Trip: 運行情報\"] {\n      <<RootEntity>>\n\t\t\t%%運行全体を識別し、管理する役割に集中する\n\t\t\tTripId: 運行情報ID\n\t\t\tRouteAggregate.RouteId: 路線ID\n\t\t\tTripDirection: 運行方向\n\t\t\tTripStatus: 運行ステータス\n\t\t\tTripDate: 運行日\n\t\t\tFeedInfoAggregate.FeedVersion: 提供データバージョン\n\t\t}\n\n\t\tclass TripId[\"TripId: 運行情報ID\"] {\n      <<ValueObject>>\n\t\t\tValue: String\n\t\t}\n\n\t\tclass TripDirection[\"TripDirection: 運行方向\"]{\n\t\t\t<<Enumeration>>\n\t\t\tUP: 上り\n\t\t\tDOWN: 下り\n\t\t}\n\n\t\tclass TripDate[\"TripDate: 運行日\"] {\n      <<ValueObject>>\n\t\t\tValue: Date\n\t\t}\n\n\t\tclass TripStatus[\"TripStatus: 運行ステータス\"] {\n\t\t\t<<Enumeration>>\n\t\t\tPRE_SERVICE: サービス開始前\n\t\t\tPLANNED: 計画済み\n\t\t\tDEPARTED: 出発済み\n\t\t\tCOMPLETED: 運行完了済み\n\t\t\tCANCELED: キャンセル済み\n\t\t}\n\t}\n\n\tnote for Trip\"**【TripAggregate のビジネスルール】**\n  **Trip: 運行情報**\n  ・特定の FeedVersion に関連付けられる。\n  ・TripStatus が PRE_SERVICE の場合、FeedVersion 変更可。\n  ・上記 FeedVersion 変更時を除き、RouteId, TripDirection, TripDate は変更不可。\n  ・RouteId に関連付けられる。\n  **TripId: 運行情報ID**\n  ・システム内で一意。1文字以上20文字以内。\n  **TripStatus: 運行ステータス**\n  ・初期状態は PRE_SERVICE。\n  ・状態遷移:\n    PRE_SERVICE -> PLANNED (FeedVersion 有効期間内化)\n    PLANNED -> DEPARTED (運行開始/出発時)\n    PLANNED -> CANCELED (運行キャンセル時)\n    DEPARTED -> COMPLETED (運行完了時)\n    DEPARTED -> CANCELED (運行途中でキャンセル時)\n    COMPLETED, CANCELED からは遷移不可。\n  **TripDate: 運行日**\n  ・運行が行われる単一の日付。\"\n\n\tnamespace StopTimeAggregate {\n\t\tclass StopTime[\"StopTime: 通過時刻情報\"] {\n      <<RootEntity>>\n\t\t\t%%特定の運行における、ある一つのバス停への到着情報\n\t\t\tStopTimeId: 通過時刻情報ID\n\t\t\tTripAggregate.TripId: 運行情報ID\n\t\t\tScheduledTime: 予定時刻\n\t\t\tActualTime: 実績時刻\n\t\t\tStopSequence: 通過順位\n\t\t\tStopAggregate.StopId: 停留所ID\n\t\t\tStopTimeStatus: 通過ステータス\n\t\t\tFeedInfoAggregate.FeedVersion: 提供データバージョン\n\t\t}\n\n\t\tclass ScheduledTime[\"ScheduledTime: 予定時刻\"] {\n      <<ValueObject>>\n\t\t\tShared.ArrivalTime: 到着時刻\n\t\t\tShared.DepartureTime: 出発時刻\n\t\t}\n\n\t\tclass ActualTime[\"ActualTime: 実績時刻\"] {\n      <<ValueObject>>\n\t\t\tShared.ArrivalTime: 到着時刻\n\t\t\tShared.DepartureTime: 出発時刻\n\t\t}\n\n\t\tclass StopSequence[\"StopSequence: 通過順位\"] {\n      <<ValueObject>>\n\t\t\tValue: Number\n\t\t}\n\n\t\tclass StopTimeStatus[\"StopTimeStatus: 通過ステータス\"] {\n\t\t\t<<Enumeration>>\n\t\t\tPRE_SERVICE: サービス開始前\n\t\t\tPLANNED: 計画済み\n\t\t\tARRIVED: 到着済み\n\t\t\tDEPARTED: 出発済み\n\t\t\tSKIPPED: スキップ済み\n\t\t\tCANCELED: キャンセル済み\n\t\t}\n\n\t\tclass StopTimeId[\"StopTimeId: 通過時刻情報ID\"] { \n\t\t    <<ValueObject>>\n\t\t    Value: String\n\t\t}\n\t}\n\tnote for StopTime\"**【StopTimeAggregate のビジネスルール】**\n  **StopTime: 通過時刻情報**\n  ・特定の Trip に関連付けられる。\n  ・FeedVersion を持ち、通常 Trip の FeedVersion と同期。\n  ・特定の Stop に関連付けられる (StopId を持つ)。\n  ・ActualTime は Status が ARRIVED or DEPARTED の場合に記録。\n  ・Status は FeedVersion の有効期間や実績に応じて遷移。\n  **StopTimeId: 通過時刻情報ID**\n  ・システム内で一意。1文字以上20文字以内。\n  **ScheduledTime/ActualTime: 予定/実績時刻**\n  ・ArrivalTime と DepartureTime を含む。\n  ・DepartureTime は ArrivalTime と同時刻かそれ以降。\n  ・始発は DepartureTime のみ、終着は ArrivalTime のみ可。\n    それ以外は両方必須。\n  **StopSequence: 通過順位**\n  ・Trip内でユニークな通過順を示す値。\n  **StopTimeStatus: 通過ステータス**\n  ・初期状態: FeedVersion が有効期間前なら PRE_SERVICE、\n    有効期間内なら PLANNED。\n  ・状態遷移:\n    PRE_SERVICE -> PLANNED (FeedVersion 有効期間内化)\n    PLANNED -> ARRIVED (到着時)\n    PLANNED -> SKIPPED (スキップ時)\n    PLANNED -> CANCELED (キャンセル時)\n    ARRIVED -> DEPARTED (出発時)\n    DEPARTED, SKIPPED, CANCELED からは遷移不可。\"\n\n%% ---サブドメイン「Trip: 運行」ここまで---\n\n\tnamespace FeedInfoAggregate{\n\t\tclass FeedInfo[\"FeedInfo: 提供情報\"] {\n      <<RootEntity>>\n\t\t\tFeedVersion: 提供データバージョン\n\t\t\tFeedPublisherName: 提供組織名\n\t\t\tFeedStartDate: 有効期間開始日\n\t\t\tFeedEndDate: 有効期間終了日\n\t\t}\n\n\t\tclass FeedVersion[\"FeedVersion: 提供データバージョン\"] {\n      <<ValueObject>>\n\t\t\tValue: String\n\t\t}\n\n\t\tclass FeedPublisherName[\"FeedPublisherName: 提供組織名\"] {\n      <<ValueObject>>\n\t\t\tValue: String\n\t\t}\n\n\t\tclass FeedStartDate[\"FeedStartDate: 有効期間開始日\"] {\n      <<ValueObject>>\n\t\t\tValue: String\n\t\t}\n\n\t\tclass FeedEndDate[\"FeedEndDate: 有効期間終了日\"] {\n      <<ValueObject>>\n\t\t\tValue: String\n\t\t}\n\t}\n\n\tnote for FeedInfo\"**【FeedInfoAggregate のビジネスルール】**\n  **FeedInfo: 提供情報**\n  ・各 FeedVersion につき1レコード存在する。\n  ・FeedVersion はシステム全体で一意。\n  ・FeedEndDate は FeedStartDate と同時刻かそれ以降。\n  ・一度作成された FeedInfo の全属性は変更不可(不変)。\n  **FeedVersion: 提供データバージョン**\n  ・システム内で一意。1文字以上40文字以内。\n  **FeedPublisherName: 提供組織名**\n  ・1文字以上40文字以内。\n  **FeedStartDate / FeedEndDate: 有効期間開始日/終了日**\n  ・有効な日付形式であること。\"\n\n  namespace AgencyAggregate{\n    class Agency[\"Agency: 事業者\"] {\n      <<RootEntity>>\n      AgencyId: 事業者ID\n      AgencyName: 事業者名称\n    }\n\n    class AgencyId[\"AgencyId: 事業者ID\"] {\n      <<ValueObject>>\n      Value: String\n    }\n\n    class AgencyName[\"AgencyName: 事業者名称\"] {\n      <<ValueObject>>\n      Value: String\n    }\n  }\n\n  note for Agency\"**【AgencyAggregate のビジネスルール】**\n  **Agency: 事業者**\n  ・一意な AgencyId と AgencyName を持つ。\n  ・AgencyName は変更可能 (AgencyId は不変)。\n  **AgencyId: 事業者ID**\n  ・システム内で一意。1文字以上20文字以内。不変。\n  **AgencyName: 事業者名称**\n  ・1文字以上40文字以内。変更可能。\"\n\n  namespace Shared {\n    class ArrivalTime[\"ArrivalTime: 到着時刻\"] {\n      <<ValueObject>>\n      Value: Date\n    }\n\n    class DepartureTime[\"DepartureTime: 出発時刻\"] {\n      <<ValueObject>>\n      Value: Date\n    }\n  }\n\n%% ---関係性の表現---\n%% StopAggregate\n\tStop \"1\" -- \"1\" StopId\n\tStop \"1\" -- \"1\" StopName\n\tStop \"1\" -- \"*\" TimeTable\n\n%% RouteAggregate\n\tRoute \"1\" -- \"1\" RouteId\n\tRoute \"1\" -- \"1\" RouteName\n\n%% TripAggregate\n\tTrip \"1\" -- \"1\" TripId\n\tTrip \"1\" -- \"1\" TripDirection\n\tTrip \"1\" -- \"1\" TripDate\n  Trip \"1\" -- \"1\" TripStatus\n\n%% FeedInfoAggregate\n\tFeedInfo \"1\" -- \"1\" FeedVersion\n\tFeedInfo \"1\" -- \"1\" FeedPublisherName\n\tFeedInfo \"1\" -- \"1\" FeedStartDate\n\tFeedInfo \"1\" -- \"1\" FeedEndDate\n\n%% StopTimeAggregate\n\tStopTime \"1\" -- \"1\" StopTimeId\n\tStopTime \"1\" -- \"1\" ScheduledTime\n\tStopTime \"1\" -- \"1\" ActualTime\n\tStopTime \"1\" -- \"1\" StopSequence\n\tStopTime \"1\" -- \"1\" StopTimeStatus\n\n%% ---集約間の関連---\n  StopTime \"*\" ..> \"1\" Stop\n  Trip \"*\" ..> \"1\" Route\n  Route \"1\" ..> \"*\" Stop\n  Route \"1\" ..> \"1\" Agency\n  StopTime \"*\" ..> \"1\" Trip\n\n\n</rewritten_file> ",
  "content_size": 7294,
  "collected_at": "2026-02-06T01:56:43.385166",
  "compilation_status": "failed",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "license": "mit",
  "license_name": "MIT License",
  "license_url": "https://api.github.com/licenses/mit",
  "repo_stars": 0,
  "repo_forks": 0
}