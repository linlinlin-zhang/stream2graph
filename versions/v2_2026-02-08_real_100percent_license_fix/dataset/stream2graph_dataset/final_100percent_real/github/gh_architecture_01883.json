{
  "id": "gh_architecture_01883",
  "source": "github",
  "source_url": "https://github.com/eduardo-mdc/Autoscaling-Global-CDN/blob/55fd7cf7a55213d277825852cac352701e2904d2/docs/streaming.mmd",
  "github_repo": "eduardo-mdc/Autoscaling-Global-CDN",
  "github_file_path": "docs/streaming.mmd",
  "diagram_type": "architecture",
  "code": "---\nconfig:\n  layout: elk\n---\nflowchart TB\n    subgraph subGraph0[\"ğŸŒ Global Infrastructure\"]\n        Users[\"ğŸŒ Global Users<br>(Europe, Americas, APAC)\"]\n        GLB[\"ğŸ”„ Global HTTPS Load Balancer<br>IP: 34.110.245.13<br>SSL: Managed Certificate<br>Domain: adm-cdn.pt\"]\n        DNS[\"ğŸŒ Cloud DNS Zone<br>adm-cdn.pt<br>DNSSEC Enabled\"]\n        WAF[\"ğŸ›¡ï¸ Cloud Armor WAF<br>XSS Protection<br>Rate Limiting: 200/min<br>DDoS Protection\"]\n    end\n    subgraph subGraph1[\"ğŸ”§ Admin Infrastructure - 10.250.0.0/24\"]\n        AdminVM[\"ğŸ–¥ï¸ Admin VM<br>Public IP: X.X.X.X<br>Private IP: 10.250.0.10<br>Type: e2-standard-2<br>Services: gcloud, kubectl\"]\n        AdminLB[\"âš–ï¸ Admin Webapp LB<br>admin.adm-cdn.pt<br>Flask App + GCS Mount\"]\n        ContentMgr[\"ğŸ“¦ Content Manager<br>Master Bucket: EU<br>Sync Scripts\"]\n        ScaleFunc[\"ğŸ¤– Cold Scaler Cron<br>Triggers: Geographic Traffic<br>Latency Threshold<br>Scheduled Checks<br>Uses: gcloud CLI\"]\n    end\n    subgraph subGraph15[\"ğŸ¯ Multi-Cluster Ingress (MCI)\"]\n        MCI[\"ğŸ”— MultiClusterIngress<br>Global IP: 34.110.245.13<br>Config Cluster: europe-west2<br>SSL: uporto-cd-admin-webapp-ssl\"]\n        MCS[\"âš–ï¸ MultiClusterService<br>Backend Config<br>Health Check: /health<br>Session Affinity: None\"]\n        OAuth2[\"ğŸ” Identity-Aware Proxy<br>Google Authentication<br>All Endpoints Protected\"]\n    end\n    subgraph subGraph5[\"ğŸ“¹ Streaming Pods EU - Auto-scaling (2-5)\"]\n        PodEU1[\"ğŸ“¹ Streaming Pod 1<br>Deployment + IAP<br>nginx + GCS CSI<br>Ready\"]\n        PodEU2[\"ğŸ“¹ Streaming Pod 2<br>Deployment + IAP<br>nginx + GCS CSI<br>Ready\"]\n        PodEUN[\"ğŸ“¹ ... Pod N<br>Auto-scaled<br>Based on traffic\"]\n        SuricataEU[\"ğŸ›¡ï¸ Suricata IDS<br>DaemonSet Pod<br>Network monitoring\"]\n    end\n    subgraph subGraph4[\"ğŸ”¥ HOT GKE Cluster EU (Config Cluster)\"]\n        MasterEU[\"ğŸ›ï¸ Control Plane EU<br>172.16.1.0/28<br>Private Endpoint<br>Workload Identity<br>GKE Fleet: Registered\"]\n        NodePoolEU[\"âš™ï¸ Hot Node Pool<br>e2-standard-2<br>Min: 2, Max: 5<br>Always Running\"]\n        subGraph5\n        ServiceEU[\"âš–ï¸ K8s Service MCI<br>Type: ClusterIP<br>NEG Annotations<br>Backend Config\"]\n        NEGEU[\"ğŸ¯ Network Endpoint Group<br>Zone: europe-west2-a/b/c<br>Status: Healthy<br>MCI Managed\"]\n    end\n    subgraph subGraph3[\"VPC-EU - 10.1.0.0/20\"]\n        BastionEU[\"ğŸ”§ Bastion Host EU<br>10.1.x.x<br>Private Only<br>kubectl access\"]\n        subGraph4\n        StorageEU[\"ğŸ—„ï¸ Regional Storage<br>Bucket: EU Cache<br>GCS FUSE CSI Mount\"]\n    end\n    subgraph subGraph2[\"ğŸ”¥ HOT REGION: Europe West2 - ALWAYS ACTIVE\"]\n        subGraph3\n    end\n    subgraph subGraph9[\"ğŸ“¹ Streaming Pods US - Auto-scaling (2-5)\"]\n        PodUS1[\"ğŸ“¹ Streaming Pod 1<br>Deployment + IAP<br>nginx + GCS CSI<br>Ready\"]\n        PodUS2[\"ğŸ“¹ Streaming Pod 2<br>Deployment + IAP<br>nginx + GCS CSI<br>Ready\"]\n        PodUSN[\"ğŸ“¹ ... Pod N<br>Auto-scaled<br>Based on traffic\"]\n        SuricataUS[\"ğŸ›¡ï¸ Suricata IDS<br>DaemonSet Pod<br>Network monitoring\"]\n    end\n    subgraph subGraph8[\"ğŸ”¥ HOT GKE Cluster US (Member Cluster)\"]\n        MasterUS[\"ğŸ›ï¸ Control Plane US<br>172.16.2.0/28<br>Private Endpoint<br>Workload Identity<br>GKE Fleet: Registered\"]\n        NodePoolUS[\"âš™ï¸ Hot Node Pool<br>e2-standard-2<br>Min: 2, Max: 5<br>Always Running\"]\n        subGraph9\n        ServiceUS[\"âš–ï¸ K8s Service MCI<br>Type: ClusterIP<br>NEG Annotations<br>Backend Config\"]\n        NEGUS[\"ğŸ¯ Network Endpoint Group<br>Zone: us-south1-a/b/c<br>Status: Healthy<br>MCI Managed\"]\n    end\n    subgraph subGraph7[\"VPC-US - 10.2.0.0/20\"]\n        BastionUS[\"ğŸ”§ Bastion Host US<br>10.2.x.x<br>Private Only<br>kubectl access\"]\n        subGraph8\n        StorageUS[\"ğŸ—„ï¸ Regional Storage<br>Bucket: US Cache<br>GCS FUSE CSI Mount\"]\n    end\n    subgraph subGraph6[\"ğŸ”¥ HOT REGION: US South1 - ALWAYS ACTIVE\"]\n        subGraph7\n    end\n    subgraph subGraph13[\"ğŸ“¹ Streaming Pods ASIA - Traffic-based Scaling (0-3)\"]\n        PodASIA1[\"ğŸ’¤ Pod 1<br>Deployment + OAuth2<br>nginx + GCS CSI<br>âš ï¸ Not Ready<br>Scale: 0\"]\n    end\n    subgraph subGraph12[\"â„ï¸ COLD GKE Cluster ASIA (Member Cluster)\"]\n        MasterASIA[\"ğŸ›ï¸ Control Plane ASIA<br>172.16.3.0/28<br>Private Endpoint<br>Workload Identity<br>GKE Fleet: Registered\"]\n        NodePoolASIA[\"âš™ï¸ Cold Node Pool<br>e2-standard-2<br>Min: 0, Max: 3<br>ğŸ”½ SCALED DOWN\"]\n        subGraph13\n        ServiceASIA[\"âš–ï¸ K8s Service MCI<br>Type: ClusterIP<br>NEG Annotations<br>Backend Config<br>âš ï¸ No Endpoints\"]\n        NEGASIA[\"ğŸ¯ Network Endpoint Group<br>Zone: asia-southeast1-a/b/c<br>âŒ No Healthy Backends<br>MCI Managed\"]\n    end\n    subgraph subGraph11[\"VPC-ASIA - 10.3.0.0/20\"]\n        BastionASIA[\"ğŸ”§ Bastion Host ASIA<br>10.3.x.x<br>Private Only<br>kubectl access\"]\n        subGraph12\n        StorageASIA[\"ğŸ—„ï¸ Regional Storage<br>Bucket: ASIA Cache<br>GCS FUSE CSI Mount\"]\n    end\n    subgraph subGraph10[\"â„ï¸ COLD REGION: Asia Southeast1 - SCALE-TO-ZERO\"]\n        subGraph11\n    end\n    subgraph subGraph14[\"ğŸ“Š Storage & Content Distribution\"]\n        MasterBucket[\"ğŸ—„ï¸ Master Bucket<br>Location: EU Multi-region<br>Content Ingestion<br>Versioning: Off\"]\n        RegionalBucketsEU[\"ğŸ—„ï¸ EU Cache Bucket<br>europe-west2<br>Synced from Master\"]\n        RegionalBucketsUS[\"ğŸ—„ï¸ US Cache Bucket<br>us-south1<br>Synced from Master\"]\n        RegionalBucketsASIA[\"ğŸ—„ï¸ ASIA Cache Bucket<br>asia-southeast1<br>Synced from Master\"]\n    end\n    subgraph subGraph16[\"ğŸ” Authentication & Security\"]\n        GoogleAuth[\"ğŸ”‘ Google Authentication\"]\n        SuricataIDS[\"ğŸ›¡ï¸ Suricata IDS<br>DaemonSet on all nodes\"]\n    end\n    Users --> DNS\n    DNS --> GLB\n    GLB --> WAF\n    WAF --> MCI\n    MCI --> MCS\n    MCS --> OAuth2\n    OAuth2 --> NEGEU & NEGUS & NEGASIA\n    NEGEU --> ServiceEU\n    NEGUS --> ServiceUS\n    NEGASIA --> ServiceASIA\n    ServiceEU --> PodEU1 & PodEU2 & PodEUN\n    ServiceUS --> PodUS1 & PodUS2 & PodUSN\n    ServiceASIA -. No Healthy Endpoints .-> PodASIA1\n    GoogleAuth --> OAuth2\n    SuricataIDS -. Monitor Traffic .-> PodEU1 & PodEU2 & PodEUN & PodUS1 & PodUS2 & PodUSN & PodASIA1\n    SuricataEU -. Network Analysis .-> SuricataIDS\n    SuricataUS -. Network Analysis .-> SuricataIDS\n    AdminVM --> AdminLB\n    AdminVM -. VPC Peering<br>SSH Tunnel .-> BastionEU & BastionUS & BastionASIA\n    BastionEU -. kubectl<br>Authorized Networks .-> MasterEU\n    BastionUS -. kubectl<br>Authorized Networks .-> MasterUS\n    BastionASIA -. kubectl<br>Authorized Networks .-> MasterASIA\n    MasterEU -. Node Management .-> NodePoolEU\n    MasterUS -. Node Management .-> NodePoolUS\n    MasterASIA -. Node Management .-> NodePoolASIA\n    NodePoolEU -. Pod Scheduling .-> PodEU1 & PodEU2 & PodEUN\n    NodePoolUS -. Pod Scheduling .-> PodUS1 & PodUS2 & PodUSN\n    NodePoolASIA -. Cold Scaling .-> PodASIA1\n    ContentMgr --> MasterBucket\n    MasterBucket --> RegionalBucketsEU & RegionalBucketsUS & RegionalBucketsASIA\n    RegionalBucketsEU --> StorageEU\n    RegionalBucketsUS --> StorageUS\n    RegionalBucketsASIA --> StorageASIA\n    StorageEU --> PodEU1 & PodEU2 & PodEUN\n    StorageUS --> PodUS1 & PodUS2 & PodUSN\n    StorageASIA -. Mount Ready .-> PodASIA1\n    ScaleFunc -. Monitor Traffic<br>Geographic Analysis .-> GLB\n    ScaleFunc -. gcloud container clusters resize<br>Asia Traffic &gt; 10%<br> Asia Latency &gt; 500ms<br> Asia Requests 10 Min &gt; 50 .-> NodePoolASIA\nAdminVM -. Hosts Scaler .-> ScaleFunc\nAdminLB -- Calls --> ContentMgr\nUsers:::public\nGLB:::public\nDNS:::public\nWAF:::public\nAdminVM:::admin\nAdminLB:::admin\nContentMgr:::admin\nScaleFunc:::scaling\nMCI:::mci\nMCS:::mci\nOAuth2:::auth\nPodEU1:::hotStreaming\nPodEU2:::hotStreaming\nPodEUN:::hotStreaming\nSuricataEU:::security\nMasterEU:::private\nNodePoolEU:::hotInfra\nServiceEU:::mci\nNEGEU:::mci\nBastionEU:::private\nStorageEU:::storage\nPodUS1:::hotStreaming\nPodUS2:::hotStreaming\nPodUSN:::hotStreaming\nSuricataUS:::security\nMasterUS:::private\nNodePoolUS:::hotInfra\nServiceUS:::mci\nNEGUS:::mci\nBastionUS:::private\nStorageUS:::storage\nPodASIA1:::coldStreaming\nMasterASIA:::private\nNodePoolASIA:::coldInfra\nServiceASIA:::coldMci\nNEGASIA:::coldMci\nBastionASIA:::private\nStorageASIA:::storage\nMasterBucket:::storage\nRegionalBucketsEU:::storage\nRegionalBucketsUS:::storage\nRegionalBucketsASIA:::storage\nGoogleAuth:::auth\nSuricataIDS:::security\nclassDef public fill:#e1f5fe,stroke:#01579b,stroke-width:2px\nclassDef private fill:#f3e5f5,stroke:#4a148c,stroke-width:2px\nclassDef hotStreaming fill:#ffebee,stroke:#c62828,stroke-width:3px\nclassDef coldStreaming fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,stroke-dasharray: 5 5\nclassDef admin fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px\nclassDef hotInfra fill:#fff3e0,stroke:#f57c00,stroke-width:2px\nclassDef coldInfra fill:#fafafa,stroke:#616161,stroke-width:2px,stroke-dasharray: 3 3\nclassDef coldMci fill:#e8eaf6,stroke:#3f51b5,stroke-width:2px,stroke-dasharray: 3 3\nclassDef scaling fill:#f1f8e9,stroke:#689f38,stroke-width:2px\nclassDef storage fill:#fff8e1,stroke:#ff8f00,stroke-width:2px\nclassDef mci fill:#e8f5e8,stroke:#388e3c,stroke-width:3px\nclassDef auth fill:#fce4ec,stroke:#c2185b,stroke-width:2px\nclassDef security fill:#ffebee,stroke:#d32f2f,stroke-width:2px\n",
  "content_size": 9050,
  "collected_at": "2026-02-06T02:04:31.642669",
  "compilation_status": "failed",
  "compilation_error": "[WinError 2] ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶ã€‚",
  "license": "apache-2.0",
  "license_name": "Apache License 2.0",
  "license_url": "https://api.github.com/licenses/apache-2.0",
  "repo_stars": 0,
  "repo_forks": 0
}