{
  "id": "gh_flowchart_00483",
  "source": "github",
  "source_url": "https://github.com/jb-8200/dox-asdlc/blob/14d5c4a7a4d5de8b6cec311194fe1abbd94e5204/docker/hitl-ui/public/docs/diagrams/14-victoriametrics-monitoring.mmd",
  "github_repo": "jb-8200/dox-asdlc",
  "github_file_path": "docker/hitl-ui/public/docs/diagrams/14-victoriametrics-monitoring.mmd",
  "diagram_type": "flowchart",
  "code": "%% File: docs/diagrams/14-victoriametrics-monitoring.mmd\n%% Description: VictoriaMetrics monitoring stack architecture with Service Health Dashboard\n%% Updated: 2026-01-27\n\n%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#E6F0FF', 'primaryTextColor': '#1e3a5f', 'primaryBorderColor': '#2563eb', 'lineColor': '#64748b'}}}%%\n\nflowchart TB\n    subgraph UI[\"HITL-UI SPA\"]\n        MetricsPage[\"MetricsPage.tsx\\n• Time series charts\\n• Service selector\\n• Time range selector\"]\n        ServiceDashboard[\"ServiceHealthDashboard.tsx\\n• ServiceTopologyMap\\n• ServiceCards with sparklines\\n• Auto-refresh (30s)\"]\n    end\n\n    subgraph Monitoring[\"VictoriaMetrics Stack\"]\n        subgraph VMStatefulSet[\"StatefulSet: victoriametrics\"]\n            VM[\"VictoriaMetrics\\nPort: 8428\\n• TSDB storage\\n• PromQL API\\n• /api/v1/query_range\"]\n            VMPVC[(\"PVC: vm-data\\n10Gi\")]\n        end\n\n        subgraph VMAgent[\"DaemonSet: vmagent\"]\n            Agent1[\"vmagent\\n(node-1)\"]\n            Agent2[\"vmagent\\n(node-2)\"]\n            AgentN[\"vmagent\\n(node-N)\"]\n        end\n    end\n\n    subgraph Services[\"aSDLC Microservices\"]\n        subgraph OrchestratorSvc[\"Orchestrator Service\"]\n            OrcMetrics[\"/metrics :8080\\n• asdlc_http_requests_total\\n• asdlc_http_request_duration\\n• asdlc_redis_connection\"]\n        end\n\n        subgraph WorkersSvc[\"Workers Service\"]\n            WrkMetrics[\"/metrics :8081\\n• asdlc_active_workers\\n• asdlc_events_processed\\n• asdlc_process_memory\"]\n        end\n\n        subgraph HITLUISvc[\"HITL-UI Service\"]\n            HITLMetrics[\"/metrics :3000\\n• process_cpu_seconds\\n• process_memory_bytes\\n• http_requests_total\"]\n        end\n\n        subgraph Exporters[\"Exporters\"]\n            RedisExp[\"redis-exporter\\n:9121/metrics\"]\n            ESExp[\"elasticsearch-exporter\\n:9114/metrics\"]\n        end\n    end\n\n    subgraph K8sSvc[\"Kubernetes Services\"]\n        VMSvc[\"Service: victoriametrics\\nport: 8428\"]\n    end\n\n    %% Data flow - Scraping (vmagent pulls from services)\n    Agent1 -->|scrape /metrics| OrcMetrics\n    Agent1 -->|scrape /metrics| WrkMetrics\n    Agent1 -->|scrape /metrics| HITLMetrics\n    Agent2 -->|scrape /metrics| RedisExp\n    AgentN -->|scrape /metrics| ESExp\n\n    %% Data flow - vmagent pushes to VM\n    Agent1 -->|remote_write| VM\n    Agent2 -->|remote_write| VM\n    AgentN -->|remote_write| VM\n\n    %% Storage\n    VM -->|persist| VMPVC\n\n    %% Service exposure\n    VM --> VMSvc\n\n    subgraph Backend[\"Backend API (Orchestrator)\"]\n        OrcProxy[\"Proxy Endpoints\\n/api/metrics/query_range\\n/api/metrics/cpu, /memory, etc.\"]\n        ServiceHealthAPI[\"Service Health API (P06-F07)\\n/api/metrics/services/health\\n/api/metrics/services/{name}/sparkline\"]\n    end\n\n    %% UI queries backend proxy, not VM directly\n    MetricsPage -->|GET /api/metrics/query_range| OrcProxy\n    ServiceDashboard -->|GET /api/metrics/services/health| ServiceHealthAPI\n    ServiceDashboard -->|GET /api/metrics/services/{name}/sparkline| ServiceHealthAPI\n    OrcProxy -->|PromQL queries| VMSvc\n    ServiceHealthAPI -->|PromQL queries| VMSvc\n\n    %% Styling\n    classDef ui fill:#E0F2FE,stroke:#0284c7,stroke-width:2px\n    classDef monitoring fill:#DCFCE7,stroke:#16a34a,stroke-width:2px\n    classDef agent fill:#FEF3C7,stroke:#d97706,stroke-width:2px\n    classDef service fill:#E6F0FF,stroke:#2563eb,stroke-width:2px\n    classDef storage fill:#F3E8FF,stroke:#9333ea,stroke-width:2px\n    classDef exporter fill:#FEE2E2,stroke:#dc2626,stroke-width:2px\n    classDef orchestration fill:#D0E8FF,stroke:#2563eb,stroke-width:2px\n\n    class MetricsPage,ServiceDashboard ui\n    class VM monitoring\n    class Agent1,Agent2,AgentN agent\n    class OrcMetrics,WrkMetrics,HITLMetrics service\n    class RedisExp,ESExp exporter\n    class VMPVC storage\n    class VMSvc service\n    class OrcProxy,ServiceHealthAPI orchestration\n",
  "content_size": 3846,
  "collected_at": "2026-02-06T01:44:19.645734",
  "compilation_status": "failed",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 2
}