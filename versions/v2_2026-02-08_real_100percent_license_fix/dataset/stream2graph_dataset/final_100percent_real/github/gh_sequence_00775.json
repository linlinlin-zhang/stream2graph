{
  "id": "gh_sequence_00775",
  "source": "github",
  "source_url": "https://github.com/forepath/agenstra/blob/6a2b5d1006fcb07aeb873ca3cd0c6f8e184b2b85/libs/domains/framework/backend/feature-agent-controller/docs/sequence-http-vcs.mmd",
  "github_repo": "forepath/agenstra",
  "github_file_path": "libs/domains/framework/backend/feature-agent-controller/docs/sequence-http-vcs.mmd",
  "diagram_type": "sequence",
  "code": "sequenceDiagram\n    participant Client as HTTP Client\n    participant ControllerAPI as ClientsVcsController<br/>(/api/clients/:id/agents/:agentId/vcs)\n    participant ProxyService as ClientAgentVcsProxyService\n    participant ManagerAPI as AgentsVcsController<br/>(Remote Agent Manager)\n    participant Container as Agent Container<br/>(/app)\n\n    Note over Client,Container: HTTP API - Proxied VCS Operations\n\n    rect rgb(230, 240, 255)\n        Note over Client,Container: Get Git Status (Proxied)\n        Client->>ControllerAPI: GET /api/clients/{id}/agents/{agentId}/vcs/status\n        ControllerAPI->>ProxyService: getStatus(clientId, agentId)\n        ProxyService->>ProxyService: getClientAgentCredentials(clientId, agentId)\n        ProxyService->>ProxyService: build request to agent-manager\n        ProxyService->>ManagerAPI: GET {endpoint}/api/agents/{agentId}/vcs/status<br/>(with auth headers)\n        ManagerAPI->>Container: Execute git status\n        Container-->>ManagerAPI: GitStatusDto\n        ManagerAPI-->>ProxyService: GitStatusDto\n        ProxyService-->>ControllerAPI: GitStatusDto\n        ControllerAPI-->>Client: 200 OK<br/>{status}\n    end\n\n    rect rgb(240, 255, 240)\n        Note over Client,Container: Stage Files (Proxied)\n        Client->>ControllerAPI: POST /api/clients/{id}/agents/{agentId}/vcs/stage<br/>{files: []}\n        ControllerAPI->>ProxyService: stageFiles(clientId, agentId, dto)\n        ProxyService->>ProxyService: getClientAgentCredentials(clientId, agentId)\n        ProxyService->>ProxyService: build request to agent-manager\n        ProxyService->>ManagerAPI: POST {endpoint}/api/agents/{agentId}/vcs/stage<br/>(with auth headers)\n        ManagerAPI->>Container: Execute git add\n        Container-->>ManagerAPI: success\n        ManagerAPI-->>ProxyService: 204 No Content\n        ProxyService-->>ControllerAPI: void\n        ControllerAPI-->>Client: 204 No Content\n    end\n\n    rect rgb(255, 240, 240)\n        Note over Client,Container: Commit Changes (Proxied)\n        Client->>ControllerAPI: POST /api/clients/{id}/agents/{agentId}/vcs/commit<br/>{message: \"...\"}\n        ControllerAPI->>ProxyService: commit(clientId, agentId, dto)\n        ProxyService->>ProxyService: getClientAgentCredentials(clientId, agentId)\n        ProxyService->>ProxyService: build request to agent-manager\n        ProxyService->>ManagerAPI: POST {endpoint}/api/agents/{agentId}/vcs/commit<br/>(with auth headers)\n        ManagerAPI->>Container: Execute git commit<br/>(with ENV author config)\n        Container-->>ManagerAPI: success\n        ManagerAPI-->>ProxyService: 204 No Content\n        ProxyService-->>ControllerAPI: void\n        ControllerAPI-->>Client: 204 No Content\n    end\n\n    rect rgb(255, 255, 230)\n        Note over Client,Container: Push Changes (Proxied)\n        Client->>ControllerAPI: POST /api/clients/{id}/agents/{agentId}/vcs/push\n        ControllerAPI->>ProxyService: push(clientId, agentId)\n        ProxyService->>ProxyService: getClientAgentCredentials(clientId, agentId)\n        ProxyService->>ProxyService: build request to agent-manager\n        ProxyService->>ManagerAPI: POST {endpoint}/api/agents/{agentId}/vcs/push<br/>(with auth headers)\n        ManagerAPI->>Container: Execute git push<br/>(uses .netrc or SSH key)\n        Container-->>ManagerAPI: success\n        ManagerAPI-->>ProxyService: 204 No Content\n        ProxyService-->>ControllerAPI: void\n        ControllerAPI-->>Client: 204 No Content\n    end\n\n    rect rgb(255, 230, 255)\n        Note over Client,Container: Create Branch (Proxied)\n        Client->>ControllerAPI: POST /api/clients/{id}/agents/{agentId}/vcs/branches<br/>{name, useConventionalPrefix, conventionalType}\n        ControllerAPI->>ProxyService: createBranch(clientId, agentId, dto)\n        ProxyService->>ProxyService: getClientAgentCredentials(clientId, agentId)\n        ProxyService->>ProxyService: build request to agent-manager\n        ProxyService->>ManagerAPI: POST {endpoint}/api/agents/{agentId}/vcs/branches<br/>(with auth headers)\n        ManagerAPI->>Container: Execute git checkout -b<br/>(with conventional prefix if enabled)\n        Container-->>ManagerAPI: success\n        ManagerAPI-->>ProxyService: 201 Created\n        ProxyService-->>ControllerAPI: void\n        ControllerAPI-->>Client: 201 Created\n    end\n\n    rect rgb(240, 230, 255)\n        Note over Client,Container: Error Handling\n        Client->>ControllerAPI: POST /api/clients/{id}/agents/{agentId}/vcs/push\n        ControllerAPI->>ProxyService: push(clientId, agentId)\n        ProxyService->>ManagerAPI: POST {endpoint}/api/agents/{agentId}/vcs/push\n        ManagerAPI->>Container: Execute git push\n        Container-->>ManagerAPI: error (e.g., authentication failed)\n        ManagerAPI-->>ProxyService: 400 Bad Request<br/>{error message}\n        ProxyService->>ProxyService: translate error\n        ProxyService-->>ControllerAPI: 400 Bad Request<br/>{translated error}\n        ControllerAPI-->>Client: 400 Bad Request<br/>{error message}\n    end\n",
  "content_size": 5012,
  "collected_at": "2026-02-06T01:36:52.296773",
  "compilation_status": "failed",
  "license": "none",
  "license_name": "No License (Assumed)",
  "license_url": null,
  "repo_stars": 1,
  "repo_forks": 0,
  "repo_owner": "forepath",
  "repo_name": "agenstra",
  "repo_description": "Centralized management platform for distributed AI agent infrastructure with real-time interaction, code editing, and automated provisioning.",
  "repo_language": "TypeScript",
  "repo_topics": [
    "angular",
    "bootstrap",
    "clarity",
    "forepath",
    "framework"
  ],
  "repo_created_at": "2025-09-24T22:34:48Z",
  "repo_updated_at": "2026-02-04T23:08:27Z",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}