{
  "id": "gh_architecture_01738",
  "source": "github",
  "source_url": "https://github.com/aaronfeingold/DoxIn/blob/f4da7f866072e86b3559ff2faf0f14a1eb5e023c/plans/deployment-architecture.mmd",
  "github_repo": "aaronfeingold/DoxIn",
  "github_file_path": "plans/deployment-architecture.mmd",
  "diagram_type": "architecture",
  "code": "graph TB\n    %% GCP Production Deployment Architecture\n    %% Infrastructure as Code with Terraform\n\n    subgraph \"DNS & Edge\"\n        DNS[Cloud DNS<br/>doxin.com<br/>app.doxin.com]\n        CloudArmor[Cloud Armor<br/>WAF + DDoS Protection<br/>Rate Limiting]\n    end\n\n    subgraph \"Global Load Balancing\"\n        GLB[Cloud Load Balancer<br/>Global HTTPS<br/>SSL Termination]\n        BackendService[Backend Service<br/>Health Checks<br/>Session Affinity]\n    end\n\n    subgraph \"GCP Region: us-central1\"\n        direction TB\n\n        subgraph \"Compute - Cloud Run\"\n            direction LR\n\n            subgraph \"API Service\"\n                API_Rev1[api-service<br/>Revision: abc123<br/>Min: 2, Max: 20<br/>2vCPU, 4GB RAM]\n                API_Rev2[api-service<br/>Revision: abc124<br/>Traffic: 0%<br/>Blue-Green Deploy]\n            end\n\n            subgraph \"Worker Service\"\n                Worker_Rev1[worker-service<br/>Revision: def456<br/>Min: 1, Max: 10<br/>1vCPU, 2GB RAM]\n            end\n\n            subgraph \"Qdrant Service\"\n                Qdrant_Rev1[qdrant-service<br/>Revision: ghi789<br/>Min: 1, Max: 3<br/>2vCPU, 8GB RAM<br/>50GB SSD Volume]\n            end\n        end\n\n        subgraph \"Networking\"\n            VPC[VPC Network<br/>Private IP Range<br/>10.0.0.0/16]\n            Connector[Serverless VPC Connector<br/>Cloud Run → VPC]\n            CloudNAT[Cloud NAT<br/>Egress Gateway]\n        end\n\n        subgraph \"Managed Services\"\n            Memorystore[(Memorystore Redis<br/>2GB Standard<br/>HA Configuration<br/>Private IP)]\n\n            PubSub[Cloud Pub/Sub<br/>Event Streaming<br/>Worker Tasks]\n\n            CloudTasks[Cloud Tasks<br/>Job Queue<br/>Retry + DLQ]\n\n            SecretManager[Secret Manager<br/>API Keys<br/>DB Credentials]\n        end\n\n        subgraph \"Storage\"\n            GCS_Docs[GCS Bucket: documents<br/>Regional<br/>Lifecycle: 90d → Nearline]\n\n            GCS_Exports[GCS Bucket: exports<br/>Regional<br/>Lifecycle: 30d → Coldline]\n\n            GCS_Backups[GCS Bucket: backups<br/>Multi-regional<br/>Retention: 1 year]\n\n            GCS_Qdrant[GCS Persistent Disk<br/>Qdrant Data<br/>50GB SSD<br/>Automated Snapshots]\n        end\n    end\n\n    subgraph \"External: AWS us-east-1\"\n        Neon[(Neon PostgreSQL<br/>Serverless Database<br/>Branch: production<br/>Connection Pooling)]\n    end\n\n    subgraph \"Container Registry\"\n        GAR[Google Artifact Registry<br/>us-central1<br/>Docker Images]\n\n        subgraph \"Image Repositories\"\n            IMG_API[api-service:latest<br/>api-service:abc123]\n            IMG_Worker[worker-service:latest<br/>worker-service:def456]\n            IMG_Qdrant[qdrant:latest<br/>qdrant:ghi789]\n        end\n    end\n\n    subgraph \"CI/CD Pipeline\"\n        GitHub[GitHub<br/>Source Repository<br/>main branch]\n\n        GitHubActions[GitHub Actions<br/>Build & Test<br/>Docker Build<br/>Deploy]\n\n        CloudBuild[Cloud Build<br/>Image Building<br/>Vulnerability Scan]\n    end\n\n    subgraph \"Observability Suite\"\n        direction TB\n\n        CloudLogging[Cloud Logging<br/>Centralized Logs<br/>30d Retention<br/>Export to BigQuery]\n\n        CloudMonitoring[Cloud Monitoring<br/>Metrics & Dashboards<br/>Uptime Checks<br/>SLO Tracking]\n\n        CloudTrace[Cloud Trace<br/>Distributed Tracing<br/>Latency Analysis]\n\n        ErrorReporting[Error Reporting<br/>Exception Tracking<br/>Slack Alerts]\n\n        CloudProfiler[Cloud Profiler<br/>CPU & Memory<br/>Performance Analysis]\n    end\n\n    subgraph \"Security & IAM\"\n        IAM[Cloud IAM<br/>Service Accounts<br/>Workload Identity]\n\n        KMS[Cloud KMS<br/>Encryption Keys<br/>CMEK for GCS]\n\n        VPCFirewall[VPC Firewall Rules<br/>Ingress/Egress<br/>Internal Only]\n    end\n\n    subgraph \"Monitoring & Alerting\"\n        AlertPolicy[Alert Policies<br/>Error Rate > 5%<br/>Latency P95 > 1s<br/>CPU > 80%]\n\n        NotifChannel[Notification Channels<br/>PagerDuty<br/>Slack<br/>Email]\n\n        UptimeCheck[Uptime Checks<br/>Global Monitoring<br/>5 locations]\n    end\n\n    %% DNS Flow\n    DNS --> GLB\n    GLB --> CloudArmor\n    CloudArmor --> BackendService\n\n    %% Load balancer to services\n    BackendService --> API_Rev1\n    BackendService -.canary 10%.-> API_Rev2\n\n    %% API service connections\n    API_Rev1 --> Connector\n    API_Rev2 --> Connector\n    Worker_Rev1 --> Connector\n    Qdrant_Rev1 --> Connector\n\n    %% VPC networking\n    Connector --> VPC\n    VPC --> Memorystore\n    VPC --> CloudNAT\n\n    %% External connections\n    API_Rev1 --> Neon\n    Worker_Rev1 --> Neon\n    CloudNAT --> Neon\n\n    %% Service to service\n    API_Rev1 --> Qdrant_Rev1\n    API_Rev1 --> Memorystore\n    Worker_Rev1 --> Memorystore\n    API_Rev1 --> CloudTasks\n    CloudTasks --> Worker_Rev1\n    API_Rev1 --> PubSub\n    PubSub --> Worker_Rev1\n\n    %% Storage connections\n    API_Rev1 --> GCS_Docs\n    Worker_Rev1 --> GCS_Docs\n    API_Rev1 --> GCS_Exports\n    Qdrant_Rev1 --> GCS_Qdrant\n\n    %% Secrets\n    API_Rev1 --> SecretManager\n    Worker_Rev1 --> SecretManager\n    Qdrant_Rev1 --> SecretManager\n\n    %% CI/CD flow\n    GitHub --> GitHubActions\n    GitHubActions --> CloudBuild\n    CloudBuild --> GAR\n    GAR --> IMG_API & IMG_Worker & IMG_Qdrant\n    IMG_API --> API_Rev1 & API_Rev2\n    IMG_Worker --> Worker_Rev1\n    IMG_Qdrant --> Qdrant_Rev1\n\n    %% Monitoring connections\n    API_Rev1 -.logs.-> CloudLogging\n    Worker_Rev1 -.logs.-> CloudLogging\n    Qdrant_Rev1 -.logs.-> CloudLogging\n\n    API_Rev1 -.metrics.-> CloudMonitoring\n    Worker_Rev1 -.metrics.-> CloudMonitoring\n    Memorystore -.metrics.-> CloudMonitoring\n\n    API_Rev1 -.traces.-> CloudTrace\n    API_Rev1 -.errors.-> ErrorReporting\n    API_Rev1 -.profiling.-> CloudProfiler\n\n    CloudMonitoring --> AlertPolicy\n    AlertPolicy --> NotifChannel\n    UptimeCheck --> CloudMonitoring\n\n    %% Security\n    IAM -.controls.-> API_Rev1\n    IAM -.controls.-> Worker_Rev1\n    IAM -.controls.-> Qdrant_Rev1\n    KMS -.encrypts.-> GCS_Docs\n    KMS -.encrypts.-> GCS_Backups\n    VPCFirewall -.protects.-> VPC\n\n    %% Backup flow\n    Neon -.backup.-> GCS_Backups\n    GCS_Qdrant -.snapshot.-> GCS_Backups\n\n    %% Styling\n    classDef dns fill:#e1f5fe,stroke:#01579b,stroke-width:2px\n    classDef lb fill:#fff3e0,stroke:#e65100,stroke-width:3px\n    classDef compute fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px\n    classDef network fill:#f3e5f5,stroke:#4a148c,stroke-width:2px\n    classDef managed fill:#fce4ec,stroke:#880e4f,stroke-width:2px\n    classDef storage fill:#fff9c4,stroke:#f57f17,stroke-width:2px\n    classDef database fill:#e0f2f1,stroke:#004d40,stroke-width:2px\n    classDef cicd fill:#ede7f6,stroke:#311b92,stroke-width:2px\n    classDef monitor fill:#e8eaf6,stroke:#1a237e,stroke-width:2px\n    classDef security fill:#fbe9e7,stroke:#bf360c,stroke-width:2px\n\n    class DNS,CloudArmor dns\n    class GLB,BackendService lb\n    class API_Rev1,API_Rev2,Worker_Rev1,Qdrant_Rev1 compute\n    class VPC,Connector,CloudNAT network\n    class Memorystore,PubSub,CloudTasks,SecretManager managed\n    class GCS_Docs,GCS_Exports,GCS_Backups,GCS_Qdrant storage\n    class Neon database\n    class GitHub,GitHubActions,CloudBuild,GAR,IMG_API,IMG_Worker,IMG_Qdrant cicd\n    class CloudLogging,CloudMonitoring,CloudTrace,ErrorReporting,CloudProfiler,AlertPolicy,NotifChannel,UptimeCheck monitor\n    class IAM,KMS,VPCFirewall security\n",
  "content_size": 7288,
  "collected_at": "2026-02-06T02:02:43.419871",
  "compilation_status": "failed",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0
}