{
  "id": "gh_sequence_00317",
  "source": "github",
  "source_url": "https://github.com/filecoin-project/specs/blob/a95002835b34d4042c007feda3fecf5e68e79dfa/content/systems/filecoin_markets/onchain_storage_market/diagrams/deal-payment.mmd",
  "github_repo": "filecoin-project/specs",
  "github_file_path": "content/systems/filecoin_markets/onchain_storage_market/diagrams/deal-payment.mmd",
  "diagram_type": "sequence",
  "code": "sequenceDiagram\nparticipant StorageMiningSubsystem\nparticipant StorageMinerActor\nparticipant StorageMarketActor\nStorageMiningSubsystem -->+ StorageMarketActor: PublishStorageDeals\nStorageMarketActor -->> StorageMarketActor: _validateNewStorageDeal\nStorageMarketActor -->> StorageMarketActor: _assertValidClienSignature\nStorageMarketActor -->> StorageMarketActor: _assertValidDealTimingAtPublish\nStorageMarketActor -->> StorageMarketActor: _assertValidDealMinimum\nStorageMarketActor -->> StorageMarketActor: _assertSufficientBalanceAvailableForDeal\nStorageMarketActor -->> StorageMarketActor: _lockFundsForStorageDeal\nStorageMarketActor --> StorageMarketActor: _generateStorageDealID\nStorageMarketActor -->- StorageMiningSubsystem: DealIDs\nStorageMiningSubsystem --> StorageMinerActor: PreCommitSector\nStorageMinerActor -->+ StorageMarketActor: VerifyPublishedDealIDs(dealIDs)\nStorageMarketActor -->> StorageMarketActor: _assertPublishedDealState\nStorageMarketActor -->> StorageMarketActor: _assertDealStartAfterCurrEpoch\nStorageMarketActor -->> StorageMarketActor: _assertDealExpireAfterMaxProveCommitWindow\nStorageMarketActor -->- StorageMinerActor: Success\nStorageMiningSubsystem -->> StorageMinerActor: ProveCommitSector\nStorageMinerActor -->+ StorageMarketActor: ActivateDeals(dealIDs)\nStorageMarketActor -->> StorageMarketActor: _assertPublishedDealState\nStorageMarketActor -->> StorageMarketActor: _assertDealNotYetExpired\nStorageMarketActor -->> StorageMarketActor: _activateDeal(publishedDeal)\nStorageMarketActor -->- StorageMinerActor: Deals\nStorageMinerActor -->> StorageMinerActor: _initializeUtilizationInfo\n\n\nStorageMinerActor -->> StorageMinerActor: _onSuccessfulPoSt\nStorageMinerActor -->> StorageMarketActor: ProcessDealPayment\nStorageMarketActor -->> StorageMarketActor: _assertActiveDealState\nStorageMarketActor -->> StorageMarketActor: _getStorageFeeSinceLastPayment\nStorageMarketActor -->> StorageMarketActor: _transferBalance\n\nStorageMinerActor -->> StorageMinerActor: _submitPowerReport (if any deal expires)\nStorageMinerActor -->> StorageMarketActor: ProcessDealExpiration\nStorageMarketActor -->> StorageMarketActor: _assertActiveDealState\nStorageMarketActor -->> StorageMarketActor: _getStorageFeeSinceLastPayment\nStorageMarketActor -->> StorageMarketActor: _transferBalance\nStorageMarketActor -->> StorageMarketActor: _unlockCollateral\n\nStorageMinerActor -->> StorageMinerActor: _submitFaultReport(if TerminatedFault)\nStorageMinerActor -->> StorageMarketActor: ProcessDealSlash\nStorageMarketActor -->> StorageMarketActor: _slashTerminatedFaults\nStorageMarketActor -->> StorageMarketActor: _assertActiveDealState\nStorageMarketActor -->> StorageMarketActor: _terminateDeal\n\nStorageMinerActor -->+ StorageMarketActor: WithdrawBalance\nStorageMarketActor -->- StorageMinerActor: fund",
  "content_size": 2803,
  "collected_at": "2026-02-06T01:30:36.716045",
  "compilation_status": "failed",
  "license": "none",
  "license_name": "No License (Assumed)",
  "license_url": null,
  "repo_stars": 366,
  "repo_forks": 167,
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}