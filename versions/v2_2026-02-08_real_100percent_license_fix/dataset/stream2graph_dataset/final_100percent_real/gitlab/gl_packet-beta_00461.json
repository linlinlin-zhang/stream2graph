{
  "id": "gl_packet-beta_00461",
  "source": "gitlab",
  "source_url": "https://github.com/seanchatmangpt/erlmcp/blob/1356e12d778f4f4908360bdb3af445db8caff50d/docs/diagrams/examples/performance-benchmark.mmd",
  "source_note": "collected_from_github_additional",
  "github_repo": "seanchatmangpt/erlmcp",
  "diagram_type": "packet-beta",
  "code": "graph TB\n    subgraph \"Benchmark Setup: erlmcp Performance Test Suite\"\n        A[Start Benchmark Runner] --> B{Select Test Scenario}\n    end\n\n    subgraph \"Scenario 1: Core Operations (registry/queue/pool/session)\"\n        B --> C[erlmcp_bench_core_ops]\n        C --> D[Initialize Test Environment]\n        D --> E[Generate Workload: 100K Operations]\n\n        E --> F[\"Test 1: Registry Operations<br/>gproc:register/lookup\"]\n        F --> G[\"Execute: 100K registry lookups<br/>O(log N) complexity\"]\n        G --> H[Measure: Throughput, Latency, Memory]\n        H --> I{Result Analysis}\n        I -->|553K ops/s| J[✓ PASS: Baseline achieved]\n\n        E --> K[\"Test 2: Queue Operations<br/>erlmcp_queue:enqueue/dequeue\"]\n        K --> L[\"Execute: 100K queue operations<br/>Lock-free implementation\"]\n        L --> M[Measure: Throughput, Contention]\n        M --> N{Result Analysis}\n        N -->|971K ops/s| O[✓ PASS: Baseline achieved]\n\n        E --> P[\"Test 3: Pool Management<br/>poolboy:checkout/checkin\"]\n        P --> Q[\"Execute: 100K pool operations<br/>10 workers, max_overflow 5\"]\n        Q --> R[Measure: Checkout latency, Queue depth]\n        R --> S{Result Analysis}\n        S -->|149K ops/s| T[✓ PASS: Baseline achieved]\n\n        E --> U[\"Test 4: Session Handling<br/>erlmcp_session:create/lookup/delete\"]\n        U --> V[\"Execute: 100K session operations<br/>ETS backend (O(1))\"]\n        V --> W[Measure: CRUD latency, Memory growth]\n        W --> X{Result Analysis}\n        X -->|242K ops/s| Y[✓ PASS: Baseline achieved]\n    end\n\n    subgraph \"Scenario 2: Network I/O (TCP/HTTP real sockets)\"\n        B --> Z[erlmcp_bench_network_real]\n        Z --> AA[Initialize Transport: TCP]\n        AA --> AB[Establish: 100 Concurrent Connections]\n\n        AB --> AC[\"Test: TCP Message Throughput<br/>4KB packets, sustained load\"]\n        AC --> AD[\"Execute: 100K messages<br/>100 concurrent connections\"]\n        AD --> AE[Measure: msgs/sec, latency_p99, CPU, Memory]\n        AE --> AF{Result Analysis}\n        AF -->|43K msg/s| AG[✓ PASS: Network bound<br/>bottleneck identified]\n\n        AB --> AH[\"Test: HTTP/2 Multiplexing<br/>gun client, multiple streams\"]\n        AH --> AI[\"Execute: 5K requests<br/>10 concurrent connections\"]\n        AI --> AJ[Measure: Request latency, Stream concurrency]\n        AJ --> AK{Result Analysis}\n        AK -->|38K req/s| AL[✓ PASS: HTTP/2 multiplexing<br/>effective]\n\n        AB --> AM[\"Test: Connection Pooling<br/>poolboy + gun\"]\n        AM --> AN[\"Execute: 10K requests<br/>Pool size: 10, overflow: 5\"]\n        AN --> AO[Measure: Pool hit rate, Checkout latency]\n        AO --> AP{Result Analysis}\n        AP -->|95% hit rate| AQ[✓ PASS: Pool reuse<br/>optimal]\n    end\n\n    subgraph \"Scenario 3: Sustained Load (stress testing)\"\n        B --> AR[erlmcp_bench_stress]\n        AR --> AS[Configure Duration: 5 minutes]\n        AS --> AT[Start Workload Generator]\n\n        AT --> AU[\"Phase 1: Ramp-up (0-60s)<br/>0 → 300K ops/s\"]\n        AU --> AV[Monitor: CPU, Memory, GC]\n        AV --> AW{Stable?}\n        AW -->|Yes| AX[\"Phase 2: Sustained (60-240s)<br/>300K ops/s constant\"]\n\n        AX --> AY[Collect Time-Series Metrics]\n        AY --> AZ[\"Metrics:<br/>  - Throughput (ops/s)<br/>  - Latency (p50/p95/p99)<br/>  - Memory (heap/rss)<br/>  - GC (frequency/pause)<br/>  - CPU utilization\"]\n\n        AZ --> BA{Anomaly Detection}\n        BA -->|No anomalies| BB[\"Phase 3: Ramp-down (240-300s)<br/>300K → 0 ops/s\"]\n\n        BB --> BC[Generate Report]\n        BC --> BD{Result Analysis}\n        BD -->|372K avg ops/s<br/>p99 latency: 4.2ms<br/>Memory stable| BE[✓ PASS: System stable<br/>under sustained load]\n    end\n\n    subgraph \"Scenario 4: Chaos Engineering (failure injection)\"\n        B --> BF[erlmcp_bench_chaos]\n        BF --> BG[Select Chaos Scenario]\n\n        BG --> BH[\"Scenario 1: Process Kill<br/>Randomly kill worker processes\"]\n        BH --> BI[Inject: 10 process kills/sec]\n        BI --> BJ[Measure: Recovery time, Message loss]\n        BJ --> BK{Recovery < 5s?}\n        BK -->|Yes| BL[✓ PASS: Supervision tree<br/>effective]\n\n        BG --> BM[\"Scenario 2: Memory Exhaustion<br/>Allocate memory until pressure\"]\n        BM --> BN[Inject: Memory allocator]\n        BN --> BO[Trigger: VM memory monitor]\n        BO --> BP[Measure: GC behavior, Swap rate]\n        BP --> BQ{Graceful degradation?}\n        BQ -->|Yes| BR[✓ PASS: Memory guard<br/>effective]\n\n        BG --> BS[\"Scenario 3: Network Latency<br/>Add 100ms delay to TCP\"]\n        BS --> BT[Inject: tc netem delay]\n        BT --> BU[Measure: Timeout rate, Retry attempts]\n        BU --> BV{Circuit breaker?}\n        BV -->|Triggered| BW[✓ PASS: Circuit breaker<br/>protects system]\n\n        BG --> BX[\"Scenario 4: Connection Storm<br/>Spawn 50K connections\"]\n        BX --> BY[Inject: Connection burst]\n        BY --> BZ[Measure: Accept rate, Rejection rate]\n        BZ --> CA{Rate limiting?}\n        CA -->|Active| CB[✓ PASS: Connection limiter<br/>protects system]\n    end\n\n    subgraph \"Scenario 5: MCP Integration (end-to-end workflows)\"\n        B --> CC[erlmcp_bench_integration]\n        CC --> CD[Select MCP Workflow]\n\n        CD --> CE[\"Workflow 1: Resource Subscription<br/>subscribe → notify → unsubscribe\"]\n        CE --> CF[Execute: 1K subscription cycles]\n        CF --> CG[Measure: Notification latency, Delivery rate]\n        CG --> CH{Result Analysis}\n        CH -->|99.8% delivery| CI[✓ PASS: Subscription system<br/>reliable]\n\n        CD --> CJ[\"Workflow 2: Tool Invocation<br/>call_tool with progress\"]\n        CJ --> CK[Execute: 500 tool calls<br/>with progress notifications]\n        CK --> CL[Measure: Invocation latency, Progress delivery]\n        CL --> CM{Result Analysis}\n        CM -->|avg 2.3ms| CN[✓ PASS: Tool overhead<br/>acceptable]\n\n        CD --> CO[\"Workflow 3: Prompt Rendering<br/>get_prompt with args\"]\n        CO --> CP[Execute: 1K prompt renders<br/>with template variables]\n        CP --> CQ[Measure: Render latency, Template cache hit]\n        CQ --> CR{Result Analysis}\n        CR -->|95% cache hit| CS[✓ PASS: Template caching<br/>effective]\n\n        CD --> CT[\"Workflow 4: Error Handling<br/>trigger various errors\"]\n        CT --> CU[Execute: 200 error scenarios<br/>protocol/validation/transport]\n        CU --> CV[Measure: Error response time, Recovery rate]\n        CV --> CW{Result Analysis}\n        CW -->|98% recovery| CX[✓ PASS: Error handling<br/>robust]\n\n        CD --> CY[\"Workflow 5: Concurrent Requests<br/>100 parallel tool calls\"]\n        CY --> CZ[Execute: Parallel request batch]\n        CZ --> DA[Measure: Total completion time, Request correlation]\n        DA --> DB{Result Analysis}\n        DB -->|No correlation errors| DC[✓ PASS: Request ID system<br/>reliable]\n    end\n\n    subgraph \"Report Generation\"\n        J --> EEA[Aggregate All Results]\n        O --> EEA\n        T --> EEA\n        Y --> EEA\n        AG --> EEA\n        AL --> EEA\n        AQ --> EEA\n        BE --> EEA\n        BL --> EEA\n        BR --> EEA\n        BW --> EEA\n        CB --> EEA\n        CI --> EEA\n        CN --> EEA\n        CS --> EEA\n        CX --> EEA\n        DC --> EEA\n\n        EEA --> EEBA[Generate Performance Report]\n        EEBA --> EECA[\"Format: Markdown + JSON<br/>Include: Metrics, Charts, Recommendations\"]\n\n        EECA --> EEDA[Compare to Baselines]\n        EEDA --> EEDA{Regression Check}\n        EEDA -->|< 10% regression| EEA[✓ PASS: Performance<br/>within acceptable range]\n        EEDA -->|≥ 10% regression| EEFA[✗ FAIL: Performance<br/>regression detected]\n\n        EEFA --> EEJA[Generate Alert]\n        EEJA --> EEKA[Open Performance Issue]\n    end\n\n    subgraph \"Benchmark Results Summary\"\n        EEBA --> EELA[\"Summary Metrics:<br/><br/>Core Operations:<br/>  - Registry: 553K ops/s<br/>  - Queue: 971K ops/s<br/>  - Pool: 149K ops/s<br/>  - Session: 242K ops/s<br/><br/>Network I/O:<br/>  - TCP: 43K msg/s<br/>  - HTTP: 38K req/s<br/>  - Pool hit rate: 95%<br/><br/>Sustained Load:<br/>  - Avg: 372K ops/s<br/>  - p99 latency: 4.2ms<br/><br/>Chaos Recovery:<br/>  - Process kill: < 5s<br/>  - Memory guard: Active<br/>  - Circuit breaker: Effective<br/><br/>MCP Integration:<br/>  - Subscriptions: 99.8%<br/>  - Tool calls: 2.3ms avg<br/>  - Error recovery: 98%\"]\n    end\n\n    style A fill:#e1f5ff\n    style EEBA fill:#e1f5ff\n    style EELA fill:#fff4e1\n    style J fill:#d4edda\n    style O fill:#d4edda\n    style T fill:#d4edda\n    style Y fill:#d4edda\n    style AG fill:#d4edda\n    style AL fill:#d4edda\n    style AQ fill:#d4edda\n    style BE fill:#d4edda\n    style BL fill:#d4edda\n    style BR fill:#d4edda\n    style BW fill:#d4edda\n    style CB fill:#d4edda\n    style CI fill:#d4edda\n    style CN fill:#d4edda\n    style CS fill:#d4edda\n    style CX fill:#d4edda\n    style DC fill:#d4edda\n    style EEFA fill:#f8d7da\n    style EEJA fill:#f8d7da\n",
  "content_size": 8830,
  "collected_at": "2026-02-06T14:10:11.565089",
  "compilation_status": "failed",
  "license": "gitlab_repo",
  "license_name": "GitLab Repository",
  "license_url": "https://gitlab.com",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}