{
  "id": "gl_packet-beta_00399",
  "source": "gitlab",
  "source_url": "https://github.com/k5tuck/rootstar-bci/blob/17a6f4582c8b6243be686153f34c87fc180f48e3/docs/diagrams/02-data-flow.mmd",
  "source_note": "collected_from_github_additional",
  "github_repo": "k5tuck/rootstar-bci",
  "diagram_type": "packet-beta",
  "code": "%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#4a90d9', 'primaryTextColor': '#fff', 'primaryBorderColor': '#2d5a87', 'lineColor': '#5a5a5a'}}}%%\nflowchart TB\n    subgraph Hardware[\"<b>Hardware Layer (ESP32)</b>\"]\n        EEG[\"EEG Sensor<br/>(ADS1299 8ch)\"]\n        FNIRS[\"fNIRS Sensor<br/>(ADS1115 + LEDs)\"]\n        EMG[\"EMG Sensor\"]\n        EDA[\"EDA Sensor\"]\n    end\n\n    subgraph Acquisition[\"<b>Data Acquisition</b>\"]\n        SPI[\"SPI Interface\"]\n        I2C[\"I2C Interface\"]\n        ADC[\"ADC Sampling\"]\n    end\n\n    subgraph Packet[\"<b>Packet Formation</b>\"]\n        Serialize[\"Serialize<br/>(postcard)\"]\n        Timestamp[\"Add Timestamp\"]\n        CRC[\"CRC Checksum\"]\n    end\n\n    subgraph Transport[\"<b>Transport Layer</b>\"]\n        UART[\"USB/Serial\"]\n        BLE[\"BLE Notify\"]\n    end\n\n    subgraph HostBridge[\"<b>Host Bridge</b>\"]\n        DevMgr[\"DeviceManager<br/>next_event()\"]\n        Parse[\"Parse Packets\"]\n        Buffer[\"Ring Buffers\"]\n    end\n\n    subgraph Processing[\"<b>Signal Processing</b>\"]\n        Filter[\"IIR/Biquad<br/>Filtering\"]\n        FFT[\"FFT Spectral<br/>Analysis\"]\n        BeerLambert[\"Beer-Lambert<br/>(fNIRS→HbO/HbR)\"]\n        Fusion[\"EEG+fNIRS<br/>Temporal Align\"]\n    end\n\n    subgraph Features[\"<b>Feature Extraction</b>\"]\n        BandPower[\"Band Power<br/>(δ,θ,α,β,γ)\"]\n        Coherence[\"Inter-brain<br/>Coherence\"]\n        SNSDecode[\"SNS Decode<br/>(Cortex→Receptor)\"]\n        FP[\"Neural<br/>Fingerprint\"]\n    end\n\n    subgraph Output[\"<b>Output Layer</b>\"]\n        NativeViz[\"Native Viz<br/>(egui)\"]\n        WebViz[\"Web Viz<br/>(WASM)\"]\n        LSL[\"LSL Stream\"]\n        OSC[\"OSC Messages\"]\n        StimCmd[\"Stim Commands\"]\n    end\n\n    subgraph Feedback[\"<b>Feedback Loop</b>\"]\n        StimCtrl[\"Stimulation<br/>Controller\"]\n        Safety[\"Safety<br/>Enforcement\"]\n        DAC[\"DAC Output\"]\n    end\n\n    %% Hardware to Acquisition\n    EEG --> SPI\n    FNIRS --> I2C\n    EMG --> ADC\n    EDA --> ADC\n\n    %% Acquisition to Packet\n    SPI --> Serialize\n    I2C --> Serialize\n    ADC --> Serialize\n    Serialize --> Timestamp --> CRC\n\n    %% Packet to Transport\n    CRC --> UART\n    CRC --> BLE\n\n    %% Transport to Host\n    UART --> DevMgr\n    BLE --> DevMgr\n    DevMgr --> Parse --> Buffer\n\n    %% Host to Processing\n    Buffer --> Filter\n    Buffer --> BeerLambert\n    Filter --> FFT\n    Filter --> Fusion\n    BeerLambert --> Fusion\n\n    %% Processing to Features\n    FFT --> BandPower\n    Fusion --> Coherence\n    Fusion --> SNSDecode\n    BandPower --> FP\n\n    %% Features to Output\n    BandPower --> NativeViz\n    BandPower --> WebViz\n    SNSDecode --> WebViz\n    Coherence --> LSL\n    BandPower --> OSC\n\n    %% Feedback loop\n    FP --> StimCtrl\n    StimCtrl --> Safety\n    Safety --> StimCmd\n    StimCmd --> DAC\n    DAC -.-> Hardware\n\n    classDef hw fill:#e74c3c,stroke:#c0392b,color:#fff\n    classDef acq fill:#f39c12,stroke:#d35400,color:#fff\n    classDef packet fill:#9b59b6,stroke:#8e44ad,color:#fff\n    classDef transport fill:#1abc9c,stroke:#16a085,color:#fff\n    classDef host fill:#3498db,stroke:#2980b9,color:#fff\n    classDef proc fill:#2ecc71,stroke:#27ae60,color:#fff\n    classDef feat fill:#e67e22,stroke:#d35400,color:#fff\n    classDef out fill:#34495e,stroke:#2c3e50,color:#fff\n    classDef fb fill:#c0392b,stroke:#922b21,color:#fff\n\n    class Hardware hw\n    class Acquisition acq\n    class Packet packet\n    class Transport transport\n    class HostBridge host\n    class Processing proc\n    class Features feat\n    class Output out\n    class Feedback fb\n",
  "content_size": 3530,
  "collected_at": "2026-02-06T14:08:59.761855",
  "compilation_status": "failed",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0,
  "repo_owner": "k5tuck",
  "repo_name": "rootstar-bci",
  "repo_description": "Brain-Computer Interface Platform - Rust-based BCI with EEG/fNIRS processing and sensory neural simulation",
  "repo_language": "Rust",
  "repo_topics": [],
  "repo_created_at": "2025-12-29T13:28:15Z",
  "repo_updated_at": "2026-01-05T17:09:56Z",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}