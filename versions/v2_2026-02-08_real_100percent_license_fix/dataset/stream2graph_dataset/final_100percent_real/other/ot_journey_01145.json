{
  "id": "ot_journey_01145",
  "source": "other",
  "source_url": "https://github.com/ik-workshop/naglfar-analytics/blob/2ff359b7b80b238f0b039374ec84a4f8152fadc1/docs/assets/diagrams/01-system-architecture.mmd",
  "source_type": "github_search",
  "github_repo": "ik-workshop/naglfar-analytics",
  "diagram_type": "journey",
  "code": "graph TB\n    Internet[INTERNET<br/>Public Traffic]\n\n    subgraph API_Layer[API Layer]\n        Traefik[API Gateway<br/>Traefik v3.6<br/>TLS Termination<br/>Routing]\n    end\n\n    subgraph Naglfar_Layer[Naglfar Protection Layer]\n        ValidationService[Naglfar Validation Service<br/>.NET 10.0<br/>1. Check auth-token<br/>2. Validate with Redis<br/>3. Capture metadata<br/>4. Publish to Kafka<br/>5. Proxy to backend]\n    end\n\n    subgraph Auth_Layer[Authentication]\n        AuthService[Auth Service<br/>Python FastAPI<br/>3rd Party<br/>E-token validation<br/>JWT generation]\n    end\n\n    subgraph Backend_Layer[Backend Services]\n        BookstoreUS[Book Store US<br/>Inventory, Cart<br/>Checkout, Orders]\n        BookstoreEU[Book Store EU<br/>Inventory, Cart<br/>Checkout, Orders]\n    end\n\n    subgraph Message_Layer[Message Broker]\n        Kafka[Apache Kafka<br/>Topics:<br/>- naglfar-validation-topic<br/>- naglfar-user-journey-topic]\n    end\n\n    subgraph Worker_Layer[Processing Workers]\n        NagWorker[Naglfar Worker<br/>.NET Consumer<br/>Kafka → Neo4j<br/>Event correlation]\n        AnalyticsWorker[Analytics Worker<br/>Pattern Detection<br/>Neo4j → Redis<br/>Abuse detection]\n    end\n\n    subgraph Storage_Layer[Data Storage]\n        Neo4j[(Neo4j<br/>Graph Database<br/>Request metadata<br/>User journeys<br/>Relationships)]\n        Redis[(Redis Cache<br/>Blocked IPs<br/>Blocked tokens<br/>Raw / Bloom filter)]\n    end\n\n    Internet -->|HTTPS| Traefik\n    Traefik -->|HTTP| ValidationService\n\n    ValidationService -.->|No auth-token<br/>302 Redirect| AuthService\n    AuthService -.->|auth-token<br/>302 Redirect| ValidationService\n\n    ValidationService -->|Check blocks<br/>< 1ms| Redis\n    ValidationService -->|Async publish<br/>metadata| Kafka\n    ValidationService -->|Proxy request<br/>Client-side LB| BookstoreUS\n    ValidationService -->|Proxy request<br/>Client-side LB| BookstoreEU\n\n    BookstoreUS -->|User actions<br/>with email| Kafka\n    BookstoreEU -->|User actions<br/>with email| Kafka\n\n    Kafka -->|Consume| NagWorker\n    NagWorker -->|Write graph| Neo4j\n\n    Neo4j -->|Pattern queries| AnalyticsWorker\n    AnalyticsWorker -->|Write blocks<br/>TTL: 5min| Redis\n\n    style Internet fill:#e1f5ff\n    style Traefik fill:#ffe6cc\n    style ValidationService fill:#d5e8d4\n    style AuthService fill:#fff4cc\n    style BookstoreUS fill:#f8cecc\n    style BookstoreEU fill:#f8cecc\n    style Kafka fill:#e1d5e7\n    style NagWorker fill:#dae8fc\n    style AnalyticsWorker fill:#dae8fc\n    style Neo4j fill:#ffe6cc\n    style Redis fill:#ffe6cc\n",
  "content_size": 2561,
  "collected_at": "2026-02-06T11:05:57.115081",
  "compilation_status": "failed",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0,
  "repo_owner": "ik-workshop",
  "repo_name": "naglfar-analytics",
  "repo_description": "The ship made of dead men's nails. A bit darker, but represents collection and analysis of threat data.",
  "repo_language": "Python",
  "repo_topics": [],
  "repo_created_at": "2025-12-27T10:40:47Z",
  "repo_updated_at": "2025-12-29T16:42:42Z",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}