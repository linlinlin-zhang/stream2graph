{
  "id": "ot_stateDiagram_00144",
  "source": "other",
  "source_url": "https://github.com/Leyber91/WirthForge_wiki/blob/566ba86a84e0c8d6c7bf941bcd891dc085a370f8/assets/diagrams/WF-TECH/WF-TECH-004-state-transitions-detailed.mmd",
  "source_type": "github_search_special",
  "github_repo": "Leyber91/WirthForge_wiki",
  "diagram_type": "stateDiagram",
  "code": "---\ntitle: \"WIRTHFORGE State Transitions & Energy Flow\"\nconfig:\n  theme: dark\n  themeVariables:\n    primaryColor: \"#00ff88\"\n    primaryTextColor: \"#ffffff\"\n    primaryBorderColor: \"#4a90e2\"\n    lineColor: \"#61dafb\"\n    secondaryColor: \"#ff6b6b\"\n    tertiaryColor: \"#feca57\"\n    background: \"#0d1117\"\n    mainBkg: \"#161b22\"\n    secondBkg: \"#21262d\"\n---\n\nstateDiagram-v2\n    [*] --> SystemInitialization : System Start\n\n    state SystemInitialization {\n        [*] --> CheckingDatabase\n        CheckingDatabase --> LoadingSchema : Schema Valid\n        CheckingDatabase --> CreatingSchema : No Schema\n        CreatingSchema --> LoadingSchema : Schema Created\n        LoadingSchema --> CheckingRecovery : Schema Loaded\n        CheckingRecovery --> CleanStart : No Previous Session\n        CheckingRecovery --> RecoveryMode : Unclean Shutdown\n        CleanStart --> Ready\n        RecoveryMode --> Ready : Recovery Complete\n    }\n\n    Ready --> SessionActive : Start Session\n\n    state SessionActive {\n        [*] --> Idle\n        \n        state \"Energy Processing\" as EnergyProc {\n            [*] --> CalculatingEnergy\n            CalculatingEnergy --> ValidatingEnergy : Energy Calculated\n            ValidatingEnergy --> UpdatingAccumulator : Valid Energy\n            ValidatingEnergy --> ErrorHandling : Invalid Energy\n            UpdatingAccumulator --> CheckingPatterns : Accumulator Updated\n            CheckingPatterns --> [*] : No Patterns\n            CheckingPatterns --> InterferenceDetected : Interference Found\n            CheckingPatterns --> ResonanceDetected : Resonance Found\n            InterferenceDetected --> [*] : Pattern Processed\n            ResonanceDetected --> [*] : Pattern Processed\n        }\n        \n        state \"Event Processing\" as EventProc {\n            [*] --> QueueingEvent\n            QueueingEvent --> ValidatingEvent : Event Queued\n            ValidatingEvent --> ProcessingEvent : Valid Event\n            ValidatingEvent --> DroppingEvent : Invalid Event\n            ProcessingEvent --> UpdatingState : Event Processed\n            UpdatingState --> CheckingSnapshot : State Updated\n            CheckingSnapshot --> [*] : No Snapshot Needed\n            CheckingSnapshot --> CreatingSnapshot : Snapshot Trigger\n            CreatingSnapshot --> [*] : Snapshot Created\n            DroppingEvent --> [*] : Event Dropped\n        }\n        \n        state \"Background Persistence\" as BgPersist {\n            [*] --> BatchingEvents\n            BatchingEvents --> WritingBatch : Batch Ready\n            BatchingEvents --> Waiting : Batch Not Ready\n            Waiting --> BatchingEvents : Timeout/More Events\n            WritingBatch --> VerifyingWrite : Write Complete\n            VerifyingWrite --> [*] : Write Verified\n            VerifyingWrite --> RetryWrite : Write Failed\n            RetryWrite --> WritingBatch : Retry Attempt\n            RetryWrite --> ErrorHandling : Max Retries\n        }\n        \n        Idle --> EnergyProc : Energy Update\n        Idle --> EventProc : User/System Event\n        Idle --> BgPersist : Background Write\n        EnergyProc --> Idle : Processing Complete\n        EventProc --> Idle : Processing Complete\n        BgPersist --> Idle : Write Complete\n        \n        Idle --> UserInteraction : User Input\n        UserInteraction --> EnergyProc : AI Processing\n        UserInteraction --> EventProc : User Event\n        \n        state UserInteraction {\n            [*] --> ReceivingInput\n            ReceivingInput --> ValidatingInput : Input Received\n            ValidatingInput --> ProcessingPrompt : Valid Input\n            ValidatingInput --> RejectingInput : Invalid Input\n            ProcessingPrompt --> GeneratingResponse : Prompt Processed\n            GeneratingResponse --> [*] : Response Generated\n            RejectingInput --> [*] : Input Rejected\n        }\n        \n        Idle --> PatternDetection : Pattern Trigger\n        \n        state PatternDetection {\n            [*] --> AnalyzingModels\n            AnalyzingModels --> DetectingInterference : Multiple Models\n            AnalyzingModels --> DetectingResonance : Synchronized Models\n            AnalyzingModels --> [*] : No Patterns\n            \n            DetectingInterference --> CalculatingInterference : Interference Found\n            CalculatingInterference --> ApplyingInterference : Interference Calculated\n            ApplyingInterference --> [*] : Interference Applied\n            \n            DetectingResonance --> CalculatingResonance : Resonance Found\n            CalculatingResonance --> ApplyingAmplification : Resonance Calculated\n            ApplyingAmplification --> [*] : Amplification Applied\n        }\n        \n        PatternDetection --> Idle : Pattern Complete\n        \n        Idle --> HealthCheck : Health Monitor\n        \n        state HealthCheck {\n            [*] --> CheckingMetrics\n            CheckingMetrics --> HealthyState : All Metrics OK\n            CheckingMetrics --> WarningState : Some Issues\n            CheckingMetrics --> CriticalState : Critical Issues\n            HealthyState --> [*] : Health OK\n            WarningState --> [*] : Warning Logged\n            CriticalState --> ErrorHandling : Critical Error\n        }\n        \n        HealthCheck --> Idle : Health Check Complete\n        \n        state ErrorHandling {\n            [*] --> LoggingError\n            LoggingError --> DeterminingRecovery : Error Logged\n            DeterminingRecovery --> GracefulDegradation : Recoverable\n            DeterminingRecovery --> EmergencyShutdown : Unrecoverable\n            GracefulDegradation --> [*] : Degraded Mode\n            EmergencyShutdown --> SystemShutdown : Emergency\n        }\n        \n        ErrorHandling --> Idle : Error Recovered\n        ErrorHandling --> SystemShutdown : Fatal Error\n    }\n\n    SessionActive --> SessionEnding : End Session Request\n    SessionActive --> CrashRecovery : Unexpected Shutdown\n    SessionActive --> SystemShutdown : System Shutdown\n\n    state SessionEnding {\n        [*] --> FlushingEvents\n        FlushingEvents --> CreatingFinalSnapshot : Events Flushed\n        CreatingFinalSnapshot --> UpdatingSessionRecord : Snapshot Created\n        UpdatingSessionRecord --> CleanupResources : Session Updated\n        CleanupResources --> [*] : Cleanup Complete\n    }\n\n    SessionEnding --> Ready : Session Ended\n\n    state CrashRecovery {\n        [*] --> DetectingCrash\n        DetectingCrash --> LoadingLastSnapshot : Crash Detected\n        LoadingLastSnapshot --> ReplayingEvents : Snapshot Loaded\n        ReplayingEvents --> ValidatingRecovery : Events Replayed\n        ValidatingRecovery --> RecoveryComplete : Recovery Valid\n        ValidatingRecovery --> RecoveryFailed : Recovery Invalid\n        RecoveryComplete --> [*] : Recovery Success\n        RecoveryFailed --> [*] : Recovery Failed\n    }\n\n    CrashRecovery --> Ready : Recovery Complete\n    CrashRecovery --> SystemShutdown : Recovery Failed\n\n    state SystemShutdown {\n        [*] --> StoppingComponents\n        StoppingComponents --> FlushingFinalData : Components Stopped\n        FlushingFinalData --> ClosingDatabase : Data Flushed\n        ClosingDatabase --> ReleasingResources : Database Closed\n        ReleasingResources --> [*] : Resources Released\n    }\n\n    SystemShutdown --> [*] : System Stopped\n\n    %% Energy State Annotations\n    note right of EnergyProc : Energy Accumulator:\\n• Total Energy: Σ(energy_deltas)\\n• Model Contributions\\n• Frame-by-frame tracking\\n• Conservation validation\n\n    note right of PatternDetection : Pattern Types:\\n• Constructive Interference\\n• Destructive Interference\\n• Resonance Amplification\\n• Synchronization Events\n\n    note right of BgPersist : Performance Targets:\\n• Batch Size: 15 events\\n• Write Latency: <20ms p99\\n• Queue Depth: <500 events\\n• Frame Budget: <16.67ms\n\n    note right of HealthCheck : Monitoring Metrics:\\n• Memory Usage\\n• Queue Depth\\n• Write Performance\\n• Error Rates\\n• Energy Conservation\n\n    %% Styling\n    classDef initClass fill:#4a90e2,stroke:#2c5aa0,stroke-width:2px,color:#fff\n    classDef activeClass fill:#27ae60,stroke:#229954,stroke-width:2px,color:#fff\n    classDef processingClass fill:#f39c12,stroke:#e67e22,stroke-width:2px,color:#fff\n    classDef errorClass fill:#e74c3c,stroke:#c0392b,stroke-width:2px,color:#fff\n    classDef shutdownClass fill:#95a5a6,stroke:#7f8c8d,stroke-width:2px,color:#fff\n\n    class SystemInitialization,Ready initClass\n    class SessionActive,SessionEnding activeClass\n    class EnergyProc,EventProc,BgPersist,PatternDetection,HealthCheck processingClass\n    class ErrorHandling,CrashRecovery errorClass\n    class SystemShutdown shutdownClass\n",
  "content_size": 8646,
  "collected_at": "2026-02-06T10:38:24.600609",
  "compilation_status": "failed",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "license": "other_source",
  "license_name": "Other Source (GitHub-based)"
}