{
  "id": "ot_journey_01091",
  "source": "other",
  "source_url": "https://github.com/sethmcknight/quantic-msse-easy-park-plus/blob/039c5204b7b2c68b7ff94688985eb9bc26fba23c/project-submission/proposed-ddd-microservices-architecture/diagrams/_system-high-level/mermaid/proposed-system-sequence-overview.mmd",
  "source_type": "github_search",
  "github_repo": "sethmcknight/quantic-msse-easy-park-plus",
  "diagram_type": "journey",
  "code": "---\ntitle Easy Park Plus - System Sequence Overview (Proposed)\n---\nsequenceDiagram\n    actor Customer\n    participant FL as FrontendLayer\n    participant GW as APIGateway\n    participant CCSvc as CustomerContextSvc\n    participant RSSvc as ReservationsSvc\n    participant PSvc as PricingSvc\n    participant BSvc as BillingSvc\n    participant POSvc as ParkingOperationsSvc\n    participant VCSvc as VehicleContextSvc\n    participant ECSvc as ElectricVehicleChargingSvc\n    participant EISvc as ExternalIntegrationsSvc\n    participant PolMSvc as PolicyManagementSvc\n    participant IAETSvc as InternalAudit&EventTraceSvc\n    participant MB as MessageBroker\n\n    %% User Authentication and Dashboard Load\n    rect rgb(230, 245, 255)\n    Note over Customer, IAETSvc: User Authentication & Session Management\n    Customer->>FL: Start session / Login\n    FL->>GW: Authenticate User\n    GW->>CCSvc: Validate Credentials\n    CCSvc-->>GW: User Authenticated\n    GW-->>FL: Session Established\n    GW-->>IAETSvc: Log(UserSessionStarted)\n    \n    FL->>GW: Load Dashboard\n    GW->>RSSvc: Get Reservations\n    GW->>POSvc: Get Lot Status\n    RSSvc-->>GW: Reservations Data\n    POSvc-->>GW: Lot Status Data\n    GW-->>FL: Dashboard Data\n    end\n\n    %% Make Reservation (with SlotHold)\n    rect rgb(255, 245, 230)\n    Note over Customer, MB: Reservation Creation & Payment Processing\n    Customer->>FL: Make Reservation\n    FL->>GW: Request Reservation(details)\n    GW->>RSSvc: CreateReservation(details)\n    RSSvc->>PolMSvc: GetReservationPolicies(lotId, customerType)\n    PolMSvc-->>RSSvc: ReservationPolicies\n    RSSvc->>RSSvc: CreateSlotHold(PaymentConfirmation)\n    RSSvc-->>IAETSvc: Publish(SlotHoldCreated)\n    RSSvc->>PSvc: GetFeeQuote(details)\n    PSvc-->>RSSvc: FeeQuote\n    RSSvc->>BSvc: PreAuthPayment(fee)\n    BSvc-->>RSSvc: PreAuth OK\n    RSSvc->>RSSvc: ConvertHoldToReservation()\n    RSSvc-->>GW: ReservationConfirmed\n    GW-->>FL: Show Confirmation\n    RSSvc->>MB: publish ReservationConfirmedEvent\n    IAETSvc->>MB: consume ReservationConfirmedEvent\n    end\n\n    %% Vehicle Entry (ANPR based with VisitLifecycleStateMachine)\n    rect rgb(240, 255, 240)\n    Note over EISvc, IAETSvc: Vehicle Entry & Visit Initiation\n    EISvc->>GW: VehicleDetectedAtEntry(plate, gateId)\n    GW->>POSvc: RegisterVehicleEntry(plate, gateId)\n    POSvc->>VCSvc: GetVehicleDetails(plate)\n    VCSvc-->>POSvc: VehicleDetails\n    POSvc->>PolMSvc: GetEntryPolicies(lotId, vehicleCategory)\n    PolMSvc-->>POSvc: EntryPolicies (GracePeriod, Fallback)\n    POSvc->>RSSvc: CheckReservation(plate)\n    RSSvc-->>POSvc: ReservationMatch / NoMatch\n    POSvc->>POSvc: VisitLifecycleStateMachine.StartVisit()\n    POSvc->>BSvc: InitiateBillingForVisit(visitId)\n    POSvc-->>GW: EntryProcessed, OpenGate\n    GW->>EISvc: Command: OpenEntryGate\n    POSvc->>MB: publish VehicleEnteredEvent\n    IAETSvc->>MB: consume VehicleEnteredEvent\n    end\n\n    %% Start EV Charging (with Policy Application)\n    rect rgb(255, 240, 255)\n    Note over Customer, IAETSvc: EV Charging Session Management\n    Customer->>FL: Start EV Charging\n    FL->>GW: RequestStartCharging(chargerId)\n    GW->>ECSvc: StartChargingSession(chargerId, visitId)\n    ECSvc->>PolMSvc: GetChargingPolicies(lotId, chargerType)\n    PolMSvc-->>ECSvc: ChargingPolicies (GracePeriod for idle)\n    ECSvc->>EISvc: Command: StartChargerHardware\n    EISvc-->>ECSvc: Event: ChargerSessionActive (async)\n    ECSvc->>BSvc: NotifyChargingStarted(rateInfo)\n    ECSvc-->>GW: ChargingSessionStarted\n    GW-->>FL: Show Charging Status\n    ECSvc->>MB: publish EVChargingStartedEvent\n    IAETSvc->>MB: consume EVChargingStartedEvent\n    end\n\n    %% Vehicle Exit (ANPR based)\n    rect rgb(255, 235, 235)\n    Note over EISvc, MB: Vehicle Exit & Billing Finalization\n    EISvc->>GW: VehicleDetectedAtExit(plate, gateId)\n    GW->>POSvc: RegisterVehicleExit(plate, gateId)\n    POSvc->>PSvc: CalculateParkingFee(visitData)\n    PSvc-->>POSvc: ParkingFee\n    alt EV Charging was active\n        POSvc->>ECSvc: NotifyVehicleExiting(visitId)\n        ECSvc->>EISvc: Command: StopChargerHardware\n        EISvc-->>ECSvc: Event: ChargerSessionEnded (async)\n        ECSvc->>PSvc: CalculateChargingFee(sessionData)\n        PSvc-->>ECSvc: ChargingFee\n        ECSvc->>BSvc: AddChargingFeeToBill(fee)\n    end\n    POSvc->>BSvc: AddParkingFeeToBill(fee)\n    BSvc-->>GW: BillReady(totalDue)\n    GW-->>FL: Show Payment Due\n    POSvc->>MB: publish VehicleExitedEvent\n    GW->>EISvc: Command: OpenExitGate\n    end\n\n    %% Pay Bill\n    rect rgb(255, 255, 230)\n    Note over Customer, MB: Payment Processing & Completion\n    Customer->>FL: Pay Bill\n    FL->>GW: ProcessPayment(paymentDetails)\n    GW->>BSvc: SettlePayment(billId, paymentDetails)\n    BSvc->>EISvc: Command: ProcessPaymentGateway\n    EISvc-->>BSvc: Event: PaymentProcessed (async)\n    BSvc-->>GW: PaymentConfirmed\n    GW-->>FL: Show Receipt\n    BSvc->>MB: publish PaymentCompletedEvent\n    end\n\n    Note over Customer, MB: This sequence shows a typical user journey: Reservation, Entry, EV Charging, Exit, and Payment, highlighting key service interactions.\n",
  "content_size": 5095,
  "collected_at": "2026-02-06T11:03:57.774208",
  "compilation_status": "failed",
  "license": "other_source",
  "license_name": "Other Source (GitHub-based)",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}