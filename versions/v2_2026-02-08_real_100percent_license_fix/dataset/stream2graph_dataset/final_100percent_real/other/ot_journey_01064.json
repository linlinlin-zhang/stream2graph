{
  "id": "ot_journey_01064",
  "source": "other",
  "source_url": "https://github.com/alexfarlander/stitch-run/blob/97ed17d1aa70d69eaf4e348e021a4473f10c471b/docs/implementation/diagrams/database-schema.mmd",
  "source_type": "github_search",
  "github_repo": "alexfarlander/stitch-run",
  "diagram_type": "journey",
  "code": "erDiagram\n    %% Core Flow and Run Tables\n    stitch_flows ||--o{ stitch_runs : \"executes\"\n    stitch_flows ||--o{ stitch_flows : \"parent_of\"\n    stitch_flows ||--o{ stitch_flow_versions : \"has_versions\"\n    stitch_flows ||--o| stitch_flow_versions : \"current_version\"\n    stitch_flows ||--o{ stitch_entities : \"tracks\"\n    stitch_flows ||--o{ stitch_webhook_configs : \"receives_webhooks\"\n    \n    %% Run and Version Relationship\n    stitch_runs }o--|| stitch_flow_versions : \"executed_version\"\n    \n    %% Entity Relationships\n    stitch_entities ||--o{ stitch_journey_events : \"generates\"\n    stitch_entities ||--o{ stitch_runs : \"triggers\"\n    stitch_entities ||--o{ stitch_webhook_events : \"created_from\"\n    \n    %% Webhook System\n    stitch_webhook_configs ||--o{ stitch_webhook_events : \"receives\"\n    stitch_webhook_events }o--|| stitch_runs : \"triggers\"\n    \n    %% Media Library\n    stitch_media ||--o{ stitch_media : \"style_reference\"\n    stitch_media ||--o{ stitch_media : \"source_image\"\n    \n    %% ========================================================================\n    %% Table: stitch_flows\n    %% Purpose: Stores all canvases (BMC and Workflows)\n    %% ========================================================================\n    stitch_flows {\n        uuid id PK \"Primary key\"\n        text name \"Canvas name\"\n        jsonb graph \"Visual graph structure\"\n        text canvas_type \"bmc or workflow\"\n        uuid parent_id FK \"Parent canvas for hierarchy\"\n        uuid current_version_id FK \"Latest version\"\n        timestamptz created_at \"Creation timestamp\"\n        timestamptz updated_at \"Last update timestamp\"\n    }\n    \n    %% ========================================================================\n    %% Table: stitch_flow_versions\n    %% Purpose: Immutable snapshots of canvas versions\n    %% ========================================================================\n    stitch_flow_versions {\n        uuid id PK \"Primary key\"\n        uuid flow_id FK \"Parent flow\"\n        jsonb visual_graph \"UI graph with positions\"\n        jsonb execution_graph \"Optimized runtime graph\"\n        text commit_message \"Version description\"\n        timestamptz created_at \"Version creation time\"\n    }\n    \n    %% ========================================================================\n    %% Table: stitch_runs\n    %% Purpose: Tracks workflow execution instances\n    %% ========================================================================\n    stitch_runs {\n        uuid id PK \"Primary key\"\n        uuid flow_id FK \"Flow being executed\"\n        uuid flow_version_id FK \"Specific version executed\"\n        uuid entity_id FK \"Entity triggering run\"\n        jsonb node_states \"Current state of all nodes\"\n        jsonb trigger \"Trigger metadata\"\n        timestamptz created_at \"Run start time\"\n        timestamptz updated_at \"Last state update\"\n    }\n    \n    %% ========================================================================\n    %% Table: stitch_entities\n    %% Purpose: Tracks customers/leads moving through canvas\n    %% ========================================================================\n    stitch_entities {\n        uuid id PK \"Primary key\"\n        uuid canvas_id FK \"Canvas entity belongs to\"\n        text name \"Entity name\"\n        text avatar_url \"Avatar image URL\"\n        text entity_type \"customer, lead, churned\"\n        text current_node_id \"Current node position\"\n        text current_edge_id \"Current edge if traveling\"\n        numeric edge_progress \"Position on edge 0.0-1.0\"\n        jsonb journey \"Journey history array\"\n        jsonb metadata \"Additional entity data\"\n        timestamptz created_at \"Entity creation time\"\n        timestamptz updated_at \"Last position update\"\n    }\n    \n    %% ========================================================================\n    %% Table: stitch_journey_events\n    %% Purpose: Detailed event log of entity movements\n    %% ========================================================================\n    stitch_journey_events {\n        uuid id PK \"Primary key\"\n        uuid entity_id FK \"Entity generating event\"\n        text event_type \"Event type identifier\"\n        text node_id \"Related node if applicable\"\n        text edge_id \"Related edge if applicable\"\n        numeric progress \"Progress value 0.0-1.0\"\n        jsonb metadata \"Event-specific data\"\n        timestamptz timestamp \"Event occurrence time\"\n    }\n    \n    %% ========================================================================\n    %% Table: stitch_webhook_configs\n    %% Purpose: Webhook endpoint configurations\n    %% ========================================================================\n    stitch_webhook_configs {\n        uuid id PK \"Primary key\"\n        uuid canvas_id FK \"Canvas receiving webhooks\"\n        text name \"Config name\"\n        text source \"stripe, typeform, calendly\"\n        text endpoint_slug UK \"Unique URL slug\"\n        text secret \"Webhook signature secret\"\n        uuid workflow_id FK \"Workflow to trigger\"\n        text entry_edge_id \"Edge to inject entity\"\n        jsonb entity_mapping \"Field mapping config\"\n        boolean is_active \"Enable/disable webhook\"\n        timestamptz created_at \"Config creation time\"\n        timestamptz updated_at \"Last config update\"\n    }\n    \n    %% ========================================================================\n    %% Table: stitch_webhook_events\n    %% Purpose: Log of received webhook events\n    %% ========================================================================\n    stitch_webhook_events {\n        uuid id PK \"Primary key\"\n        uuid webhook_config_id FK \"Config that received event\"\n        timestamptz received_at \"Event receipt time\"\n        jsonb payload \"Raw webhook payload\"\n        uuid entity_id FK \"Created entity\"\n        uuid workflow_run_id FK \"Triggered run\"\n        text status \"pending, processed, failed\"\n        text error \"Error message if failed\"\n        timestamptz processed_at \"Processing completion time\"\n    }\n    \n    %% ========================================================================\n    %% Table: stitch_media\n    %% Purpose: Centralized media asset library\n    %% ========================================================================\n    stitch_media {\n        uuid id PK \"Primary key\"\n        text name \"Asset name\"\n        text description \"Asset description\"\n        text media_type \"image, video, audio, etc\"\n        text storage_path \"Storage bucket path\"\n        text url \"Public URL\"\n        text thumbnail_path \"Thumbnail storage path\"\n        text thumbnail_url \"Thumbnail public URL\"\n        integer file_size \"File size in bytes\"\n        text mime_type \"MIME type\"\n        numeric duration_seconds \"Duration for audio/video\"\n        jsonb dimensions \"Width and height\"\n        jsonb metadata \"Additional metadata\"\n        text[] tags \"Searchable tags array\"\n        uuid style_reference_id FK \"Style reference asset\"\n        uuid source_image_id FK \"Source image asset\"\n        uuid user_id FK \"Owner user ID\"\n        timestamptz created_at \"Asset creation time\"\n        timestamptz updated_at \"Last asset update\"\n    }\n",
  "content_size": 7119,
  "collected_at": "2026-02-06T11:02:46.342167",
  "compilation_status": "failed",
  "license": "other_source",
  "license_name": "Other Source (GitHub-based)",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。"
}