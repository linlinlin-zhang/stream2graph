{
  "id": "gh_sequence_00664",
  "source": "github",
  "source_url": "https://github.com/sallim-me/web-server/blob/1ede26a91dbf5d21bb78886efddf0700ee0ae98b/mermaid/chat/chat.mmd",
  "github_repo": "sallim-me/web-server",
  "github_file_path": "mermaid/chat/chat.mmd",
  "diagram_type": "sequence",
  "code": "sequenceDiagram\n    autonumber\n    participant FE_A as 사용자 A (보낸 사람)\n    participant FE_B as 사용자 B (받는 사람)\n    participant SPRING as Spring Boot API\n    participant Kafka as Kafka Broker\n    participant SPRING_Consumer as Spring Boot API (Consumer)\n    participant Redis as Redis (세션 저장소)\n    participant DB as MySQL\n    participant FCM as Firebase FCM\n\n%% 사용자 B 채팅방 입장\n    note over FE_B, DB: 사용자 B가 채팅방에 입장하는 과정\n    FE_B->>SPRING: GET /chat/message\n    SPRING->>DB: 채팅방의 메시지 조회 (roomId, userId(A)로)\n    SPRING-->>FE_B: 채팅방의 메시지 조회 결과 (messageId, content 등)\n    FE_B->>SPRING: WebSocket 연결 (ws://.../chat)\n    SPRING->>Redis: B의 세션 등록 (roomID, userId(B) → sessionId)\n\n%% 사용자 A가 메시지 전송\n    note over FE_A, DB: 사용자 A가 채팅방에서 메시지 전송하는 과정\n    FE_A->>SPRING: POST /chat/message\n    SPRING->>Kafka: kafkaTemplate.send(\"chat-messages\", ChatMessageDto)\n\n%% Kafka consumer 동작\n    note over FE_B, FCM: [처리 시작] Spring Boot Consumer가 Kafka 메시지를 처리하는 과정\n    Kafka-->>SPRING_Consumer: ChatMessageDto 수신\n    SPRING_Consumer->>DB: A의 메시지 저장 (roomId, userId(A)로)\n    SPRING_Consumer->>Redis: B의 세션 조회 (roomId, userId(A)로)\n\n    alt WebSocket 세션 존재\n        SPRING_Consumer->>FE_B: WebSocket 메시지 전송 (\"new_message\", messageId)\n        alt WebSocket 응답 대기 중 (2초 이내)\n        FE_B->>SPRING_Consumer: WebSocket 응답 (\"received\", messageId)\n        note right of SPRING_Consumer: [처리 종료] 사용자 B가 채팅창을 새로고침\n        FE_B->>SPRING: GET /chat/message\n        SPRING->>DB: 채팅방의 메시지 조회 (roomId, userId(A)로)\n        SPRING-->>FE_B: 채팅방의 메시지 조회 결과 (messageId, content 등)\n        else WebSocket 응답 대기 없음\n            SPRING_Consumer->>FCM: FCM 알림 전송 (\"새 메시지 도착\")\n            note left of FCM: [처리 종료] Flutter 앱에 알림 표시\n        end\n    else 세션 없음\n        SPRING_Consumer->>FCM: FCM 알림 전송 (\"새 메시지 도착\") [처리 종료]\n        note left of FCM: [처리 종료] Flutter 앱에 알림 표시\n    end",
  "content_size": 1826,
  "collected_at": "2026-02-06T01:35:22.994967",
  "compilation_status": "success",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0,
  "repo_owner": "sallim-me",
  "repo_name": "web-server",
  "repo_description": "백엔드 레포지토리입니다.",
  "repo_language": "Java",
  "repo_topics": [],
  "repo_created_at": "2025-02-14T16:38:26Z",
  "repo_updated_at": "2025-06-23T06:20:13Z"
}