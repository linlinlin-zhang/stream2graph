{
  "id": "gh_architecture_01608",
  "source": "github",
  "source_url": "https://github.com/cuneytm/SpotifyA2ABuddy/blob/057e3a819b7cd350f9e6fed1e7415f6b5b2e0b29/flowchart.mmd",
  "github_repo": "cuneytm/SpotifyA2ABuddy",
  "github_file_path": "flowchart.mmd",
  "diagram_type": "architecture",
  "code": "flowchart TB\n    subgraph USER[\"ğŸ¤ User Input\"]\n        direction TB\n        MIC[\"Microphone<br/>Browser Audio API\"]\n        VAD[\"Voice Activity Detection<br/>SPEECH_THRESHOLD: 0.02\"]\n    end\n\n    subgraph CLIENT[\"ğŸŒ Browser Client\"]\n        direction TB\n        SDK[\"Spotify Web Playback SDK\"]\n        WS[\"WebSocket Connection\"]\n        AUDIO[\"Audio Playback\"]\n    end\n\n    subgraph SERVER[\"ğŸ–¥ï¸ Node.js Server + A2A Protocol\"]\n        direction TB\n        subgraph BUS[\"ğŸ“¨ MessageBus<br/>Event-Driven Pub/Sub\"]\n            EVENTS[\"Events:<br/>speech:transcribed<br/>spotify:command<br/>response:ready<br/>client:echo_suppress\"]\n        end\n        \n        subgraph A2A[\"ğŸ”— A2A Protocol Handler<br/>Google Agent-to-Agent\"]\n            CARDS[\"Agent Cards<br/>Skills & Capabilities\"]\n            TASKS[\"Task Management<br/>submittedâ†’workingâ†’completed\"]\n            RPC[\"JSON-RPC 2.0<br/>/.well-known/agent.json\"]\n        end\n        \n        subgraph LOGGING[\"ğŸ“ Logging System\"]\n            LOG[\"server.log<br/>A2A Transactions<br/>All Events\"]\n        end\n    end\n\n    subgraph AGENTS[\"ğŸ¤– Multi-Agent System (A2A Enabled)\"]\n        direction TB\n        ORCH[\"ğŸ¯ OrchestratorAgent<br/>Skills: coordinate_agents<br/>manage_sessions, list_agents\"]\n        \n        subgraph SPEECH[\"ğŸ—£ï¸ SpeechAgent\"]\n            STT[\"Speech-to-Text<br/>Skill: transcribe_audio\"]\n            TTS[\"Text-to-Speech<br/>Skill: generate_speech\"]\n            ECHO[\"Echo Suppression\"]\n            NOAUDIO[\"No Audio Timeout<br/>500ms failsafe\"]\n        end\n        \n        CONV[\"ğŸ’¬ ConversationAgent<br/>Skills: parse_intent<br/>generate_response\"]\n        SENT[\"ğŸ˜Š SentimentAgent<br/>Skills: analyze_sentiment<br/>get_mood_history\"]\n        SPOT[\"ğŸµ SpotifyAgent<br/>Skills: play_music, pause_music<br/>skip_next, play_by_mood<br/>+ ensureDeviceActive\"]\n    end\n\n    subgraph OPENAI[\"ğŸ§  OpenAI APIs\"]\n        direction TB\n        WHISPER[\"Whisper API<br/>whisper-1\"]\n        GPT[\"GPT-4o<br/>Function Calling<br/>Intent Classification\"]\n        GPTSENTIMENT[\"GPT-4o<br/>Sentiment Analysis<br/>Enhanced Mood Detection\"]\n        TTSAPI[\"TTS-1-HD API<br/>Voice: nova\"]\n    end\n\n    subgraph SPOTIFY[\"ğŸ§ Spotify Web API\"]\n        direction TB\n        SEARCH[\"Search Tracks\"]\n        PLAY[\"Playback Control\"]\n        QUEUE[\"Queue Management<br/>20-track buffer\"]\n        DEVICES[\"Device Management<br/>Auto-select & Transfer\"]\n    end\n\n    %% User Flow\n    MIC -->|\"Audio Stream\"| VAD\n    VAD -->|\"Speech Detected\"| WS\n    \n    %% Client-Server\n    WS <-->|\"WebSocket\"| BUS\n    SDK <-->|\"Device ID\"| SERVER\n    \n    %% A2A Protocol Integration\n    A2A <--> BUS\n    A2A <--> ORCH\n    CARDS -.->|\"Register\"| AGENTS\n    \n    %% Logging\n    BUS -->|\"All Events\"| LOG\n    A2A -->|\"A2A Transactions\"| LOG\n    \n    %% MessageBus to Agents\n    BUS --> ORCH\n    BUS <--> SPEECH\n    BUS <--> CONV\n    BUS <--> SENT\n    BUS <--> SPOT\n    \n    %% Speech Agent Flow\n    STT -->|\"audio:received\"| WHISPER\n    WHISPER -->|\"transcription\"| STT\n    STT -->|\"speech:transcribed\"| BUS\n    NOAUDIO -->|\"Process on timeout\"| STT\n    \n    %% Conversation Agent Flow\n    CONV -->|\"Function Calling\"| GPT\n    GPT -->|\"Tool result\"| CONV\n    \n    %% Sentiment Agent Flow\n    SENT -->|\"mood analysis\"| GPTSENTIMENT\n    GPTSENTIMENT -->|\"sentiment + energy_level\"| SENT\n    \n    %% Spotify Agent Flow\n    SPOT -->|\"search/play/next\"| SPOTIFY\n    SPOTIFY -->|\"track info\"| SPOT\n    SPOT -->|\"ensureDeviceActive\"| DEVICES\n    \n    %% TTS Flow\n    TTS -->|\"text\"| TTSAPI\n    TTSAPI -->|\"HD audio\"| TTS\n    TTS -->|\"client:audio\"| WS\n    WS -->|\"Play Audio\"| AUDIO\n    \n    %% Echo Suppression\n    ECHO -->|\"client:echo_suppress\"| WS\n\n    %% Styling\n    classDef userStyle fill:#e1f5fe,stroke:#01579b\n    classDef clientStyle fill:#f3e5f5,stroke:#4a148c\n    classDef serverStyle fill:#e8f5e9,stroke:#1b5e20\n    classDef agentStyle fill:#fff3e0,stroke:#e65100\n    classDef openaiStyle fill:#fce4ec,stroke:#880e4f\n    classDef spotifyStyle fill:#e8f5e9,stroke:#1db954\n    classDef a2aStyle fill:#e3f2fd,stroke:#1565c0\n",
  "content_size": 4039,
  "collected_at": "2026-02-06T01:48:31.032187",
  "license": "none",
  "license_name": "No License",
  "compilation_status": "success",
  "compilation_error": "[WinError 2] ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶ã€‚",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0
}