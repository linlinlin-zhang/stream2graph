{
  "id": "gh_sequence_00521",
  "source": "github",
  "source_url": "https://github.com/comsa33/porfolio-site/blob/c73cbe20f09305f1683bb39a5801ae130d98c492/public/architecture/pyeditor/lsp-websocket-flow.mmd",
  "github_repo": "comsa33/porfolio-site",
  "github_file_path": "public/architecture/pyeditor/lsp-websocket-flow.mmd",
  "diagram_type": "sequence",
  "code": "sequenceDiagram\n    participant Client as 브라우저<br/>Monaco Editor\n    participant WS as WebSocket<br/>Server\n    participant Pool as LSP Process<br/>Pool\n    participant LSP as Python LSP<br/>Process\n    participant FileWatch as File Watch<br/>Service\n    participant GitWatch as Git Watch<br/>Service\n    participant Cache as LSP Cache<br/>Manager\n    \n    Note over Client,Cache: 연결 단계\n    Client->>WS: WebSocket 연결<br/>?folder=workspace\n    WS->>Pool: 프로세스 요청<br/>getOrCreateProcess(userId)\n    Pool->>LSP: 유휴 프로세스 할당<br/>또는 새 프로세스 생성\n    LSP-->>Pool: 프로세스 준비 완료\n    Pool-->>WS: pylsp 인스턴스\n    WS->>FileWatch: 클라이언트 등록<br/>registerClient(basePath, ws)\n    WS->>GitWatch: 클라이언트 등록<br/>registerClient(agentId, ws)\n    WS->>Cache: 연결 등록<br/>registerConnection(userId)\n    WS-->>Client: userId 전송\n    \n    Note over Client,Cache: LSP 요청/응답\n    Client->>WS: LSP 요청<br/>textDocument/completion\n    WS->>LSP: LSP 메시지 전달\n    LSP->>LSP: 자동완성 계산\n    LSP-->>WS: LSP 응답\n    WS->>Cache: 결과 캐싱<br/>cacheResponse(method, params)\n    WS-->>Client: 자동완성 목록\n    \n    Note over Client,Cache: 파일 변경 감지\n    FileWatch->>FileWatch: 파일 변경 감지<br/>chokidar\n    FileWatch->>Cache: 캐시 무효화<br/>invalidate(filePath)\n    FileWatch-->>Client: 파일 변경 알림<br/>fileChanged event\n    \n    Note over Client,Cache: Git 동기화\n    GitWatch->>GitWatch: HEAD 변경 감지<br/>외부 커밋\n    GitWatch-->>Client: Git 변경 알림<br/>gitChanged event\n    Client->>Client: 파일 다시 로드\n    \n    Note over Client,Cache: 연결 종료\n    Client->>WS: WebSocket 종료\n    WS->>Pool: 프로세스 반환<br/>releaseProcess(userId)\n    Pool->>LSP: 유휴 상태로 전환<br/>5분 후 자동 종료\n    WS->>FileWatch: 클라이언트 제거\n    WS->>GitWatch: 클라이언트 제거\n    WS->>Cache: 연결 해제<br/>unregisterConnection(userId)\n",
  "content_size": 1688,
  "collected_at": "2026-02-06T01:33:25.308377",
  "compilation_status": "success",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 1,
  "repo_forks": 0,
  "repo_owner": "comsa33",
  "repo_name": "porfolio-site",
  "repo_description": "포트폴리오 사이트",
  "repo_language": "TypeScript",
  "repo_topics": [],
  "repo_created_at": "2025-12-13T13:44:58Z",
  "repo_updated_at": "2026-01-31T13:33:35Z"
}