{
  "id": "gh_architecture_01515",
  "source": "github",
  "source_url": "https://github.com/jdlam/timesync/blob/ab3f96f78e6f075048c5ac2af1974ebf26ec68c5/.ai/diagrams/architecture.mmd",
  "github_repo": "jdlam/timesync",
  "github_file_path": ".ai/diagrams/architecture.mmd",
  "diagram_type": "architecture",
  "code": "flowchart TB\n    subgraph \"Routes & Pages\"\n        Landing[\"/ Landing Page\"]\n        CreateEvent[\"/events/create\"]\n        PublicEvent[\"/events/$eventId\"]\n        EditResponse[\"/events/$eventId/edit/$editToken\"]\n        AdminEvent[\"/events/$eventId/admin/$adminToken\"]\n        MyEvents[\"/my-events\"]\n        MyEventDetail[\"/my-events/$eventId\"]\n        Pricing[\"/pricing\"]\n\n        subgraph \"Super Admin Routes\"\n            AdminIndex[\"/admin\"]\n            AdminDash[\"/admin/dashboard\"]\n            AdminEvents[\"/admin/events\"]\n            AdminEventDetail[\"/admin/events/$eventId\"]\n            AdminResponses[\"/admin/responses\"]\n            AdminLogs[\"/admin/logs\"]\n        end\n    end\n\n    subgraph \"Authentication Layer\"\n        Clerk[\"Clerk Auth\"]\n        SuperAdminCheck[\"SUPER_ADMIN_EMAILS Check\"]\n        TokenAuth[\"Token-Based Auth\\n(adminToken / editToken)\"]\n    end\n\n    subgraph \"Convex Queries\"\n        Q_getById[\"events.getById\"]\n        Q_getByIdWithCount[\"events.getByIdWithResponseCount\"]\n        Q_getByAdminToken[\"events.getByAdminToken\"]\n        Q_getResponsesByEvent[\"responses.getByEventId\"]\n        Q_getByEditToken[\"responses.getByEditToken\"]\n        Q_getMyEvents[\"myEvents.getMyEvents\"]\n        Q_getMyEventById[\"myEvents.getMyEventById\"]\n        Q_checkAccess[\"admin.checkAccess\"]\n        Q_getStats[\"admin.getStats\"]\n        Q_getAllEvents[\"admin.getAllEvents\"]\n        Q_getAllResponses[\"admin.getAllResponses\"]\n        Q_getAuditLogs[\"admin.getAuditLogs\"]\n        Q_getUserSubscription[\"users.getCurrentUserSubscription\"]\n    end\n\n    subgraph \"Convex Mutations\"\n        M_createEvent[\"events.create\"]\n        M_updateEvent[\"events.update\"]\n        M_submitResponse[\"responses.submit\"]\n        M_updateResponse[\"responses.update\"]\n        M_removeResponse[\"responses.remove\"]\n        M_toggleMyEvent[\"myEvents.toggleMyEventStatus\"]\n        M_deleteMyEvent[\"myEvents.deleteMyEvent\"]\n        M_toggleEventStatus[\"admin.toggleEventStatus\"]\n        M_deleteEvent[\"admin.deleteEvent\"]\n        M_deleteResponse[\"admin.deleteResponse\"]\n        M_getOrCreateUser[\"users.getOrCreateUser\"]\n    end\n\n    subgraph \"Database Tables\"\n        DB_users[(\"users\\n- clerkId\\n- email\\n- subscriptionTier\\n- stripeCustomerId\")]\n        DB_events[(\"events\\n- adminToken\\n- title, dates\\n- timeRange, slotDuration\\n- maxRespondents\\n- creatorId, isActive\")]\n        DB_responses[(\"responses\\n- eventId\\n- respondentName\\n- selectedSlots\\n- editToken\")]\n        DB_audit[(\"auditLogs\\n- userId, action\\n- targetType, targetId\")]\n    end\n\n    subgraph \"Key Components\"\n        AvailGrid[\"AvailabilityGrid\\n(slot selection)\"]\n        HeatmapGrid[\"HeatmapGrid\\n(visualization)\"]\n        ResponsesList[\"ResponsesList\"]\n        EventForm[\"EventForm\"]\n    end\n\n    subgraph \"Utilities\"\n        TimeUtils[\"time-utils\\n- generateTimeSlots\\n- formatTimeSlot\"]\n        HeatmapUtils[\"heatmap-utils\\n- calculateHeatmap\\n- getHeatmapColor\\n- getBestTimeSlots\"]\n        TokenUtils[\"token-utils\\n- generateAdminToken\\n- generateEditToken\"]\n    end\n\n    %% Landing Page Flow\n    Landing -->|\"Navigate\"| CreateEvent\n    Landing -->|\"Navigate\"| Pricing\n\n    %% Event Creation Flow\n    CreateEvent --> EventForm\n    EventForm -->|\"Optional\"| Clerk\n    Clerk -->|\"Sync user\"| M_getOrCreateUser\n    M_getOrCreateUser --> DB_users\n    EventForm --> TokenUtils\n    EventForm -->|\"Submit\"| M_createEvent\n    M_createEvent -->|\"Check tier\"| Q_getUserSubscription\n    Q_getUserSubscription --> DB_users\n    M_createEvent --> DB_events\n\n    %% Public Event Flow\n    PublicEvent --> Q_getByIdWithCount\n    Q_getByIdWithCount --> DB_events\n    PublicEvent --> AvailGrid\n    AvailGrid --> TimeUtils\n    PublicEvent -->|\"Submit\"| M_submitResponse\n    M_submitResponse -->|\"Check limit\"| DB_events\n    M_submitResponse --> DB_responses\n\n    %% Edit Response Flow\n    EditResponse --> Q_getByEditToken\n    Q_getByEditToken --> DB_responses\n    EditResponse --> AvailGrid\n    EditResponse -->|\"Update\"| M_updateResponse\n    M_updateResponse --> DB_responses\n\n    %% Event Admin Flow\n    AdminEvent --> TokenAuth\n    TokenAuth --> Q_getByAdminToken\n    Q_getByAdminToken --> DB_events\n    AdminEvent --> Q_getResponsesByEvent\n    Q_getResponsesByEvent --> DB_responses\n    AdminEvent --> HeatmapGrid\n    HeatmapGrid --> HeatmapUtils\n    HeatmapGrid --> TimeUtils\n    AdminEvent --> ResponsesList\n    AdminEvent -->|\"Delete\"| M_removeResponse\n    M_removeResponse --> DB_responses\n    AdminEvent -->|\"Update\"| M_updateEvent\n    M_updateEvent --> DB_events\n\n    %% My Events Flow (Authenticated)\n    MyEvents --> Clerk\n    Clerk --> Q_getMyEvents\n    Q_getMyEvents --> DB_events\n    MyEventDetail --> Q_getMyEventById\n    Q_getMyEventById --> DB_events\n    MyEventDetail -->|\"Toggle\"| M_toggleMyEvent\n    M_toggleMyEvent --> DB_events\n    MyEventDetail -->|\"Delete\"| M_deleteMyEvent\n    M_deleteMyEvent --> DB_events\n    M_deleteMyEvent --> DB_responses\n\n    %% Super Admin Flow\n    AdminIndex --> Clerk\n    Clerk --> SuperAdminCheck\n    SuperAdminCheck --> Q_checkAccess\n    Q_checkAccess --> DB_users\n    AdminDash --> Q_getStats\n    Q_getStats --> DB_events\n    Q_getStats --> DB_responses\n    AdminEvents --> Q_getAllEvents\n    Q_getAllEvents --> DB_events\n    AdminEventDetail --> Q_getByIdWithCount\n    AdminResponses --> Q_getAllResponses\n    Q_getAllResponses --> DB_responses\n    AdminLogs --> Q_getAuditLogs\n    Q_getAuditLogs --> DB_audit\n\n    %% Admin Mutations\n    AdminEvents -->|\"Toggle\"| M_toggleEventStatus\n    M_toggleEventStatus --> DB_events\n    M_toggleEventStatus --> DB_audit\n    AdminEvents -->|\"Delete\"| M_deleteEvent\n    M_deleteEvent --> DB_events\n    M_deleteEvent --> DB_responses\n    M_deleteEvent --> DB_audit\n    AdminResponses -->|\"Delete\"| M_deleteResponse\n    M_deleteResponse --> DB_responses\n    M_deleteResponse --> DB_audit\n",
  "content_size": 5831,
  "collected_at": "2026-02-06T01:47:15.728944",
  "license": "none",
  "license_name": "No License",
  "compilation_status": "success",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0
}