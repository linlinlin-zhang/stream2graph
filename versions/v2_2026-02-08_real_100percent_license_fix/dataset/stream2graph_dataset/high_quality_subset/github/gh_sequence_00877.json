{
  "id": "gh_sequence_00877",
  "source": "github",
  "source_url": "https://github.com/MyoMyatAung/nestjs-graphql-course/blob/10b585e41234ca0668caf316b19a908eccd83454/docs/auth-flow.mmd",
  "github_repo": "MyoMyatAung/nestjs-graphql-course",
  "github_file_path": "docs/auth-flow.mmd",
  "diagram_type": "sequence",
  "code": "%% Authentication flow (Mermaid sequence diagram)\n%% File: docs/auth-flow.mmd\nsequenceDiagram\n  participant Client\n  participant GraphQL as GraphQL Server\n  participant GqlJwtGuard as GqlJwtGuard\n  participant Passport as Passport(jwt)\n  participant JwtStrategy as JwtStrategy\n  participant AuthService as AuthService\n  participant DB as Database\n  participant Resolver\n\n  Note over Client,AuthService: Sign-in / Issue token\n  Client->>GraphQL: mutation signIn(email,password)\n  GraphQL->>AuthService: AuthResolver.signIn -> verify password (argon2)\n  AuthService->>AuthService: jwtService.sign({ sub: { userId } })\n  AuthService-->>Client: AuthPayload { accessToken, userId, role }\n\n  Note over Client,Resolver: Protected request using token\n  Client->>GraphQL: Query/Mutation with header Authorization: Bearer <token>\n  GraphQL->>GqlJwtGuard: guard invoked (@UseGuards(GqlJwtGuard))\n  GqlJwtGuard->>GqlJwtGuard: getRequest(context) -> return req\n  GqlJwtGuard->>Passport: delegate to AuthGuard('jwt')\n\n  Passport->>Passport: Extract token from header\n  Passport->>Passport: Verify signature & expiry (secret)\n  Passport->>JwtStrategy: call validate(decodedPayload)\n\n  JwtStrategy->>AuthService: validate(payload) -> validateJwtUser(userId)\n  AuthService->>DB: find user by id\n  DB-->>AuthService: user entity\n  AuthService-->>JwtStrategy: JwtUser { userId, role }\n  JwtStrategy-->>Passport: return JwtUser -> attached to req.user\n\n  Passport-->>Resolver: allow request to continue\n  Resolver->>Resolver: @CurrentUser() reads req.user\n  Resolver-->>Client: GraphQL response\n\n  Note over Passport,Client: Failure modes\n  Passport->>Client: Unauthorized (missing/invalid/expired)\n  JwtStrategy->>Client: Unauthorized (user not found/disabled)\n",
  "content_size": 1742,
  "collected_at": "2026-02-06T01:50:13.827879",
  "compilation_status": "success",
  "license": "none",
  "license_name": "No License",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0,
  "repo_owner": "MyoMyatAung",
  "repo_name": "nestjs-graphql-course",
  "repo_description": "NestJS GraphQL Course",
  "repo_language": "TypeScript",
  "repo_topics": [],
  "repo_created_at": "2025-11-12T05:18:46Z",
  "repo_updated_at": "2025-11-12T11:44:37Z"
}