{
  "id": "gh_architecture_01470",
  "source": "github",
  "source_url": "https://github.com/sdodlapati3/BioPipelines/blob/7bb603ade88cc7f3f8800fb72a7201db77b3b939/docs/diagrams/unified_agent_flow.mmd",
  "github_repo": "sdodlapati3/BioPipelines",
  "github_file_path": "docs/diagrams/unified_agent_flow.mmd",
  "diagram_type": "architecture",
  "code": "%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#4a90d9'}}}%%\n\nflowchart TB\n    START([ğŸ¯ User Query]) --> CLASSIFY\n\n    subgraph CLASSIFICATION[\"1ï¸âƒ£ Task Classification\"]\n        CLASSIFY[\"classify_task(query)\"]\n        CLASSIFY --> TASK_TYPE{\"Task Type?\"}\n        \n        TASK_TYPE -->|workflow| TT_WF[\"WORKFLOW<br/>generate, pipeline, RNA-seq...\"]\n        TASK_TYPE -->|diagnosis| TT_DIAG[\"DIAGNOSIS<br/>error, fail, debug...\"]\n        TASK_TYPE -->|data| TT_DATA[\"DATA<br/>scan, search, download...\"]\n        TASK_TYPE -->|job| TT_JOB[\"JOB<br/>submit, status, cancel...\"]\n        TASK_TYPE -->|education| TT_EDU[\"EDUCATION<br/>explain, what is, help...\"]\n        TASK_TYPE -->|system| TT_SYS[\"SYSTEM<br/>health, vllm, restart...\"]\n        TASK_TYPE -->|general| TT_GEN[\"GENERAL<br/>other queries\"]\n    end\n\n    TT_WF & TT_DIAG & TT_DATA & TT_JOB & TT_EDU & TT_SYS & TT_GEN --> DETECT\n\n    subgraph DETECTION[\"2ï¸âƒ£ Tool Detection\"]\n        DETECT[\"tools.detect_tool(query)\"]\n        DETECT --> TOOL_FOUND{\"Tool<br/>Detected?\"}\n        \n        TOOL_FOUND -->|Yes| SPECIFIC[\"Specific Tool<br/>e.g., GENERATE_WORKFLOW\"]\n        TOOL_FOUND -->|No| GENERAL_HANDLER[\"General Handler<br/>Route by TaskType\"]\n    end\n\n    SPECIFIC --> PERM_CHECK\n    GENERAL_HANDLER --> DEFAULT_TOOL[\"Select Default Tool<br/>for TaskType\"]\n    DEFAULT_TOOL --> PERM_CHECK\n\n    subgraph PERMISSION[\"3ï¸âƒ£ Permission Check\"]\n        PERM_CHECK[\"check_tool_permission(tool)\"]\n        PERM_CHECK --> PERM_MAP[\"Map Tool â†’ Permission<br/>read/write/execute/delete\"]\n        PERM_MAP --> LEVEL_CHECK{\"Allowed at<br/>Current Level?\"}\n        \n        LEVEL_CHECK -->|Denied| PERM_DENIED[\"âŒ Permission Denied<br/>Return Error Response\"]\n        LEVEL_CHECK -->|Needs Approval| APPROVAL[\"ğŸ”” Request Approval<br/>NEEDS_APPROVAL response\"]\n        LEVEL_CHECK -->|Allowed| EXTRACT\n    end\n\n    PERM_DENIED --> RESPONSE\n    APPROVAL --> RESPONSE\n\n    subgraph EXECUTION[\"4ï¸âƒ£ Tool Execution\"]\n        EXTRACT[\"_extract_parameters(query, tool)\"]\n        EXTRACT --> EXEC[\"execute_tool(tool, **params)\"]\n        \n        EXEC --> AUDIT_LOG[\"ğŸ“ AuditLogger<br/>log_tool_call()\"]\n        AUDIT_LOG --> TOOL_HANDLER[\"Tool Handler<br/>Actual Implementation\"]\n        TOOL_HANDLER --> RESULT[\"ToolResult<br/>success/error + data\"]\n        RESULT --> AUDIT_RESULT[\"ğŸ“ AuditLogger<br/>log_tool_result()\"]\n    end\n\n    AUDIT_RESULT --> BUILD\n\n    subgraph RESPONSE_BUILD[\"5ï¸âƒ£ Response Building\"]\n        BUILD[\"_build_response()\"]\n        BUILD --> COMBINE[\"Combine:<br/>â€¢ Messages<br/>â€¢ Data<br/>â€¢ Suggestions\"]\n        COMBINE --> AGENT_RESP[\"AgentResponse<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>success: bool<br/>message: str<br/>task_type: TaskType<br/>tool_executions: list<br/>data: dict<br/>suggestions: list\"]\n    end\n\n    AGENT_RESP --> HISTORY[\"Save to _history\"]\n    HISTORY --> RESPONSE([ğŸ“¤ Return AgentResponse])\n\n    %% Styling\n    classDef startEnd fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px\n    classDef process fill:#e3f2fd,stroke:#1976d2,stroke-width:2px\n    classDef decision fill:#fff3e0,stroke:#f57c00,stroke-width:2px\n    classDef error fill:#ffcdd2,stroke:#c62828,stroke-width:2px\n    classDef approval fill:#fff9c4,stroke:#f9a825,stroke-width:2px\n\n    class START,RESPONSE startEnd\n    class CLASSIFY,DETECT,PERM_CHECK,EXTRACT,EXEC,BUILD process\n    class TASK_TYPE,TOOL_FOUND,LEVEL_CHECK decision\n    class PERM_DENIED error\n    class APPROVAL approval\n",
  "content_size": 3428,
  "collected_at": "2026-02-06T01:46:38.777602",
  "license": "mit",
  "license_name": "MIT License",
  "compilation_status": "success",
  "compilation_error": "[WinError 2] ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„æ–‡ä»¶ã€‚",
  "license_url": "https://api.github.com/licenses/mit",
  "repo_stars": 0,
  "repo_forks": 0
}