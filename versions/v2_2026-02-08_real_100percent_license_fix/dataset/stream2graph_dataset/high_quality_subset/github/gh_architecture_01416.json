{
  "id": "gh_architecture_01416",
  "source": "github",
  "source_url": "https://github.com/ErnieAtLYD/miami-theater-voice-agent/blob/29c51f66355731d89e184a46f6d5c969217f5661/diagrams/data-structure-redis.mmd",
  "github_repo": "ErnieAtLYD/miami-theater-voice-agent",
  "github_file_path": "diagrams/data-structure-redis.mmd",
  "diagram_type": "architecture",
  "code": "graph TB\n    %% Redis Database Structure\n    subgraph Redis[\"Upstash Redis Storage\"]\n        %% Showtimes Keys\n        subgraph ShowtimesData[\"Showtimes Data\"]\n            CurrentKey[\"Key: showtimes:current<br/>Type: String (JSON)<br/>TTL: 7200s (2 hours)\"]\n            UpdateKey[\"Key: showtimes:last_updated<br/>Type: String<br/>Value: ISO timestamp\"]\n        end\n\n        %% Voicemail Keys\n        subgraph VoicemailData[\"Voicemail Data\"]\n            IndexKey[\"Key: voicemails:index<br/>Type: Sorted Set (ZSET)<br/>Score: Unix timestamp<br/>Members: RecordingSids\"]\n            VoicemailKeys[\"Keys: voicemail:{RecordingSid}<br/>Type: String (JSON)<br/>One per voicemail<br/>No TTL (persistent)\"]\n        end\n    end\n\n    %% Showtimes Data Structure\n    subgraph ShowtimesJSON[\"showtimes:current JSON Structure\"]\n        Movies[\"movies: Array<br/>- Complete list of all movies<br/>- Each with showtimes array\"]\n        ByDate[\"by_date: Object<br/>- Keys: YYYY-MM-DD<br/>- Values: Movies for that date\"]\n        Weekend[\"weekend: Array<br/>- Pre-filtered Fri/Sat/Sun<br/>- Next weekend's movies\"]\n        Upcoming[\"upcoming: Array<br/>- Next 7 days<br/>- All upcoming movies\"]\n\n        MovieDetail[\"Movie Object:<br/>{<br/>  title: string,<br/>  rating: string,<br/>  runtime: number,<br/>  format: string,<br/>  showtimes: [{<br/>    date: YYYY-MM-DD,<br/>    time: HH:MM AM/PM,<br/>    theater: string,<br/>    summary: string<br/>  }]<br/>}\"]\n    end\n\n    %% Voicemail Data Structure\n    subgraph VoicemailJSON[\"voicemail:{RecordingSid} JSON Structure\"]\n        VMFields[\"Voicemail Object:<br/>{<br/>  id: RecordingSid,<br/>  recordingUrl: string,<br/>  duration: number (seconds),<br/>  from: phone number,<br/>  to: phone number,<br/>  callSid: string,<br/>  transcription: string | null,<br/>  transcriptionStatus: string,<br/>  createdAt: ISO timestamp,<br/>  listened: boolean<br/>}\"]\n    end\n\n    %% Index Structure\n    subgraph IndexStructure[\"voicemails:index ZSET Structure\"]\n        ZSetExample[\"Sorted Set (newest first):<br/><br/>Score: 1704067200 → Member: RE123abc<br/>Score: 1704063600 → Member: RE456def<br/>Score: 1704060000 → Member: RE789ghi<br/><br/>Commands:<br/>ZREVRANGE voicemails:index 0 -1<br/>(Returns newest to oldest)\"]\n    end\n\n    %% Data Operations\n    subgraph Operations[\"Common Redis Operations\"]\n        Write[\"Write Operations:<br/><br/>Showtimes:<br/>SETEX showtimes:current 7200 {JSON}<br/>SET showtimes:last_updated {timestamp}<br/><br/>Voicemail:<br/>ZADD voicemails:index {timestamp} {RecordingSid}<br/>SET voicemail:{RecordingSid} {JSON}\"]\n\n        Read[\"Read Operations:<br/><br/>Showtimes:<br/>GET showtimes:current<br/>GET showtimes:last_updated<br/><br/>Voicemail:<br/>ZREVRANGE voicemails:index 0 -1<br/>GET voicemail:{RecordingSid}<br/>ZCARD voicemails:index (count)\"]\n\n        Update[\"Update Operations:<br/><br/>Showtimes:<br/>Auto-expire via TTL<br/>Overwrite on next cron run<br/><br/>Voicemail:<br/>GET → Modify → SET<br/>(for transcription updates,<br/>listened status)\"]\n    end\n\n    %% Example Data\n    subgraph Examples[\"Example Data\"]\n        ShowtimeExample[\"Example Showtime:<br/>{<br/>  'title': 'The Substance',<br/>  'rating': 'R',<br/>  'runtime': 140,<br/>  'format': 'IMAX, 3D',<br/>  'showtimes': [{<br/>    'date': '2024-01-15',<br/>    'time': '7:30 PM',<br/>    'theater': 'O Cinema South Beach',<br/>    'summary': 'The Substance is showing<br/>              on Monday, January 15th<br/>              at 7:30 PM in O Cinema<br/>              South Beach'<br/>  }]<br/>}\"]\n\n        VoicemailExample[\"Example Voicemail:<br/>{<br/>  'id': 'RExxxxxxxxxxxxx',<br/>  'recordingUrl': 'https://api.twilio.com/...',<br/>  'duration': 45,<br/>  'from': '+13051234567',<br/>  'to': '+13057654321',<br/>  'callSid': 'CAxxxxxxxxxxxxx',<br/>  'transcription': 'Hello, I would like<br/>                   to inquire about...',<br/>  'transcriptionStatus': 'completed',<br/>  'createdAt': '2024-01-15T19:30:00Z',<br/>  'listened': false<br/>}\"]\n    end\n\n    %% Connections\n    CurrentKey --> Movies\n    CurrentKey --> ByDate\n    CurrentKey --> Weekend\n    CurrentKey --> Upcoming\n\n    Movies --> MovieDetail\n    ByDate --> MovieDetail\n    Weekend --> MovieDetail\n    Upcoming --> MovieDetail\n\n    VoicemailKeys --> VMFields\n    IndexKey --> ZSetExample\n\n    %% Operation Connections\n    Write -.-> CurrentKey\n    Write -.-> UpdateKey\n    Write -.-> IndexKey\n    Write -.-> VoicemailKeys\n\n    Read -.-> CurrentKey\n    Read -.-> IndexKey\n    Read -.-> VoicemailKeys\n\n    Update -.-> CurrentKey\n    Update -.-> VoicemailKeys\n\n    %% Examples\n    MovieDetail -.-> ShowtimeExample\n    VMFields -.-> VoicemailExample\n\n    %% Styling\n    classDef storage fill:#f3e5f5,stroke:#4a148c,stroke-width:2px\n    classDef structure fill:#e1f5ff,stroke:#01579b,stroke-width:2px\n    classDef operation fill:#fff3e0,stroke:#e65100,stroke-width:2px\n    classDef example fill:#e8f5e9,stroke:#1b5e20,stroke-width:2px\n\n    class Redis,ShowtimesData,VoicemailData storage\n    class ShowtimesJSON,VoicemailJSON,IndexStructure,CurrentKey,UpdateKey,IndexKey,VoicemailKeys,Movies,ByDate,Weekend,Upcoming,MovieDetail,VMFields,ZSetExample structure\n    class Operations,Write,Read,Update operation\n    class Examples,ShowtimeExample,VoicemailExample example\n",
  "content_size": 5287,
  "collected_at": "2026-02-06T01:45:57.511904",
  "license": "none",
  "license_name": "No License",
  "compilation_status": "success",
  "compilation_error": "[WinError 2] 系统找不到指定的文件。",
  "license_url": "",
  "repo_stars": 0,
  "repo_forks": 0
}