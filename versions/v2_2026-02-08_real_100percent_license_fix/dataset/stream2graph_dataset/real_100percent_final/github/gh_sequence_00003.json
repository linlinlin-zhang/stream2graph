{
  "id": "gh_sequence_00003",
  "source": "github",
  "source_url": "https://github.com/I2A2-ai-atividade-coletiva/MultiAgents_RH_VRVA/blob/aa031b526a411aee29fef3990864d406d3123b11/docs/architecture.mmd",
  "github_repo": "I2A2-ai-atividade-coletiva/MultiAgents_RH_VRVA",
  "github_file_path": "docs/architecture.mmd",
  "diagram_type": "sequence",
  "code": "%% Architecture diagrams for MultiAgents_RH_VRVA\n%% All documentation is in English as per project rules.\n\n%% ---------------------------------------------\n%% 1) Data Flow (Ingestion, Persistence, Processing)\n%% ---------------------------------------------\nflowchart LR\n  %% Inputs\n  subgraph Inputs\n    A1[CCT PDFs\\nbase_conhecimento/ccts_pdfs/]\n    A2[CSV/XLSX\\ndados_entrada/]\n  end\n\n  %% Ingestion & Tools\n  subgraph Ingestion\n    I1[ingest_ccts.py\\nDocling → Text → OCR]\n    T1[ferramentas/extracao_cct_docling.py]\n  end\n\n  %% Persistence\n  subgraph Persistence\n    DB[(SQLite\\nbase_conhecimento/automacao_rh.db)]\n    CH[[ChromaDB\\nbase_conhecimento/chromadb/]]\n    F_CCT[[FAISS CCTs\\nbase_conhecimento/faiss_ccts/]]\n    F_TAB[[FAISS Tables\\nbase_conhecimento/faiss_tabelas/]]\n    RJSON[rules_index.json]\n  end\n\n  %% Processing\n  subgraph Processing\n    CALC[ferramentas/calculadora_beneficios.py]\n    REPORT[ferramentas/gerador_relatorio.py]\n  end\n\n  %% Outputs\n  subgraph Outputs\n    OUT1[relatorios_saida/\\nXLSX/CSV/JSON]\n  end\n\n  %% Data flow\n  A1 --> I1\n  I1 --> DB\n  I1 --> CH\n  I1 --> RJSON\n  A2 --> F_TAB\n  CH --> F_CCT\n  DB --> CALC\n  F_CCT --> CALC\n  CALC --> REPORT\n  REPORT --> OUT1\n\n%% ---------------------------------------------\n%% 2) Agents Communication (Sequence)\n%% ---------------------------------------------\nsequenceDiagram\n  autonumber\n  participant UI as Streamlit UI\n  participant ORQ as Orchestrator (main.py)\n  participant D as Data Agent\n  participant COL as CCT Collector\n  participant ANA as CCT Analyst\n  participant CAL as Calc Specialist\n  participant CMP as Compliance\n  participant TOOLS as Tools (ferramentas/*.py)\n  participant DB as SQLite/Indexes\n\n  UI->>ORQ: Start monthly run / request\n  ORQ->>D: Validate/load base tables\n  D-->>DB: Persist/load datasets\n  ORQ->>COL: Consolidate CCT rules (rules_index.json → DB)\n  COL-->>DB: Upsert regras_cct/resumo\n  ORQ->>ANA: Query CCTs (when needed)\n  ANA-->>DB: Retrieve from FAISS/Chroma\n  ORQ->>CAL: Execute deterministic calculation\n  CAL->>TOOLS: Use calculadora_beneficios.py\n  TOOLS-->>DB: Read/write intermediates\n  ORQ->>CMP: Produce observations\n  CMP-->>DB: Save compliance notes\n  ORQ->>TOOLS: Generate final report\n  TOOLS-->>UI: Make file(s) available in relatorios_saida/\n\n%% ---------------------------------------------\n%% 3) Visual Flow (UI Pages)\n%% ---------------------------------------------\nflowchart TB\n  subgraph Sidebar\n    SB1[LLM Provider/Model/Temp]\n  end\n\n  subgraph UI[Streamlit Pages]\n    P0[0 - Mês Competência\\nSet window (YYYY-MM, day range)]\n    P1[1 - Importar Relatórios Base\\nUpload CSV/XLSX, SQLite load]\n    P2[2 - Importar CCTs\\nUpload PDFs, Ingest]\n    P22[2.2 - Chat com CCTs\\nBuild/Use FAISS CCTs]\n    P3[3 - Validação de Regras CCT\\nRegister Overrides]\n    P4[4 - Cadastro de Feriados\\nManage holidays by UF]\n    P5[5 - Prompts\\nEdit prompts/*.md]\n    P7[7 - Dados Finais\\nRun calc, DB viewer, Data Chat]\n  end\n\n  SB1 --- P22\n  SB1 --- P7\n\n  P0 --> P7\n  P1 --> P7\n  P2 --> P22\n  P2 --> P3\n  P22 --> P7\n  P3 --> P7\n  P4 --> P7\n  P5 --> P7\n\n  P7 -->|Generate| OUT[relatorios_saida/]\n",
  "content_size": 3118,
  "collected_at": "2026-02-06T01:23:55.458276"
}